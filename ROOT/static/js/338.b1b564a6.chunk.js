"use strict";(self.webpackChunkmobileInsurance=self.webpackChunkmobileInsurance||[]).push([[338],{93338:function(e,t,n){n.r(t),n.d(t,{default:function(){return I}});var a=n(89062),i=n(93324),c=n(72791),s=n(87056),l=n(45987),r=n(763),o=n.n(r),d=n(80184),u=["isModal","containerRef"],m=function(e){var t=e.isModal,n=void 0!==t&&t,a=e.containerRef,s=(0,l.Z)(e,u),o=(0,c.useState)(!1),m=(0,i.Z)(o,2),g=m[0],f=m[1];return(0,c.useEffect)((function(){if(n){var e=function(e){for(var t=a.current,n=t.scrollTop,i=t.scrollHeight,c=t.clientHeight,l=document.getElementsByClassName("pdfCard"),o=0;o<l.length;o++){var d=l.item(o),u=d?d.getBoundingClientRect().y:0,m=d?d.clientHeight:0;if((0,r.round)(u)<=148&&(0,r.round)(u)>=148-m){s.setActivePage(o+1);var g=document.getElementById("pageItem-"+(o+1));null!==g&&void 0!==g&&g.classList.contains("editItem")||null===g||void 0===g||g.classList.add("active")}}f(n+c>=i-.2*i)};return a.current.addEventListener("scroll",e),function(){a.current.removeEventListener("scroll",e)}}var t=function(e){f(document.documentElement.scrollHeight-window.innerHeight<=window.scrollY+50)};return window.addEventListener("scroll",t),function(){window.removeEventListener("scroll",t)}}),[]),g?(0,d.jsx)("div",{className:"topBtn",onClick:function(){n?a.current.scrollTo({top:0,behavior:"smooth"}):document.documentElement.scrollTop=0},children:"Top"}):(0,d.jsx)(d.Fragment,{})},g=["bodyClassName","isOpen","headerTitle","headerButton","buttonPosition","children","footerContent","customHeaderButtonOnclick","isModalMsg"],f=function(e){var t=e.bodyClassName,n=e.isOpen,a=e.headerTitle,s=e.headerButton,r=e.buttonPosition,o=e.children,u=e.footerContent,f=(e.customHeaderButtonOnclick,e.isModalMsg),h=((0,l.Z)(e,g),(0,c.useRef)(null)),v=(0,c.useState)(1),p=(0,i.Z)(v,2),x=p[0],y=p[1];return(0,d.jsx)(d.Fragment,{children:n&&(0,d.jsxs)("div",{id:"SignModal",className:"modal-overlay ".concat(n?"visible":""," ").concat(f?"modal-message":""),style:{zIndex:"".concat(n?function(){for(var e=document.getElementsByTagName("*"),t=0,n=0;n<e.length;n++){var a=window.getComputedStyle(e[n]).zIndex;if("auto"!==a){var i=parseInt(a,10);isNaN(i)||(t=Math.max(t,i))}}return t}()+10:0)},children:[(0,d.jsxs)("div",{className:"modal-container",children:[(0,d.jsxs)("div",{className:"modal-header",children:[s&&(0,d.jsx)("div",{className:"header-button ".concat(null!==r&&void 0!==r?r:"right"),children:s}),(0,d.jsx)("div",{className:"header-title",children:a})]}),(0,d.jsx)("div",{className:"row header-page justify-center",children:(0,d.jsxs)("ul",{className:"d-flex justify-center pdfPage",children:[(0,d.jsx)("li",{className:"pageLabel",children:"\u9801\u9762\u5feb\u901f\u7d22\u5f15\uff1a"}),[{pageNum:1,edit:!1},{pageNum:2,edit:!1},{pageNum:3,edit:!0}].map((function(e,t){return(0,d.jsxs)("li",{id:"pageItem-"+e.pageNum,onClick:function(){var t=document.getElementById("pdfCard-"+e.pageNum);null===t||void 0===t||t.scrollIntoView({behavior:"smooth"})},className:"pageItem"+(0===t?" active":"")+(e.edit?" editItem":""),children:[" ",(0,d.jsx)("span",{className:"pageNum "+(x===e.pageNum?"active":""),children:e.pageNum})]},t)}))]})}),(0,d.jsx)("div",{ref:h,className:"modal-body mb-5 ".concat(null!==t&&void 0!==t?t:""),children:o}),u&&(0,d.jsx)("div",{className:"modal-footer justify-content-center",children:u})]}),h&&(0,d.jsx)(m,{isModal:!0,setActivePage:y,containerRef:h})]})})},h=n(36473),v=n(51276),p=n.n(v),x=n(38526),y=["bodyClassName","isOpen","headerButton","buttonPosition","children","footerContent","customHeaderButtonOnclick","isModalMsg"],b=function(e){e.bodyClassName;var t=e.isOpen,n=e.headerButton,a=e.buttonPosition,i=e.children,s=e.footerContent,r=(e.customHeaderButtonOnclick,e.isModalMsg),o=((0,l.Z)(e,y),(0,c.useRef)(null));return(0,d.jsx)(d.Fragment,{children:t&&(0,d.jsxs)("div",{id:"SignatureModal",className:"modal-overlay start-0 top-0 position-fixed justify-content-center align-items-center d-flex w-100 h-100 ".concat(t?"visible":""," ").concat(r?"modal-message":""),style:{zIndex:"".concat(t?function(){for(var e=document.getElementsByTagName("*"),t=0,n=0;n<e.length;n++){var a=window.getComputedStyle(e[n]).zIndex;if("auto"!==a){var i=parseInt(a,10);isNaN(i)||(t=Math.max(t,i))}}return t}()+10:0)},children:[(0,d.jsxs)("div",{className:"modal-container container bg-white p-0 position-relative d-flex flex-column",children:[n&&(0,d.jsx)("div",{className:"m-0 row justify-content-center align-items-center",children:(0,d.jsxs)("div",{className:"col justify-content-center align-items-center modal-header position-relative d-flex p-3",children:[(0,d.jsx)("div",{className:"header-title",children:"\u8acb\u7c3d\u540d\u65bc\u4e0b\u65b9\u6846\u5185\uff1a\u738b\u5c0f\u660e"}),n&&(0,d.jsx)("div",{className:"position-absolute header-button ".concat(null!==a&&void 0!==a?a:"right"),children:n})]})}),(0,d.jsx)("div",{ref:o,className:"row justify-content-center align-items-center modal-body mh-100 m-0",children:(0,d.jsx)("div",{className:"container mh-100",children:i})}),s&&(0,d.jsx)("div",{className:"row justify-content-center align-items-center m-0",children:(0,d.jsx)("div",{className:"container m-1 p-1",children:s})})]}),o&&(0,d.jsx)(x.Z,{isModal:!0,containerRef:o})]})})},w=n(43144),j=n(15671),N=(0,w.Z)((function e(t,n){(0,j.Z)(this,e),this.x=void 0,this.y=void 0,this.x=t,this.y=n})),I=function(e){var t,l=(0,c.useState)(null),r=(0,i.Z)(l,2),u=r[0],m=r[1],g=[{name:"insure",backRect:[172,340,100,30],signImg:null,clickRect:[new N(172,340),new N(172,370),new N(272,340),new N(272,370)]},{name:"applicant",backRect:[308,340,100,30],signImg:null,clickRect:[new N(308,340),new N(308,370),new N(408,340),new N(408,370)]},{name:"agentInsure",backRect:[450,320,100,30],signImg:null,clickRect:[new N(450,320),new N(450,350),new N(550,320),new N(550,350)]},{name:"agentApplicant",backRect:[450,355,100,30],signImg:null,clickRect:[new N(450,355),new N(450,385),new N(550,355),new N(550,385)]},{name:"saleMan",backRect:[172,485,100,30],signImg:null,clickRect:[new N(172,485),new N(172,515),new N(272,485),new N(272,515)]}],v=(0,c.useState)(g),x=(0,i.Z)(v,2),y=x[0],w=x[1],j=(0,c.useState)(),I=(0,i.Z)(j,2),C=I[0],k=I[1],R=(0,c.useState)(new Set([])),B=(0,i.Z)(R,2),E=B[0],M=B[1];(0,c.useEffect)((function(){var e;e=n(50090),s.Me(e).promise.then((function(e){m(e)}))}),[]),(0,c.useEffect)((function(){if(null!=u)for(var e=function(e){u.getPage(e).then((function(t){var n=document.getElementById("pdfCanvas-"+e),a=n.getContext("2d"),i=t.getViewport({scale:1});n.width=2*i.width,n.height=2*i.height,n.style.width="100%",n.style.height="100%",a.setTransform(2,0,0,2,0,0);var c={canvasContext:a,viewport:i};t.render(c).promise.then((function(){3===e&&T()}))}))},t=1;t<=u.numPages;t++)e(t)}),[u]);var T=function(){var e=document.getElementById("pdfCanvas-3").getContext("2d");e.fillStyle="#e0e0e0",y.forEach((function(t){e.fillRect(t.backRect[0],t.backRect[1],t.backRect[2],t.backRect[3])}))},S=(0,c.useState)(!1),Z=(0,i.Z)(S,2),P=Z[0],H=Z[1],L=(0,c.useRef)(null);return(0,c.useEffect)((function(){if(P&&C.signImg){var e,t=null===(e=document.getElementsByClassName("signature").item(0))||void 0===e?void 0:e.getElementsByTagName("canvas"),n=new Image;n.src=C.signImg;var a=t[0].getContext("2d");n.onload=function(){a.drawImage(n,0,0,t[0].clientWidth,t[0].clientHeight)}}}),[P]),(0,c.useEffect)((function(){!function(){var e,t;y.filter((function(e){return null===e.signImg})).length<=0?null===(e=document.getElementById("pageItem-3"))||void 0===e||e.classList.add("active"):null===(t=document.getElementById("pageItem-3"))||void 0===t||t.classList.remove("active")}()}),[y]),(0,c.useEffect)((function(){!function(e){var t=document.getElementById("pdfCanvas-3");if(t){var n=t.getContext("2d");switch(n.fillStyle="black",n.clearRect(530,385,35,15),e){case"agentInsure":n.fillText("\u8981\u4fdd\u4eba",530,395);break;case"agentApplicant":n.fillText("\u88ab\u4fdd\u4eba",530,395)}}}(E.values().next().value)}),[E]),(0,d.jsxs)(d.Fragment,{children:[e.visible&&(0,d.jsx)(f,{headerTitle:"\u8981\u4fdd\u66f8",isOpen:e.visible,buttonPosition:"right",numPages:u?u.numPages:0,headerButton:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{type:"button",className:"btn btn-outline-primary me-1 me-lg-0 cus-outline-transparent InsuranceButton",onClick:function(){return e.setVisible(!1)},children:"\u5b8c\u6210"}),(0,d.jsx)("button",{type:"button",className:"btn ml-1 btn-outline-light me-1 me-lg-0 cus-outline-transparent InsuranceButton",onClick:function(){return e.setVisible(!1)},children:"\u53d6\u6d88"})]}),children:(0,d.jsx)("div",{className:"justify-center d-flex",children:(0,d.jsx)("div",{children:null!==u&&(0,a.Z)(Array(null!==(t=u.numPages)&&void 0!==t?t:0)).map((function(e,t){return(0,d.jsx)("div",{className:"pdfCard pb-3",children:(0,d.jsx)(h.Z,{id:"pdfCard-"+(t+1),children:(0,d.jsx)("canvas",{onClick:function(e){var t=e.clientX,n=e.clientY,a=e.currentTarget.getBoundingClientRect();t-=a.left,n-=a.top,t=t/e.currentTarget.clientWidth*e.currentTarget.width/2,n=n/e.currentTarget.clientHeight*e.currentTarget.height/2,y.forEach((function(e){(function(e,t){var n=t[1],a=t[0],i=t[2],c=t[3],s=(a.x-n.x)*(e.y-n.y)-(a.y-n.y)*(e.x-n.x),l=(i.x-a.x)*(e.y-a.y)-(i.y-a.y)*(e.x-a.x),r=(c.x-i.x)*(e.y-i.y)-(c.y-i.y)*(e.x-i.x),o=(n.x-c.x)*(e.y-c.y)-(n.y-c.y)*(e.x-c.x);return s>0&&l>0&&r>0&&o>0||s<0&&l<0&&r<0&&o<0})(new N(t,n),e.clickRect)&&(H(!0),k(e))}))},id:"pdfCanvas-"+(t+1)})})},t)}))})})}),P&&(0,d.jsx)(b,{isModalMsg:!0,headerButton:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{type:"button",className:"btn btn-outline-primary me-1 me-lg-0 cus-outline-transparent InsuranceButton",onClick:function(){if(H(!1),L.current){var e=L.current.getTrimmedCanvas();if(e){var t=document.getElementById("pdfCanvas-3"),n=null===t||void 0===t?void 0:t.getContext("2d");n.clearRect(C.backRect[0],C.backRect[1],100,30),n.fillStyle="#e0e0e0",n.fillRect(C.backRect[0],C.backRect[1],100,30),n.drawImage(e,C.backRect[0],C.backRect[1],100,30);var a=e.toDataURL(),i=o().cloneDeep(y);i=i.map((function(t){if(t.name===C.name){if(e.width>1&&e.height>1){if(C.signImg=a,"agentInsure"===t.name||"agentApplicant"===t.name){var n=o().clone(E);n.add(t.name),M(n)}}else{if("agentInsure"===t.name||"agentApplicant"===t.name){var i=o().clone(E);i.delete(t.name),M(i)}C.signImg=null}return C}return t})),w(i)}}},children:"\u5b8c\u6210"}),(0,d.jsx)("button",{type:"button",className:"btn ml-1 btn-outline-light me-1 me-lg-0 cus-outline-transparent InsuranceButton",onClick:function(){L.current&&L.current.clear()},children:"\u64a4\u92b7"})]}),buttonPosition:"right",isOpen:P,children:(0,d.jsx)("div",{className:"signature",children:(0,d.jsx)(p(),{ref:L})})})]})}},50090:function(e,t,n){e.exports=n.p+"static/media/insure.38a780aa57ac3ad16ff1.pdf"}}]);
//# sourceMappingURL=338.b1b564a6.chunk.js.map