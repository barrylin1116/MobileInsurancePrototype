/*! For license information please see 328.fa2386ac.chunk.js.LICENSE.txt */
(self.webpackChunkmobileInsurance=self.webpackChunkmobileInsurance||[]).push([[328],{51276:function(t,e,i){var n,a,r,s;t.exports=(n=i(52007),a=i(72791),r=i(20354),s=i(59590),function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e){var i={};for(var n in t)e.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n]);return i}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},h=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=n(i(1)),c=i(2),d=n(c),v=n(i(3)),f=n(i(4)),p=function(t){function e(){var t,i,n;r(this,e);for(var o=arguments.length,l=Array(o),h=0;h<o;h++)l[h]=arguments[h];return i=n=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(l))),n._sigPad=null,n._excludeOurProps=function(){var t=n.props;return t.canvasProps,t.clearOnResize,a(t,["canvasProps","clearOnResize"])},n.getCanvas=function(){return n._canvas},n.getTrimmedCanvas=function(){var t=document.createElement("canvas");return t.width=n._canvas.width,t.height=n._canvas.height,t.getContext("2d").drawImage(n._canvas,0,0),(0,f.default)(t)},n.getSignaturePad=function(){return n._sigPad},n._checkClearOnResize=function(){n.props.clearOnResize&&n._resizeCanvas()},n._resizeCanvas=function(){var t=n.props.canvasProps||{},e=t.width,i=t.height;if(!e||!i){var a=n._canvas,r=Math.max(window.devicePixelRatio||1,1);e||(a.width=a.offsetWidth*r),i||(a.height=a.offsetHeight*r),a.getContext("2d").scale(r,r),n.clear()}},n.on=function(){return window.addEventListener("resize",n._checkClearOnResize),n._sigPad.on()},n.off=function(){return window.removeEventListener("resize",n._checkClearOnResize),n._sigPad.off()},n.clear=function(){return n._sigPad.clear()},n.isEmpty=function(){return n._sigPad.isEmpty()},n.fromDataURL=function(t,e){return n._sigPad.fromDataURL(t,e)},n.toDataURL=function(t,e){return n._sigPad.toDataURL(t,e)},n.fromData=function(t){return n._sigPad.fromData(t)},n.toData=function(){return n._sigPad.toData()},s(n,i)}return o(e,t),h(e,[{key:"componentDidMount",value:function(){this._sigPad=new v.default(this._canvas,this._excludeOurProps()),this._resizeCanvas(),this.on()}},{key:"componentWillUnmount",value:function(){this.off()}},{key:"componentDidUpdate",value:function(){Object.assign(this._sigPad,this._excludeOurProps())}},{key:"render",value:function(){var t=this,e=this.props.canvasProps;return d.default.createElement("canvas",l({ref:function(e){t._canvas=e}},e))}}]),e}(c.Component);p.propTypes={velocityFilterWeight:u.default.number,minWidth:u.default.number,maxWidth:u.default.number,minDistance:u.default.number,dotSize:u.default.oneOfType([u.default.number,u.default.func]),penColor:u.default.string,throttle:u.default.number,onEnd:u.default.func,onBegin:u.default.func,canvasProps:u.default.object,clearOnResize:u.default.bool},p.defaultProps={clearOnResize:!0},e.default=p},function(t,e){t.exports=n},function(t,e){t.exports=a},function(t,e){t.exports=r},function(t,e){t.exports=s}]))},59590:function(t){t.exports=function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e){"use strict";function i(t){var e=t.getContext("2d"),i=t.width,n=t.height,a=e.getImageData(0,0,i,n).data,o=r(!0,i,n,a),l=r(!1,i,n,a),h=s(!0,i,n,a),u=s(!1,i,n,a)-h+1,c=l-o+1,d=e.getImageData(h,o,u,c);return t.width=u,t.height=c,e.clearRect(0,0,u,c),e.putImageData(d,0,0),t}function n(t,e,i,n){return{red:n[4*(i*e+t)],green:n[4*(i*e+t)+1],blue:n[4*(i*e+t)+2],alpha:n[4*(i*e+t)+3]}}function a(t,e,i,a){return n(t,e,i,a).alpha}function r(t,e,i,n){for(var r=t?1:-1,s=t?0:i-1;t?s<i:s>-1;s+=r)for(var o=0;o<e;o++)if(a(o,s,e,n))return s;return null}function s(t,e,i,n){for(var r=t?1:-1,s=t?0:e-1;t?s<e:s>-1;s+=r)for(var o=0;o<i;o++)if(a(s,o,e,n))return s;return null}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i}])},87056:function(t,e,i){"use strict";i.d(e,{Me:function(){return am}});var n=i(1413);function a(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}function r(t,e){return t.get(a(t,e))}function s(t,e){return function(t,e){if(e.set)return"__destrObj"in e||(e.__destrObj={set value(i){e.set.call(t,i)}}),e.__destrObj;if(!e.writable)throw new TypeError("attempted to set read only private field");return e}(t,r(e,t))}var o=i(61120);function l(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=(0,o.Z)(t)););return t}function h(){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=l(t,e);if(n){var a=Object.getOwnPropertyDescriptor(n,e);return a.get?a.get.call(arguments.length<3?t:i):a.value}},h.apply(null,arguments)}function u(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}function c(t,e){if(void 0===t)throw new TypeError("attempted to "+e+" private static field before its declaration")}function d(t,e,i,n){return a(e,t),c(i,"set"),u(t,i,n),n}function v(t,e){return e.get?e.get.call(t):e.value}function f(t,e,i){return a(e,t),c(i,"get"),v(t,i)}var p=i(89062),g=i(97326);function m(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function y(t,e){m(t,e),e.add(t)}function k(t,e,i){return a(e,t),i}var b=i(4942),w=i(15861);function A(t,e,i){m(t,e),e.set(t,i)}function _(t,e){return v(t,r(e,t))}function x(t,e,i){return u(t,r(e,t),i),i}function S(t,e,i){return a(e,t),i}var M=i(93324),E=i(40181);function C(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=(0,E.Z)(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}var Z=i(43144),T=i(15671),R=i(60136),P=i(29388),L=i(64687),I={d:function(t,e){for(var i in e)I.o(e,i)&&!I.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}};e=globalThis.pdfjsLib={};I.d(e,{AbortException:function(){return Xt},AnnotationEditorLayer:function(){return Bg},AnnotationEditorParamsType:function(){return K},AnnotationEditorType:function(){return X},AnnotationEditorUIManager:function(){return Pa},AnnotationLayer:function(){return Oc},AnnotationMode:function(){return q},CMapCompressionType:function(){return Ct},ColorPicker:function(){return Tv},DOMSVGFactory:function(){return hi},DrawLayer:function(){return $g},FeatureTest:function(){return Jt},GlobalWorkerOptions:function(){return fo},ImageKind:function(){return nt},InvalidPDFException:function(){return Ut},MissingPDFException:function(){return Vt},OPS:function(){return Zt},PDFDataRangeTransport:function(){return fh},PDFDateString:function(){return bi},PDFWorker:function(){return Ch},PasswordResponses:function(){return Tt},PermissionFlag:function(){return Y},PixelsPerInch:function(){return Se},RenderingCancelledException:function(){return ci},TextLayer:function(){return Gl},UnexpectedResponseException:function(){return Gt},Util:function(){return te},VerbosityLevel:function(){return Et},XfaLayer:function(){return eu},build:function(){return Qh},createValidAbsoluteUrl:function(){return Ot},fetchData:function(){return ri},getDocument:function(){return lh},getFilenameFromUrl:function(){return fi},getPdfFilenameFromUrl:function(){return pi},getXfaPageViewport:function(){return wi},isDataScheme:function(){return di},isPdfFile:function(){return vi},noContextMenu:function(){return ki},normalizeUnicode:function(){return se},setLayerDimensions:function(){return Si},shadow:function(){return Bt},version:function(){return Yh}});var F="object"===typeof process&&process+""==="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&"browser"!==process.type),D=[1,0,0,1,0,0],W=[.001,0,0,.001,0,0],N=1.35,O=1,B=2,H=4,z=16,j=32,U=64,V=128,G=256,q={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},X={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},K={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},Y={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Q=0,J=1,$=2,tt=3,et=3,it=4,nt={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},at=1,rt=2,st=3,ot=4,lt=5,ht=6,ut=7,ct=8,dt=9,vt=10,ft=11,pt=12,gt=13,mt=14,yt=15,kt=16,bt=17,wt=20,At=1,_t=2,xt=3,St=4,Mt=5,Et={ERRORS:0,WARNINGS:1,INFOS:5},Ct={NONE:0,BINARY:1},Zt={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},Tt={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},Rt=Et.WARNINGS;function Pt(t){Number.isInteger(t)&&(Rt=t)}function Lt(){return Rt}function It(t){Rt>=Et.INFOS&&console.log("Info: ".concat(t))}function Ft(t){Rt>=Et.WARNINGS&&console.log("Warning: ".concat(t))}function Dt(t){throw new Error(t)}function Wt(t,e){t||Dt(e)}function Nt(t){switch(null===t||void 0===t?void 0:t.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Ot(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return null;try{if(i&&"string"===typeof t){if(i.addDefaultProtocol&&t.startsWith("www.")){var n=t.match(/\./g);(null===n||void 0===n?void 0:n.length)>=2&&(t="http://".concat(t))}if(i.tryConvertEncoding)try{t=ne(t)}catch(r){}}var a=e?new URL(t,e):new URL(t);if(Nt(a))return a}catch(s){}return null}function Bt(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Object.defineProperty(t,e,{value:i,enumerable:!n,configurable:!0,writable:!1}),i}var Ht=function(){function t(e,i){this.constructor===t&&Dt("Cannot initialize BaseException."),this.message=e,this.name=i}return t.prototype=new Error,t.constructor=t,t}(),zt=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t,n){var a;return(0,T.Z)(this,i),(a=e.call(this,t,"PasswordException")).code=n,a}return(0,Z.Z)(i)}(Ht),jt=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t,n){var a;return(0,T.Z)(this,i),(a=e.call(this,t,"UnknownErrorException")).details=n,a}return(0,Z.Z)(i)}(Ht),Ut=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,"InvalidPDFException")}return(0,Z.Z)(i)}(Ht),Vt=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,"MissingPDFException")}return(0,Z.Z)(i)}(Ht),Gt=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t,n){var a;return(0,T.Z)(this,i),(a=e.call(this,t,"UnexpectedResponseException")).status=n,a}return(0,Z.Z)(i)}(Ht),qt=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,"FormatError")}return(0,Z.Z)(i)}(Ht),Xt=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,"AbortException")}return(0,Z.Z)(i)}(Ht);function Kt(t){"object"===typeof t&&void 0!==(null===t||void 0===t?void 0:t.length)||Dt("Invalid argument for bytesToString");var e=t.length,i=8192;if(e<i)return String.fromCharCode.apply(null,t);for(var n=[],a=0;a<e;a+=i){var r=Math.min(a+i,e),s=t.subarray(a,r);n.push(String.fromCharCode.apply(null,s))}return n.join("")}function Yt(t){"string"!==typeof t&&Dt("Invalid argument for stringToBytes");for(var e=t.length,i=new Uint8Array(e),n=0;n<e;++n)i[n]=255&t.charCodeAt(n);return i}function Qt(t){var e,i=Object.create(null),n=C(t);try{for(n.s();!(e=n.n()).done;){var a=(0,M.Z)(e.value,2),r=a[0],s=a[1];i[r]=s}}catch(o){n.e(o)}finally{n.f()}return i}var Jt=function(){function t(){(0,T.Z)(this,t)}return(0,Z.Z)(t,null,[{key:"isLittleEndian",get:function(){return Bt(this,"isLittleEndian",function(){var t=new Uint8Array(4);return t[0]=1,1===new Uint32Array(t.buffer,0,1)[0]}())}},{key:"isEvalSupported",get:function(){return Bt(this,"isEvalSupported",function(){try{return new Function(""),!0}catch(t){return!1}}())}},{key:"isOffscreenCanvasSupported",get:function(){return Bt(this,"isOffscreenCanvasSupported","undefined"!==typeof OffscreenCanvas)}},{key:"platform",get:function(){var t;return"undefined"!==typeof navigator&&"string"===typeof(null===(t=navigator)||void 0===t?void 0:t.platform)?Bt(this,"platform",{isMac:navigator.platform.includes("Mac")}):Bt(this,"platform",{isMac:!1})}},{key:"isCSSRoundSupported",get:function(){var t,e;return Bt(this,"isCSSRoundSupported",null===(t=globalThis.CSS)||void 0===t||null===(e=t.supports)||void 0===e?void 0:e.call(t,"width: round(1.5px, 1px)"))}}]),t}(),$t=Array.from(Array(256).keys(),(function(t){return t.toString(16).padStart(2,"0")})),te=function(){function t(){(0,T.Z)(this,t)}return(0,Z.Z)(t,null,[{key:"makeHexColor",value:function(t,e,i){return"#".concat($t[t]).concat($t[e]).concat($t[i])}},{key:"scaleMinMax",value:function(t,e){var i;t[0]?(t[0]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[3],e[3]*=t[3]):(i=e[0],e[0]=e[1],e[1]=i,i=e[2],e[2]=e[3],e[3]=i,t[1]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}},{key:"transform",value:function(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}},{key:"applyTransform",value:function(t,e){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}},{key:"applyInverseTransform",value:function(t,e){var i=e[0]*e[3]-e[1]*e[2];return[(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/i,(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/i]}},{key:"getAxialAlignedBoundingBox",value:function(t,e){var i=this.applyTransform(t,e),n=this.applyTransform(t.slice(2,4),e),a=this.applyTransform([t[0],t[3]],e),r=this.applyTransform([t[2],t[1]],e);return[Math.min(i[0],n[0],a[0],r[0]),Math.min(i[1],n[1],a[1],r[1]),Math.max(i[0],n[0],a[0],r[0]),Math.max(i[1],n[1],a[1],r[1])]}},{key:"inverseTransform",value:function(t){var e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}},{key:"singularValueDecompose2dScale",value:function(t){var e=[t[0],t[2],t[1],t[3]],i=t[0]*e[0]+t[1]*e[2],n=t[0]*e[1]+t[1]*e[3],a=t[2]*e[0]+t[3]*e[2],r=t[2]*e[1]+t[3]*e[3],s=(i+r)/2,o=Math.sqrt(Math.pow(i+r,2)-4*(i*r-a*n))/2,l=s+o||1,h=s-o||1;return[Math.sqrt(l),Math.sqrt(h)]}},{key:"normalizeRect",value:function(t){var e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}},{key:"intersect",value:function(t,e){var i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),n=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(i>n)return null;var a=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return a>r?null:[i,a,n,r]}},{key:"bezierBoundingBox",value:function(e,i,n,a,r,s,o,l,h){return h?(h[0]=Math.min(h[0],e,o),h[1]=Math.min(h[1],i,l),h[2]=Math.max(h[2],e,o),h[3]=Math.max(h[3],i,l)):h=[Math.min(e,o),Math.min(i,l),Math.max(e,o),Math.max(i,l)],S(this,t,ie).call(this,e,n,r,o,i,a,s,l,3*(3*(n-r)-e+o),6*(e-2*n+r),3*(n-e),h),S(this,t,ie).call(this,e,n,r,o,i,a,s,l,3*(3*(a-s)-i+l),6*(i-2*a+s),3*(a-i),h),h}}]),t}();function ee(t,e,i,n,a,r,s,o,l,h){if(!(l<=0||l>=1)){var u=1-l,c=l*l,d=c*l,v=u*(u*(u*t+3*l*e)+3*c*i)+d*n,f=u*(u*(u*a+3*l*r)+3*c*s)+d*o;h[0]=Math.min(h[0],v),h[1]=Math.min(h[1],f),h[2]=Math.max(h[2],v),h[3]=Math.max(h[3],f)}}function ie(t,e,i,n,a,r,s,o,l,h,u,c){if(Math.abs(l)<1e-12)Math.abs(h)>=1e-12&&S(this,te,ee).call(this,t,e,i,n,a,r,s,o,-u/h,c);else{var d=Math.pow(h,2)-4*u*l;if(!(d<0)){var v=Math.sqrt(d),f=2*l;S(this,te,ee).call(this,t,e,i,n,a,r,s,o,(-h+v)/f,c),S(this,te,ee).call(this,t,e,i,n,a,r,s,o,(-h-v)/f,c)}}}function ne(t){return decodeURIComponent(escape(t))}var ae=null,re=null;function se(t){return ae||(ae=/([\xA0\xB5\u037E\u0EB3\u2000-\u200A\u202F\u2126\uFB00-\uFB04\uFB06\uFB20-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBA1\uFBA4-\uFBA9\uFBAE-\uFBB1\uFBD3-\uFBDC\uFBDE-\uFBE7\uFBEA-\uFBF8\uFBFC\uFBFD\uFC00-\uFC5D\uFC64-\uFCF1\uFCF5-\uFD3D\uFD88\uFDF4\uFDFA\uFDFB\uFE71\uFE77\uFE79\uFE7B\uFE7D]+)|(\uFB05+)/g,re=new Map([["\ufb05","\u017ft"]])),t.replaceAll(ae,(function(t,e,i){return e?e.normalize("NFKC"):re.get(i)}))}function oe(){var t,e;if("undefined"!==typeof crypto&&"function"===typeof(null===(t=crypto)||void 0===t?void 0:t.randomUUID))return crypto.randomUUID();var i=new Uint8Array(32);if("undefined"!==typeof crypto&&"function"===typeof(null===(e=crypto)||void 0===e?void 0:e.getRandomValues))crypto.getRandomValues(i);else for(var n=0;n<32;n++)i[n]=Math.floor(255*Math.random());return Kt(i)}var le="pdfjs_internal_id_",he=0,ue=1,ce=2,de=3,ve=4,fe=5,pe=6,ge=7,me=8,ye=function(){function t(){(0,T.Z)(this,t),this.constructor===t&&Dt("Cannot initialize BaseFilterFactory.")}return(0,Z.Z)(t,[{key:"addFilter",value:function(t){return"none"}},{key:"addHCMFilter",value:function(t,e){return"none"}},{key:"addAlphaFilter",value:function(t){return"none"}},{key:"addLuminosityFilter",value:function(t){return"none"}},{key:"addHighlightHCMFilter",value:function(t,e,i,n,a){return"none"}},{key:"destroy",value:function(){}}]),t}(),ke=new WeakMap,be=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.enableHWA,n=void 0!==i&&i;(0,T.Z)(this,t),A(this,ke,{writable:!0,value:!1}),this.constructor===t&&Dt("Cannot initialize BaseCanvasFactory."),x(this,ke,n)}return(0,Z.Z)(t,[{key:"create",value:function(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");var i=this._createCanvas(t,e);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!_(this,ke)})}}},{key:"reset",value:function(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=i}},{key:"destroy",value:function(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}},{key:"_createCanvas",value:function(t,e){Dt("Abstract method `_createCanvas` called.")}}]),t}(),we=function(){function t(e){var i=e.baseUrl,n=void 0===i?null:i,a=e.isCompressed,r=void 0===a||a;(0,T.Z)(this,t),this.constructor===t&&Dt("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=n,this.isCompressed=r}return(0,Z.Z)(t,[{key:"fetch",value:function(){var t=(0,w.Z)(L.mark((function t(e){var i,n,a,r=this;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.name,this.baseUrl){t.next=3;break}throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');case 3:if(i){t.next=5;break}throw new Error("CMap name must be specified.");case 5:return n=this.baseUrl+i+(this.isCompressed?".bcmap":""),a=this.isCompressed?Ct.BINARY:Ct.NONE,t.abrupt("return",this._fetchData(n,a).catch((function(t){throw new Error("Unable to load ".concat(r.isCompressed?"binary ":"","CMap at: ").concat(n))})));case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"_fetchData",value:function(t,e){Dt("Abstract method `_fetchData` called.")}}]),t}(),Ae=function(){function t(e){var i=e.baseUrl,n=void 0===i?null:i;(0,T.Z)(this,t),this.constructor===t&&Dt("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=n}return(0,Z.Z)(t,[{key:"fetch",value:function(){var t=(0,w.Z)(L.mark((function t(e){var i,n;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.filename,this.baseUrl){t.next=3;break}throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');case 3:if(i){t.next=5;break}throw new Error("Font filename must be specified.");case 5:return n="".concat(this.baseUrl).concat(i),t.abrupt("return",this._fetchData(n).catch((function(t){throw new Error("Unable to load font data at: ".concat(n))})));case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"_fetchData",value:function(t){Dt("Abstract method `_fetchData` called.")}}]),t}(),_e=function(){function t(){(0,T.Z)(this,t),this.constructor===t&&Dt("Cannot initialize BaseSVGFactory.")}return(0,Z.Z)(t,[{key:"create",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");var n=this._createSVG("svg:svg");return n.setAttribute("version","1.1"),i||(n.setAttribute("width","".concat(t,"px")),n.setAttribute("height","".concat(e,"px"))),n.setAttribute("preserveAspectRatio","none"),n.setAttribute("viewBox","0 0 ".concat(t," ").concat(e)),n}},{key:"createElement",value:function(t){if("string"!==typeof t)throw new Error("Invalid SVG element type");return this._createSVG(t)}},{key:"_createSVG",value:function(t){Dt("Abstract method `_createSVG` called.")}}]),t}(),xe="http://www.w3.org/2000/svg",Se=(0,Z.Z)((function t(){(0,T.Z)(this,t)}));(0,b.Z)(Se,"CSS",96),(0,b.Z)(Se,"PDF",72),(0,b.Z)(Se,"PDF_TO_CSS_UNITS",Se.CSS/Se.PDF);var Me=new WeakMap,Ee=new WeakMap,Ce=new WeakMap,Ze=new WeakMap,Te=new WeakMap,Re=new WeakMap,Pe=new WeakMap,Le=new WeakMap,Ie=new WeakMap,Fe=new WeakMap,De=new WeakSet,We=new WeakSet,Ne=new WeakSet,Oe=new WeakSet,Be=new WeakSet,He=new WeakSet,ze=new WeakSet,je=new WeakSet,Ue=new WeakSet,Ve=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=n.docId,r=n.ownerDocument,s=void 0===r?globalThis.document:r;return(0,T.Z)(this,i),t=e.call(this),y((0,g.Z)(t),Ue),y((0,g.Z)(t),je),y((0,g.Z)(t),ze),y((0,g.Z)(t),He),y((0,g.Z)(t),Be),y((0,g.Z)(t),Oe),y((0,g.Z)(t),Ne),y((0,g.Z)(t),We),y((0,g.Z)(t),De),A((0,g.Z)(t),Fe,{get:Xe,set:void 0}),A((0,g.Z)(t),Ie,{get:qe,set:void 0}),A((0,g.Z)(t),Le,{get:Ge,set:void 0}),A((0,g.Z)(t),Me,{writable:!0,value:void 0}),A((0,g.Z)(t),Ee,{writable:!0,value:void 0}),A((0,g.Z)(t),Ce,{writable:!0,value:void 0}),A((0,g.Z)(t),Ze,{writable:!0,value:void 0}),A((0,g.Z)(t),Te,{writable:!0,value:void 0}),A((0,g.Z)(t),Re,{writable:!0,value:void 0}),A((0,g.Z)(t),Pe,{writable:!0,value:0}),x((0,g.Z)(t),Ze,a),x((0,g.Z)(t),Te,s),t}return(0,Z.Z)(i,[{key:"addFilter",value:function(t){var e;if(!t)return"none";var i=_(this,Le).get(t);if(i)return i;var n=k(this,De,Ke).call(this,t),a=(0,M.Z)(n,3),r=a[0],s=a[1],o=a[2],l=1===t.length?r:"".concat(r).concat(s).concat(o);if(i=_(this,Le).get(l))return _(this,Le).set(t,i),i;var h="g_".concat(_(this,Ze),"_transfer_map_").concat((x(this,Pe,1+(e=+_(this,Pe))),e)),u=k(this,We,Ye).call(this,h);_(this,Le).set(t,u),_(this,Le).set(l,u);var c=k(this,Be,$e).call(this,h);return k(this,ze,ei).call(this,r,s,o,c),u}},{key:"addHCMFilter",value:function(t,e){var i,n,a="".concat(t,"-").concat(e),r="base",s=_(this,Ie).get(r);if((null===(i=s)||void 0===i?void 0:i.key)===a)return s.url;s?(null===(n=s.filter)||void 0===n||n.remove(),s.key=a,s.url="none",s.filter=null):(s={key:a,url:"none",filter:null},_(this,Ie).set(r,s));if(!t||!e)return s.url;var o=k(this,Ue,ni).call(this,t);t=te.makeHexColor.apply(te,(0,p.Z)(o));var l=k(this,Ue,ni).call(this,e);if(e=te.makeHexColor.apply(te,(0,p.Z)(l)),_(this,Fe).style.color="","#000000"===t&&"#ffffff"===e||t===e)return s.url;for(var h=new Array(256),u=0;u<=255;u++){var c=u/255;h[u]=c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4)}var d=h.join(","),v="g_".concat(_(this,Ze),"_hcm_filter"),f=s.filter=k(this,Be,$e).call(this,v);k(this,ze,ei).call(this,d,d,d,f),k(this,Oe,Je).call(this,f);var g=function(t,e){for(var i=o[t]/255,n=l[t]/255,a=new Array(e+1),r=0;r<=e;r++)a[r]=i+r/e*(n-i);return a.join(",")};return k(this,ze,ei).call(this,g(0,5),g(1,5),g(2,5),f),s.url=k(this,We,Ye).call(this,v),s.url}},{key:"addAlphaFilter",value:function(t){var e,i=_(this,Le).get(t);if(i)return i;var n=k(this,De,Ke).call(this,[t]),a=(0,M.Z)(n,1)[0],r="alpha_".concat(a);if(i=_(this,Le).get(r))return _(this,Le).set(t,i),i;var s="g_".concat(_(this,Ze),"_alpha_map_").concat((x(this,Pe,1+(e=+_(this,Pe))),e)),o=k(this,We,Ye).call(this,s);_(this,Le).set(t,o),_(this,Le).set(r,o);var l=k(this,Be,$e).call(this,s);return k(this,je,ii).call(this,a,l),o}},{key:"addLuminosityFilter",value:function(t){var e,i,n,a=_(this,Le).get(t||"luminosity");if(a)return a;if(t){var r=k(this,De,Ke).call(this,[t]);i=(0,M.Z)(r,1)[0],n="luminosity_".concat(i)}else n="luminosity";if(a=_(this,Le).get(n))return _(this,Le).set(t,a),a;var s="g_".concat(_(this,Ze),"_luminosity_map_").concat((x(this,Pe,1+(e=+_(this,Pe))),e)),o=k(this,We,Ye).call(this,s);_(this,Le).set(t,o),_(this,Le).set(n,o);var l=k(this,Be,$e).call(this,s);return k(this,Ne,Qe).call(this,l),t&&k(this,je,ii).call(this,i,l),o}},{key:"addHighlightHCMFilter",value:function(t,e,i,n,a){var r,s,o="".concat(e,"-").concat(i,"-").concat(n,"-").concat(a),l=_(this,Ie).get(t);if((null===(r=l)||void 0===r?void 0:r.key)===o)return l.url;l?(null===(s=l.filter)||void 0===s||s.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},_(this,Ie).set(t,l));if(!e||!i)return l.url;var h=[e,i].map(k(this,Ue,ni).bind(this)),u=(0,M.Z)(h,2),c=u[0],d=u[1],v=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),f=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),p=[n,a].map(k(this,Ue,ni).bind(this)),g=(0,M.Z)(p,2),m=g[0],y=g[1];if(f<v){var b=[f,v,y,m];v=b[0],f=b[1],m=b[2],y=b[3]}_(this,Fe).style.color="";var w=function(t,e,i){for(var n=new Array(256),a=(f-v)/i,r=t/255,s=(e-t)/(255*i),o=0,l=0;l<=i;l++){for(var h=Math.round(v+l*a),u=r+l*s,c=o;c<=h;c++)n[c]=u;o=h+1}for(var d=o;d<256;d++)n[d]=n[o-1];return n.join(",")},A="g_".concat(_(this,Ze),"_hcm_").concat(t,"_filter"),x=l.filter=k(this,Be,$e).call(this,A);return k(this,Oe,Je).call(this,x),k(this,ze,ei).call(this,w(m[0],y[0],5),w(m[1],y[1],5),w(m[2],y[2],5),x),l.url=k(this,We,Ye).call(this,A),l.url}},{key:"destroy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t&&0!==_(this,Ie).size||(_(this,Ce)&&(_(this,Ce).parentNode.parentNode.remove(),x(this,Ce,null)),_(this,Ee)&&(_(this,Ee).clear(),x(this,Ee,null)),x(this,Pe,0))}}]),i}(ye);function Ge(){return _(this,Ee)||x(this,Ee,new Map)}function qe(){return _(this,Re)||x(this,Re,new Map)}function Xe(){if(!_(this,Ce)){var t=_(this,Te).createElement("div"),e=t.style;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;var i=_(this,Te).createElementNS(xe,"svg");i.setAttribute("width",0),i.setAttribute("height",0),x(this,Ce,_(this,Te).createElementNS(xe,"defs")),t.append(i),i.append(_(this,Ce)),_(this,Te).body.append(t)}return _(this,Ce)}function Ke(t){if(1===t.length){for(var e=t[0],i=new Array(256),n=0;n<256;n++)i[n]=e[n]/255;var a=i.join(",");return[a,a,a]}for(var r=(0,M.Z)(t,3),s=r[0],o=r[1],l=r[2],h=new Array(256),u=new Array(256),c=new Array(256),d=0;d<256;d++)h[d]=s[d]/255,u[d]=o[d]/255,c[d]=l[d]/255;return[h.join(","),u.join(","),c.join(",")]}function Ye(t){if(void 0===_(this,Me)){x(this,Me,"");var e=_(this,Te).URL;e!==_(this,Te).baseURI&&(di(e)?Ft('#createUrl: ignore "data:"-URL for performance reasons.'):x(this,Me,e.split("#",1)[0]))}return"url(".concat(_(this,Me),"#").concat(t,")")}function Qe(t){var e=_(this,Te).createElementNS(xe,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}function Je(t){var e=_(this,Te).createElementNS(xe,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}function $e(t){var e=_(this,Te).createElementNS(xe,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),_(this,Fe).append(e),e}function ti(t,e,i){var n=_(this,Te).createElementNS(xe,e);n.setAttribute("type","discrete"),n.setAttribute("tableValues",i),t.append(n)}function ei(t,e,i,n){var a=_(this,Te).createElementNS(xe,"feComponentTransfer");n.append(a),k(this,He,ti).call(this,a,"feFuncR",t),k(this,He,ti).call(this,a,"feFuncG",e),k(this,He,ti).call(this,a,"feFuncB",i)}function ii(t,e){var i=_(this,Te).createElementNS(xe,"feComponentTransfer");e.append(i),k(this,He,ti).call(this,i,"feFuncA",t)}function ni(t){return _(this,Fe).style.color=t,Ai(getComputedStyle(_(this,Fe)).getPropertyValue("color"))}var ai=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=n.ownerDocument,r=void 0===a?globalThis.document:a,s=n.enableHWA,o=void 0!==s&&s;return(0,T.Z)(this,i),(t=e.call(this,{enableHWA:o}))._document=r,t}return(0,Z.Z)(i,[{key:"_createCanvas",value:function(t,e){var i=this._document.createElement("canvas");return i.width=t,i.height=e,i}}]),i}(be);function ri(t){return si.apply(this,arguments)}function si(){return si=(0,w.Z)(L.mark((function t(e){var i,n,a=arguments;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=a.length>1&&void 0!==a[1]?a[1]:"text",!yi(e,document.baseURI)){t.next=14;break}return t.next=4,fetch(e);case 4:if((n=t.sent).ok){t.next=7;break}throw new Error(n.statusText);case 7:t.t0=i,t.next="arraybuffer"===t.t0?10:"blob"===t.t0?11:"json"===t.t0?12:13;break;case 10:return t.abrupt("return",n.arrayBuffer());case 11:return t.abrupt("return",n.blob());case 12:return t.abrupt("return",n.json());case 13:return t.abrupt("return",n.text());case 14:return t.abrupt("return",new Promise((function(t,n){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType=i,a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)if(200!==a.status&&0!==a.status)n(new Error(a.statusText));else{switch(i){case"arraybuffer":case"blob":case"json":return void t(a.response)}t(a.responseText)}},a.send(null)})));case 15:case"end":return t.stop()}}),t)}))),si.apply(this,arguments)}var oi=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(){return(0,T.Z)(this,i),e.apply(this,arguments)}return(0,Z.Z)(i,[{key:"_fetchData",value:function(t,e){return ri(t,this.isCompressed?"arraybuffer":"text").then((function(t){return{cMapData:t instanceof ArrayBuffer?new Uint8Array(t):Yt(t),compressionType:e}}))}}]),i}(we),li=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(){return(0,T.Z)(this,i),e.apply(this,arguments)}return(0,Z.Z)(i,[{key:"_fetchData",value:function(t){return ri(t,"arraybuffer").then((function(t){return new Uint8Array(t)}))}}]),i}(Ae),hi=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(){return(0,T.Z)(this,i),e.apply(this,arguments)}return(0,Z.Z)(i,[{key:"_createSVG",value:function(t){return document.createElementNS(xe,t)}}]),i}(_e),ui=function(){function t(e){var i=e.viewBox,n=e.scale,a=e.rotation,r=e.offsetX,s=void 0===r?0:r,o=e.offsetY,l=void 0===o?0:o,h=e.dontFlip,u=void 0!==h&&h;(0,T.Z)(this,t),this.viewBox=i,this.scale=n,this.rotation=a,this.offsetX=s,this.offsetY=l;var c,d,v,f,p,g,m,y,k=(i[2]+i[0])/2,b=(i[3]+i[1])/2;switch((a%=360)<0&&(a+=360),a){case 180:c=-1,d=0,v=0,f=1;break;case 90:c=0,d=1,v=1,f=0;break;case 270:c=0,d=-1,v=-1,f=0;break;case 0:c=1,d=0,v=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}u&&(v=-v,f=-f),0===c?(p=Math.abs(b-i[1])*n+s,g=Math.abs(k-i[0])*n+l,m=(i[3]-i[1])*n,y=(i[2]-i[0])*n):(p=Math.abs(k-i[0])*n+s,g=Math.abs(b-i[1])*n+l,m=(i[2]-i[0])*n,y=(i[3]-i[1])*n),this.transform=[c*n,d*n,v*n,f*n,p-c*n*k-v*n*b,g-d*n*k-f*n*b],this.width=m,this.height=y}return(0,Z.Z)(t,[{key:"rawDims",get:function(){var t=this.viewBox;return Bt(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}},{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.scale,n=void 0===i?this.scale:i,a=e.rotation,r=void 0===a?this.rotation:a,s=e.offsetX,o=void 0===s?this.offsetX:s,l=e.offsetY,h=void 0===l?this.offsetY:l,u=e.dontFlip,c=void 0!==u&&u;return new t({viewBox:this.viewBox.slice(),scale:n,rotation:r,offsetX:o,offsetY:h,dontFlip:c})}},{key:"convertToViewportPoint",value:function(t,e){return te.applyTransform([t,e],this.transform)}},{key:"convertToViewportRectangle",value:function(t){var e=te.applyTransform([t[0],t[1]],this.transform),i=te.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],i[0],i[1]]}},{key:"convertToPdfPoint",value:function(t,e){return te.applyInverseTransform([t,e],this.transform)}}]),t}(),ci=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,T.Z)(this,i),(n=e.call(this,t,"RenderingCancelledException")).extraDelay=a,n}return(0,Z.Z)(i)}(Ht);function di(t){for(var e=t.length,i=0;i<e&&""===t[i].trim();)i++;return"data:"===t.substring(i,i+5).toLowerCase()}function vi(t){return"string"===typeof t&&/\.pdf$/i.test(t)}function fi(t){var e=t.split(/[#?]/,1);return(t=(0,M.Z)(e,1)[0]).substring(t.lastIndexOf("/")+1)}function pi(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if("string"!==typeof t)return e;if(di(t))return Ft('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;var i=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,a=i.exec(t),r=n.exec(a[1])||n.exec(a[2])||n.exec(a[3]);if(r&&(r=r[0]).includes("%"))try{r=n.exec(decodeURIComponent(r))[0]}catch(s){}return r||e}var gi,mi=function(){function t(){(0,T.Z)(this,t),(0,b.Z)(this,"started",Object.create(null)),(0,b.Z)(this,"times",[])}return(0,Z.Z)(t,[{key:"time",value:function(t){t in this.started&&Ft("Timer is already running for ".concat(t)),this.started[t]=Date.now()}},{key:"timeEnd",value:function(t){t in this.started||Ft("Timer has not been started for ".concat(t)),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}},{key:"toString",value:function(){var t,e=[],i=0,n=C(this.times);try{for(n.s();!(t=n.n()).done;){var a=t.value.name;i=Math.max(a.length,i)}}catch(c){n.e(c)}finally{n.f()}var r,s=C(this.times);try{for(s.s();!(r=s.n()).done;){var o=r.value,l=o.name,h=o.start,u=o.end;e.push("".concat(l.padEnd(i)," ").concat(u-h,"ms\n"))}}catch(c){s.e(c)}finally{s.f()}return e.join("")}}]),t}();function yi(t,e){try{var i=(e?new URL(t,e):new URL(t)).protocol;return"http:"===i||"https:"===i}catch(n){return!1}}function ki(t){t.preventDefault()}var bi=function(){function t(){(0,T.Z)(this,t)}return(0,Z.Z)(t,null,[{key:"toDateObject",value:function(t){if(!t||"string"!==typeof t)return null;gi||(gi=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));var e=gi.exec(t);if(!e)return null;var i=parseInt(e[1],10),n=parseInt(e[2],10);n=n>=1&&n<=12?n-1:0;var a=parseInt(e[3],10);a=a>=1&&a<=31?a:1;var r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;var s=parseInt(e[5],10);s=s>=0&&s<=59?s:0;var o=parseInt(e[6],10);o=o>=0&&o<=59?o:0;var l=e[7]||"Z",h=parseInt(e[8],10);h=h>=0&&h<=23?h:0;var u=parseInt(e[9],10)||0;return u=u>=0&&u<=59?u:0,"-"===l?(r+=h,s+=u):"+"===l&&(r-=h,s-=u),new Date(Date.UTC(i,n,a,r,s,o))}}]),t}();function wi(t,e){var i=e.scale,n=void 0===i?1:i,a=e.rotation,r=void 0===a?0:a,s=t.attributes.style,o=s.width,l=s.height,h=[0,0,parseInt(o),parseInt(l)];return new ui({viewBox:h,scale:n,rotation:r})}function Ai(t){if(t.startsWith("#")){var e=parseInt(t.slice(1),16);return[(16711680&e)>>16,(65280&e)>>8,255&e]}return t.startsWith("rgb(")?t.slice(4,-1).split(",").map((function(t){return parseInt(t)})):t.startsWith("rgba(")?t.slice(5,-1).split(",").map((function(t){return parseInt(t)})).slice(0,3):(Ft('Not a valid color format: "'.concat(t,'"')),[0,0,0])}function _i(t){var e=t.getTransform();return[e.a,e.b,e.c,e.d,e.e,e.f]}function xi(t){var e=t.getTransform().invertSelf();return[e.a,e.b,e.c,e.d,e.e,e.f]}function Si(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e instanceof ui){var a=e.rawDims,r=a.pageWidth,s=a.pageHeight,o=t.style,l=Jt.isCSSRoundSupported,h="var(--scale-factor) * ".concat(r,"px"),u="var(--scale-factor) * ".concat(s,"px"),c=l?"round(".concat(h,", 1px)"):"calc(".concat(h,")"),d=l?"round(".concat(u,", 1px)"):"calc(".concat(u,")");i&&e.rotation%180!==0?(o.width=d,o.height=c):(o.width=c,o.height=d)}n&&t.setAttribute("data-main-rotation",e.rotation)}var Mi=new WeakMap,Ei=new WeakMap,Ci=new WeakMap,Zi=new WeakMap,Ti=new WeakSet,Ri=new WeakSet,Pi=new WeakSet,Li=new WeakSet,Ii=new WeakMap,Fi=function(){function t(e){(0,T.Z)(this,t),A(this,Ii,{get:Hi,set:void 0}),y(this,Li),y(this,Pi),y(this,Ri),y(this,Ti),A(this,Mi,{writable:!0,value:null}),A(this,Ei,{writable:!0,value:null}),A(this,Ci,{writable:!0,value:void 0}),A(this,Zi,{writable:!0,value:null}),x(this,Ci,e)}return(0,Z.Z)(t,[{key:"render",value:function(){var e=x(this,Mi,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar");var i=_(this,Ci)._uiManager._signal;e.addEventListener("contextmenu",ki,{signal:i}),e.addEventListener("pointerdown",S(t,t,Di),{signal:i});var n=x(this,Zi,document.createElement("div"));n.className="buttons",e.append(n);var a=_(this,Ci).toolbarPosition;if(a){var r=e.style,s="ltr"===_(this,Ci)._uiManager.direction?1-a[0]:a[0];r.insetInlineEnd="".concat(100*s,"%"),r.top="calc(".concat(100*a[1],"% + var(--editor-toolbar-vert-offset))")}return k(this,Li,Bi).call(this),e}},{key:"hide",value:function(){var t;_(this,Mi).classList.add("hidden"),null===(t=_(this,Ei))||void 0===t||t.hideDropdown()}},{key:"show",value:function(){_(this,Mi).classList.remove("hidden")}},{key:"addAltTextButton",value:function(t){k(this,Pi,Oi).call(this,t),_(this,Zi).prepend(t,_(this,Ii))}},{key:"addColorPicker",value:function(t){x(this,Ei,t);var e=t.renderButton();k(this,Pi,Oi).call(this,e),_(this,Zi).prepend(e,_(this,Ii))}},{key:"remove",value:function(){var t;_(this,Mi).remove(),null===(t=_(this,Ei))||void 0===t||t.destroy(),x(this,Ei,null)}}]),t}();function Di(t){t.stopPropagation()}function Wi(t){_(this,Ci)._focusEventsAllowed=!1,t.preventDefault(),t.stopPropagation()}function Ni(t){_(this,Ci)._focusEventsAllowed=!0,t.preventDefault(),t.stopPropagation()}function Oi(t){var e=_(this,Ci)._uiManager._signal;t.addEventListener("focusin",k(this,Ti,Wi).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",k(this,Ri,Ni).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",ki,{signal:e})}function Bi(){var t=this,e=document.createElement("button");e.className="delete",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-editor-remove-".concat(_(this,Ci).editorType,"-button")),k(this,Pi,Oi).call(this,e),e.addEventListener("click",(function(e){_(t,Ci)._uiManager.delete()}),{signal:_(this,Ci)._uiManager._signal}),_(this,Zi).append(e)}function Hi(){var t=document.createElement("div");return t.className="divider",t}var zi=new WeakMap,ji=new WeakMap,Ui=new WeakMap,Vi=new WeakSet,Gi=new WeakSet,qi=new WeakSet,Xi=function(){function t(e){(0,T.Z)(this,t),y(this,qi),y(this,Gi),y(this,Vi),A(this,zi,{writable:!0,value:null}),A(this,ji,{writable:!0,value:null}),A(this,Ui,{writable:!0,value:void 0}),x(this,Ui,e)}return(0,Z.Z)(t,[{key:"show",value:function(t,e,i){var n=k(this,Gi,Yi).call(this,e,i),a=(0,M.Z)(n,2),r=a[0],s=a[1],o=(_(this,ji)||x(this,ji,k(this,Vi,Ki).call(this))).style;t.append(_(this,ji)),o.insetInlineEnd="".concat(100*r,"%"),o.top="calc(".concat(100*s,"% + var(--editor-toolbar-vert-offset))")}},{key:"hide",value:function(){_(this,ji).remove()}}]),t}();function Ki(){var t=x(this,ji,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",ki,{signal:_(this,Ui)._signal});var e=x(this,zi,document.createElement("div"));return e.className="buttons",t.append(e),k(this,qi,Qi).call(this),t}function Yi(t,e){var i,n=0,a=0,r=C(t);try{for(r.s();!(i=r.n()).done;){var s=i.value,o=s.y+s.height;if(!(o<n)){var l=s.x+(e?s.width:0);o>n?(a=l,n=o):e?l>a&&(a=l):l<a&&(a=l)}}}catch(h){r.e(h)}finally{r.f()}return[e?1-a:a,n]}function Qi(){var t=this,e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");var i=document.createElement("span");e.append(i),i.className="visuallyHidden",i.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");var n=_(this,Ui)._signal;e.addEventListener("contextmenu",ki,{signal:n}),e.addEventListener("click",(function(){_(t,Ui).highlightSelection("floating_button")}),{signal:n}),_(this,zi).append(e)}function Ji(t,e,i){var n,a=C(i);try{for(a.s();!(n=a.n()).done;){var r=n.value;e.addEventListener(r,t[r].bind(t))}}catch(s){a.e(s)}finally{a.f()}}var $i=new WeakMap,tn=function(){function t(){(0,T.Z)(this,t),A(this,$i,{writable:!0,value:0})}return(0,Z.Z)(t,[{key:"id",get:function(){var t;return"".concat("pdfjs_internal_editor_").concat((x(this,$i,1+(t=+_(this,$i))),t))}}]),t}(),en=new WeakMap,nn=new WeakMap,an=new WeakMap,rn=new WeakSet,sn=function(){function t(){(0,T.Z)(this,t),y(this,rn),A(this,en,{writable:!0,value:oe()}),A(this,nn,{writable:!0,value:0}),A(this,an,{writable:!0,value:null})}return(0,Z.Z)(t,[{key:"getFromFile",value:function(){var t=(0,w.Z)(L.mark((function t(e){var i,n,a,r;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.lastModified,n=e.name,a=e.size,r=e.type,t.abrupt("return",k(this,rn,on).call(this,"".concat(i,"_").concat(n,"_").concat(a,"_").concat(r),e));case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getFromUrl",value:function(){var t=(0,w.Z)(L.mark((function t(e){return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",k(this,rn,on).call(this,e,e));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getFromId",value:function(){var t=(0,w.Z)(L.mark((function t(e){var i;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(_(this,an)||x(this,an,new Map),i=_(this,an).get(e)){t.next=4;break}return t.abrupt("return",null);case 4:if(!i.bitmap){t.next=7;break}return i.refCounter+=1,t.abrupt("return",i);case 7:if(!i.file){t.next=9;break}return t.abrupt("return",this.getFromFile(i.file));case 9:return t.abrupt("return",this.getFromUrl(i.url));case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getSvgUrl",value:function(t){var e=_(this,an).get(t);return null!==e&&void 0!==e&&e.isSvg?e.svgUrl:null}},{key:"deleteId",value:function(t){_(this,an)||x(this,an,new Map);var e=_(this,an).get(t);e&&(e.refCounter-=1,0===e.refCounter&&(e.bitmap=null))}},{key:"isValidId",value:function(t){return t.startsWith("image_".concat(_(this,en),"_"))}}],[{key:"_isSVGFittingCanvas",get:function(){var t=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',Bt(this,"_isSVGFittingCanvas",e.decode().then((function(){return t.drawImage(e,0,0,1,1,0,0,1,3),0===new Uint32Array(t.getImageData(0,0,1,1).data.buffer)[0]})))}}]),t}();function on(t,e){return ln.apply(this,arguments)}function ln(){return(ln=(0,w.Z)(L.mark((function t(e,i){var n,a,r,s,o,l,h,u;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(_(this,an)||x(this,an,new Map),null!==(a=_(this,an).get(e))){t.next=4;break}return t.abrupt("return",null);case 4:if(null===(n=a)||void 0===n||!n.bitmap){t.next=7;break}return a.refCounter+=1,t.abrupt("return",a);case 7:if(t.prev=7,a||(a={bitmap:null,id:"image_".concat(_(this,en),"_").concat((x(this,nn,1+(r=+_(this,nn))),r)),refCounter:0,isSvg:!1}),"string"!==typeof i){t.next=16;break}return a.url=i,t.next=13,ri(i,"blob");case 13:s=t.sent,t.next=17;break;case 16:s=a.file=i;case 17:if("image/svg+xml"!==s.type){t.next=27;break}return o=sn._isSVGFittingCanvas,l=new FileReader,h=new Image,u=new Promise((function(t,e){h.onload=function(){a.bitmap=h,a.isSvg=!0,t()},l.onload=(0,w.Z)(L.mark((function t(){var e;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=a.svgUrl=l.result,t.next=3,o;case 3:if(!t.sent){t.next=7;break}t.t0="".concat(e,"#svgView(preserveAspectRatio(none))"),t.next=8;break;case 7:t.t0=e;case 8:h.src=t.t0;case 9:case"end":return t.stop()}}),t)}))),h.onerror=l.onerror=e})),l.readAsDataURL(s),t.next=25,u;case 25:t.next=30;break;case 27:return t.next=29,createImageBitmap(s);case 29:a.bitmap=t.sent;case 30:a.refCounter=1,t.next=37;break;case 33:t.prev=33,t.t0=t.catch(7),console.error(t.t0),a=null;case 37:return _(this,an).set(e,a),a&&_(this,an).set(a.id,a),t.abrupt("return",a);case 40:case"end":return t.stop()}}),t,this,[[7,33]])})))).apply(this,arguments)}var hn=new WeakMap,un=new WeakMap,cn=new WeakMap,dn=new WeakMap,vn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;(0,T.Z)(this,t),A(this,hn,{writable:!0,value:[]}),A(this,un,{writable:!0,value:!1}),A(this,cn,{writable:!0,value:void 0}),A(this,dn,{writable:!0,value:-1}),x(this,cn,e)}return(0,Z.Z)(t,[{key:"add",value:function(t){var e=t.cmd,i=t.undo,n=t.post,a=t.mustExec,r=t.type,s=void 0===r?NaN:r,o=t.overwriteIfSameType,l=void 0!==o&&o,h=t.keepUndo,u=void 0!==h&&h;if(a&&e(),!_(this,un)){var c={cmd:e,undo:i,post:n,type:s};if(-1===_(this,dn))return _(this,hn).length>0&&(_(this,hn).length=0),x(this,dn,0),void _(this,hn).push(c);if(l&&_(this,hn)[_(this,dn)].type===s)return u&&(c.undo=_(this,hn)[_(this,dn)].undo),void(_(this,hn)[_(this,dn)]=c);var d=_(this,dn)+1;d===_(this,cn)?_(this,hn).splice(0,1):(x(this,dn,d),d<_(this,hn).length&&_(this,hn).splice(d)),_(this,hn).push(c)}}},{key:"undo",value:function(){if(-1!==_(this,dn)){x(this,un,!0);var t=_(this,hn)[_(this,dn)],e=t.undo,i=t.post;e(),null===i||void 0===i||i(),x(this,un,!1),x(this,dn,_(this,dn)-1)}}},{key:"redo",value:function(){if(_(this,dn)<_(this,hn).length-1){x(this,dn,_(this,dn)+1),x(this,un,!0);var t=_(this,hn)[_(this,dn)],e=t.cmd,i=t.post;e(),null===i||void 0===i||i(),x(this,un,!1)}}},{key:"hasSomethingToUndo",value:function(){return-1!==_(this,dn)}},{key:"hasSomethingToRedo",value:function(){return _(this,dn)<_(this,hn).length-1}},{key:"destroy",value:function(){x(this,hn,null)}}]),t}(),fn=new WeakSet,pn=function(){function t(e){(0,T.Z)(this,t),y(this,fn),this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;var i,n=Jt.platform.isMac,a=C(e);try{for(a.s();!(i=a.n()).done;){var r,s=(0,M.Z)(i.value,3),o=s[0],l=s[1],h=s[2],u=void 0===h?{}:h,c=C(o);try{for(c.s();!(r=c.n()).done;){var d=r.value,v=d.startsWith("mac+");n&&v?(this.callbacks.set(d.slice(4),{callback:l,options:u}),this.allKeys.add(d.split("+").at(-1))):n||v||(this.callbacks.set(d,{callback:l,options:u}),this.allKeys.add(d.split("+").at(-1)))}}catch(f){c.e(f)}finally{c.f()}}}catch(f){a.e(f)}finally{a.f()}}return(0,Z.Z)(t,[{key:"exec",value:function(t,e){if(this.allKeys.has(e.key)){var i=this.callbacks.get(k(this,fn,gn).call(this,e));if(i){var n=i.callback,a=i.options,r=a.bubbles,s=void 0!==r&&r,o=a.args,l=void 0===o?[]:o,h=a.checker,u=void 0===h?null:h;u&&!u(t,e)||(n.bind.apply(n,[t].concat((0,p.Z)(l),[e]))(),s||(e.stopPropagation(),e.preventDefault()))}}}}]),t}();function gn(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);var e=this.buffer.join("+");return this.buffer.length=0,e}var mn=function(){function t(){(0,T.Z)(this,t)}return(0,Z.Z)(t,[{key:"_colors",get:function(){var t=new Map([["CanvasText",null],["Canvas",null]]);return function(t){var e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);var i,n=C(t.keys());try{for(n.s();!(i=n.n()).done;){var a=i.value;e.style.color=a;var r=window.getComputedStyle(e).color;t.set(a,Ai(r))}}catch(s){n.e(s)}finally{n.f()}e.remove()}(t),Bt(this,"_colors",t)}},{key:"convert",value:function(e){var i=Ai(e);if(!window.matchMedia("(forced-colors: active)").matches)return i;var n,a=C(this._colors);try{for(a.s();!(n=a.n()).done;){var r=(0,M.Z)(n.value,2),s=r[0];if(r[1].every((function(t,e){return t===i[e]})))return t._colorsMapping.get(s)}}catch(o){a.e(o)}finally{a.f()}return i}},{key:"getHexCode",value:function(t){var e=this._colors.get(t);return e?te.makeHexColor.apply(te,(0,p.Z)(e)):t}}]),t}();(0,b.Z)(mn,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var yn=new WeakMap,kn=new WeakMap,bn=new WeakMap,wn=new WeakMap,An=new WeakMap,_n=new WeakMap,xn=new WeakMap,Sn=new WeakMap,Mn=new WeakMap,En=new WeakMap,Cn=new WeakMap,Zn=new WeakMap,Tn=new WeakMap,Rn=new WeakMap,Pn=new WeakMap,Ln=new WeakMap,In=new WeakMap,Fn=new WeakMap,Dn=new WeakMap,Wn=new WeakMap,Nn=new WeakMap,On=new WeakMap,Bn=new WeakMap,Hn=new WeakMap,zn=new WeakMap,jn=new WeakMap,Un=new WeakMap,Vn=new WeakMap,Gn=new WeakMap,qn=new WeakMap,Xn=new WeakMap,Kn=new WeakMap,Yn=new WeakMap,Qn=new WeakMap,Jn=new WeakMap,$n=new WeakMap,ta=new WeakMap,ea=new WeakMap,ia=new WeakMap,na=new WeakMap,aa=new WeakMap,ra=new WeakMap,sa=new WeakMap,oa=new WeakMap,la=new WeakMap,ha=new WeakMap,ua=new WeakMap,ca=new WeakSet,da=new WeakSet,va=new WeakSet,fa=new WeakSet,pa=new WeakSet,ga=new WeakSet,ma=new WeakSet,ya=new WeakSet,ka=new WeakSet,ba=new WeakSet,wa=new WeakSet,Aa=new WeakSet,_a=new WeakSet,xa=new WeakSet,Sa=new WeakSet,Ma=new WeakSet,Ea=new WeakSet,Ca=new WeakSet,Za=new WeakMap,Ta=new WeakSet,Ra=new WeakSet,Pa=function(){function t(e,i,n,a,r,s,o,l,h,u){(0,T.Z)(this,t),y(this,Ra),y(this,Ta),A(this,Za,{get:Qa,set:void 0}),y(this,Ca),y(this,Ea),y(this,Ma),y(this,Sa),y(this,xa),y(this,_a),y(this,Aa),y(this,wa),y(this,ba),y(this,ka),y(this,ya),y(this,ma),y(this,ga),y(this,pa),y(this,fa),y(this,va),y(this,da),y(this,ca),A(this,yn,{writable:!0,value:new AbortController}),A(this,kn,{writable:!0,value:null}),A(this,bn,{writable:!0,value:new Map}),A(this,wn,{writable:!0,value:new Map}),A(this,An,{writable:!0,value:null}),A(this,_n,{writable:!0,value:null}),A(this,xn,{writable:!0,value:null}),A(this,Sn,{writable:!0,value:new vn}),A(this,Mn,{writable:!0,value:0}),A(this,En,{writable:!0,value:new Set}),A(this,Cn,{writable:!0,value:null}),A(this,Zn,{writable:!0,value:null}),A(this,Tn,{writable:!0,value:new Set}),A(this,Rn,{writable:!0,value:!1}),A(this,Pn,{writable:!0,value:!1}),A(this,Ln,{writable:!0,value:null}),A(this,In,{writable:!0,value:null}),A(this,Fn,{writable:!0,value:null}),A(this,Dn,{writable:!0,value:!1}),A(this,Wn,{writable:!0,value:null}),A(this,Nn,{writable:!0,value:new tn}),A(this,On,{writable:!0,value:!1}),A(this,Bn,{writable:!0,value:!1}),A(this,Hn,{writable:!0,value:null}),A(this,zn,{writable:!0,value:null}),A(this,jn,{writable:!0,value:null}),A(this,Un,{writable:!0,value:X.NONE}),A(this,Vn,{writable:!0,value:new Set}),A(this,Gn,{writable:!0,value:null}),A(this,qn,{writable:!0,value:null}),A(this,Xn,{writable:!0,value:null}),A(this,Kn,{writable:!0,value:this.blur.bind(this)}),A(this,Yn,{writable:!0,value:this.focus.bind(this)}),A(this,Qn,{writable:!0,value:this.copy.bind(this)}),A(this,Jn,{writable:!0,value:this.cut.bind(this)}),A(this,$n,{writable:!0,value:this.paste.bind(this)}),A(this,ta,{writable:!0,value:this.keydown.bind(this)}),A(this,ea,{writable:!0,value:this.keyup.bind(this)}),A(this,ia,{writable:!0,value:this.onEditingAction.bind(this)}),A(this,na,{writable:!0,value:this.onPageChanging.bind(this)}),A(this,aa,{writable:!0,value:this.onScaleChanging.bind(this)}),A(this,ra,{writable:!0,value:this.onRotationChanging.bind(this)}),A(this,sa,{writable:!0,value:{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1}}),A(this,oa,{writable:!0,value:[0,0]}),A(this,la,{writable:!0,value:null}),A(this,ha,{writable:!0,value:null}),A(this,ua,{writable:!0,value:null}),this._signal=_(this,yn).signal,x(this,ha,e),x(this,ua,i),x(this,An,n),this._eventBus=a,this._eventBus._on("editingaction",_(this,ia)),this._eventBus._on("pagechanging",_(this,na)),this._eventBus._on("scalechanging",_(this,aa)),this._eventBus._on("rotationchanging",_(this,ra)),k(this,ga,Na).call(this),k(this,_a,Va).call(this),k(this,ka,Ha).call(this),x(this,_n,r.annotationStorage),x(this,Ln,r.filterFactory),x(this,qn,s),x(this,Fn,o||null),x(this,Rn,l),x(this,Pn,h),x(this,jn,u||null),this.viewParameters={realScale:Se.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}return(0,Z.Z)(t,[{key:"destroy",value:function(){var t,e,i;null===(t=_(this,yn))||void 0===t||t.abort(),x(this,yn,null),this._signal=null,this._eventBus._off("editingaction",_(this,ia)),this._eventBus._off("pagechanging",_(this,na)),this._eventBus._off("scalechanging",_(this,aa)),this._eventBus._off("rotationchanging",_(this,ra));var n,a=C(_(this,wn).values());try{for(a.s();!(n=a.n()).done;){n.value.destroy()}}catch(r){a.e(r)}finally{a.f()}_(this,wn).clear(),_(this,bn).clear(),_(this,Tn).clear(),x(this,kn,null),_(this,Vn).clear(),_(this,Sn).destroy(),null===(e=_(this,An))||void 0===e||e.destroy(),null===(i=_(this,Wn))||void 0===i||i.hide(),x(this,Wn,null),_(this,In)&&(clearTimeout(_(this,In)),x(this,In,null)),_(this,la)&&(clearTimeout(_(this,la)),x(this,la,null))}},{key:"mlGuess",value:function(){var t=(0,w.Z)(L.mark((function t(e){var i;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(null===(i=_(this,jn))||void 0===i?void 0:i.guess(e))||null);case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"isMLEnabledFor",value:function(){var t=(0,w.Z)(L.mark((function t(e){var i;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null===(i=_(this,jn))||void 0===i?void 0:i.isEnabledFor(e);case 2:return t.abrupt("return",!!t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"useNewAltTextFlow",get:function(){return _(this,Pn)}},{key:"hcmFilter",get:function(){return Bt(this,"hcmFilter",_(this,qn)?_(this,Ln).addHCMFilter(_(this,qn).foreground,_(this,qn).background):"none")}},{key:"direction",get:function(){return Bt(this,"direction",getComputedStyle(_(this,ha)).direction)}},{key:"highlightColors",get:function(){return Bt(this,"highlightColors",_(this,Fn)?new Map(_(this,Fn).split(",").map((function(t){return t.split("=").map((function(t){return t.trim()}))}))):null)}},{key:"highlightColorNames",get:function(){return Bt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,(function(t){return t.reverse()}))):null)}},{key:"setMainHighlightColorPicker",value:function(t){x(this,zn,t)}},{key:"editAltText",value:function(t){var e;null===(e=_(this,An))||void 0===e||e.editAltText(this,t)}},{key:"switchToMode",value:function(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}},{key:"setPreference",value:function(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}},{key:"onPageChanging",value:function(t){var e=t.pageNumber;x(this,Mn,e-1)}},{key:"focusMainContainer",value:function(){_(this,ha).focus()}},{key:"findParent",value:function(t,e){var i,n=C(_(this,wn).values());try{for(n.s();!(i=n.n()).done;){var a=i.value,r=a.div.getBoundingClientRect(),s=r.x,o=r.y,l=r.width,h=r.height;if(t>=s&&t<=s+l&&e>=o&&e<=o+h)return a}}catch(u){n.e(u)}finally{n.f()}return null}},{key:"disableUserSelect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_(this,ua).classList.toggle("noUserSelect",t)}},{key:"addShouldRescale",value:function(t){_(this,Tn).add(t)}},{key:"removeShouldRescale",value:function(t){_(this,Tn).delete(t)}},{key:"onScaleChanging",value:function(t){var e=t.scale;this.commitOrRemove(),this.viewParameters.realScale=e*Se.PDF_TO_CSS_UNITS;var i,n=C(_(this,Tn));try{for(n.s();!(i=n.n()).done;){i.value.onScaleChanging()}}catch(a){n.e(a)}finally{n.f()}}},{key:"onRotationChanging",value:function(t){var e=t.pagesRotation;this.commitOrRemove(),this.viewParameters.rotation=e}},{key:"highlightSelection",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=document.getSelection();if(i&&!i.isCollapsed){var n=i.anchorNode,a=i.anchorOffset,r=i.focusNode,s=i.focusOffset,o=i.toString(),l=k(this,ca,La).call(this,i),h=l.closest(".textLayer"),u=this.getSelectionBoxes(h);if(u){i.empty();var c=k(this,da,Ia).call(this,h),d=_(this,Un)===X.NONE,v=function(){null===c||void 0===c||c.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:u,anchorNode:n,anchorOffset:a,focusNode:r,focusOffset:s,text:o}),d&&t.showAllEditors("highlight",!0,!0)};d?this.switchToMode(X.HIGHLIGHT,v):v()}}}},{key:"addToAnnotationStorage",value:function(t){t.isEmpty()||!_(this,_n)||_(this,_n).has(t.id)||_(this,_n).setValue(t.id,t)}},{key:"blur",value:function(){if(this.isShiftKeyDown=!1,_(this,Dn)&&(x(this,Dn,!1),k(this,pa,Wa).call(this,"main_toolbar")),this.hasSelection){var t,e=document.activeElement,i=C(_(this,Vn));try{for(i.s();!(t=i.n()).done;){var n=t.value;if(n.div.contains(e)){x(this,Hn,[n,e]),n._focusEventsAllowed=!1;break}}}catch(a){i.e(a)}finally{i.f()}}}},{key:"focus",value:function(){if(_(this,Hn)){var t=_(this,Hn),e=(0,M.Z)(t,2),i=e[0],n=e[1];x(this,Hn,null),n.addEventListener("focusin",(function(){i._focusEventsAllowed=!0}),{once:!0,signal:this._signal}),n.focus()}}},{key:"addEditListeners",value:function(){k(this,ka,Ha).call(this),k(this,wa,ja).call(this)}},{key:"removeEditListeners",value:function(){k(this,ba,za).call(this),k(this,Aa,Ua).call(this)}},{key:"dragOver",value:function(t){var e,i=C(t.dataTransfer.items);try{for(i.s();!(e=i.n()).done;){var n,a=e.value.type,r=C(_(this,Zn));try{for(r.s();!(n=r.n()).done;){if(n.value.isHandlingMimeForPasting(a))return t.dataTransfer.dropEffect="copy",void t.preventDefault()}}catch(s){r.e(s)}finally{r.f()}}}catch(s){i.e(s)}finally{i.f()}}},{key:"drop",value:function(t){var e,i=C(t.dataTransfer.items);try{for(i.s();!(e=i.n()).done;){var n,a=e.value,r=C(_(this,Zn));try{for(r.s();!(n=r.n()).done;){var s=n.value;if(s.isHandlingMimeForPasting(a.type))return s.paste(a,this.currentLayer),void t.preventDefault()}}catch(o){r.e(o)}finally{r.f()}}}catch(o){i.e(o)}finally{i.f()}}},{key:"copy",value:function(t){var e;if(t.preventDefault(),null===(e=_(this,kn))||void 0===e||e.commitOrRemove(),this.hasSelection){var i,n=[],a=C(_(this,Vn));try{for(a.s();!(i=a.n()).done;){var r=i.value.serialize(!0);r&&n.push(r)}}catch(s){a.e(s)}finally{a.f()}0!==n.length&&t.clipboardData.setData("application/pdfjs",JSON.stringify(n))}}},{key:"cut",value:function(t){this.copy(t),this.delete()}},{key:"paste",value:function(t){var e=this;t.preventDefault();var i,n=t.clipboardData,a=C(n.items);try{for(a.s();!(i=a.n()).done;){var r,s=i.value,o=C(_(this,Zn));try{for(o.s();!(r=o.n()).done;){var l=r.value;if(l.isHandlingMimeForPasting(s.type))return void l.paste(s,this.currentLayer)}}catch(g){o.e(g)}finally{o.f()}}}catch(g){a.e(g)}finally{a.f()}var h=n.getData("application/pdfjs");if(h){try{h=JSON.parse(h)}catch(m){return void Ft('paste: "'.concat(m.message,'".'))}if(Array.isArray(h)){this.unselectAll();var u=this.currentLayer;try{var c,d=[],v=C(h);try{for(v.s();!(c=v.n()).done;){var f=c.value,p=u.deserialize(f);if(!p)return;d.push(p)}}catch(g){v.e(g)}finally{v.f()}this.addCommands({cmd:function(){var t,i=C(d);try{for(i.s();!(t=i.n()).done;){var n=t.value;k(e,Ca,Ya).call(e,n)}}catch(g){i.e(g)}finally{i.f()}k(e,Ra,$a).call(e,d)},undo:function(){var t,e=C(d);try{for(e.s();!(t=e.n()).done;){t.value.remove()}}catch(g){e.e(g)}finally{e.f()}},mustExec:!0})}catch(m){Ft('paste: "'.concat(m.message,'".'))}}}}},{key:"keydown",value:function(e){this.isShiftKeyDown||"Shift"!==e.key||(this.isShiftKeyDown=!0),_(this,Un)===X.NONE||this.isEditorHandlingKeyboard||t._keyboardManager.exec(this,e)}},{key:"keyup",value:function(t){this.isShiftKeyDown&&"Shift"===t.key&&(this.isShiftKeyDown=!1,_(this,Dn)&&(x(this,Dn,!1),k(this,pa,Wa).call(this,"main_toolbar")))}},{key:"onEditingAction",value:function(t){var e=t.name;switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu")}}},{key:"setEditingState",value:function(t){t?(k(this,ma,Oa).call(this),k(this,wa,ja).call(this),k(this,xa,Ga).call(this,{isEditing:_(this,Un)!==X.NONE,isEmpty:k(this,Ta,Ja).call(this),hasSomethingToUndo:_(this,Sn).hasSomethingToUndo(),hasSomethingToRedo:_(this,Sn).hasSomethingToRedo(),hasSelectedEditor:!1})):(k(this,ya,Ba).call(this),k(this,Aa,Ua).call(this),k(this,xa,Ga).call(this,{isEditing:!1}),this.disableUserSelect(!1))}},{key:"registerEditorTypes",value:function(t){if(!_(this,Zn)){x(this,Zn,t);var e,i=C(_(this,Zn));try{for(i.s();!(e=i.n()).done;){var n=e.value;k(this,Sa,qa).call(this,n.defaultPropertiesToUpdate)}}catch(a){i.e(a)}finally{i.f()}}}},{key:"getId",value:function(){return _(this,Nn).id}},{key:"currentLayer",get:function(){return _(this,wn).get(_(this,Mn))}},{key:"getLayer",value:function(t){return _(this,wn).get(t)}},{key:"currentPageIndex",get:function(){return _(this,Mn)}},{key:"addLayer",value:function(t){_(this,wn).set(t.pageIndex,t),_(this,On)?t.enable():t.disable()}},{key:"removeLayer",value:function(t){_(this,wn).delete(t.pageIndex)}},{key:"updateMode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(_(this,Un)!==t){if(x(this,Un,t),t===X.NONE)return this.setEditingState(!1),void k(this,Ea,Ka).call(this);this.setEditingState(!0),k(this,Ma,Xa).call(this),this.unselectAll();var n,a=C(_(this,wn).values());try{for(a.s();!(n=a.n()).done;){var r=n.value;r.updateMode(t)}}catch(h){a.e(h)}finally{a.f()}if(e||!i){if(e){var s,o=C(_(this,bn).values());try{for(o.s();!(s=o.n()).done;){var l=s.value;if(l.annotationElementId===e){this.setSelected(l),l.enterInEditMode();break}}}catch(h){o.e(h)}finally{o.f()}}}else this.addNewEditorFromKeyboard()}}},{key:"addNewEditorFromKeyboard",value:function(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}},{key:"updateToolbar",value:function(t){t!==_(this,Un)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}},{key:"updateParams",value:function(t,e){var i;if(_(this,Zn)){switch(t){case K.CREATE:return void this.currentLayer.addNewEditor();case K.HIGHLIGHT_DEFAULT_COLOR:null===(i=_(this,zn))||void 0===i||i.updateColor(e);break;case K.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(_(this,Xn)||x(this,Xn,new Map)).set(t,e),this.showAllEditors("highlight",e)}var n,a=C(_(this,Vn));try{for(a.s();!(n=a.n()).done;){n.value.updateParams(t,e)}}catch(o){a.e(o)}finally{a.f()}var r,s=C(_(this,Zn));try{for(s.s();!(r=s.n()).done;){r.value.updateDefaultParams(t,e)}}catch(o){s.e(o)}finally{s.f()}}}},{key:"showAllEditors",value:function(t,e){var i,n,a,r=C(_(this,bn).values());try{for(r.s();!(a=r.n()).done;){var s=a.value;s.editorType===t&&s.show(e)}}catch(l){r.e(l)}finally{r.f()}var o=null===(i=null===(n=_(this,Xn))||void 0===n?void 0:n.get(K.HIGHLIGHT_SHOW_ALL))||void 0===i||i;o!==e&&k(this,Sa,qa).call(this,[[K.HIGHLIGHT_SHOW_ALL,e]])}},{key:"enableWaiting",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(_(this,Bn)!==t){x(this,Bn,t);var e,i=C(_(this,wn).values());try{for(i.s();!(e=i.n()).done;){var n=e.value;t?n.disableClick():n.enableClick(),n.div.classList.toggle("waiting",t)}}catch(a){i.e(a)}finally{i.f()}}}},{key:"getEditors",value:function(t){var e,i=[],n=C(_(this,bn).values());try{for(n.s();!(e=n.n()).done;){var a=e.value;a.pageIndex===t&&i.push(a)}}catch(r){n.e(r)}finally{n.f()}return i}},{key:"getEditor",value:function(t){return _(this,bn).get(t)}},{key:"addEditor",value:function(t){_(this,bn).set(t.id,t)}},{key:"removeEditor",value:function(t){var e,i=this;(t.div.contains(document.activeElement)&&(_(this,In)&&clearTimeout(_(this,In)),x(this,In,setTimeout((function(){i.focusMainContainer(),x(i,In,null)}),0))),_(this,bn).delete(t.id),this.unselect(t),t.annotationElementId&&_(this,En).has(t.annotationElementId))||(null===(e=_(this,_n))||void 0===e||e.remove(t.id))}},{key:"addDeletedAnnotationElement",value:function(t){_(this,En).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}},{key:"isDeletedAnnotationElement",value:function(t){return _(this,En).has(t)}},{key:"removeDeletedAnnotationElement",value:function(t){_(this,En).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}},{key:"setActiveEditor",value:function(t){_(this,kn)!==t&&(x(this,kn,t),t&&k(this,Sa,qa).call(this,t.propertiesToUpdate))}},{key:"updateUI",value:function(t){_(this,Za)===t&&k(this,Sa,qa).call(this,t.propertiesToUpdate)}},{key:"toggleSelected",value:function(t){if(_(this,Vn).has(t))return _(this,Vn).delete(t),t.unselect(),void k(this,xa,Ga).call(this,{hasSelectedEditor:this.hasSelection});_(this,Vn).add(t),t.select(),k(this,Sa,qa).call(this,t.propertiesToUpdate),k(this,xa,Ga).call(this,{hasSelectedEditor:!0})}},{key:"setSelected",value:function(t){var e,i=C(_(this,Vn));try{for(i.s();!(e=i.n()).done;){var n=e.value;n!==t&&n.unselect()}}catch(a){i.e(a)}finally{i.f()}_(this,Vn).clear(),_(this,Vn).add(t),t.select(),k(this,Sa,qa).call(this,t.propertiesToUpdate),k(this,xa,Ga).call(this,{hasSelectedEditor:!0})}},{key:"isSelected",value:function(t){return _(this,Vn).has(t)}},{key:"firstSelectedEditor",get:function(){return _(this,Vn).values().next().value}},{key:"unselect",value:function(t){t.unselect(),_(this,Vn).delete(t),k(this,xa,Ga).call(this,{hasSelectedEditor:this.hasSelection})}},{key:"hasSelection",get:function(){return 0!==_(this,Vn).size}},{key:"isEnterHandled",get:function(){return 1===_(this,Vn).size&&this.firstSelectedEditor.isEnterHandled}},{key:"undo",value:function(){_(this,Sn).undo(),k(this,xa,Ga).call(this,{hasSomethingToUndo:_(this,Sn).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:k(this,Ta,Ja).call(this)})}},{key:"redo",value:function(){_(this,Sn).redo(),k(this,xa,Ga).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:_(this,Sn).hasSomethingToRedo(),isEmpty:k(this,Ta,Ja).call(this)})}},{key:"addCommands",value:function(t){_(this,Sn).add(t),k(this,xa,Ga).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:k(this,Ta,Ja).call(this)})}},{key:"delete",value:function(){var t=this;if(this.commitOrRemove(),this.hasSelection){var e=(0,p.Z)(_(this,Vn));this.addCommands({cmd:function(){var t,i=C(e);try{for(i.s();!(t=i.n()).done;){t.value.remove()}}catch(n){i.e(n)}finally{i.f()}},undo:function(){var i,n=C(e);try{for(n.s();!(i=n.n()).done;){var a=i.value;k(t,Ca,Ya).call(t,a)}}catch(r){n.e(r)}finally{n.f()}},mustExec:!0})}}},{key:"commitOrRemove",value:function(){var t;null===(t=_(this,kn))||void 0===t||t.commitOrRemove()}},{key:"hasSomethingToControl",value:function(){return _(this,kn)||this.hasSelection}},{key:"selectAll",value:function(){var t,e=C(_(this,Vn));try{for(e.s();!(t=e.n()).done;){t.value.commit()}}catch(i){e.e(i)}finally{e.f()}k(this,Ra,$a).call(this,_(this,bn).values())}},{key:"unselectAll",value:function(){if((!_(this,kn)||(_(this,kn).commitOrRemove(),_(this,Un)===X.NONE))&&this.hasSelection){var t,e=C(_(this,Vn));try{for(e.s();!(t=e.n()).done;){t.value.unselect()}}catch(i){e.e(i)}finally{e.f()}_(this,Vn).clear(),k(this,xa,Ga).call(this,{hasSelectedEditor:!1})}}},{key:"translateSelectedEditors",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n||this.commitOrRemove(),this.hasSelection){_(this,oa)[0]+=t,_(this,oa)[1]+=e;var a=_(this,oa),r=(0,M.Z)(a,2),s=r[0],o=r[1],l=(0,p.Z)(_(this,Vn)),h=1e3;_(this,la)&&clearTimeout(_(this,la)),x(this,la,setTimeout((function(){x(i,la,null),_(i,oa)[0]=_(i,oa)[1]=0,i.addCommands({cmd:function(){var t,e=C(l);try{for(e.s();!(t=e.n()).done;){var n=t.value;_(i,bn).has(n.id)&&n.translateInPage(s,o)}}catch(a){e.e(a)}finally{e.f()}},undo:function(){var t,e=C(l);try{for(e.s();!(t=e.n()).done;){var n=t.value;_(i,bn).has(n.id)&&n.translateInPage(-s,-o)}}catch(a){e.e(a)}finally{e.f()}},mustExec:!1})}),h));var u,c=C(l);try{for(c.s();!(u=c.n()).done;){var d=u.value;d.translateInPage(t,e)}}catch(v){c.e(v)}finally{c.f()}}}},{key:"setUpDragSession",value:function(){if(this.hasSelection){this.disableUserSelect(!0),x(this,Cn,new Map);var t,e=C(_(this,Vn));try{for(e.s();!(t=e.n()).done;){var i=t.value;_(this,Cn).set(i,{savedX:i.x,savedY:i.y,savedPageIndex:i.pageIndex,newX:0,newY:0,newPageIndex:-1})}}catch(n){e.e(n)}finally{e.f()}}}},{key:"endDragSession",value:function(){var t=this;if(!_(this,Cn))return!1;this.disableUserSelect(!1);var e=_(this,Cn);x(this,Cn,null);var i,n=!1,a=C(e);try{for(a.s();!(i=a.n()).done;){var r=(0,M.Z)(i.value,2),s=r[0],o=s.x,l=s.y,h=s.pageIndex,u=r[1];u.newX=o,u.newY=l,u.newPageIndex=h,n||(n=o!==u.savedX||l!==u.savedY||h!==u.savedPageIndex)}}catch(d){a.e(d)}finally{a.f()}if(!n)return!1;var c=function(e,i,n,a){if(_(t,bn).has(e.id)){var r=_(t,wn).get(a);r?e._setParentAndPosition(r,i,n):(e.pageIndex=a,e.x=i,e.y=n)}};return this.addCommands({cmd:function(){var t,i=C(e);try{for(i.s();!(t=i.n()).done;){var n=(0,M.Z)(t.value,2),a=n[0],r=n[1],s=r.newX,o=r.newY,l=r.newPageIndex;c(a,s,o,l)}}catch(d){i.e(d)}finally{i.f()}},undo:function(){var t,i=C(e);try{for(i.s();!(t=i.n()).done;){var n=(0,M.Z)(t.value,2),a=n[0],r=n[1],s=r.savedX,o=r.savedY,l=r.savedPageIndex;c(a,s,o,l)}}catch(d){i.e(d)}finally{i.f()}},mustExec:!0}),!0}},{key:"dragSelectedEditors",value:function(t,e){if(_(this,Cn)){var i,n=C(_(this,Cn).keys());try{for(n.s();!(i=n.n()).done;){i.value.drag(t,e)}}catch(a){n.e(a)}finally{n.f()}}}},{key:"rebuild",value:function(t){if(null===t.parent){var e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}},{key:"isEditorHandlingKeyboard",get:function(){var t;return(null===(t=this.getActive())||void 0===t?void 0:t.shouldGetKeyboardEvents())||1===_(this,Vn).size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}},{key:"isActive",value:function(t){return _(this,kn)===t}},{key:"getActive",value:function(){return _(this,kn)}},{key:"getMode",value:function(){return _(this,Un)}},{key:"imageManager",get:function(){return Bt(this,"imageManager",new sn)}},{key:"getSelectionBoxes",value:function(t){if(!t)return null;for(var e=document.getSelection(),i=0,n=e.rangeCount;i<n;i++)if(!t.contains(e.getRangeAt(i).commonAncestorContainer))return null;var a,r=t.getBoundingClientRect(),s=r.x,o=r.y,l=r.width,h=r.height;switch(t.getAttribute("data-main-rotation")){case"90":a=function(t,e,i,n){return{x:(e-o)/h,y:1-(t+i-s)/l,width:n/h,height:i/l}};break;case"180":a=function(t,e,i,n){return{x:1-(t+i-s)/l,y:1-(e+n-o)/h,width:i/l,height:n/h}};break;case"270":a=function(t,e,i,n){return{x:1-(e+n-o)/h,y:(t-s)/l,width:n/h,height:i/l}};break;default:a=function(t,e,i,n){return{x:(t-s)/l,y:(e-o)/h,width:i/l,height:n/h}}}for(var u=[],c=0,d=e.rangeCount;c<d;c++){var v=e.getRangeAt(c);if(!v.collapsed){var f,p=C(v.getClientRects());try{for(p.s();!(f=p.n()).done;){var g=f.value,m=g.x,y=g.y,k=g.width,b=g.height;0!==k&&0!==b&&u.push(a(m,y,k,b))}}catch(w){p.e(w)}finally{p.f()}}}return 0===u.length?null:u}},{key:"addChangedExistingAnnotation",value:function(t){var e=t.annotationElementId,i=t.id;(_(this,xn)||x(this,xn,new Map)).set(e,i)}},{key:"removeChangedExistingAnnotation",value:function(t){var e,i=t.annotationElementId;null===(e=_(this,xn))||void 0===e||e.delete(i)}},{key:"renderAnnotationElement",value:function(t){var e,i=null===(e=_(this,xn))||void 0===e?void 0:e.get(t.data.id);if(i){var n=_(this,_n).getRawValue(i);n&&(_(this,Un)!==X.NONE||n.hasBeenModified)&&n.renderAnnotationElement(t)}}}],[{key:"_keyboardManager",get:function(){var e=t.prototype,i=function(t){return _(t,ha).contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&t.hasSomethingToControl()},n=function(t,e){var i=e.target;if(i instanceof HTMLInputElement){var n=i.type;return"text"!==n&&"number"!==n}return!0},a=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return Bt(this,"_keyboardManager",new pn([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:function(t,e){var i=e.target;return!(i instanceof HTMLButtonElement)&&_(t,ha).contains(i)&&!t.isEnterHandled}}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:function(t,e){return!(e.target instanceof HTMLButtonElement)&&_(t,ha).contains(document.activeElement)}}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-a,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:i}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[a,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:i}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-a],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:i}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,a],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:i}]]))}}]),t}();function La(t){var e=t.anchorNode;return e.nodeType===Node.TEXT_NODE?e.parentElement:e}function Ia(t){var e=this.currentLayer;if(e.hasTextLayer(t))return e;var i,n=C(_(this,wn).values());try{for(n.s();!(i=n.n()).done;){var a=i.value;if(a.hasTextLayer(t))return a}}catch(r){n.e(r)}finally{n.f()}return null}function Fa(){var t=document.getSelection();if(t&&!t.isCollapsed){var e=k(this,ca,La).call(this,t).closest(".textLayer"),i=this.getSelectionBoxes(e);i&&(_(this,Wn)||x(this,Wn,new Xi(this)),_(this,Wn).show(e,i,"ltr"===this.direction))}}function Da(){var t,e=this,i=document.getSelection();if(i&&!i.isCollapsed){var n=i.anchorNode;if(n!==_(this,Gn)){var a,r=k(this,ca,La).call(this,i).closest(".textLayer");if(r){if(null===(t=_(this,Wn))||void 0===t||t.hide(),x(this,Gn,n),k(this,xa,Ga).call(this,{hasSelectedText:!0}),(_(this,Un)===X.HIGHLIGHT||_(this,Un)===X.NONE)&&(_(this,Un)===X.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),x(this,Dn,this.isShiftKeyDown),!this.isShiftKeyDown)){var s=_(this,Un)===X.HIGHLIGHT?k(this,da,Ia).call(this,r):null;null===s||void 0===s||s.toggleDrawing();var o=this._signal,l=function t(i){"pointerup"===i.type&&0!==i.button||(null===s||void 0===s||s.toggleDrawing(!0),window.removeEventListener("pointerup",t),window.removeEventListener("blur",t),"pointerup"===i.type&&k(e,pa,Wa).call(e,"main_toolbar"))};window.addEventListener("pointerup",l,{signal:o}),window.addEventListener("blur",l,{signal:o})}}else _(this,Gn)&&(null===(a=_(this,Wn))||void 0===a||a.hide(),x(this,Gn,null),k(this,xa,Ga).call(this,{hasSelectedText:!1}))}}else{var h;_(this,Gn)&&(null===(h=_(this,Wn))||void 0===h||h.hide(),x(this,Gn,null),k(this,xa,Ga).call(this,{hasSelectedText:!1}))}}function Wa(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";_(this,Un)===X.HIGHLIGHT?this.highlightSelection(t):_(this,Rn)&&k(this,va,Fa).call(this)}function Na(){document.addEventListener("selectionchange",k(this,fa,Da).bind(this),{signal:this._signal})}function Oa(){var t=this._signal;window.addEventListener("focus",_(this,Yn),{signal:t}),window.addEventListener("blur",_(this,Kn),{signal:t})}function Ba(){window.removeEventListener("focus",_(this,Yn)),window.removeEventListener("blur",_(this,Kn))}function Ha(){var t=this._signal;window.addEventListener("keydown",_(this,ta),{signal:t}),window.addEventListener("keyup",_(this,ea),{signal:t})}function za(){window.removeEventListener("keydown",_(this,ta)),window.removeEventListener("keyup",_(this,ea))}function ja(){var t=this._signal;document.addEventListener("copy",_(this,Qn),{signal:t}),document.addEventListener("cut",_(this,Jn),{signal:t}),document.addEventListener("paste",_(this,$n),{signal:t})}function Ua(){document.removeEventListener("copy",_(this,Qn)),document.removeEventListener("cut",_(this,Jn)),document.removeEventListener("paste",_(this,$n))}function Va(){var t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}function Ga(t){var e=this;Object.entries(t).some((function(t){var i=(0,M.Z)(t,2),n=i[0],a=i[1];return _(e,sa)[n]!==a}))&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(_(this,sa),t)}),_(this,Un)===X.HIGHLIGHT&&!1===t.hasSelectedEditor&&k(this,Sa,qa).call(this,[[K.HIGHLIGHT_FREE,!0]]))}function qa(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}function Xa(){if(!_(this,On)){x(this,On,!0);var t,e=C(_(this,wn).values());try{for(e.s();!(t=e.n()).done;){t.value.enable()}}catch(a){e.e(a)}finally{e.f()}var i,n=C(_(this,bn).values());try{for(n.s();!(i=n.n()).done;){i.value.enable()}}catch(a){n.e(a)}finally{n.f()}}}function Ka(){if(this.unselectAll(),_(this,On)){x(this,On,!1);var t,e=C(_(this,wn).values());try{for(e.s();!(t=e.n()).done;){t.value.disable()}}catch(a){e.e(a)}finally{e.f()}var i,n=C(_(this,bn).values());try{for(n.s();!(i=n.n()).done;){i.value.disable()}}catch(a){n.e(a)}finally{n.f()}}}function Ya(t){var e=_(this,wn).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}function Qa(){var t,e=null,i=C(_(this,Vn));try{for(i.s();!(t=i.n()).done;)e=t.value}catch(n){i.e(n)}finally{i.f()}return e}function Ja(){if(0===_(this,bn).size)return!0;if(1===_(this,bn).size){var t,e=C(_(this,bn).values());try{for(e.s();!(t=e.n()).done;){return t.value.isEmpty()}}catch(i){e.e(i)}finally{e.f()}}return!1}function $a(t){var e,i=C(_(this,Vn));try{for(i.s();!(e=i.n()).done;){e.value.unselect()}}catch(s){i.e(s)}finally{i.f()}_(this,Vn).clear();var n,a=C(t);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.isEmpty()||(_(this,Vn).add(r),r.select())}}catch(s){a.e(s)}finally{a.f()}k(this,xa,Ga).call(this,{hasSelectedEditor:this.hasSelection})}(0,b.Z)(Pa,"TRANSLATE_SMALL",1),(0,b.Z)(Pa,"TRANSLATE_BIG",10);var tr=new WeakMap,er=new WeakMap,ir=new WeakMap,nr=new WeakMap,ar=new WeakMap,rr=new WeakMap,sr=new WeakMap,or=new WeakSet,lr=function(){function t(e){(0,T.Z)(this,t),y(this,or),A(this,tr,{writable:!0,value:""}),A(this,er,{writable:!0,value:!1}),A(this,ir,{writable:!0,value:null}),A(this,nr,{writable:!0,value:null}),A(this,ar,{writable:!0,value:null}),A(this,rr,{writable:!0,value:!1}),A(this,sr,{writable:!0,value:null}),x(this,sr,e)}return(0,Z.Z)(t,[{key:"render",value:function(){var e=(0,w.Z)(L.mark((function e(){var i,n,a,r,s=this;return L.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=x(this,ir,document.createElement("button"))).className="altText",e.next=4,t._l10nPromise.get("pdfjs-editor-alt-text-button-label");case 4:return n=e.sent,i.textContent=n,i.setAttribute("aria-label",n),i.tabIndex="0",a=_(this,sr)._uiManager._signal,i.addEventListener("contextmenu",ki,{signal:a}),i.addEventListener("pointerdown",(function(t){return t.stopPropagation()}),{signal:a}),r=function(t){t.preventDefault(),_(s,sr)._uiManager.editAltText(_(s,sr))},i.addEventListener("click",r,{capture:!0,signal:a}),i.addEventListener("keydown",(function(t){t.target===i&&"Enter"===t.key&&(x(s,rr,!0),r(t))}),{signal:a}),e.next=16,k(this,or,hr).call(this);case 16:return e.abrupt("return",i);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"finish",value:function(){_(this,ir)&&(_(this,ir).focus({focusVisible:_(this,rr)}),x(this,rr,!1))}},{key:"isEmpty",value:function(){return!_(this,tr)&&!_(this,er)}},{key:"data",get:function(){return{altText:_(this,tr),decorative:_(this,er)}},set:function(t){var e=t.altText,i=t.decorative;_(this,tr)===e&&_(this,er)===i||(x(this,tr,e),x(this,er,i),k(this,or,hr).call(this))}},{key:"toggle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_(this,ir)&&(!t&&_(this,ar)&&(clearTimeout(_(this,ar)),x(this,ar,null)),_(this,ir).disabled=!t)}},{key:"destroy",value:function(){var t;null===(t=_(this,ir))||void 0===t||t.remove(),x(this,ir,null),x(this,nr,null)}}],[{key:"initialize",value:function(e){t._l10nPromise||(t._l10nPromise=e)}}]),t}();function hr(){return ur.apply(this,arguments)}function ur(){return(ur=(0,w.Z)(L.mark((function t(){var e,i,n,a,r,s,o=this;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=_(this,ir)){t.next=3;break}return t.abrupt("return");case 3:if(_(this,tr)||_(this,er)){t.next=7;break}return e.classList.remove("done"),null===(i=_(this,nr))||void 0===i||i.remove(),t.abrupt("return");case 7:if(e.classList.add("done"),lr._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then((function(t){e.setAttribute("aria-label",t)})),(n=_(this,nr))||(x(this,nr,n=document.createElement("span")),n.className="tooltip",n.setAttribute("role","tooltip"),a=n.id="alt-text-tooltip-".concat(_(this,sr).id),e.setAttribute("aria-describedby",a),100,(r=_(this,sr)._uiManager._signal).addEventListener("abort",(function(){clearTimeout(_(o,ar)),x(o,ar,null)}),{once:!0}),e.addEventListener("mouseenter",(function(){x(o,ar,setTimeout((function(){x(o,ar,null),_(o,nr).classList.add("show"),_(o,sr)._reportTelemetry({action:"alt_text_tooltip"})}),100))}),{signal:r}),e.addEventListener("mouseleave",(function(){var t;_(o,ar)&&(clearTimeout(_(o,ar)),x(o,ar,null)),null===(t=_(o,nr))||void 0===t||t.classList.remove("show")}),{signal:r})),!_(this,er)){t.next=17;break}return t.next=14,lr._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip");case 14:t.t0=t.sent,t.next=18;break;case 17:t.t0=_(this,tr);case 18:n.innerText=t.t0,n.parentNode||e.append(n),null===(s=_(this,sr).getImageForAltText())||void 0===s||s.setAttribute("aria-describedby",n.id);case 22:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}(0,b.Z)(lr,"_l10nPromise",null);var cr=new WeakMap,dr=new WeakMap,vr=new WeakMap,fr=new WeakMap,pr=new WeakMap,gr=new WeakMap,mr=new WeakMap,yr=new WeakMap,kr=new WeakMap,br=new WeakMap,wr=new WeakMap,Ar=new WeakMap,_r=new WeakMap,xr=new WeakMap,Sr=new WeakMap,Mr=new WeakMap,Er=new WeakMap,Cr=new WeakMap,Zr=new WeakMap,Tr=new WeakMap,Rr=new WeakMap,Pr=new WeakMap,Lr=new WeakSet,Ir=new WeakSet,Fr=new WeakSet,Dr=new WeakSet,Wr=new WeakSet,Nr=new WeakSet,Or=new WeakSet,Br=new WeakSet,Hr=new WeakSet,zr=new WeakSet,jr=new WeakSet,Ur=new WeakSet,Vr=new WeakSet,Gr=function(){function t(e){(0,T.Z)(this,t),y(this,Vr),y(this,Ur),y(this,jr),y(this,zr),y(this,Hr),y(this,Br),y(this,Or),y(this,Nr),y(this,Wr),y(this,Dr),y(this,Fr),y(this,Ir),y(this,Lr),A(this,cr,{writable:!0,value:null}),A(this,dr,{writable:!0,value:null}),A(this,vr,{writable:!0,value:null}),A(this,fr,{writable:!0,value:!1}),A(this,pr,{writable:!0,value:!1}),A(this,gr,{writable:!0,value:null}),A(this,mr,{writable:!0,value:null}),A(this,yr,{writable:!0,value:this.focusin.bind(this)}),A(this,kr,{writable:!0,value:this.focusout.bind(this)}),A(this,br,{writable:!0,value:null}),A(this,wr,{writable:!0,value:""}),A(this,Ar,{writable:!0,value:!1}),A(this,_r,{writable:!0,value:null}),A(this,xr,{writable:!0,value:!1}),A(this,Sr,{writable:!0,value:!1}),A(this,Mr,{writable:!0,value:!1}),A(this,Er,{writable:!0,value:null}),A(this,Cr,{writable:!0,value:0}),A(this,Zr,{writable:!0,value:0}),A(this,Tr,{writable:!0,value:null}),(0,b.Z)(this,"_initialOptions",Object.create(null)),(0,b.Z)(this,"_isVisible",!0),(0,b.Z)(this,"_uiManager",null),(0,b.Z)(this,"_focusEventsAllowed",!0),(0,b.Z)(this,"_l10nPromise",null),A(this,Rr,{writable:!0,value:!1}),A(this,Pr,{writable:!0,value:t._zIndex++}),this.constructor===t&&Dt("Cannot initialize AnnotationEditor."),this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;var i=this.parent.viewport,n=i.rotation,a=i.rawDims,r=a.pageWidth,s=a.pageHeight,o=a.pageX,l=a.pageY;this.rotation=n,this.pageRotation=(360+n-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[r,s],this.pageTranslation=[o,l];var h=(0,M.Z)(this.parentDimensions,2),u=h[0],c=h[1];this.x=e.x/u,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}return(0,Z.Z)(t,[{key:"editorType",get:function(){return Object.getPrototypeOf(this).constructor._type}},{key:"propertiesToUpdate",get:function(){return[]}},{key:"_isDraggable",get:function(){return _(this,Rr)},set:function(t){var e;x(this,Rr,t),null===(e=this.div)||void 0===e||e.classList.toggle("draggable",t)}},{key:"isEnterHandled",get:function(){return!0}},{key:"center",value:function(){var t=(0,M.Z)(this.pageDimensions,2),e=t[0],i=t[1];switch(this.parentRotation){case 90:this.x-=this.height*i/(2*e),this.y+=this.width*e/(2*i);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*i/(2*e),this.y-=this.width*e/(2*i);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}},{key:"addCommands",value:function(t){this._uiManager.addCommands(t)}},{key:"currentLayer",get:function(){return this._uiManager.currentLayer}},{key:"setInBackground",value:function(){this.div.style.zIndex=0}},{key:"setInForeground",value:function(){this.div.style.zIndex=_(this,Pr)}},{key:"setParent",value:function(t){null!==t?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):k(this,Vr,ss).call(this),this.parent=t}},{key:"focusin",value:function(t){this._focusEventsAllowed&&(_(this,Ar)?x(this,Ar,!1):this.parent.setSelected(this))}},{key:"focusout",value:function(t){var e;if(this._focusEventsAllowed&&this.isAttachedToDOM){var i=t.relatedTarget;null!==i&&void 0!==i&&i.closest("#".concat(this.id))||(t.preventDefault(),null!==(e=this.parent)&&void 0!==e&&e.isMultipleSelection||this.commitOrRemove())}}},{key:"commitOrRemove",value:function(){this.isEmpty()?this.remove():this.commit()}},{key:"commit",value:function(){this.addToAnnotationStorage()}},{key:"addToAnnotationStorage",value:function(){this._uiManager.addToAnnotationStorage(this)}},{key:"setAt",value:function(t,e,i,n){var a=(0,M.Z)(this.parentDimensions,2),r=a[0],s=a[1],o=this.screenToPageTranslation(i,n),l=(0,M.Z)(o,2);i=l[0],n=l[1],this.x=(t+i)/r,this.y=(e+n)/s,this.fixAndSetPosition()}},{key:"translate",value:function(t,e){k(this,Lr,qr).call(this,this.parentDimensions,t,e)}},{key:"translateInPage",value:function(t,e){_(this,_r)||x(this,_r,[this.x,this.y]),k(this,Lr,qr).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}},{key:"drag",value:function(t,e){_(this,_r)||x(this,_r,[this.x,this.y]);var i=(0,M.Z)(this.parentDimensions,2),n=i[0],a=i[1];if(this.x+=t/n,this.y+=e/a,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){var r=this.div.getBoundingClientRect(),s=r.x,o=r.y;this.parent.findNewParent(this,s,o)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}var l=this.x,h=this.y,u=this.getBaseTranslation(),c=(0,M.Z)(u,2);l+=c[0],h+=c[1],this.div.style.left="".concat((100*l).toFixed(2),"%"),this.div.style.top="".concat((100*h).toFixed(2),"%"),this.div.scrollIntoView({block:"nearest"})}},{key:"_hasBeenMoved",get:function(){return!!_(this,_r)&&(_(this,_r)[0]!==this.x||_(this,_r)[1]!==this.y)}},{key:"getBaseTranslation",value:function(){var e=(0,M.Z)(this.parentDimensions,2),i=e[0],n=e[1],a=t._borderLineWidth,r=a/i,s=a/n;switch(this.rotation){case 90:return[-r,s];case 180:return[r,s];case 270:return[r,-s];default:return[-r,-s]}}},{key:"_mustFixPosition",get:function(){return!0}},{key:"fixAndSetPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rotation,e=(0,M.Z)(this.pageDimensions,2),i=e[0],n=e[1],a=this.x,r=this.y,s=this.width,o=this.height;if(s*=i,o*=n,a*=i,r*=n,this._mustFixPosition)switch(t){case 0:a=Math.max(0,Math.min(i-s,a)),r=Math.max(0,Math.min(n-o,r));break;case 90:a=Math.max(0,Math.min(i-o,a)),r=Math.min(n,Math.max(s,r));break;case 180:a=Math.min(i,Math.max(s,a)),r=Math.min(n,Math.max(o,r));break;case 270:a=Math.min(i,Math.max(o,a)),r=Math.max(0,Math.min(n-s,r))}this.x=a/=i,this.y=r/=n;var l=this.getBaseTranslation(),h=(0,M.Z)(l,2),u=h[0],c=h[1];a+=u,r+=c;var d=this.div.style;d.left="".concat((100*a).toFixed(2),"%"),d.top="".concat((100*r).toFixed(2),"%"),this.moveInDOM()}},{key:"screenToPageTranslation",value:function(e,i){return S(t,t,Xr).call(t,e,i,this.parentRotation)}},{key:"pageTranslationToScreen",value:function(e,i){return S(t,t,Xr).call(t,e,i,360-this.parentRotation)}},{key:"parentScale",get:function(){return this._uiManager.viewParameters.realScale}},{key:"parentRotation",get:function(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}},{key:"parentDimensions",get:function(){var t=this.parentScale,e=(0,M.Z)(this.pageDimensions,2),i=e[0]*t,n=e[1]*t;return Jt.isCSSRoundSupported?[Math.round(i),Math.round(n)]:[i,n]}},{key:"setDims",value:function(t,e){var i=(0,M.Z)(this.parentDimensions,2),n=i[0],a=i[1];this.div.style.width="".concat((100*t/n).toFixed(2),"%"),_(this,pr)||(this.div.style.height="".concat((100*e/a).toFixed(2),"%"))}},{key:"fixDims",value:function(){var t=this.div.style,e=t.height,i=t.width,n=i.endsWith("%"),a=!_(this,pr)&&e.endsWith("%");if(!n||!a){var r=(0,M.Z)(this.parentDimensions,2),s=r[0],o=r[1];n||(t.width="".concat((100*parseFloat(i)/s).toFixed(2),"%")),_(this,pr)||a||(t.height="".concat((100*parseFloat(e)/o).toFixed(2),"%"))}}},{key:"getInitialTranslation",value:function(){return[0,0]}},{key:"altTextFinish",value:function(){var t;null===(t=_(this,vr))||void 0===t||t.finish()}},{key:"addEditToolbar",value:function(){var t=(0,w.Z)(L.mark((function t(){return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!_(this,br)&&!_(this,Sr)){t.next=2;break}return t.abrupt("return",_(this,br));case 2:if(x(this,br,new Fi(this)),this.div.append(_(this,br).render()),!_(this,vr)){t.next=10;break}return t.t0=_(this,br),t.next=8,_(this,vr).render();case 8:t.t1=t.sent,t.t0.addAltTextButton.call(t.t0,t.t1);case 10:return t.abrupt("return",_(this,br));case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"removeEditToolbar",value:function(){var t;_(this,br)&&(_(this,br).remove(),x(this,br,null),null===(t=_(this,vr))||void 0===t||t.destroy())}},{key:"getClientDimensions",value:function(){return this.div.getBoundingClientRect()}},{key:"addAltTextButton",value:function(){var e=(0,w.Z)(L.mark((function e(){return L.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_(this,vr)){e.next=2;break}return e.abrupt("return");case 2:return lr.initialize(t._l10nPromise),x(this,vr,new lr(this)),_(this,cr)&&(_(this,vr).data=_(this,cr),x(this,cr,null)),e.next=7,this.addEditToolbar();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"altTextData",get:function(){var t;return null===(t=_(this,vr))||void 0===t?void 0:t.data},set:function(t){_(this,vr)&&(_(this,vr).data=t)}},{key:"hasAltText",value:function(){var t;return!(null!==(t=_(this,vr))&&void 0!==t&&t.isEmpty())}},{key:"render",value:function(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=_(this,fr)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground();var t=this._uiManager._signal;this.div.addEventListener("focusin",_(this,yr),{signal:t}),this.div.addEventListener("focusout",_(this,kr),{signal:t});var e=(0,M.Z)(this.parentDimensions,2),i=e[0],n=e[1];this.parentRotation%180!==0&&(this.div.style.maxWidth="".concat((100*n/i).toFixed(2),"%"),this.div.style.maxHeight="".concat((100*i/n).toFixed(2),"%"));var a=this.getInitialTranslation(),r=(0,M.Z)(a,2),s=r[0],o=r[1];return this.translate(s,o),Ji(this,this.div,["pointerdown"]),this.div}},{key:"pointerdown",value:function(t){var e=Jt.platform.isMac;0!==t.button||t.ctrlKey&&e?t.preventDefault():(x(this,Ar,!0),this._isDraggable?k(this,Br,es).call(this,t):k(this,Or,ts).call(this,t))}},{key:"moveInDOM",value:function(){var t=this;_(this,Er)&&clearTimeout(_(this,Er)),x(this,Er,setTimeout((function(){var e;x(t,Er,null),null===(e=t.parent)||void 0===e||e.moveEditorInDOM(t)}),0))}},{key:"_setParentAndPosition",value:function(t,e,i){t.changeParent(this),this.x=e,this.y=i,this.fixAndSetPosition()}},{key:"getRect",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.rotation,n=this.parentScale,a=(0,M.Z)(this.pageDimensions,2),r=a[0],s=a[1],o=(0,M.Z)(this.pageTranslation,2),l=o[0],h=o[1],u=t/n,c=e/n,d=this.x*r,v=this.y*s,f=this.width*r,p=this.height*s;switch(i){case 0:return[d+u+l,s-v-c-p+h,d+u+f+l,s-v-c+h];case 90:return[d+c+l,s-v+u+h,d+c+p+l,s-v+u+f+h];case 180:return[d-u-f+l,s-v+c+h,d-u+l,s-v+c+p+h];case 270:return[d-c-p+l,s-v-u-f+h,d-c+l,s-v-u+h];default:throw new Error("Invalid rotation")}}},{key:"getRectInCurrentCoords",value:function(t,e){var i=(0,M.Z)(t,4),n=i[0],a=i[1],r=i[2],s=i[3],o=r-n,l=s-a;switch(this.rotation){case 0:return[n,e-s,o,l];case 90:return[n,e-a,l,o];case 180:return[r,e-a,o,l];case 270:return[r,e-s,l,o];default:throw new Error("Invalid rotation")}}},{key:"onceAdded",value:function(){}},{key:"isEmpty",value:function(){return!1}},{key:"enableEditMode",value:function(){x(this,Sr,!0)}},{key:"disableEditMode",value:function(){x(this,Sr,!1)}},{key:"isInEditMode",value:function(){return _(this,Sr)}},{key:"shouldGetKeyboardEvents",value:function(){return _(this,Mr)}},{key:"needsToBeRebuilt",value:function(){return this.div&&!this.isAttachedToDOM}},{key:"rebuild",value:function(){var t,e,i=this._uiManager._signal;null===(t=this.div)||void 0===t||t.addEventListener("focusin",_(this,yr),{signal:i}),null===(e=this.div)||void 0===e||e.addEventListener("focusout",_(this,kr),{signal:i})}},{key:"rotate",value:function(t){}},{key:"serialize",value:function(){Dt("An editor must be serializable")}},{key:"hasBeenModified",get:function(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}},{key:"remove",value:function(){if(this.div.removeEventListener("focusin",_(this,yr)),this.div.removeEventListener("focusout",_(this,kr)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),_(this,Er)&&(clearTimeout(_(this,Er)),x(this,Er,null)),k(this,Vr,ss).call(this),this.removeEditToolbar(),_(this,Tr)){var t,e=C(_(this,Tr).values());try{for(e.s();!(t=e.n()).done;){var i=t.value;clearTimeout(i)}}catch(n){e.e(n)}finally{e.f()}x(this,Tr,null)}this.parent=null}},{key:"isResizable",get:function(){return!1}},{key:"makeResizable",value:function(){this.isResizable&&(k(this,Fr,Yr).call(this),_(this,gr).classList.remove("hidden"),Ji(this,this.div,["keydown"]))}},{key:"toolbarPosition",get:function(){return null}},{key:"keydown",value:function(e){var i=this;if(this.isResizable&&e.target===this.div&&"Enter"===e.key){this._uiManager.setSelected(this),x(this,mr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});var n=_(this,gr).children;if(!_(this,dr)){x(this,dr,Array.from(n));var a,r=k(this,Hr,is).bind(this),s=k(this,zr,ns).bind(this),o=this._uiManager._signal,l=C(_(this,dr));try{var h=function(){var e=a.value,n=e.getAttribute("data-resizer-name");e.setAttribute("role","spinbutton"),e.addEventListener("keydown",r,{signal:o}),e.addEventListener("blur",s,{signal:o}),e.addEventListener("focus",k(i,jr,as).bind(i,n),{signal:o}),t._l10nPromise.get("pdfjs-editor-resizer-label-".concat(n)).then((function(t){return e.setAttribute("aria-label",t)}))};for(l.s();!(a=l.n()).done;)h()}catch(A){l.e(A)}finally{l.f()}}var u,c=_(this,dr)[0],d=0,v=C(n);try{for(v.s();!(u=v.n()).done;){if(u.value===c)break;d++}}catch(A){v.e(A)}finally{v.f()}var f=(360-this.rotation+this.parentRotation)%360/90*(_(this,dr).length/4);if(f!==d){if(f<d)for(var p=0;p<d-f;p++)_(this,gr).append(_(this,gr).firstChild);else if(f>d)for(var g=0;g<f-d;g++)_(this,gr).firstChild.before(_(this,gr).lastChild);var m,y=0,b=C(n);try{var w=function(){var e=m.value,n=_(i,dr)[y++].getAttribute("data-resizer-name");t._l10nPromise.get("pdfjs-editor-resizer-label-".concat(n)).then((function(t){return e.setAttribute("aria-label",t)}))};for(b.s();!(m=b.n()).done;)w()}catch(A){b.e(A)}finally{b.f()}}k(this,Ur,rs).call(this,0),x(this,Mr,!0),_(this,gr).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}}},{key:"_resizeWithKeyboard",value:function(t,e){_(this,Mr)&&k(this,Nr,$r).call(this,_(this,wr),{movementX:t,movementY:e})}},{key:"_stopResizingWithKeyboard",value:function(){k(this,Vr,ss).call(this),this.div.focus()}},{key:"select",value:function(){var t,e,i=this;this.makeResizable(),null===(t=this.div)||void 0===t||t.classList.add("selectedEditor"),_(this,br)?null===(e=_(this,br))||void 0===e||e.show():this.addEditToolbar().then((function(){var t,e;null!==(t=i.div)&&void 0!==t&&t.classList.contains("selectedEditor")&&(null===(e=_(i,br))||void 0===e||e.show())}))}},{key:"unselect",value:function(){var t,e,i,n;null===(t=_(this,gr))||void 0===t||t.classList.add("hidden"),null===(e=this.div)||void 0===e||e.classList.remove("selectedEditor"),null!==(i=this.div)&&void 0!==i&&i.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),null===(n=_(this,br))||void 0===n||n.hide()}},{key:"updateParams",value:function(t,e){}},{key:"disableEditing",value:function(){}},{key:"enableEditing",value:function(){}},{key:"enterInEditMode",value:function(){}},{key:"getImageForAltText",value:function(){return null}},{key:"contentDiv",get:function(){return this.div}},{key:"isEditing",get:function(){return _(this,xr)},set:function(t){x(this,xr,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}},{key:"setAspectRatio",value:function(t,e){x(this,pr,!0);var i=t/e,n=this.div.style;n.aspectRatio=i,n.height="auto"}},{key:"telemetryInitialData",get:function(){return{action:"added"}}},{key:"telemetryFinalData",get:function(){return null}},{key:"_reportTelemetry",value:function(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n){_(this,Tr)||x(this,Tr,new Map);var a=e.action,r=_(this,Tr).get(a);return r&&clearTimeout(r),r=setTimeout((function(){i._reportTelemetry(e),_(i,Tr).delete(a),0===_(i,Tr).size&&x(i,Tr,null)}),t._telemetryTimeout),void _(this,Tr).set(a,r)}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;this.div.classList.toggle("hidden",!t),this._isVisible=t}},{key:"enable",value:function(){this.div&&(this.div.tabIndex=0),x(this,fr,!1)}},{key:"disable",value:function(){this.div&&(this.div.tabIndex=-1),x(this,fr,!0)}},{key:"renderAnnotationElement",value:function(t){var e=t.container.querySelector(".annotationContent");if(e){if("CANVAS"===e.nodeName){var i=e;(e=document.createElement("div")).classList.add("annotationContent",this.editorType),i.before(e)}}else(e=document.createElement("div")).classList.add("annotationContent",this.editorType),t.container.prepend(e);return e}},{key:"resetAnnotationElement",value:function(t){var e=t.container.firstChild;"DIV"===e.nodeName&&e.classList.contains("annotationContent")&&e.remove()}}],[{key:"_resizerKeyboardManager",get:function(){var e=t.prototype._resizeWithKeyboard,i=Pa.TRANSLATE_SMALL,n=Pa.TRANSLATE_BIG;return Bt(this,"_resizerKeyboardManager",new pn([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-i,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[i,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-i]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,i]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],t.prototype._stopResizingWithKeyboard]]))}},{key:"_defaultLineColor",get:function(){return Bt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}},{key:"deleteAnnotationElement",value:function(t){var e=new os({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}},{key:"initialize",value:function(e,i,n){if(t._l10nPromise||(t._l10nPromise=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map((function(t){return[t,e.get(t.replaceAll(/([A-Z])/g,(function(t){return"-".concat(t.toLowerCase())})))]})))),null!==n&&void 0!==n&&n.strings){var a,r=C(n.strings);try{for(r.s();!(a=r.n()).done;){var s=a.value;t._l10nPromise.set(s,e.get(s))}}catch(l){r.e(l)}finally{r.f()}}if(-1===t._borderLineWidth){var o=getComputedStyle(document.documentElement);t._borderLineWidth=parseFloat(o.getPropertyValue("--outline-width"))||0}}},{key:"updateDefaultParams",value:function(t,e){}},{key:"defaultPropertiesToUpdate",get:function(){return[]}},{key:"isHandlingMimeForPasting",value:function(t){return!1}},{key:"paste",value:function(t,e){Dt("Not implemented")}},{key:"deserialize",value:function(t,e,i){var n=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i});n.rotation=t.rotation,x(n,cr,t.accessibilityData);var a=(0,M.Z)(n.pageDimensions,2),r=a[0],s=a[1],o=n.getRectInCurrentCoords(t.rect,s),l=(0,M.Z)(o,4),h=l[0],u=l[1],c=l[2],d=l[3];return n.x=h/r,n.y=u/s,n.width=c/r,n.height=d/s,n}},{key:"MIN_SIZE",get:function(){return 16}},{key:"canCreateNewEmptyEditor",value:function(){return!0}}]),t}();function qr(t,e,i){var n=(0,M.Z)(t,2),a=n[0],r=n[1],s=this.screenToPageTranslation(e,i),o=(0,M.Z)(s,2);e=o[0],i=o[1],this.x+=e/a,this.y+=i/r,this.fixAndSetPosition()}function Xr(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}function Kr(t){switch(t){case 90:var e=(0,M.Z)(this.pageDimensions,2),i=e[0],n=e[1];return[0,-i/n,n/i,0];case 180:return[-1,0,0,-1];case 270:var a=(0,M.Z)(this.pageDimensions,2),r=a[0],s=a[1];return[0,r/s,-s/r,0];default:return[1,0,0,1]}}function Yr(){if(!_(this,gr)){x(this,gr,document.createElement("div")),_(this,gr).classList.add("resizers");for(var t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal,i=0,n=t;i<n.length;i++){var a=n[i],r=document.createElement("div");_(this,gr).append(r),r.classList.add("resizer",a),r.setAttribute("data-resizer-name",a),r.addEventListener("pointerdown",k(this,Dr,Qr).bind(this,a),{signal:e}),r.addEventListener("contextmenu",ki,{signal:e}),r.tabIndex=-1}this.div.prepend(_(this,gr))}}function Qr(t,e){var i,n=this;e.preventDefault();var a=Jt.platform.isMac;if(!(0!==e.button||e.ctrlKey&&a)){null===(i=_(this,vr))||void 0===i||i.toggle(!1);var r=k(this,Nr,$r).bind(this,t),s=this._isDraggable;this._isDraggable=!1;var o=this._uiManager._signal,l={passive:!0,capture:!0,signal:o};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",r,l),window.addEventListener("contextmenu",ki,{signal:o});var h=this.x,u=this.y,c=this.width,d=this.height,v=this.parent.div.style.cursor,f=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;var p=function t(){var e;n.parent.togglePointerEvents(!0),null===(e=_(n,vr))||void 0===e||e.toggle(!0),n._isDraggable=s,window.removeEventListener("pointerup",t),window.removeEventListener("blur",t),window.removeEventListener("pointermove",r,l),window.removeEventListener("contextmenu",ki),n.parent.div.style.cursor=v,n.div.style.cursor=f,k(n,Wr,Jr).call(n,h,u,c,d)};window.addEventListener("pointerup",p,{signal:o}),window.addEventListener("blur",p,{signal:o})}}function Jr(t,e,i,n){var a=this,r=this.x,s=this.y,o=this.width,l=this.height;r===t&&s===e&&o===i&&l===n||this.addCommands({cmd:function(){a.width=o,a.height=l,a.x=r,a.y=s;var t=(0,M.Z)(a.parentDimensions,2),e=t[0],i=t[1];a.setDims(e*o,i*l),a.fixAndSetPosition()},undo:function(){a.width=i,a.height=n,a.x=t,a.y=e;var r=(0,M.Z)(a.parentDimensions,2),s=r[0],o=r[1];a.setDims(s*i,o*n),a.fixAndSetPosition()},mustExec:!0})}function $r(t,e){var i,n,a=(0,M.Z)(this.parentDimensions,2),r=a[0],s=a[1],o=this.x,l=this.y,h=this.width,u=this.height,c=Gr.MIN_SIZE/r,d=Gr.MIN_SIZE/s,v=function(t){return Math.round(1e4*t)/1e4},f=k(this,Ir,Kr).call(this,this.rotation),g=function(t,e){return[f[0]*t+f[2]*e,f[1]*t+f[3]*e]},m=k(this,Ir,Kr).call(this,360-this.rotation),y=!1,b=!1;switch(t){case"topLeft":y=!0,i=function(t,e){return[0,0]},n=function(t,e){return[t,e]};break;case"topMiddle":i=function(t,e){return[t/2,0]},n=function(t,e){return[t/2,e]};break;case"topRight":y=!0,i=function(t,e){return[t,0]},n=function(t,e){return[0,e]};break;case"middleRight":b=!0,i=function(t,e){return[t,e/2]},n=function(t,e){return[0,e/2]};break;case"bottomRight":y=!0,i=function(t,e){return[t,e]},n=function(t,e){return[0,0]};break;case"bottomMiddle":i=function(t,e){return[t/2,e]},n=function(t,e){return[t/2,0]};break;case"bottomLeft":y=!0,i=function(t,e){return[0,e]},n=function(t,e){return[t,0]};break;case"middleLeft":b=!0,i=function(t,e){return[0,e/2]},n=function(t,e){return[t,e/2]}}var w,A,_=i(h,u),x=n(h,u),S=g.apply(void 0,(0,p.Z)(x)),E=v(o+S[0]),C=v(l+S[1]),Z=1,T=1,R=this.screenToPageTranslation(e.movementX,e.movementY),P=(0,M.Z)(R,2),L=P[0],I=P[1],F=(w=L/r,A=I/s,[m[0]*w+m[2]*A,m[1]*w+m[3]*A]),D=(0,M.Z)(F,2);if(L=D[0],I=D[1],y){var W=Math.hypot(h,u);Z=T=Math.max(Math.min(Math.hypot(x[0]-_[0]-L,x[1]-_[1]-I)/W,1/h,1/u),c/h,d/u)}else b?Z=Math.max(c,Math.min(1,Math.abs(x[0]-_[0]-L)))/h:T=Math.max(d,Math.min(1,Math.abs(x[1]-_[1]-I)))/u;var N=v(h*Z),O=v(u*T),B=E-(S=g.apply(void 0,(0,p.Z)(n(N,O))))[0],H=C-S[1];this.width=N,this.height=O,this.x=B,this.y=H,this.setDims(r*N,s*O),this.fixAndSetPosition()}function ts(t){var e=Jt.platform.isMac;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}function es(t){var e,i,n=this,a=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();var r=this._uiManager._signal;a&&(this.div.classList.add("moving"),e={passive:!0,capture:!0,signal:r},x(this,Cr,t.clientX),x(this,Zr,t.clientY),i=function(t){var e=t.clientX,i=t.clientY,a=n.screenToPageTranslation(e-_(n,Cr),i-_(n,Zr)),r=(0,M.Z)(a,2),s=r[0],o=r[1];x(n,Cr,e),x(n,Zr,i),n._uiManager.dragSelectedEditors(s,o)},window.addEventListener("pointermove",i,e));var s=function r(){window.removeEventListener("pointerup",r),window.removeEventListener("blur",r),a&&(n.div.classList.remove("moving"),window.removeEventListener("pointermove",i,e)),x(n,Ar,!1),n._uiManager.endDragSession()||k(n,Or,ts).call(n,t)};window.addEventListener("pointerup",s,{signal:r}),window.addEventListener("blur",s,{signal:r})}function is(t){Gr._resizerKeyboardManager.exec(this,t)}function ns(t){var e;_(this,Mr)&&(null===(e=t.relatedTarget)||void 0===e?void 0:e.parentNode)!==_(this,gr)&&k(this,Vr,ss).call(this)}function as(t){x(this,wr,_(this,Mr)?t:"")}function rs(t){if(_(this,dr)){var e,i=C(_(this,dr));try{for(i.s();!(e=i.n()).done;){e.value.tabIndex=t}}catch(n){i.e(n)}finally{i.f()}}}function ss(){if(x(this,Mr,!1),k(this,Ur,rs).call(this,-1),_(this,mr)){var t=_(this,mr),e=t.savedX,i=t.savedY,n=t.savedWidth,a=t.savedHeight;k(this,Wr,Jr).call(this,e,i,n,a),x(this,mr,null)}}(0,b.Z)(Gr,"_borderLineWidth",-1),(0,b.Z)(Gr,"_colorManager",new mn),(0,b.Z)(Gr,"_zIndex",1),(0,b.Z)(Gr,"_telemetryTimeout",1e3);var os=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;return(0,T.Z)(this,i),(n=e.call(this,t)).annotationElementId=t.annotationElementId,n.deleted=!0,n}return(0,Z.Z)(i,[{key:"serialize",value:function(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}]),i}(Gr),ls=3285377520,hs=4294901760,us=65535,cs=function(){function t(e){(0,T.Z)(this,t),this.h1=e?4294967295&e:ls,this.h2=e?4294967295&e:ls}return(0,Z.Z)(t,[{key:"update",value:function(t){var e,i;if("string"===typeof t){e=new Uint8Array(2*t.length),i=0;for(var n=0,a=t.length;n<a;n++){var r=t.charCodeAt(n);r<=255?e[i++]=r:(e[i++]=r>>>8,e[i++]=255&r)}}else{if(!ArrayBuffer.isView(t))throw new Error("Invalid data format, must be a string or TypedArray.");i=(e=t.slice()).byteLength}for(var s=i>>2,o=i-4*s,l=new Uint32Array(e.buffer,0,s),h=0,u=0,c=this.h1,d=this.h2,v=3432918353,f=461845907,p=11601,g=13715,m=0;m<s;m++)1&m?c=5*(c=(c^=h=(h=(h=(h=l[m])*v&hs|h*p&us)<<15|h>>>17)*f&hs|h*g&us)<<13|c>>>19)+3864292196:d=5*(d=(d^=u=(u=(u=(u=l[m])*v&hs|u*p&us)<<15|u>>>17)*f&hs|u*g&us)<<13|d>>>19)+3864292196;switch(h=0,o){case 3:h^=e[4*s+2]<<16;case 2:h^=e[4*s+1]<<8;case 1:h=(h=(h=(h^=e[4*s])*v&hs|h*p&us)<<15|h>>>17)*f&hs|h*g&us,1&s?c^=h:d^=h}this.h1=c,this.h2=d}},{key:"hexdigest",value:function(){var t=this.h1,e=this.h2;return t=3981806797*(t^=e>>>1)&hs|36045*t&us,t=444984403*(t^=(e=4283543511*e&hs|(2950163797*(e<<16|t>>>16)&hs)>>>16)>>>1)&hs|60499*t&us,((t^=(e=3301882366*e&hs|(3120437893*(e<<16|t>>>16)&hs)>>>16)>>>1)>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}]),t}(),ds=Object.freeze({map:null,hash:"",transfer:void 0}),vs=new WeakMap,fs=new WeakMap,ps=new WeakMap,gs=new WeakSet,ms=function(){function t(){(0,T.Z)(this,t),y(this,gs),A(this,vs,{writable:!0,value:!1}),A(this,fs,{writable:!0,value:null}),A(this,ps,{writable:!0,value:new Map}),this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}return(0,Z.Z)(t,[{key:"getValue",value:function(t,e){var i=_(this,ps).get(t);return void 0===i?e:Object.assign(e,i)}},{key:"getRawValue",value:function(t){return _(this,ps).get(t)}},{key:"remove",value:function(t){if(_(this,ps).delete(t),0===_(this,ps).size&&this.resetModified(),"function"===typeof this.onAnnotationEditor){var e,i=C(_(this,ps).values());try{for(i.s();!(e=i.n()).done;){if(e.value instanceof Gr)return}}catch(n){i.e(n)}finally{i.f()}this.onAnnotationEditor(null)}}},{key:"setValue",value:function(t,e){var i=_(this,ps).get(t),n=!1;if(void 0!==i)for(var a=0,r=Object.entries(e);a<r.length;a++){var s=(0,M.Z)(r[a],2),o=s[0],l=s[1];i[o]!==l&&(n=!0,i[o]=l)}else n=!0,_(this,ps).set(t,e);n&&k(this,gs,ys).call(this),e instanceof Gr&&"function"===typeof this.onAnnotationEditor&&this.onAnnotationEditor(e.constructor._type)}},{key:"has",value:function(t){return _(this,ps).has(t)}},{key:"getAll",value:function(){return _(this,ps).size>0?Qt(_(this,ps)):null}},{key:"setAll",value:function(t){for(var e=0,i=Object.entries(t);e<i.length;e++){var n=(0,M.Z)(i[e],2),a=n[0],r=n[1];this.setValue(a,r)}}},{key:"size",get:function(){return _(this,ps).size}},{key:"resetModified",value:function(){_(this,vs)&&(x(this,vs,!1),"function"===typeof this.onResetModified&&this.onResetModified())}},{key:"print",get:function(){return new bs(this)}},{key:"serializable",get:function(){if(0===_(this,ps).size)return ds;var t,e=new Map,i=new cs,n=[],a=Object.create(null),r=!1,s=C(_(this,ps));try{for(s.s();!(t=s.n()).done;){var o=(0,M.Z)(t.value,2),l=o[0],h=o[1],u=h instanceof Gr?h.serialize(!1,a):h;u&&(e.set(l,u),i.update("".concat(l,":").concat(JSON.stringify(u))),r||(r=!!u.bitmap))}}catch(f){s.e(f)}finally{s.f()}if(r){var c,d=C(e.values());try{for(d.s();!(c=d.n()).done;){var v=c.value;v.bitmap&&n.push(v.bitmap)}}catch(f){d.e(f)}finally{d.f()}}return e.size>0?{map:e,hash:i.hexdigest(),transfer:n}:ds}},{key:"editorStats",get:function(){var t,e=null,i=new Map,n=C(_(this,ps).values());try{for(n.s();!(t=n.n()).done;){var a,r=t.value;if(r instanceof Gr){var s=r.telemetryFinalData;if(s){var o=s.type;i.has(o)||i.set(o,Object.getPrototypeOf(r).constructor),e||(e=Object.create(null));for(var l=(a=e)[o]||(a[o]=new Map),h=0,u=Object.entries(s);h<u.length;h++){var c,d=(0,M.Z)(u[h],2),v=d[0],f=d[1];if("type"!==v){var p=l.get(v);p||(p=new Map,l.set(v,p));var g=null!==(c=p.get(f))&&void 0!==c?c:0;p.set(f,g+1)}}}}}}catch(A){n.e(A)}finally{n.f()}var m,y=C(i);try{for(y.s();!(m=y.n()).done;){var k=(0,M.Z)(m.value,2),b=k[0],w=k[1];e[b]=w.computeTelemetryFinalData(e[b])}}catch(A){y.e(A)}finally{y.f()}return e}},{key:"resetModifiedIds",value:function(){x(this,fs,null)}},{key:"modifiedIds",get:function(){if(_(this,fs))return _(this,fs);var t,e=[],i=C(_(this,ps).values());try{for(i.s();!(t=i.n()).done;){var n=t.value;n instanceof Gr&&n.annotationElementId&&n.serialize()&&e.push(n.annotationElementId)}}catch(a){i.e(a)}finally{i.f()}return x(this,fs,{ids:new Set(e),hash:e.join(",")})}}]),t}();function ys(){_(this,vs)||(x(this,vs,!0),"function"===typeof this.onSetModified&&this.onSetModified())}var ks=new WeakMap,bs=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;(0,T.Z)(this,i),n=e.call(this),A((0,g.Z)(n),ks,{writable:!0,value:void 0});var a=t.serializable,r=a.map,s=a.hash,o=a.transfer,l=structuredClone(r,o?{transfer:o}:null);return x((0,g.Z)(n),ks,{map:l,hash:s,transfer:o}),n}return(0,Z.Z)(i,[{key:"print",get:function(){Dt("Should not call PrintAnnotationStorage.print")}},{key:"serializable",get:function(){return _(this,ks)}},{key:"modifiedIds",get:function(){return Bt(this,"modifiedIds",{ids:new Set,hash:""})}}]),i}(ms),ws=new WeakMap,As=function(){function t(e){var i=e.ownerDocument,n=void 0===i?globalThis.document:i;e.styleElement;(0,T.Z)(this,t),A(this,ws,{writable:!0,value:new Set}),this._document=n,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}return(0,Z.Z)(t,[{key:"addNativeFontFace",value:function(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}},{key:"removeNativeFontFace",value:function(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}},{key:"insertRule",value:function(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));var e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}},{key:"clear",value:function(){var t,e=C(this.nativeFontFaces);try{for(e.s();!(t=e.n()).done;){var i=t.value;this._document.fonts.delete(i)}}catch(n){e.e(n)}finally{e.f()}this.nativeFontFaces.clear(),_(this,ws).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}},{key:"loadSystemFont",value:function(){var t=(0,w.Z)(L.mark((function t(e){var i,n,a,r,s,o;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.systemFontInfo,n=e._inspectFont,i&&!_(this,ws).has(i.loadedName)){t.next=3;break}return t.abrupt("return");case 3:if(Wt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),!this.isFontLoadingAPISupported){t.next=20;break}return a=i.loadedName,r=i.src,s=i.style,o=new FontFace(a,r,s),this.addNativeFontFace(o),t.prev=8,t.next=11,o.load();case 11:_(this,ws).add(a),null===n||void 0===n||n(i),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(8),Ft("Cannot load system font: ".concat(i.baseFontName,", installing it could help to improve PDF rendering.")),this.removeNativeFontFace(o);case 19:return t.abrupt("return");case 20:Dt("Not implemented: loadSystemFont without the Font Loading API.");case 21:case"end":return t.stop()}}),t,this,[[8,15]])})));return function(e){return t.apply(this,arguments)}}()},{key:"bind",value:function(){var t=(0,w.Z)(L.mark((function t(e){var i,n,a=this;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.attached||e.missingFile&&!e.systemFontInfo)){t.next=2;break}return t.abrupt("return");case 2:if(e.attached=!0,!e.systemFontInfo){t.next=7;break}return t.next=6,this.loadSystemFont(e);case 6:case 21:return t.abrupt("return");case 7:if(!this.isFontLoadingAPISupported){t.next=22;break}if(!(i=e.createNativeFontFace())){t.next=21;break}return this.addNativeFontFace(i),t.prev=11,t.next=14,i.loaded;case 14:t.next=21;break;case 16:throw t.prev=16,t.t0=t.catch(11),Ft("Failed to load font '".concat(i.family,"': '").concat(t.t0,"'.")),e.disableFontFace=!0,t.t0;case 22:if(!(n=e.createFontFaceRule())){t.next=29;break}if(this.insertRule(n),!this.isSyncFontLoadingSupported){t.next=27;break}return t.abrupt("return");case 27:return t.next=29,new Promise((function(t){var i=a._queueLoadingCallback(t);a._prepareFontLoadEvent(e,i)}));case 29:case"end":return t.stop()}}),t,this,[[11,16]])})));return function(e){return t.apply(this,arguments)}}()},{key:"isFontLoadingAPISupported",get:function(){var t;return Bt(this,"isFontLoadingAPISupported",!(null===(t=this._document)||void 0===t||!t.fonts))}},{key:"isSyncFontLoadingSupported",get:function(){var t,e=!1;return(F||"undefined"!==typeof navigator&&"string"===typeof(null===(t=navigator)||void 0===t?void 0:t.userAgent)&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),Bt(this,"isSyncFontLoadingSupported",e)}},{key:"_queueLoadingCallback",value:function(t){var e=this.loadingRequests,i={done:!1,complete:function(){for(Wt(!i.done,"completeRequest() cannot be called twice."),i.done=!0;e.length>0&&e[0].done;){var t=e.shift();setTimeout(t.callback,0)}},callback:t};return e.push(i),i}},{key:"_loadTestFont",get:function(){return Bt(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}},{key:"_prepareFontLoadEvent",value:function(t,e){function i(t,e){return t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|255&t.charCodeAt(e+3)}function n(t,e,i,n){return t.substring(0,e)+n+t.substring(e+i)}var a,r,s=this._document.createElement("canvas");s.width=1,s.height=1;var o=s.getContext("2d"),l=0;var h,u="lt".concat(Date.now()).concat(this.loadTestFontId++),c=this._loadTestFont,d=1482184792,v=i(c=n(c,976,u.length,u),16);for(a=0,r=u.length-3;a<r;a+=4)v=v-d+i(u,a)|0;a<u.length&&(v=v-d+i(u+"XXX",a)|0),c=n(c,16,4,(h=v,String.fromCharCode(h>>24&255,h>>16&255,h>>8&255,255&h)));var f="url(data:font/opentype;base64,".concat(btoa(c),");"),p='@font-face {font-family:"'.concat(u,'";src:').concat(f,"}");this.insertRule(p);var g=this._document.createElement("div");g.style.visibility="hidden",g.style.width=g.style.height="10px",g.style.position="absolute",g.style.top=g.style.left="0px";for(var m=0,y=[t.loadedName,u];m<y.length;m++){var k=y[m],b=this._document.createElement("span");b.textContent="Hi",b.style.fontFamily=k,g.append(b)}this._document.body.append(g),function t(e,i){if(++l>30)return Ft("Load test font never loaded."),void i();o.font="30px "+e,o.fillText(".",0,20),o.getImageData(0,0,1,1).data[3]>0?i():setTimeout(t.bind(null,e,i))}(u,(function(){g.remove(),e.complete()}))}}]),t}(),_s=function(){function t(e,i){var n=i.disableFontFace,a=void 0!==n&&n,r=i.inspectFont,s=void 0===r?null:r;for(var o in(0,T.Z)(this,t),this.compiledGlyphs=Object.create(null),e)this[o]=e[o];this.disableFontFace=!0===a,this._inspectFont=s}return(0,Z.Z)(t,[{key:"createNativeFontFace",value:function(){var t,e;if(!this.data||this.disableFontFace)return null;if(this.cssFontInfo){var i={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(i.style="oblique ".concat(this.cssFontInfo.italicAngle,"deg")),e=new FontFace(this.cssFontInfo.fontFamily,this.data,i)}else e=new FontFace(this.loadedName,this.data,{});return null===(t=this._inspectFont)||void 0===t||t.call(this,this),e}},{key:"createFontFaceRule",value:function(){var t;if(!this.data||this.disableFontFace)return null;var e,i=Kt(this.data),n="url(data:".concat(this.mimetype,";base64,").concat(btoa(i),");");if(this.cssFontInfo){var a="font-weight: ".concat(this.cssFontInfo.fontWeight,";");this.cssFontInfo.italicAngle&&(a+="font-style: oblique ".concat(this.cssFontInfo.italicAngle,"deg;")),e='@font-face {font-family:"'.concat(this.cssFontInfo.fontFamily,'";').concat(a,"src:").concat(n,"}")}else e='@font-face {font-family:"'.concat(this.loadedName,'";src:').concat(n,"}");return null===(t=this._inspectFont)||void 0===t||t.call(this,this,n),e}},{key:"getPathGenerator",value:function(t,e){if(void 0!==this.compiledGlyphs[e])return this.compiledGlyphs[e];var i;try{i=t.get(this.loadedName+"_path_"+e)}catch(s){Ft('getPathGenerator - ignoring character: "'.concat(s,'".'))}if(!Array.isArray(i)||0===i.length)return this.compiledGlyphs[e]=function(t,e){};for(var n=[],a=0,r=i.length;a<r;)switch(i[a++]){case he:!function(){var t=i.slice(a,a+6),e=(0,M.Z)(t,6),r=e[0],s=e[1],o=e[2],l=e[3],h=e[4],u=e[5];n.push((function(t){return t.bezierCurveTo(r,s,o,l,h,u)})),a+=6}();break;case ue:!function(){var t=i.slice(a,a+2),e=(0,M.Z)(t,2),r=e[0],s=e[1];n.push((function(t){return t.moveTo(r,s)})),a+=2}();break;case ce:!function(){var t=i.slice(a,a+2),e=(0,M.Z)(t,2),r=e[0],s=e[1];n.push((function(t){return t.lineTo(r,s)})),a+=2}();break;case de:!function(){var t=i.slice(a,a+4),e=(0,M.Z)(t,4),r=e[0],s=e[1],o=e[2],l=e[3];n.push((function(t){return t.quadraticCurveTo(r,s,o,l)})),a+=4}();break;case ve:n.push((function(t){return t.restore()}));break;case fe:n.push((function(t){return t.save()}));break;case pe:Wt(2===n.length,"Scale command is only valid at the third position.");break;case ge:!function(){var t=i.slice(a,a+6),e=(0,M.Z)(t,6),r=e[0],s=e[1],o=e[2],l=e[3],h=e[4],u=e[5];n.push((function(t){return t.transform(r,s,o,l,h,u)})),a+=6}();break;case me:!function(){var t=i.slice(a,a+2),e=(0,M.Z)(t,2),r=e[0],s=e[1];n.push((function(t){return t.translate(r,s)})),a+=2}()}return this.compiledGlyphs[e]=function(t,e){n[0](t),n[1](t),t.scale(e,-e);for(var i=2,a=n.length;i<a;i++)n[i](t)}}}]),t}();if(F){var xs=Promise.withResolvers(),Ss=null,Ms=function(){var t=(0,w.Z)(L.mark((function t(){var e,i,n,a;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,import("fs");case 2:return e=t.sent,t.next=5,import("http");case 5:return i=t.sent,t.next=8,import("https");case 8:return n=t.sent,t.next=11,import("url");case 11:return a=t.sent,t.abrupt("return",new Map(Object.entries({fs:e,http:i,https:n,url:a,canvas:undefined,path2d:undefined})));case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();Ms().then((function(t){Ss=t,xs.resolve()}),(function(t){Ft("loadPackages: ".concat(t)),Ss=new Map,xs.resolve()}))}var Es=function(){function t(){(0,T.Z)(this,t)}return(0,Z.Z)(t,null,[{key:"promise",get:function(){return xs.promise}},{key:"get",value:function(t){var e;return null===(e=Ss)||void 0===e?void 0:e.get(t)}}]),t}(),Cs=function(t){return Es.get("fs").promises.readFile(t).then((function(t){return new Uint8Array(t)}))},Zs=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(){return(0,T.Z)(this,i),e.apply(this,arguments)}return(0,Z.Z)(i)}(ye),Ts=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(){return(0,T.Z)(this,i),e.apply(this,arguments)}return(0,Z.Z)(i,[{key:"_createCanvas",value:function(t,e){return Es.get("canvas").createCanvas(t,e)}}]),i}(be),Rs=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(){return(0,T.Z)(this,i),e.apply(this,arguments)}return(0,Z.Z)(i,[{key:"_fetchData",value:function(t,e){return Cs(t).then((function(t){return{cMapData:t,compressionType:e}}))}}]),i}(we),Ps=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(){return(0,T.Z)(this,i),e.apply(this,arguments)}return(0,Z.Z)(i,[{key:"_fetchData",value:function(t){return Cs(t)}}]),i}(Ae),Ls="Fill",Is="Stroke",Fs="Shading";function Ds(t,e){if(e){var i=e[2]-e[0],n=e[3]-e[1],a=new Path2D;a.rect(e[0],e[1],i,n),t.clip(a)}}var Ws=function(){function t(){(0,T.Z)(this,t),this.constructor===t&&Dt("Cannot initialize BaseShadingPattern.")}return(0,Z.Z)(t,[{key:"getPattern",value:function(){Dt("Abstract method `getPattern` called.")}}]),t}(),Ns=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;return(0,T.Z)(this,i),(n=e.call(this))._type=t[1],n._bbox=t[2],n._colorStops=t[3],n._p0=t[4],n._p1=t[5],n._r0=t[6],n._r1=t[7],n.matrix=null,n}return(0,Z.Z)(i,[{key:"_createGradient",value:function(t){var e;"axial"===this._type?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));var i,n=C(this._colorStops);try{for(n.s();!(i=n.n()).done;){var a=i.value;e.addColorStop(a[0],a[1])}}catch(r){n.e(r)}finally{n.f()}return e}},{key:"getPattern",value:function(t,e,i,n){var a;if(n===Is||n===Ls){var r=e.current.getClippedPathBoundingBox(n,_i(t))||[0,0,0,0],s=Math.ceil(r[2]-r[0])||1,o=Math.ceil(r[3]-r[1])||1,l=e.cachedCanvases.getCanvas("pattern",s,o,!0),h=l.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-r[0],-r[1]),i=te.transform(i,[1,0,0,1,r[0],r[1]]),h.transform.apply(h,(0,p.Z)(e.baseTransform)),this.matrix&&h.transform.apply(h,(0,p.Z)(this.matrix)),Ds(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),a=t.createPattern(l.canvas,"no-repeat");var u=new DOMMatrix(i);a.setTransform(u)}else Ds(t,this._bbox),a=this._createGradient(t);return a}}]),i}(Ws);function Os(t,e,i,n,a,r,s,o){var l,h=e.coords,u=e.colors,c=t.data,d=4*t.width;h[i+1]>h[n+1]&&(l=i,i=n,n=l,l=r,r=s,s=l),h[n+1]>h[a+1]&&(l=n,n=a,a=l,l=s,s=o,o=l),h[i+1]>h[n+1]&&(l=i,i=n,n=l,l=r,r=s,s=l);var v=(h[i]+e.offsetX)*e.scaleX,f=(h[i+1]+e.offsetY)*e.scaleY,p=(h[n]+e.offsetX)*e.scaleX,g=(h[n+1]+e.offsetY)*e.scaleY,m=(h[a]+e.offsetX)*e.scaleX,y=(h[a+1]+e.offsetY)*e.scaleY;if(!(f>=y))for(var k,b,w,A,_,x,S,M,E=u[r],C=u[r+1],Z=u[r+2],T=u[s],R=u[s+1],P=u[s+2],L=u[o],I=u[o+1],F=u[o+2],D=Math.round(f),W=Math.round(y),N=D;N<=W;N++){if(N<g){var O=N<f?0:(f-N)/(f-g);k=v-(v-p)*O,b=E-(E-T)*O,w=C-(C-R)*O,A=Z-(Z-P)*O}else{var B=void 0;k=p-(p-m)*(B=N>y?1:g===y?0:(g-N)/(g-y)),b=T-(T-L)*B,w=R-(R-I)*B,A=P-(P-F)*B}var H=void 0;_=v-(v-m)*(H=N<f?0:N>y?1:(f-N)/(f-y)),x=E-(E-L)*H,S=C-(C-I)*H,M=Z-(Z-F)*H;for(var z=Math.round(Math.min(k,_)),j=Math.round(Math.max(k,_)),U=d*N+4*z,V=z;V<=j;V++)(H=(k-V)/(k-_))<0?H=0:H>1&&(H=1),c[U++]=b-(b-x)*H|0,c[U++]=w-(w-S)*H|0,c[U++]=A-(A-M)*H|0,c[U++]=255}}function Bs(t,e,i){var n,a,r=e.coords,s=e.colors;switch(e.type){case"lattice":var o=e.verticesPerRow,l=Math.floor(r.length/o)-1,h=o-1;for(n=0;n<l;n++)for(var u=n*o,c=0;c<h;c++,u++)Os(t,i,r[u],r[u+1],r[u+o],s[u],s[u+1],s[u+o]),Os(t,i,r[u+o+1],r[u+1],r[u+o],s[u+o+1],s[u+1],s[u+o]);break;case"triangles":for(n=0,a=r.length;n<a;n+=3)Os(t,i,r[n],r[n+1],r[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}var Hs=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;return(0,T.Z)(this,i),(n=e.call(this))._coords=t[2],n._colors=t[3],n._figures=t[4],n._bounds=t[5],n._bbox=t[7],n._background=t[8],n.matrix=null,n}return(0,Z.Z)(i,[{key:"_createMeshCanvas",value:function(t,e,i){var n=Math.floor(this._bounds[0]),a=Math.floor(this._bounds[1]),r=Math.ceil(this._bounds[2])-n,s=Math.ceil(this._bounds[3])-a,o=Math.min(Math.ceil(Math.abs(r*t[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(s*t[1]*1.1)),3e3),h=r/o,u=s/l,c={coords:this._coords,colors:this._colors,offsetX:-n,offsetY:-a,scaleX:1/h,scaleY:1/u},d=o+4,v=l+4,f=i.getCanvas("mesh",d,v,!1),p=f.context,g=p.createImageData(o,l);if(e)for(var m=g.data,y=0,k=m.length;y<k;y+=4)m[y]=e[0],m[y+1]=e[1],m[y+2]=e[2],m[y+3]=255;var b,w=C(this._figures);try{for(w.s();!(b=w.n()).done;){Bs(g,b.value,c)}}catch(A){w.e(A)}finally{w.f()}return p.putImageData(g,2,2),{canvas:f.canvas,offsetX:n-2*h,offsetY:a-2*u,scaleX:h,scaleY:u}}},{key:"getPattern",value:function(t,e,i,n){var a;if(Ds(t,this._bbox),n===Fs)a=te.singularValueDecompose2dScale(_i(t));else if(a=te.singularValueDecompose2dScale(e.baseTransform),this.matrix){var r=te.singularValueDecompose2dScale(this.matrix);a=[a[0]*r[0],a[1]*r[1]]}var s=this._createMeshCanvas(a,n===Fs?null:this._background,e.cachedCanvases);return n!==Fs&&(t.setTransform.apply(t,(0,p.Z)(e.baseTransform)),this.matrix&&t.transform.apply(t,(0,p.Z)(this.matrix))),t.translate(s.offsetX,s.offsetY),t.scale(s.scaleX,s.scaleY),t.createPattern(s.canvas,"no-repeat")}}]),i}(Ws),zs=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(){return(0,T.Z)(this,i),e.apply(this,arguments)}return(0,Z.Z)(i,[{key:"getPattern",value:function(){return"hotpink"}}]),i}(Ws);function js(t){switch(t[0]){case"RadialAxial":return new Ns(t);case"Mesh":return new Hs(t);case"Dummy":return new zs}throw new Error("Unknown IR type: ".concat(t[0]))}var Us=1,Vs=2,Gs=function(){function t(e,i,n,a,r){(0,T.Z)(this,t),this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=i,this.ctx=n,this.canvasGraphicsFactory=a,this.baseTransform=r}return(0,Z.Z)(t,[{key:"createPatternCanvas",value:function(t){var e=this.operatorList,i=this.bbox,n=this.xstep,a=this.ystep,r=this.paintType,s=this.tilingType,o=this.color,l=this.canvasGraphicsFactory;It("TilingType: "+s);var h=i[0],u=i[1],c=i[2],d=i[3],v=te.singularValueDecompose2dScale(this.matrix),f=te.singularValueDecompose2dScale(this.baseTransform),p=[v[0]*f[0],v[1]*f[1]],g=this.getSizeAndScale(n,this.ctx.canvas.width,p[0]),m=this.getSizeAndScale(a,this.ctx.canvas.height,p[1]),y=t.cachedCanvases.getCanvas("pattern",g.size,m.size,!0),k=y.context,b=l.createCanvasGraphics(k);b.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(b,r,o);var w=h,A=u,_=c,x=d;return h<0&&(w=0,_+=Math.abs(h)),u<0&&(A=0,x+=Math.abs(u)),k.translate(-g.scale*w,-m.scale*A),b.transform(g.scale,0,0,m.scale,0,0),k.save(),this.clipBbox(b,w,A,_,x),b.baseTransform=_i(b.ctx),b.executeOperatorList(e),b.endDrawing(),{canvas:y.canvas,scaleX:g.scale,scaleY:m.scale,offsetX:w,offsetY:A}}},{key:"getSizeAndScale",value:function(e,i,n){e=Math.abs(e);var a=Math.max(t.MAX_PATTERN_SIZE,i),r=Math.ceil(e*n);return r>=a?r=a:n=r/e,{scale:n,size:r}}},{key:"clipBbox",value:function(t,e,i,n,a){var r=n-e,s=a-i;t.ctx.rect(e,i,r,s),t.current.updateRectMinMax(_i(t.ctx),[e,i,n,a]),t.clip(),t.endPath()}},{key:"setFillAndStrokeStyleToContext",value:function(t,e,i){var n=t.ctx,a=t.current;switch(e){case Us:var r=this.ctx;n.fillStyle=r.fillStyle,n.strokeStyle=r.strokeStyle,a.fillColor=r.fillStyle,a.strokeColor=r.strokeStyle;break;case Vs:var s=te.makeHexColor(i[0],i[1],i[2]);n.fillStyle=s,n.strokeStyle=s,a.fillColor=s,a.strokeColor=s;break;default:throw new qt("Unsupported paint type: ".concat(e))}}},{key:"getPattern",value:function(t,e,i,n){var a=i;n!==Fs&&(a=te.transform(a,e.baseTransform),this.matrix&&(a=te.transform(a,this.matrix)));var r=this.createPatternCanvas(e),s=new DOMMatrix(a);s=(s=s.translate(r.offsetX,r.offsetY)).scale(1/r.scaleX,1/r.scaleY);var o=t.createPattern(r.canvas,"repeat");return o.setTransform(s),o}}]),t}();function qs(t){var e=t.src,i=t.srcPos,n=void 0===i?0:i,a=t.dest,r=t.width,s=t.height,o=t.nonBlackColor,l=void 0===o?4294967295:o,h=t.inverseDecode,u=void 0!==h&&h,c=Jt.isLittleEndian?4278190080:255,d=u?[l,c]:[c,l],v=(0,M.Z)(d,2),f=v[0],p=v[1],g=r>>3,m=7&r,y=e.length;a=new Uint32Array(a.buffer);for(var k=0,b=0;b<s;b++){for(var w=n+g;n<w;n++){var A=n<y?e[n]:255;a[k++]=128&A?p:f,a[k++]=64&A?p:f,a[k++]=32&A?p:f,a[k++]=16&A?p:f,a[k++]=8&A?p:f,a[k++]=4&A?p:f,a[k++]=2&A?p:f,a[k++]=1&A?p:f}if(0!==m)for(var _=n<y?e[n++]:255,x=0;x<m;x++)a[k++]=_&1<<7-x?p:f}return{srcPos:n,destPos:k}}(0,b.Z)(Gs,"MAX_PATTERN_SIZE",3e3);var Xs=16;var Ks=function(){function t(e){(0,T.Z)(this,t),this.canvasFactory=e,this.cache=Object.create(null)}return(0,Z.Z)(t,[{key:"getCanvas",value:function(t,e,i){var n;return void 0!==this.cache[t]?(n=this.cache[t],this.canvasFactory.reset(n,e,i)):(n=this.canvasFactory.create(e,i),this.cache[t]=n),n}},{key:"delete",value:function(t){delete this.cache[t]}},{key:"clear",value:function(){for(var t in this.cache){var e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}]),t}();function Ys(t,e,i,n,a,r,s,o,l,h){var u=_i(t),c=(0,M.Z)(u,6),d=c[0],v=c[1],f=c[2],p=c[3],g=c[4],m=c[5];if(0===v&&0===f){var y=s*d+g,k=Math.round(y),b=o*p+m,w=Math.round(b),A=(s+l)*d+g,_=Math.abs(Math.round(A)-k)||1,x=(o+h)*p+m,S=Math.abs(Math.round(x)-w)||1;return t.setTransform(Math.sign(d),0,0,Math.sign(p),k,w),t.drawImage(e,i,n,a,r,0,0,_,S),t.setTransform(d,v,f,p,g,m),[_,S]}if(0===d&&0===p){var E=o*f+g,C=Math.round(E),Z=s*v+m,T=Math.round(Z),R=(o+h)*f+g,P=Math.abs(Math.round(R)-C)||1,L=(s+l)*v+m,I=Math.abs(Math.round(L)-T)||1;return t.setTransform(0,Math.sign(v),Math.sign(f),0,C,T),t.drawImage(e,i,n,a,r,0,0,I,P),t.setTransform(d,v,f,p,g,m),[I,P]}return t.drawImage(e,i,n,a,r,s,o,l,h),[Math.hypot(d,v)*l,Math.hypot(f,p)*h]}var Qs=function(){function t(e,i){(0,T.Z)(this,t),this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=D,this.textMatrixScale=1,this.fontMatrix=W,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Q,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,i])}return(0,Z.Z)(t,[{key:"clone",value:function(){var t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}},{key:"setCurrentPoint",value:function(t,e){this.x=t,this.y=e}},{key:"updatePathMinMax",value:function(t,e,i){var n=te.applyTransform([e,i],t),a=(0,M.Z)(n,2);e=a[0],i=a[1],this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,i)}},{key:"updateRectMinMax",value:function(t,e){var i=te.applyTransform(e,t),n=te.applyTransform(e.slice(2),t),a=te.applyTransform([e[0],e[3]],t),r=te.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,i[0],n[0],a[0],r[0]),this.minY=Math.min(this.minY,i[1],n[1],a[1],r[1]),this.maxX=Math.max(this.maxX,i[0],n[0],a[0],r[0]),this.maxY=Math.max(this.maxY,i[1],n[1],a[1],r[1])}},{key:"updateScalingPathMinMax",value:function(t,e){te.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}},{key:"updateCurvePathMinMax",value:function(t,e,i,n,a,r,s,o,l,h){var u=te.bezierBoundingBox(e,i,n,a,r,s,o,l,h);h||this.updateRectMinMax(t,u)}},{key:"getPathBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ls,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=[this.minX,this.minY,this.maxX,this.maxY];if(t===Is){e||Dt("Stroke bounding box must include transform.");var n=te.singularValueDecompose2dScale(e),a=n[0]*this.lineWidth/2,r=n[1]*this.lineWidth/2;i[0]-=a,i[1]-=r,i[2]+=a,i[3]+=r}return i}},{key:"updateClipFromPath",value:function(){var t=te.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}},{key:"isEmptyClip",value:function(){return this.minX===1/0}},{key:"startNewPathAndClipBox",value:function(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}},{key:"getClippedPathBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ls,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return te.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}]),t}();function Js(t,e){if("undefined"!==typeof ImageData&&e instanceof ImageData)t.putImageData(e,0,0);else{var i,n,a,r,s,o=e.height,l=e.width,h=o%Xs,u=(o-h)/Xs,c=0===h?u:u+1,d=t.createImageData(l,Xs),v=0,f=e.data,p=d.data;if(e.kind===nt.GRAYSCALE_1BPP){var g=f.byteLength,m=new Uint32Array(p.buffer,0,p.byteLength>>2),y=m.length,k=l+7>>3,b=4294967295,w=Jt.isLittleEndian?4278190080:255;for(n=0;n<c;n++){for(r=n<u?Xs:h,i=0,a=0;a<r;a++){for(var A=g-v,_=0,x=A>k?l:8*A-7,S=-8&x,M=0,E=0;_<S;_+=8)E=f[v++],m[i++]=128&E?b:w,m[i++]=64&E?b:w,m[i++]=32&E?b:w,m[i++]=16&E?b:w,m[i++]=8&E?b:w,m[i++]=4&E?b:w,m[i++]=2&E?b:w,m[i++]=1&E?b:w;for(;_<x;_++)0===M&&(E=f[v++],M=128),m[i++]=E&M?b:w,M>>=1}for(;i<y;)m[i++]=0;t.putImageData(d,0,n*Xs)}}else if(e.kind===nt.RGBA_32BPP){for(a=0,s=l*Xs*4,n=0;n<u;n++)p.set(f.subarray(v,v+s)),v+=s,t.putImageData(d,0,a),a+=Xs;n<c&&(s=l*h*4,p.set(f.subarray(v,v+s)),t.putImageData(d,0,a))}else{if(e.kind!==nt.RGB_24BPP)throw new Error("bad image kind: ".concat(e.kind));for(s=l*(r=Xs),n=0;n<c;n++){for(n>=u&&(s=l*(r=h)),i=0,a=s;a--;)p[i++]=f[v++],p[i++]=f[v++],p[i++]=f[v++],p[i++]=255;t.putImageData(d,0,n*Xs)}}}}function $s(t,e){if(e.bitmap)t.drawImage(e.bitmap,0,0);else for(var i=e.height,n=e.width,a=i%Xs,r=(i-a)/Xs,s=0===a?r:r+1,o=t.createImageData(n,Xs),l=0,h=e.data,u=o.data,c=0;c<s;c++){l=qs({src:h,srcPos:l,dest:u,width:n,height:c<r?Xs:a,nonBlackColor:0}).srcPos,t.putImageData(o,0,c*Xs)}}function to(t,e){for(var i=0,n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];i<n.length;i++){var a=n[i];void 0!==t[a]&&(e[a]=t[a])}void 0!==t.setLineDash&&(e.setLineDash(t.getLineDash()),e.lineDashOffset=t.lineDashOffset)}function eo(t){if(t.strokeStyle=t.fillStyle="#000000",t.fillRule="nonzero",t.globalAlpha=1,t.lineWidth=1,t.lineCap="butt",t.lineJoin="miter",t.miterLimit=10,t.globalCompositeOperation="source-over",t.font="10px sans-serif",void 0!==t.setLineDash&&(t.setLineDash([]),t.lineDashOffset=0),!F){var e=t.filter;"none"!==e&&""!==e&&(t.filter="none")}}function io(t,e){if(e)return!0;var i=te.singularValueDecompose2dScale(t);i[0]=Math.fround(i[0]),i[1]=Math.fround(i[1]);var n=Math.fround((globalThis.devicePixelRatio||1)*Se.PDF_TO_CSS_UNITS);return i[0]<=n&&i[1]<=n}var no=["butt","round","square"],ao=["miter","round","bevel"],ro={},so={},oo=new WeakSet,lo=new WeakSet,ho=function(){function t(e,i,n,a,r,s,o,l){var h=s.optionalContentConfig,u=s.markedContentStack,c=void 0===u?null:u;(0,T.Z)(this,t),y(this,lo),y(this,oo),this.ctx=e,this.current=new Qs(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=i,this.objs=n,this.canvasFactory=a,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=h,this.cachedCanvases=new Ks(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}return(0,Z.Z)(t,[{key:"getObject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"===typeof t?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}},{key:"beginDrawing",value:function(t){var e,i,n=t.transform,a=t.viewport,r=t.transparency,s=void 0!==r&&r,o=t.background,l=void 0===o?null:o,h=this.ctx.canvas.width,u=this.ctx.canvas.height,c=this.ctx.fillStyle;if(this.ctx.fillStyle=l||"#ffffff",this.ctx.fillRect(0,0,h,u),this.ctx.fillStyle=c,s){var d,v=this.cachedCanvases.getCanvas("transparent",h,u);this.compositeCtx=this.ctx,this.transparentCanvas=v.canvas,this.ctx=v.context,this.ctx.save(),(d=this.ctx).transform.apply(d,(0,p.Z)(_i(this.compositeCtx)))}(this.ctx.save(),eo(this.ctx),n)&&((i=this.ctx).transform.apply(i,(0,p.Z)(n)),this.outputScaleX=n[0],this.outputScaleY=n[0]);(e=this.ctx).transform.apply(e,(0,p.Z)(a.transform)),this.viewportScale=a.scale,this.baseTransform=_i(this.ctx)}},{key:"executeOperatorList",value:function(t,e,i,n){var a=t.argsArray,r=t.fnArray,s=e||0,o=a.length;if(o===s)return s;for(var l,h=o-s>10&&"function"===typeof i,u=h?Date.now()+15:0,c=0,d=this.commonObjs,v=this.objs;;){if(void 0!==n&&s===n.nextBreakPoint)return n.breakIt(s,i),s;if((l=r[s])!==Zt.dependency)this[l].apply(this,a[s]);else{var f,p=C(a[s]);try{for(p.s();!(f=p.n()).done;){var g=f.value,m=g.startsWith("g_")?d:v;if(!m.has(g))return m.get(g,i),s}}catch(y){p.e(y)}finally{p.f()}}if(++s===o)return s;if(h&&++c>10){if(Date.now()>u)return i(),s;c=0}}}},{key:"endDrawing",value:function(){k(this,oo,uo).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();var t,e=C(this._cachedBitmapsMap.values());try{for(e.s();!(t=e.n()).done;){var i,n=t.value,a=C(n.values());try{for(a.s();!(i=a.n()).done;){var r=i.value;"undefined"!==typeof HTMLCanvasElement&&r instanceof HTMLCanvasElement&&(r.width=r.height=0)}}catch(s){a.e(s)}finally{a.f()}n.clear()}}catch(s){e.e(s)}finally{e.f()}this._cachedBitmapsMap.clear(),k(this,lo,co).call(this)}},{key:"_scaleImage",value:function(t,e){for(var i,n,a=t.width,r=t.height,s=Math.max(Math.hypot(e[0],e[1]),1),o=Math.max(Math.hypot(e[2],e[3]),1),l=a,h=r,u="prescale1";s>2&&l>1||o>2&&h>1;){var c=l,d=h;s>2&&l>1&&(s/=l/(c=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2))),o>2&&h>1&&(o/=h/(d=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h)/2)),(n=(i=this.cachedCanvases.getCanvas(u,c,d)).context).clearRect(0,0,c,d),n.drawImage(t,0,0,l,h,0,0,c,d),t=i.canvas,l=c,h=d,u="prescale1"===u?"prescale2":"prescale1"}return{img:t,paintWidth:l,paintHeight:h}}},{key:"_createMaskCanvas",value:function(t){var e,i,n,a,r=this.ctx,s=t.width,o=t.height,l=this.current.fillColor,h=this.current.patternFill,u=_i(r);if((t.bitmap||t.data)&&t.count>1){var c=t.bitmap||t.data.buffer;i=JSON.stringify(h?u:[u.slice(0,4),l]),(e=this._cachedBitmapsMap.get(c))||(e=new Map,this._cachedBitmapsMap.set(c,e));var d=e.get(i);if(d&&!h)return{canvas:d,offsetX:Math.round(Math.min(u[0],u[2])+u[4]),offsetY:Math.round(Math.min(u[1],u[3])+u[5])};n=d}n||$s((a=this.cachedCanvases.getCanvas("maskCanvas",s,o)).context,t);var v=te.transform(u,[1/s,0,0,-1/o,0,0]);v=te.transform(v,[1,0,0,1,0,-o]);var f=te.getAxialAlignedBoundingBox([0,0,s,o],v),g=(0,M.Z)(f,4),m=g[0],y=g[1],k=g[2],b=g[3],w=Math.round(k-m)||1,A=Math.round(b-y)||1,_=this.cachedCanvases.getCanvas("fillCanvas",w,A),x=_.context,S=m,E=y;x.translate(-S,-E),x.transform.apply(x,(0,p.Z)(v)),n||(n=(n=this._scaleImage(a.canvas,xi(x))).img,e&&h&&e.set(i,n)),x.imageSmoothingEnabled=io(_i(x),t.interpolate),Ys(x,n,0,0,n.width,n.height,0,0,s,o),x.globalCompositeOperation="source-in";var C=te.transform(xi(x),[1,0,0,1,-S,-E]);return x.fillStyle=h?l.getPattern(r,this,C,Ls):l,x.fillRect(0,0,s,o),e&&!h&&(this.cachedCanvases.delete("fillCanvas"),e.set(i,_.canvas)),{canvas:_.canvas,offsetX:Math.round(S),offsetY:Math.round(E)}}},{key:"setLineWidth",value:function(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}},{key:"setLineCap",value:function(t){this.ctx.lineCap=no[t]}},{key:"setLineJoin",value:function(t){this.ctx.lineJoin=ao[t]}},{key:"setMiterLimit",value:function(t){this.ctx.miterLimit=t}},{key:"setDash",value:function(t,e){var i=this.ctx;void 0!==i.setLineDash&&(i.setLineDash(t),i.lineDashOffset=e)}},{key:"setRenderingIntent",value:function(t){}},{key:"setFlatness",value:function(t){}},{key:"setGState",value:function(t){var e,i=C(t);try{for(i.s();!(e=i.n()).done;){var n=(0,M.Z)(e.value,2),a=n[0],r=n[1];switch(a){case"LW":this.setLineWidth(r);break;case"LC":this.setLineCap(r);break;case"LJ":this.setLineJoin(r);break;case"ML":this.setMiterLimit(r);break;case"D":this.setDash(r[0],r[1]);break;case"RI":this.setRenderingIntent(r);break;case"FL":this.setFlatness(r);break;case"Font":this.setFont(r[0],r[1]);break;case"CA":this.current.strokeAlpha=r;break;case"ca":this.current.fillAlpha=r,this.ctx.globalAlpha=r;break;case"BM":this.ctx.globalCompositeOperation=r;break;case"SMask":this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r)}}}catch(s){i.e(s)}finally{i.f()}}},{key:"inSMaskMode",get:function(){return!!this.suspendedCtx}},{key:"checkSMaskState",value:function(){var t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}},{key:"beginSMaskMode",value:function(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");var t=this.ctx.canvas.width,e=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,n=this.cachedCanvases.getCanvas(i,t,e);this.suspendedCtx=this.ctx,this.ctx=n.context;var a=this.ctx;a.setTransform.apply(a,(0,p.Z)(_i(this.suspendedCtx))),to(this.suspendedCtx,a),function(t,e){if(t._removeMirroring)throw new Error("Context is already forwarding operations.");t.__originalSave=t.save,t.__originalRestore=t.restore,t.__originalRotate=t.rotate,t.__originalScale=t.scale,t.__originalTranslate=t.translate,t.__originalTransform=t.transform,t.__originalSetTransform=t.setTransform,t.__originalResetTransform=t.resetTransform,t.__originalClip=t.clip,t.__originalMoveTo=t.moveTo,t.__originalLineTo=t.lineTo,t.__originalBezierCurveTo=t.bezierCurveTo,t.__originalRect=t.rect,t.__originalClosePath=t.closePath,t.__originalBeginPath=t.beginPath,t._removeMirroring=function(){t.save=t.__originalSave,t.restore=t.__originalRestore,t.rotate=t.__originalRotate,t.scale=t.__originalScale,t.translate=t.__originalTranslate,t.transform=t.__originalTransform,t.setTransform=t.__originalSetTransform,t.resetTransform=t.__originalResetTransform,t.clip=t.__originalClip,t.moveTo=t.__originalMoveTo,t.lineTo=t.__originalLineTo,t.bezierCurveTo=t.__originalBezierCurveTo,t.rect=t.__originalRect,t.closePath=t.__originalClosePath,t.beginPath=t.__originalBeginPath,delete t._removeMirroring},t.save=function(){e.save(),this.__originalSave()},t.restore=function(){e.restore(),this.__originalRestore()},t.translate=function(t,i){e.translate(t,i),this.__originalTranslate(t,i)},t.scale=function(t,i){e.scale(t,i),this.__originalScale(t,i)},t.transform=function(t,i,n,a,r,s){e.transform(t,i,n,a,r,s),this.__originalTransform(t,i,n,a,r,s)},t.setTransform=function(t,i,n,a,r,s){e.setTransform(t,i,n,a,r,s),this.__originalSetTransform(t,i,n,a,r,s)},t.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},t.rotate=function(t){e.rotate(t),this.__originalRotate(t)},t.clip=function(t){e.clip(t),this.__originalClip(t)},t.moveTo=function(t,i){e.moveTo(t,i),this.__originalMoveTo(t,i)},t.lineTo=function(t,i){e.lineTo(t,i),this.__originalLineTo(t,i)},t.bezierCurveTo=function(t,i,n,a,r,s){e.bezierCurveTo(t,i,n,a,r,s),this.__originalBezierCurveTo(t,i,n,a,r,s)},t.rect=function(t,i,n,a){e.rect(t,i,n,a),this.__originalRect(t,i,n,a)},t.closePath=function(){e.closePath(),this.__originalClosePath()},t.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}(a,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}},{key:"endSMaskMode",value:function(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),to(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}},{key:"compose",value:function(t){if(this.current.activeSMask){t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];var e=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}}},{key:"composeSMask",value:function(t,e,i,n){var a=n[0],r=n[1],s=n[2]-a,o=n[3]-r;0!==s&&0!==o&&(this.genericComposeSMask(e.context,i,s,o,e.subtype,e.backdrop,e.transferMap,a,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(i.canvas,0,0),t.restore())}},{key:"genericComposeSMask",value:function(t,e,i,n,a,r,s,o,l,h,u){var c=t.canvas,d=o-h,v=l-u;if(r)if(d<0||v<0||d+i>c.width||v+n>c.height){var f=this.cachedCanvases.getCanvas("maskExtension",i,n),g=f.context;g.drawImage(c,-d,-v),r.some((function(t){return 0!==t}))&&(g.globalCompositeOperation="destination-atop",g.fillStyle=te.makeHexColor.apply(te,(0,p.Z)(r)),g.fillRect(0,0,i,n),g.globalCompositeOperation="source-over"),c=f.canvas,d=v=0}else if(r.some((function(t){return 0!==t}))){t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);var m=new Path2D;m.rect(d,v,i,n),t.clip(m),t.globalCompositeOperation="destination-atop",t.fillStyle=te.makeHexColor.apply(te,(0,p.Z)(r)),t.fillRect(d,v,i,n),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),"Alpha"===a&&s?e.filter=this.filterFactory.addAlphaFilter(s):"Luminosity"===a&&(e.filter=this.filterFactory.addLuminosityFilter(s));var y=new Path2D;y.rect(o,l,i,n),e.clip(y),e.globalCompositeOperation="destination-in",e.drawImage(c,d,v,i,n,o,l,i,n),e.restore()}},{key:"save",value:function(){this.inSMaskMode?(to(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();var t=this.current;this.stateStack.push(t),this.current=t.clone()}},{key:"restore",value:function(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),to(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}},{key:"transform",value:function(t,e,i,n,a,r){this.ctx.transform(t,e,i,n,a,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}},{key:"constructPath",value:function(t,e,i){for(var n,a,r=this.ctx,s=this.current,o=s.x,l=s.y,h=_i(r),u=0===h[0]&&0===h[3]||0===h[1]&&0===h[2],c=u?i.slice(0):null,d=0,v=0,f=t.length;d<f;d++)switch(0|t[d]){case Zt.rectangle:o=e[v++],l=e[v++];var p=e[v++],g=e[v++],m=o+p,y=l+g;r.moveTo(o,l),0===p||0===g?r.lineTo(m,y):(r.lineTo(m,l),r.lineTo(m,y),r.lineTo(o,y)),u||s.updateRectMinMax(h,[o,l,m,y]),r.closePath();break;case Zt.moveTo:o=e[v++],l=e[v++],r.moveTo(o,l),u||s.updatePathMinMax(h,o,l);break;case Zt.lineTo:o=e[v++],l=e[v++],r.lineTo(o,l),u||s.updatePathMinMax(h,o,l);break;case Zt.curveTo:n=o,a=l,o=e[v+4],l=e[v+5],r.bezierCurveTo(e[v],e[v+1],e[v+2],e[v+3],o,l),s.updateCurvePathMinMax(h,n,a,e[v],e[v+1],e[v+2],e[v+3],o,l,c),v+=6;break;case Zt.curveTo2:n=o,a=l,r.bezierCurveTo(o,l,e[v],e[v+1],e[v+2],e[v+3]),s.updateCurvePathMinMax(h,n,a,o,l,e[v],e[v+1],e[v+2],e[v+3],c),o=e[v+2],l=e[v+3],v+=4;break;case Zt.curveTo3:n=o,a=l,o=e[v+2],l=e[v+3],r.bezierCurveTo(e[v],e[v+1],o,l,o,l),s.updateCurvePathMinMax(h,n,a,e[v],e[v+1],o,l,o,l,c),v+=4;break;case Zt.closePath:r.closePath()}u&&s.updateScalingPathMinMax(h,c),s.setCurrentPoint(o,l)}},{key:"closePath",value:function(){this.ctx.closePath()}},{key:"stroke",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.ctx,i=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"===typeof i&&null!==i&&void 0!==i&&i.getPattern?(e.save(),e.strokeStyle=i.getPattern(e,this,xi(e),Is),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}},{key:"closeStroke",value:function(){this.closePath(),this.stroke()}},{key:"fill",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.ctx,i=this.current.fillColor,n=this.current.patternFill,a=!1;n&&(e.save(),e.fillStyle=i.getPattern(e,this,xi(e),Ls),a=!0);var r=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==r&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),a&&e.restore(),t&&this.consumePath(r)}},{key:"eoFill",value:function(){this.pendingEOFill=!0,this.fill()}},{key:"fillStroke",value:function(){this.fill(!1),this.stroke(!1),this.consumePath()}},{key:"eoFillStroke",value:function(){this.pendingEOFill=!0,this.fillStroke()}},{key:"closeFillStroke",value:function(){this.closePath(),this.fillStroke()}},{key:"closeEOFillStroke",value:function(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}},{key:"endPath",value:function(){this.consumePath()}},{key:"clip",value:function(){this.pendingClip=ro}},{key:"eoClip",value:function(){this.pendingClip=so}},{key:"beginText",value:function(){this.current.textMatrix=D,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}},{key:"endText",value:function(){var t=this.pendingTextPaths,e=this.ctx;if(void 0!==t){e.save(),e.beginPath();var i,n=C(t);try{for(n.s();!(i=n.n()).done;){var a=i.value;e.setTransform.apply(e,(0,p.Z)(a.transform)),e.translate(a.x,a.y),a.addToPath(e,a.fontSize)}}catch(r){n.e(r)}finally{n.f()}e.restore(),e.clip(),e.beginPath(),delete this.pendingTextPaths}else e.beginPath()}},{key:"setCharSpacing",value:function(t){this.current.charSpacing=t}},{key:"setWordSpacing",value:function(t){this.current.wordSpacing=t}},{key:"setHScale",value:function(t){this.current.textHScale=t/100}},{key:"setLeading",value:function(t){this.current.leading=-t}},{key:"setFont",value:function(t,e){var i,n=this.commonObjs.get(t),a=this.current;if(!n)throw new Error("Can't find font for ".concat(t));if(a.fontMatrix=n.fontMatrix||W,0!==a.fontMatrix[0]&&0!==a.fontMatrix[3]||Ft("Invalid font matrix for font "+t),e<0?(e=-e,a.fontDirection=-1):a.fontDirection=1,this.current.font=n,this.current.fontSize=e,!n.isType3Font){var r=n.loadedName||"sans-serif",s=(null===(i=n.systemFontInfo)||void 0===i?void 0:i.css)||'"'.concat(r,'", ').concat(n.fallbackName),o="normal";n.black?o="900":n.bold&&(o="bold");var l=n.italic?"italic":"normal",h=e;e<16?h=16:e>100&&(h=100),this.current.fontSizeScale=e/h,this.ctx.font="".concat(l," ").concat(o," ").concat(h,"px ").concat(s)}}},{key:"setTextRenderingMode",value:function(t){this.current.textRenderingMode=t}},{key:"setTextRise",value:function(t){this.current.textRise=t}},{key:"moveText",value:function(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}},{key:"setLeadingMoveText",value:function(t,e){this.setLeading(-e),this.moveText(t,e)}},{key:"setTextMatrix",value:function(t,e,i,n,a,r){this.current.textMatrix=[t,e,i,n,a,r],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}},{key:"nextLine",value:function(){this.moveText(0,this.current.leading)}},{key:"paintChar",value:function(t,e,i,n){var a,r=this.ctx,s=this.current,o=s.font,l=s.textRenderingMode,h=s.fontSize/s.fontSizeScale,u=l&et,c=!!(l&it),d=s.patternFill&&!o.missingFile;((o.disableFontFace||c||d)&&(a=o.getPathGenerator(this.commonObjs,t)),o.disableFontFace||d?(r.save(),r.translate(e,i),r.beginPath(),a(r,h),n&&r.setTransform.apply(r,(0,p.Z)(n)),u!==Q&&u!==$||r.fill(),u!==J&&u!==$||r.stroke(),r.restore()):(u!==Q&&u!==$||r.fillText(t,e,i),u!==J&&u!==$||r.strokeText(t,e,i)),c)&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:_i(r),x:e,y:i,fontSize:h,addToPath:a})}},{key:"isFontSubpixelAAEnabled",get:function(){var t=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10).context;t.scale(1.5,1),t.fillText("I",0,10);for(var e=t.getImageData(0,0,10,10).data,i=!1,n=3;n<e.length;n+=4)if(e[n]>0&&e[n]<255){i=!0;break}return Bt(this,"isFontSubpixelAAEnabled",i)}},{key:"showText",value:function(t){var e=this.current,i=e.font;if(i.isType3Font)return this.showType3Text(t);var n=e.fontSize;if(0!==n){var a,r=this.ctx,s=e.fontSizeScale,o=e.charSpacing,l=e.wordSpacing,h=e.fontDirection,u=e.textHScale*h,c=t.length,d=i.vertical,v=d?1:-1,f=i.defaultVMetrics,g=n*e.fontMatrix[0],m=e.textRenderingMode===Q&&!i.disableFontFace&&!e.patternFill;if(r.save(),r.transform.apply(r,(0,p.Z)(e.textMatrix)),r.translate(e.x,e.y+e.textRise),h>0?r.scale(u,-1):r.scale(u,1),e.patternFill){r.save();var y=e.fillColor.getPattern(r,this,xi(r),Ls);a=_i(r),r.restore(),r.fillStyle=y}var k=e.lineWidth,b=e.textMatrixScale;if(0===b||0===k){var w=e.textRenderingMode&et;w!==J&&w!==$||(k=this.getSinglePixelWidth())}else k/=b;if(1!==s&&(r.scale(s,s),k/=s),r.lineWidth=k,i.isInvalidPDFjsFont){var A,_=[],x=0,S=C(t);try{for(S.s();!(A=S.n()).done;){var M=A.value;_.push(M.unicode),x+=M.width}}catch(V){S.e(V)}finally{S.f()}return r.fillText(_.join(""),0,0),e.x+=x*g*u,r.restore(),void this.compose()}var E,Z=0;for(E=0;E<c;++E){var T=t[E];if("number"!==typeof T){var R=!1,P=(T.isSpace?l:0)+o,L=T.fontChar,I=T.accent,F=void 0,D=void 0,W=T.width;if(d){var N=T.vmetric||f,O=-(T.vmetric?N[1]:.5*W)*g,B=N[2]*g;W=N?-N[0]:W,F=O/s,D=(Z+B)/s}else F=Z/s,D=0;if(i.remeasure&&W>0){var H=1e3*r.measureText(L).width/n*s;if(W<H&&this.isFontSubpixelAAEnabled){var z=W/H;R=!0,r.save(),r.scale(z,1),F/=z}else W!==H&&(F+=(W-H)/2e3*n/s)}if(this.contentVisible&&(T.isInFont||i.missingFile))if(m&&!I)r.fillText(L,F,D);else if(this.paintChar(L,F,D,a),I){var j=F+n*I.offset.x/s,U=D-n*I.offset.y/s;this.paintChar(I.fontChar,j,U,a)}Z+=d?W*g-P*h:W*g+P*h,R&&r.restore()}else Z+=v*T*n/1e3}d?e.y-=Z:e.x+=Z*u,r.restore(),this.compose()}}},{key:"showType3Text",value:function(t){var e,i,n,a,r=this.ctx,s=this.current,o=s.font,l=s.fontSize,h=s.fontDirection,u=o.vertical?1:-1,c=s.charSpacing,d=s.wordSpacing,v=s.textHScale*h,f=s.fontMatrix||W,g=t.length;if(!(s.textRenderingMode===tt)&&0!==l){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,r.save(),r.transform.apply(r,(0,p.Z)(s.textMatrix)),r.translate(s.x,s.y),r.scale(v,h),e=0;e<g;++e)if("number"!==typeof(i=t[e])){var m=(i.isSpace?d:0)+c,y=o.charProcOperatorList[i.operatorListId];if(y)this.contentVisible&&(this.processingType3=i,this.save(),r.scale(l,l),r.transform.apply(r,(0,p.Z)(f)),this.executeOperatorList(y),this.restore()),n=te.applyTransform([i.width,0],f)[0]*l+m,r.translate(n,0),s.x+=n*v;else Ft('Type3 character "'.concat(i.operatorListId,'" is not available.'))}else a=u*i*l/1e3,this.ctx.translate(a,0),s.x+=a*v;r.restore(),this.processingType3=null}}},{key:"setCharWidth",value:function(t,e){}},{key:"setCharWidthAndBounds",value:function(t,e,i,n,a,r){this.ctx.rect(i,n,a-i,r-n),this.ctx.clip(),this.endPath()}},{key:"getColorN_Pattern",value:function(e){var i,n=this;if("TilingPattern"===e[0]){var a=e[1],r=this.baseTransform||_i(this.ctx),s={createCanvasGraphics:function(e){return new t(e,n.commonObjs,n.objs,n.canvasFactory,n.filterFactory,{optionalContentConfig:n.optionalContentConfig,markedContentStack:n.markedContentStack})}};i=new Gs(e,a,this.ctx,s,r)}else i=this._getPattern(e[1],e[2]);return i}},{key:"setStrokeColorN",value:function(){this.current.strokeColor=this.getColorN_Pattern(arguments)}},{key:"setFillColorN",value:function(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}},{key:"setStrokeRGBColor",value:function(t,e,i){this.ctx.strokeStyle=this.current.strokeColor=te.makeHexColor(t,e,i)}},{key:"setStrokeTransparent",value:function(){this.ctx.strokeStyle=this.current.strokeColor="transparent"}},{key:"setFillRGBColor",value:function(t,e,i){this.ctx.fillStyle=this.current.fillColor=te.makeHexColor(t,e,i),this.current.patternFill=!1}},{key:"setFillTransparent",value:function(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}},{key:"_getPattern",value:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.cachedPatterns.has(t)?e=this.cachedPatterns.get(t):(e=js(this.getObject(t)),this.cachedPatterns.set(t,e)),i&&(e.matrix=i),e}},{key:"shadingFill",value:function(t){if(this.contentVisible){var e=this.ctx;this.save();var i=this._getPattern(t);e.fillStyle=i.getPattern(e,this,xi(e),Fs);var n=xi(e);if(n){var a=e.canvas,r=a.width,s=a.height,o=te.getAxialAlignedBoundingBox([0,0,r,s],n),l=(0,M.Z)(o,4),h=l[0],u=l[1],c=l[2],d=l[3];this.ctx.fillRect(h,u,c-h,d-u)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}}},{key:"beginInlineImage",value:function(){Dt("Should not call beginInlineImage")}},{key:"beginImageData",value:function(){Dt("Should not call beginImageData")}},{key:"paintFormXObjectBegin",value:function(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform.apply(this,(0,p.Z)(t)),this.baseTransform=_i(this.ctx),e)){var i=e[2]-e[0],n=e[3]-e[1];this.ctx.rect(e[0],e[1],i,n),this.current.updateRectMinMax(_i(this.ctx),e),this.clip(),this.endPath()}}},{key:"paintFormXObjectEnd",value:function(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}},{key:"beginGroup",value:function(t){if(this.contentVisible){this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);var e=this.ctx;t.isolated||It("TODO: Support non-isolated groups."),t.knockout&&Ft("Knockout groups not supported.");var i=_i(e);if(t.matrix&&e.transform.apply(e,(0,p.Z)(t.matrix)),!t.bbox)throw new Error("Bounding box is required.");var n=te.getAxialAlignedBoundingBox(t.bbox,_i(e)),a=[0,0,e.canvas.width,e.canvas.height];n=te.intersect(n,a)||[0,0,0,0];var r=Math.floor(n[0]),s=Math.floor(n[1]),o=Math.max(Math.ceil(n[2])-r,1),l=Math.max(Math.ceil(n[3])-s,1);this.current.startNewPathAndClipBox([0,0,o,l]);var h="groupAt"+this.groupLevel;t.smask&&(h+="_smask_"+this.smaskCounter++%2);var u=this.cachedCanvases.getCanvas(h,o,l),c=u.context;c.translate(-r,-s),c.transform.apply(c,(0,p.Z)(i)),t.smask?this.smaskStack.push({canvas:u.canvas,context:c,offsetX:r,offsetY:s,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(r,s),e.save()),to(e,c),this.ctx=c,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}}},{key:"endGroup",value:function(t){if(this.contentVisible){this.groupLevel--;var e=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{var n;this.ctx.restore();var a=_i(this.ctx);this.restore(),this.ctx.save(),(n=this.ctx).setTransform.apply(n,(0,p.Z)(a));var r=te.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],a);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(r)}}}},{key:"beginAnnotation",value:function(t,e,i,n,a){var r;(k(this,oo,uo).call(this),eo(this.ctx),this.ctx.save(),this.save(),this.baseTransform)&&(r=this.ctx).setTransform.apply(r,(0,p.Z)(this.baseTransform));if(e){var s=e[2]-e[0],o=e[3]-e[1];if(a&&this.annotationCanvasMap){(i=i.slice())[4]-=e[0],i[5]-=e[1],(e=e.slice())[0]=e[1]=0,e[2]=s,e[3]=o;var l=te.singularValueDecompose2dScale(_i(this.ctx)),h=(0,M.Z)(l,2),u=h[0],c=h[1],d=this.viewportScale,v=Math.ceil(s*this.outputScaleX*d),f=Math.ceil(o*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(v,f);var g=this.annotationCanvas,m=g.canvas,y=g.context;this.annotationCanvasMap.set(t,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=y,this.ctx.save(),this.ctx.setTransform(u,0,0,-c,0,o*c),eo(this.ctx)}else eo(this.ctx),this.ctx.rect(e[0],e[1],s,o),this.ctx.clip(),this.endPath()}this.current=new Qs(this.ctx.canvas.width,this.ctx.canvas.height),this.transform.apply(this,(0,p.Z)(i)),this.transform.apply(this,(0,p.Z)(n))}},{key:"endAnnotation",value:function(){this.annotationCanvas&&(this.ctx.restore(),k(this,lo,co).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}},{key:"paintImageMaskXObject",value:function(t){if(this.contentVisible){var e=t.count;(t=this.getObject(t.data,t)).count=e;var i=this.ctx,n=this.processingType3;if(n&&(void 0===n.compiled&&(n.compiled=function(t){var e=t.width,i=t.height;if(e>1e3||i>1e3)return null;var n,a,r,s,o=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),l=e+1,h=new Uint8Array(l*(i+1)),u=e+7&-8,c=new Uint8Array(u*i),d=0,v=C(t.data);try{for(v.s();!(s=v.n()).done;)for(var f=s.value,p=128;p>0;)c[d++]=f&p?0:255,p>>=1}catch(M){v.e(M)}finally{v.f()}var g=0;for(0!==c[d=0]&&(h[0]=1,++g),a=1;a<e;a++)c[d]!==c[d+1]&&(h[a]=c[d]?2:1,++g),d++;for(0!==c[d]&&(h[a]=2,++g),n=1;n<i;n++){r=n*l,c[(d=n*u)-u]!==c[d]&&(h[r]=c[d]?1:8,++g);var m=(c[d]?4:0)+(c[d-u]?8:0);for(a=1;a<e;a++)o[m=(m>>2)+(c[d+1]?4:0)+(c[d-u+1]?8:0)]&&(h[r+a]=o[m],++g),d++;if(c[d-u]!==c[d]&&(h[r+a]=c[d]?2:4,++g),g>1e3)return null}for(r=n*l,0!==c[d=u*(i-1)]&&(h[r]=8,++g),a=1;a<e;a++)c[d]!==c[d+1]&&(h[r+a]=c[d]?4:8,++g),d++;if(0!==c[d]&&(h[r+a]=4,++g),g>1e3)return null;var y=new Int32Array([0,l,-1,0,-l,0,0,0,1]),k=new Path2D;for(n=0;g&&n<=i;n++){for(var b=n*l,w=b+e;b<w&&!h[b];)b++;if(b!==w){k.moveTo(b%l,n);var A=b,_=h[b];do{var x=y[_];do{b+=x}while(!h[b]);var S=h[b];5!==S&&10!==S?(_=S,h[b]=0):(_=S&51*_>>4,h[b]&=_>>2|_<<2),k.lineTo(b%l,b/l|0),h[b]||--g}while(A!==b);--n}}return c=null,h=null,function(t){t.save(),t.scale(1/e,-1/i),t.translate(0,-i),t.fill(k),t.beginPath(),t.restore()}}(t)),n.compiled))n.compiled(i);else{var a=this._createMaskCanvas(t),r=a.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(r,a.offsetX,a.offsetY),i.restore(),this.compose()}}}},{key:"paintImageMaskXObjectRepeat",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;if(this.contentVisible){t=this.getObject(t.data,t);var s=this.ctx;s.save();var o=_i(s);s.transform(e,i,n,a,0,0);var l=this._createMaskCanvas(t);s.setTransform(1,0,0,1,l.offsetX-o[4],l.offsetY-o[5]);for(var h=0,u=r.length;h<u;h+=2){var c=te.transform(o,[e,i,n,a,r[h],r[h+1]]),d=te.applyTransform([0,0],c),v=(0,M.Z)(d,2),f=v[0],p=v[1];s.drawImage(l.canvas,f,p)}s.restore(),this.compose()}}},{key:"paintImageMaskXObjectGroup",value:function(t){if(this.contentVisible){var e,i=this.ctx,n=this.current.fillColor,a=this.current.patternFill,r=C(t);try{for(r.s();!(e=r.n()).done;){var s=e.value,o=s.data,l=s.width,h=s.height,u=s.transform,c=this.cachedCanvases.getCanvas("maskCanvas",l,h),d=c.context;d.save(),$s(d,this.getObject(o,s)),d.globalCompositeOperation="source-in",d.fillStyle=a?n.getPattern(d,this,xi(i),Ls):n,d.fillRect(0,0,l,h),d.restore(),i.save(),i.transform.apply(i,(0,p.Z)(u)),i.scale(1,-1),Ys(i,c.canvas,0,0,l,h,0,-1,1,1),i.restore()}}catch(v){r.e(v)}finally{r.f()}this.compose()}}},{key:"paintImageXObject",value:function(t){if(this.contentVisible){var e=this.getObject(t);e?this.paintInlineImageXObject(e):Ft("Dependent image isn't ready yet")}}},{key:"paintImageXObjectRepeat",value:function(t,e,i,n){if(this.contentVisible){var a=this.getObject(t);if(a){for(var r=a.width,s=a.height,o=[],l=0,h=n.length;l<h;l+=2)o.push({transform:[e,0,0,i,n[l],n[l+1]],x:0,y:0,w:r,h:s});this.paintInlineImageXObjectGroup(a,o)}else Ft("Dependent image isn't ready yet")}}},{key:"applyTransferMapsToCanvas",value:function(t){return"none"!==this.current.transferMaps&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}},{key:"applyTransferMapsToBitmap",value:function(t){if("none"===this.current.transferMaps)return t.bitmap;var e=t.bitmap,i=t.width,n=t.height,a=this.cachedCanvases.getCanvas("inlineImage",i,n),r=a.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",a.canvas}},{key:"paintInlineImageXObject",value:function(t){if(this.contentVisible){var e,i=t.width,n=t.height,a=this.ctx;if(this.save(),!F){var r=a.filter;"none"!==r&&""!==r&&(a.filter="none")}if(a.scale(1/i,-1/n),t.bitmap)e=this.applyTransferMapsToBitmap(t);else if("function"===typeof HTMLElement&&t instanceof HTMLElement||!t.data)e=t;else{var s=this.cachedCanvases.getCanvas("inlineImage",i,n).context;Js(s,t),e=this.applyTransferMapsToCanvas(s)}var o=this._scaleImage(e,xi(a));a.imageSmoothingEnabled=io(_i(a),t.interpolate),Ys(a,o.img,0,0,o.paintWidth,o.paintHeight,0,-n,i,n),this.compose(),this.restore()}}},{key:"paintInlineImageXObjectGroup",value:function(t,e){if(this.contentVisible){var i,n=this.ctx;if(t.bitmap)i=t.bitmap;else{var a=t.width,r=t.height,s=this.cachedCanvases.getCanvas("inlineImage",a,r).context;Js(s,t),i=this.applyTransferMapsToCanvas(s)}var o,l=C(e);try{for(l.s();!(o=l.n()).done;){var h=o.value;n.save(),n.transform.apply(n,(0,p.Z)(h.transform)),n.scale(1,-1),Ys(n,i,h.x,h.y,h.w,h.h,0,-1,1,1),n.restore()}}catch(u){l.e(u)}finally{l.f()}this.compose()}}},{key:"paintSolidColorImageMask",value:function(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}},{key:"markPoint",value:function(t){}},{key:"markPointProps",value:function(t,e){}},{key:"beginMarkedContent",value:function(t){this.markedContentStack.push({visible:!0})}},{key:"beginMarkedContentProps",value:function(t,e){"OC"===t?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}},{key:"endMarkedContent",value:function(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}},{key:"beginCompat",value:function(){}},{key:"endCompat",value:function(){}},{key:"consumePath",value:function(t){var e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);var i=this.ctx;this.pendingClip&&(e||(this.pendingClip===so?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}},{key:"getSinglePixelWidth",value:function(){if(!this._cachedGetSinglePixelWidth){var t=_i(this.ctx);if(0===t[1]&&0===t[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{var e=Math.abs(t[0]*t[3]-t[2]*t[1]),i=Math.hypot(t[0],t[2]),n=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(i,n)/e}}return this._cachedGetSinglePixelWidth}},{key:"getScaleForStroking",value:function(){if(-1===this._cachedScaleForStroking[0]){var t,e,i=this.current.lineWidth,n=this.ctx.getTransform(),a=n.a,r=n.b,s=n.c,o=n.d;if(0===r&&0===s){var l=Math.abs(a),h=Math.abs(o);if(l===h)if(0===i)t=e=1/l;else{var u=l*i;t=e=u<1?1/u:1}else if(0===i)t=1/l,e=1/h;else{var c=l*i,d=h*i;t=c<1?1/c:1,e=d<1?1/d:1}}else{var v=Math.abs(a*o-r*s),f=Math.hypot(a,r),p=Math.hypot(s,o);if(0===i)t=p/v,e=f/v;else{var g=i*v;t=p>g?p/g:1,e=f>g?f/g:1}}this._cachedScaleForStroking[0]=t,this._cachedScaleForStroking[1]=e}return this._cachedScaleForStroking}},{key:"rescaleAndStroke",value:function(t){var e=this.ctx,i=this.current.lineWidth,n=this.getScaleForStroking(),a=(0,M.Z)(n,2),r=a[0],s=a[1];if(e.lineWidth=i||1,1!==r||1!==s){var o=e.getLineDash();if(t&&e.save(),e.scale(r,s),o.length>0){var l=Math.max(r,s);e.setLineDash(o.map((function(t){return t/l}))),e.lineDashOffset/=l}e.stroke(),t&&e.restore()}else e.stroke()}},{key:"isContentVisible",value:function(){for(var t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}]),t}();function uo(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}function co(){if(this.pageColors){var t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==t){var e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}for(var vo in Zt)void 0!==ho.prototype[vo]&&(ho.prototype[Zt[vo]]=ho.prototype[vo]);var fo=function(){function t(){(0,T.Z)(this,t)}return(0,Z.Z)(t,null,[{key:"workerPort",get:function(){return f(this,t,po)},set:function(e){if(!("undefined"!==typeof Worker&&e instanceof Worker)&&null!==e)throw new Error("Invalid `workerPort` type.");d(this,t,po,e)}},{key:"workerSrc",get:function(){return f(this,t,go)},set:function(e){if("string"!==typeof e)throw new Error("Invalid `workerSrc` type.");d(this,t,go,e)}}]),t}(),po={writable:!0,value:null},go={writable:!0,value:""},mo=1,yo=2,ko=1,bo=2,wo=3,Ao=4,_o=5,xo=6,So=7,Mo=8;function Eo(t){switch(t instanceof Error||"object"===typeof t&&null!==t||Dt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),t.name){case"AbortException":return new Xt(t.message);case"MissingPDFException":return new Vt(t.message);case"PasswordException":return new zt(t.message,t.code);case"UnexpectedResponseException":return new Gt(t.message,t.status);case"UnknownErrorException":return new jt(t.message,t.details);default:return new jt(t.message,t.toString())}}var Co=new WeakSet,Zo=new WeakSet,To=new WeakSet,Ro=function(){function t(e,i,n){var a=this;(0,T.Z)(this,t),y(this,To),y(this,Zo),y(this,Co),this.sourceName=e,this.targetName=i,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=function(t){var e=t.data;if(e.targetName===a.sourceName)if(e.stream)k(a,Zo,Lo).call(a,e);else if(e.callback){var i=e.callbackId,r=a.callbackCapabilities[i];if(!r)throw new Error("Cannot resolve callback ".concat(i));if(delete a.callbackCapabilities[i],e.callback===mo)r.resolve(e.data);else{if(e.callback!==yo)throw new Error("Unexpected callback case");r.reject(Eo(e.reason))}}else{var s=a.actionHandler[e.action];if(!s)throw new Error("Unknown action from worker: ".concat(e.action));if(e.callbackId){var o=a.sourceName,l=e.sourceName;new Promise((function(t){t(s(e.data))})).then((function(t){n.postMessage({sourceName:o,targetName:l,callback:mo,callbackId:e.callbackId,data:t})}),(function(t){n.postMessage({sourceName:o,targetName:l,callback:yo,callbackId:e.callbackId,reason:Eo(t)})}))}else e.streamId?k(a,Co,Po).call(a,e):s(e.data)}},n.addEventListener("message",this._onComObjOnMessage)}return(0,Z.Z)(t,[{key:"on",value:function(t,e){var i=this.actionHandler;if(i[t])throw new Error('There is already an actionName called "'.concat(t,'"'));i[t]=e}},{key:"send",value:function(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}},{key:"sendWithPromise",value:function(t,e,i){var n=this.callbackId++,a=Promise.withResolvers();this.callbackCapabilities[n]=a;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:n,data:e},i)}catch(r){a.reject(r)}return a.promise}},{key:"sendWithStream",value:function(t,e,i,n){var a=this,r=this.streamId++,s=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:function(i){var h=Promise.withResolvers();return a.streamControllers[r]={controller:i,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:s,targetName:o,action:t,streamId:r,data:e,desiredSize:i.desiredSize},n),h.promise},pull:function(t){var e=Promise.withResolvers();return a.streamControllers[r].pullCall=e,l.postMessage({sourceName:s,targetName:o,stream:xo,streamId:r,desiredSize:t.desiredSize}),e.promise},cancel:function(t){Wt(t instanceof Error,"cancel must have a valid reason");var e=Promise.withResolvers();return a.streamControllers[r].cancelCall=e,a.streamControllers[r].isClosed=!0,l.postMessage({sourceName:s,targetName:o,stream:ko,streamId:r,reason:Eo(t)}),e.promise}},i)}},{key:"destroy",value:function(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}]),t}();function Po(t){var e=t.streamId,i=this.sourceName,n=t.sourceName,a=this.comObj,r=this,s=this.actionHandler[t.action],o={enqueue:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0;if(!this.isCancelled){var o=this.desiredSize;this.desiredSize-=r,o>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),a.postMessage({sourceName:i,targetName:n,stream:Ao,streamId:e,chunk:t},s)}},close:function(){this.isCancelled||(this.isCancelled=!0,a.postMessage({sourceName:i,targetName:n,stream:wo,streamId:e}),delete r.streamSinks[e])},error:function(t){Wt(t instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,a.postMessage({sourceName:i,targetName:n,stream:_o,streamId:e,reason:Eo(t)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[e]=o,new Promise((function(e){e(s(t.data,o))})).then((function(){a.postMessage({sourceName:i,targetName:n,stream:Mo,streamId:e,success:!0})}),(function(t){a.postMessage({sourceName:i,targetName:n,stream:Mo,streamId:e,reason:Eo(t)})}))}function Lo(t){var e=t.streamId,i=this.sourceName,n=t.sourceName,a=this.comObj,r=this.streamControllers[e],s=this.streamSinks[e];switch(t.stream){case Mo:t.success?r.startCall.resolve():r.startCall.reject(Eo(t.reason));break;case So:t.success?r.pullCall.resolve():r.pullCall.reject(Eo(t.reason));break;case xo:if(!s){a.postMessage({sourceName:i,targetName:n,stream:So,streamId:e,success:!0});break}s.desiredSize<=0&&t.desiredSize>0&&s.sinkCapability.resolve(),s.desiredSize=t.desiredSize,new Promise((function(t){var e;t(null===(e=s.onPull)||void 0===e?void 0:e.call(s))})).then((function(){a.postMessage({sourceName:i,targetName:n,stream:So,streamId:e,success:!0})}),(function(t){a.postMessage({sourceName:i,targetName:n,stream:So,streamId:e,reason:Eo(t)})}));break;case Ao:if(Wt(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case wo:if(Wt(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),k(this,To,Io).call(this,r,e);break;case _o:Wt(r,"error should have stream controller"),r.controller.error(Eo(t.reason)),k(this,To,Io).call(this,r,e);break;case bo:t.success?r.cancelCall.resolve():r.cancelCall.reject(Eo(t.reason)),k(this,To,Io).call(this,r,e);break;case ko:if(!s)break;new Promise((function(e){var i;e(null===(i=s.onCancel)||void 0===i?void 0:i.call(s,Eo(t.reason)))})).then((function(){a.postMessage({sourceName:i,targetName:n,stream:bo,streamId:e,success:!0})}),(function(t){a.postMessage({sourceName:i,targetName:n,stream:bo,streamId:e,reason:Eo(t)})})),s.sinkCapability.reject(Eo(t.reason)),s.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}function Io(t,e){return Fo.apply(this,arguments)}function Fo(){return(Fo=(0,w.Z)(L.mark((function t(e,i){var n,a,r;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.allSettled([null===(n=e.startCall)||void 0===n?void 0:n.promise,null===(a=e.pullCall)||void 0===a?void 0:a.promise,null===(r=e.cancelCall)||void 0===r?void 0:r.promise]);case 2:delete this.streamControllers[i];case 3:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}var Do=new WeakMap,Wo=new WeakMap,No=function(){function t(e){var i=e.parsedData,n=e.rawData;(0,T.Z)(this,t),A(this,Do,{writable:!0,value:void 0}),A(this,Wo,{writable:!0,value:void 0}),x(this,Do,i),x(this,Wo,n)}return(0,Z.Z)(t,[{key:"getRaw",value:function(){return _(this,Wo)}},{key:"get",value:function(t){var e;return null!==(e=_(this,Do).get(t))&&void 0!==e?e:null}},{key:"getAll",value:function(){return Qt(_(this,Do))}},{key:"has",value:function(t){return _(this,Do).has(t)}}]),t}(),Oo=Symbol("INTERNAL"),Bo=new WeakMap,Ho=new WeakMap,zo=new WeakMap,jo=new WeakMap,Uo=function(){function t(e,i){var n=i.name,a=i.intent,r=i.usage;(0,T.Z)(this,t),A(this,Bo,{writable:!0,value:!1}),A(this,Ho,{writable:!0,value:!1}),A(this,zo,{writable:!0,value:!1}),A(this,jo,{writable:!0,value:!0}),x(this,Bo,!!(e&B)),x(this,Ho,!!(e&H)),this.name=n,this.intent=a,this.usage=r}return(0,Z.Z)(t,[{key:"visible",get:function(){if(_(this,zo))return _(this,jo);if(!_(this,jo))return!1;var t=this.usage,e=t.print,i=t.view;return _(this,Bo)?"OFF"!==(null===i||void 0===i?void 0:i.viewState):!_(this,Ho)||"OFF"!==(null===e||void 0===e?void 0:e.printState)}},{key:"_setVisible",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t!==Oo&&Dt("Internal method `_setVisible` called."),x(this,zo,i),x(this,jo,e)}}]),t}(),Vo=new WeakMap,Go=new WeakMap,qo=new WeakMap,Xo=new WeakMap,Ko=new WeakSet,Yo=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B;if((0,T.Z)(this,t),y(this,Ko),A(this,Vo,{writable:!0,value:null}),A(this,Go,{writable:!0,value:new Map}),A(this,qo,{writable:!0,value:null}),A(this,Xo,{writable:!0,value:null}),this.renderingIntent=i,this.name=null,this.creator=null,null!==e){this.name=e.name,this.creator=e.creator,x(this,Xo,e.order);var n,a=C(e.groups);try{for(a.s();!(n=a.n()).done;){var r=n.value;_(this,Go).set(r.id,new Uo(i,r))}}catch(p){a.e(p)}finally{a.f()}if("OFF"===e.baseState){var s,o=C(_(this,Go).values());try{for(o.s();!(s=o.n()).done;){var l=s.value;l._setVisible(Oo,!1)}}catch(p){o.e(p)}finally{o.f()}}var h,u=C(e.on);try{for(u.s();!(h=u.n()).done;){var c=h.value;_(this,Go).get(c)._setVisible(Oo,!0)}}catch(p){u.e(p)}finally{u.f()}var d,v=C(e.off);try{for(v.s();!(d=v.n()).done;){var f=d.value;_(this,Go).get(f)._setVisible(Oo,!1)}}catch(p){v.e(p)}finally{v.f()}x(this,qo,this.getHash())}}return(0,Z.Z)(t,[{key:"isVisible",value:function(t){if(0===_(this,Go).size)return!0;if(!t)return It("Optional content group not defined."),!0;if("OCG"===t.type)return _(this,Go).has(t.id)?_(this,Go).get(t.id).visible:(Ft("Optional content group not found: ".concat(t.id)),!0);if("OCMD"===t.type){if(t.expression)return k(this,Ko,Qo).call(this,t.expression);if(!t.policy||"AnyOn"===t.policy){var e,i=C(t.ids);try{for(i.s();!(e=i.n()).done;){var n=e.value;if(!_(this,Go).has(n))return Ft("Optional content group not found: ".concat(n)),!0;if(_(this,Go).get(n).visible)return!0}}catch(v){i.e(v)}finally{i.f()}return!1}if("AllOn"===t.policy){var a,r=C(t.ids);try{for(r.s();!(a=r.n()).done;){var s=a.value;if(!_(this,Go).has(s))return Ft("Optional content group not found: ".concat(s)),!0;if(!_(this,Go).get(s).visible)return!1}}catch(v){r.e(v)}finally{r.f()}return!0}if("AnyOff"===t.policy){var o,l=C(t.ids);try{for(l.s();!(o=l.n()).done;){var h=o.value;if(!_(this,Go).has(h))return Ft("Optional content group not found: ".concat(h)),!0;if(!_(this,Go).get(h).visible)return!0}}catch(v){l.e(v)}finally{l.f()}return!1}if("AllOff"===t.policy){var u,c=C(t.ids);try{for(c.s();!(u=c.n()).done;){var d=u.value;if(!_(this,Go).has(d))return Ft("Optional content group not found: ".concat(d)),!0;if(_(this,Go).get(d).visible)return!1}}catch(v){c.e(v)}finally{c.f()}return!0}return Ft("Unknown optional content policy ".concat(t.policy,".")),!0}return Ft("Unknown group type ".concat(t.type,".")),!0}},{key:"setVisibility",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=_(this,Go).get(t);i?(i._setVisible(Oo,!!e,!0),x(this,Vo,null)):Ft("Optional content group not found: ".concat(t))}},{key:"setOCGState",value:function(t){var e,i,n=t.state,a=(t.preserveRB,C(n));try{for(a.s();!(i=a.n()).done;){var r=i.value;switch(r){case"ON":case"OFF":case"Toggle":e=r;continue}var s=_(this,Go).get(r);if(s)switch(e){case"ON":s._setVisible(Oo,!0);break;case"OFF":s._setVisible(Oo,!1);break;case"Toggle":s._setVisible(Oo,!s.visible)}}}catch(o){a.e(o)}finally{a.f()}x(this,Vo,null)}},{key:"hasInitialVisibility",get:function(){return null===_(this,qo)||this.getHash()===_(this,qo)}},{key:"getOrder",value:function(){return _(this,Go).size?_(this,Xo)?_(this,Xo).slice():(0,p.Z)(_(this,Go).keys()):null}},{key:"getGroups",value:function(){return _(this,Go).size>0?Qt(_(this,Go)):null}},{key:"getGroup",value:function(t){return _(this,Go).get(t)||null}},{key:"getHash",value:function(){if(null!==_(this,Vo))return _(this,Vo);var t,e=new cs,i=C(_(this,Go));try{for(i.s();!(t=i.n()).done;){var n=(0,M.Z)(t.value,2),a=n[0],r=n[1];e.update("".concat(a,":").concat(r.visible))}}catch(s){i.e(s)}finally{i.f()}return x(this,Vo,e.hexdigest())}}]),t}();function Qo(t){var e=t.length;if(e<2)return!0;for(var i=t[0],n=1;n<e;n++){var a=t[n],r=void 0;if(Array.isArray(a))r=k(this,Ko,Qo).call(this,a);else{if(!_(this,Go).has(a))return Ft("Optional content group not found: ".concat(a)),!0;r=_(this,Go).get(a).visible}switch(i){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return"And"===i}var Jo=function(){function t(e,i){var n=this,a=i.disableRange,r=void 0!==a&&a,s=i.disableStream,o=void 0!==s&&s;(0,T.Z)(this,t),Wt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');var l=e.length,h=e.initialData,u=e.progressiveDone,c=e.contentDispositionFilename;if(this._queuedChunks=[],this._progressiveDone=u,this._contentDispositionFilename=c,(null===h||void 0===h?void 0:h.length)>0){var d=h instanceof Uint8Array&&h.byteLength===h.buffer.byteLength?h.buffer:new Uint8Array(h).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!o,this._isRangeSupported=!r,this._contentLength=l,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((function(t,e){n._onReceiveData({begin:t,chunk:e})})),e.addProgressListener((function(t,e){n._onProgress({loaded:t,total:e})})),e.addProgressiveReadListener((function(t){n._onReceiveData({chunk:t})})),e.addProgressiveDoneListener((function(){n._onProgressiveDone()})),e.transportReady()}return(0,Z.Z)(t,[{key:"_onReceiveData",value:function(t){var e=t.begin,i=t.chunk,n=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;void 0===e?this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n):Wt(this._rangeReaders.some((function(t){return t._begin===e&&(t._enqueue(n),!0)})),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}},{key:"_progressiveDataLength",get:function(){var t,e;return null!==(t=null===(e=this._fullRequestReader)||void 0===e?void 0:e._loaded)&&void 0!==t?t:0}},{key:"_onProgress",value:function(t){var e,i,n,a;void 0===t.total?null===(e=this._rangeReaders[0])||void 0===e||null===(i=e.onProgress)||void 0===i||i.call(e,{loaded:t.loaded}):null===(n=this._fullRequestReader)||void 0===n||null===(a=n.onProgress)||void 0===a||a.call(n,{loaded:t.loaded,total:t.total})}},{key:"_onProgressiveDone",value:function(){var t;null===(t=this._fullRequestReader)||void 0===t||t.progressiveDone(),this._progressiveDone=!0}},{key:"_removeRangeReader",value:function(t){var e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}},{key:"getFullReader",value:function(){Wt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");var t=this._queuedChunks;return this._queuedChunks=null,new $o(this,t,this._progressiveDone,this._contentDispositionFilename)}},{key:"getRangeReader",value:function(t,e){if(e<=this._progressiveDataLength)return null;var i=new tl(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(i),i}},{key:"cancelAllRequests",value:function(t){var e;null===(e=this._fullRequestReader)||void 0===e||e.cancel(t);var i,n=C(this._rangeReaders.slice(0));try{for(n.s();!(i=n.n()).done;){i.value.cancel(t)}}catch(a){n.e(a)}finally{n.f()}this._pdfDataRangeTransport.abort()}}]),t}(),$o=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,T.Z)(this,t),this._stream=e,this._done=n||!1,this._filename=vi(a)?a:null,this._queuedChunks=i||[],this._loaded=0;var r,s=C(this._queuedChunks);try{for(s.s();!(r=s.n()).done;){var o=r.value;this._loaded+=o.byteLength}}catch(l){s.e(l)}finally{s.f()}this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}return(0,Z.Z)(t,[{key:"_enqueue",value:function(t){if(!this._done){if(this._requests.length>0)this._requests.shift().resolve({value:t,done:!1});else this._queuedChunks.push(t);this._loaded+=t.byteLength}}},{key:"headersReady",get:function(){return this._headersReady}},{key:"filename",get:function(){return this._filename}},{key:"isRangeSupported",get:function(){return this._stream._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._stream._isStreamingSupported}},{key:"contentLength",get:function(){return this._stream._contentLength}},{key:"read",value:function(){var t=(0,w.Z)(L.mark((function t(){var e,i;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this._queuedChunks.length>0)){t.next=3;break}return e=this._queuedChunks.shift(),t.abrupt("return",{value:e,done:!1});case 3:if(!this._done){t.next=5;break}return t.abrupt("return",{value:void 0,done:!0});case 5:return i=Promise.withResolvers(),this._requests.push(i),t.abrupt("return",i.promise);case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"cancel",value:function(t){this._done=!0;var e,i=C(this._requests);try{for(i.s();!(e=i.n()).done;){e.value.resolve({value:void 0,done:!0})}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0}},{key:"progressiveDone",value:function(){this._done||(this._done=!0)}}]),t}(),tl=function(){function t(e,i,n){(0,T.Z)(this,t),this._stream=e,this._begin=i,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}return(0,Z.Z)(t,[{key:"_enqueue",value:function(t){if(!this._done){if(0===this._requests.length)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});var e,i=C(this._requests);try{for(i.s();!(e=i.n()).done;){e.value.resolve({value:void 0,done:!0})}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}},{key:"isStreamingSupported",get:function(){return!1}},{key:"read",value:function(){var t=(0,w.Z)(L.mark((function t(){var e,i;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._queuedChunk){t.next=4;break}return e=this._queuedChunk,this._queuedChunk=null,t.abrupt("return",{value:e,done:!1});case 4:if(!this._done){t.next=6;break}return t.abrupt("return",{value:void 0,done:!0});case 6:return i=Promise.withResolvers(),this._requests.push(i),t.abrupt("return",i.promise);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"cancel",value:function(t){this._done=!0;var e,i=C(this._requests);try{for(i.s();!(e=i.n()).done;){e.value.resolve({value:void 0,done:!0})}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0,this._stream._removeRangeReader(this)}}]),t}();function el(t){var e=t.getResponseHeader,i=t.isHttp,n=t.rangeChunkSize,a=t.disableRange,r={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(e("Content-Length"),10);return Number.isInteger(s)?(r.suggestedLength=s,s<=2*n||a||!i||"bytes"!==e("Accept-Ranges")||"identity"!==(e("Content-Encoding")||"identity")||(r.allowRangeRequests=!0),r):r}function il(t){var e=t("Content-Disposition");if(e){var i=function(t){var e=!0,i=r("filename\\*","i").exec(t);if(i){var n=l(i=i[1]);return o(n=u(n=h(n=unescape(n))))}if(i=function(t){for(var e,i=[],n=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");null!==(e=n.exec(t));){var a=e,s=(0,M.Z)(a,4),o=s[1],u=s[2],c=s[3];if((o=parseInt(o,10))in i){if(0===o)break}else i[o]=[u,c]}for(var d=[],v=0;v<i.length&&v in i;++v){var f=(0,M.Z)(i[v],2),p=f[0],g=f[1];g=l(g),p&&(g=unescape(g),0===v&&(g=h(g))),d.push(g)}return d.join("")}(t))return o(u(i));if(i=r("filename","i").exec(t)){var a=l(i=i[1]);return o(a=u(a))}function r(t,e){return new RegExp("(?:^|;)\\s*"+t+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',e)}function s(t,i){if(t){if(!/^[\x00-\xFF]+$/.test(i))return i;try{var n=new TextDecoder(t,{fatal:!0}),a=Yt(i);i=n.decode(a),e=!1}catch(r){}}return i}function o(t){return e&&/[\x80-\xff]/.test(t)&&(t=s("utf-8",t),e&&(t=s("iso-8859-1",t))),t}function l(t){if(t.startsWith('"')){for(var e=t.slice(1).split('\\"'),i=0;i<e.length;++i){var n=e[i].indexOf('"');-1!==n&&(e[i]=e[i].slice(0,n),e.length=i+1),e[i]=e[i].replaceAll(/\\(.)/g,"$1")}t=e.join('"')}return t}function h(t){var e=t.indexOf("'");return-1===e?t:s(t.slice(0,e),t.slice(e+1).replace(/^[^']*'/,""))}function u(t){return!t.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(t)?t:t.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(t,e,i,n){if("q"===i||"Q"===i)return s(e,n=(n=n.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,(function(t,e){return String.fromCharCode(parseInt(e,16))})));try{n=atob(n)}catch(a){}return s(e,n)}))}return""}(e);if(i.includes("%"))try{i=decodeURIComponent(i)}catch(n){}if(vi(i))return i}return null}function nl(t,e){return 404===t||0===t&&e.startsWith("file:")?new Vt('Missing PDF "'+e+'".'):new Gt("Unexpected server response (".concat(t,') while retrieving PDF "').concat(e,'".'),t)}function al(t){return 200===t||206===t}function rl(t,e,i){return{method:"GET",headers:t,signal:i.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function sl(t){var e=new Headers;for(var i in t){var n=t[i];void 0!==n&&e.append(i,n)}return e}function ol(t){return t instanceof Uint8Array?t.buffer:t instanceof ArrayBuffer?t:(Ft("getArrayBuffer - unexpected data format: ".concat(t)),new Uint8Array(t).buffer)}var ll=function(){function t(e){(0,T.Z)(this,t),this.source=e,this.isHttp=/^https?:/i.test(e.url),this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}return(0,Z.Z)(t,[{key:"_progressiveDataLength",get:function(){var t,e;return null!==(t=null===(e=this._fullRequestReader)||void 0===e?void 0:e._loaded)&&void 0!==t?t:0}},{key:"getFullReader",value:function(){return Wt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new hl(this),this._fullRequestReader}},{key:"getRangeReader",value:function(t,e){if(e<=this._progressiveDataLength)return null;var i=new ul(this,t,e);return this._rangeRequestReaders.push(i),i}},{key:"cancelAllRequests",value:function(t){var e;null===(e=this._fullRequestReader)||void 0===e||e.cancel(t);var i,n=C(this._rangeRequestReaders.slice(0));try{for(n.s();!(i=n.n()).done;){i.value.cancel(t)}}catch(a){n.e(a)}finally{n.f()}}}]),t}(),hl=function(){function t(e){var i=this;(0,T.Z)(this,t),this._stream=e,this._reader=null,this._loaded=0,this._filename=null;var n=e.source;this._withCredentials=n.withCredentials||!1,this._contentLength=n.length,this._headersCapability=Promise.withResolvers(),this._disableRange=n.disableRange||!1,this._rangeChunkSize=n.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!n.disableStream,this._isRangeSupported=!n.disableRange,this._headers=sl(this._stream.httpHeaders);var a=n.url;fetch(a,rl(this._headers,this._withCredentials,this._abortController)).then((function(t){if(!al(t.status))throw nl(t.status,a);i._reader=t.body.getReader(),i._headersCapability.resolve();var e=function(e){return t.headers.get(e)},n=el({getResponseHeader:e,isHttp:i._stream.isHttp,rangeChunkSize:i._rangeChunkSize,disableRange:i._disableRange}),r=n.allowRangeRequests,s=n.suggestedLength;i._isRangeSupported=r,i._contentLength=s||i._contentLength,i._filename=il(e),!i._isStreamingSupported&&i._isRangeSupported&&i.cancel(new Xt("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}return(0,Z.Z)(t,[{key:"headersReady",get:function(){return this._headersCapability.promise}},{key:"filename",get:function(){return this._filename}},{key:"contentLength",get:function(){return this._contentLength}},{key:"isRangeSupported",get:function(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:function(){var t=(0,w.Z)(L.mark((function t(){var e,i,n,a;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._headersCapability.promise;case 2:return t.next=4,this._reader.read();case 4:if(i=t.sent,n=i.value,!(a=i.done)){t.next=9;break}return t.abrupt("return",{value:n,done:a});case 9:return this._loaded+=n.byteLength,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded,total:this._contentLength}),t.abrupt("return",{value:ol(n),done:!1});case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"cancel",value:function(t){var e;null===(e=this._reader)||void 0===e||e.cancel(t),this._abortController.abort()}}]),t}(),ul=function(){function t(e,i,n){var a=this;(0,T.Z)(this,t),this._stream=e,this._reader=null,this._loaded=0;var r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController,this._headers=sl(this._stream.httpHeaders),this._headers.append("Range","bytes=".concat(i,"-").concat(n-1));var s=r.url;fetch(s,rl(this._headers,this._withCredentials,this._abortController)).then((function(t){if(!al(t.status))throw nl(t.status,s);a._readCapability.resolve(),a._reader=t.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}return(0,Z.Z)(t,[{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:function(){var t=(0,w.Z)(L.mark((function t(){var e,i,n,a;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._readCapability.promise;case 2:return t.next=4,this._reader.read();case 4:if(i=t.sent,n=i.value,!(a=i.done)){t.next=9;break}return t.abrupt("return",{value:n,done:a});case 9:return this._loaded+=n.byteLength,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded}),t.abrupt("return",{value:ol(n),done:!1});case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"cancel",value:function(t){var e;null===(e=this._reader)||void 0===e||e.cancel(t),this._abortController.abort()}}]),t}();var cl=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,T.Z)(this,t),this.url=e,this.isHttp=/^https?:/i.test(e),this.httpHeaders=this.isHttp&&i.httpHeaders||Object.create(null),this.withCredentials=i.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}return(0,Z.Z)(t,[{key:"requestRange",value:function(t,e,i){var n={begin:t,end:e};for(var a in i)n[a]=i[a];return this.request(n)}},{key:"requestFull",value:function(t){return this.request(t)}},{key:"request",value:function(t){var e=new XMLHttpRequest,i=this.currXhrId++,n=this.pendingRequests[i]={xhr:e};for(var a in e.open("GET",this.url),e.withCredentials=this.withCredentials,this.httpHeaders){var r=this.httpHeaders[a];void 0!==r&&e.setRequestHeader(a,r)}return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range","bytes=".concat(t.begin,"-").concat(t.end-1)),n.expectedStatus=206):n.expectedStatus=200,e.responseType="arraybuffer",t.onError&&(e.onerror=function(i){t.onError(e.status)}),e.onreadystatechange=this.onStateChange.bind(this,i),e.onprogress=this.onProgress.bind(this,i),n.onHeadersReceived=t.onHeadersReceived,n.onDone=t.onDone,n.onError=t.onError,n.onProgress=t.onProgress,e.send(null),i}},{key:"onProgress",value:function(t,e){var i,n=this.pendingRequests[t];n&&(null===(i=n.onProgress)||void 0===i||i.call(n,e))}},{key:"onStateChange",value:function(t,e){var i=this.pendingRequests[t];if(i){var n=i.xhr;if(n.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),4===n.readyState&&t in this.pendingRequests)if(delete this.pendingRequests[t],0===n.status&&this.isHttp){var a;null===(a=i.onError)||void 0===a||a.call(i,n.status)}else{var r=n.status||200;if(200===r&&206===i.expectedStatus||r===i.expectedStatus){var s=function(t){var e=t.response;return"string"!==typeof e?e:Yt(e).buffer}(n);if(206===r){var o=n.getResponseHeader("Content-Range"),l=/bytes (\d+)-(\d+)\/(\d+)/.exec(o);i.onDone({begin:parseInt(l[1],10),chunk:s})}else if(s)i.onDone({begin:0,chunk:s});else{var h;null===(h=i.onError)||void 0===h||h.call(i,n.status)}}else{var u;null===(u=i.onError)||void 0===u||u.call(i,n.status)}}}}},{key:"getRequestXhr",value:function(t){return this.pendingRequests[t].xhr}},{key:"isPendingRequest",value:function(t){return t in this.pendingRequests}},{key:"abortRequest",value:function(t){var e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}]),t}(),dl=function(){function t(e){(0,T.Z)(this,t),this._source=e,this._manager=new cl(e.url,{httpHeaders:e.httpHeaders,withCredentials:e.withCredentials}),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}return(0,Z.Z)(t,[{key:"_onRangeRequestReaderClosed",value:function(t){var e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}},{key:"getFullReader",value:function(){return Wt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new vl(this._manager,this._source),this._fullRequestReader}},{key:"getRangeReader",value:function(t,e){var i=new fl(this._manager,t,e);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}},{key:"cancelAllRequests",value:function(t){var e;null===(e=this._fullRequestReader)||void 0===e||e.cancel(t);var i,n=C(this._rangeRequestReaders.slice(0));try{for(n.s();!(i=n.n()).done;){i.value.cancel(t)}}catch(a){n.e(a)}finally{n.f()}}}]),t}(),vl=function(){function t(e,i){(0,T.Z)(this,t),this._manager=e;var n={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=i.url,this._fullRequestId=e.requestFull(n),this._headersReceivedCapability=Promise.withResolvers(),this._disableRange=i.disableRange||!1,this._contentLength=i.length,this._rangeChunkSize=i.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}return(0,Z.Z)(t,[{key:"_onHeadersReceived",value:function(){var t=this._fullRequestId,e=this._manager.getRequestXhr(t),i=function(t){return e.getResponseHeader(t)},n=el({getResponseHeader:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange}),a=n.allowRangeRequests,r=n.suggestedLength;a&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=il(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersReceivedCapability.resolve()}},{key:"_onDone",value:function(t){t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk));if(this._done=!0,!(this._cachedChunks.length>0)){var e,i=C(this._requests);try{for(i.s();!(e=i.n()).done;){e.value.resolve({value:void 0,done:!0})}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0}}},{key:"_onError",value:function(t){this._storedError=nl(t,this._url),this._headersReceivedCapability.reject(this._storedError);var e,i=C(this._requests);try{for(i.s();!(e=i.n()).done;){e.value.reject(this._storedError)}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0,this._cachedChunks.length=0}},{key:"_onProgress",value:function(t){var e;null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}},{key:"filename",get:function(){return this._filename}},{key:"isRangeSupported",get:function(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"contentLength",get:function(){return this._contentLength}},{key:"headersReady",get:function(){return this._headersReceivedCapability.promise}},{key:"read",value:function(){var t=(0,w.Z)(L.mark((function t(){var e,i;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._storedError){t.next=2;break}throw this._storedError;case 2:if(!(this._cachedChunks.length>0)){t.next=5;break}return e=this._cachedChunks.shift(),t.abrupt("return",{value:e,done:!1});case 5:if(!this._done){t.next=7;break}return t.abrupt("return",{value:void 0,done:!0});case 7:return i=Promise.withResolvers(),this._requests.push(i),t.abrupt("return",i.promise);case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"cancel",value:function(t){this._done=!0,this._headersReceivedCapability.reject(t);var e,i=C(this._requests);try{for(i.s();!(e=i.n()).done;){e.value.resolve({value:void 0,done:!0})}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}]),t}(),fl=function(){function t(e,i,n){(0,T.Z)(this,t),this._manager=e;var a={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(i,n,a),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}return(0,Z.Z)(t,[{key:"_close",value:function(){var t;null===(t=this.onClosed)||void 0===t||t.call(this,this)}},{key:"_onDone",value:function(t){var e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e;this._done=!0;var i,n=C(this._requests);try{for(n.s();!(i=n.n()).done;){i.value.resolve({value:void 0,done:!0})}}catch(a){n.e(a)}finally{n.f()}this._requests.length=0,this._close()}},{key:"_onError",value:function(t){this._storedError=nl(t,this._url);var e,i=C(this._requests);try{for(i.s();!(e=i.n()).done;){e.value.reject(this._storedError)}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0,this._queuedChunk=null}},{key:"_onProgress",value:function(t){var e;this.isStreamingSupported||(null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:t.loaded}))}},{key:"isStreamingSupported",get:function(){return!1}},{key:"read",value:function(){var t=(0,w.Z)(L.mark((function t(){var e,i;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._storedError){t.next=2;break}throw this._storedError;case 2:if(null===this._queuedChunk){t.next=6;break}return e=this._queuedChunk,this._queuedChunk=null,t.abrupt("return",{value:e,done:!1});case 6:if(!this._done){t.next=8;break}return t.abrupt("return",{value:void 0,done:!0});case 8:return i=Promise.withResolvers(),this._requests.push(i),t.abrupt("return",i.promise);case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"cancel",value:function(t){this._done=!0;var e,i=C(this._requests);try{for(i.s();!(e=i.n()).done;){e.value.resolve({value:void 0,done:!0})}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}]),t}(),pl=/^file:\/\/\/[a-zA-Z]:\//;var gl=function(){function t(e){(0,T.Z)(this,t),this.source=e,this.url=function(t){var e=Es.get("url"),i=e.parse(t);return"file:"===i.protocol||i.host?i:/^[a-z]:[/\\]/i.test(t)?e.parse("file:///".concat(t)):(i.host||(i.protocol="file:"),i)}(e.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}return(0,Z.Z)(t,[{key:"_progressiveDataLength",get:function(){var t,e;return null!==(t=null===(e=this._fullRequestReader)||void 0===e?void 0:e._loaded)&&void 0!==t?t:0}},{key:"getFullReader",value:function(){return Wt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new Al(this):new bl(this),this._fullRequestReader}},{key:"getRangeReader",value:function(t,e){if(e<=this._progressiveDataLength)return null;var i=this.isFsUrl?new _l(this,t,e):new wl(this,t,e);return this._rangeRequestReaders.push(i),i}},{key:"cancelAllRequests",value:function(t){var e;null===(e=this._fullRequestReader)||void 0===e||e.cancel(t);var i,n=C(this._rangeRequestReaders.slice(0));try{for(n.s();!(i=n.n()).done;){i.value.cancel(t)}}catch(a){n.e(a)}finally{n.f()}}}]),t}(),ml=function(){function t(e){(0,T.Z)(this,t),this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;var i=e.source;this._contentLength=i.length,this._loaded=0,this._filename=null,this._disableRange=i.disableRange||!1,this._rangeChunkSize=i.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!i.disableStream,this._isRangeSupported=!i.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}return(0,Z.Z)(t,[{key:"headersReady",get:function(){return this._headersCapability.promise}},{key:"filename",get:function(){return this._filename}},{key:"contentLength",get:function(){return this._contentLength}},{key:"isRangeSupported",get:function(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:function(){var t=(0,w.Z)(L.mark((function t(){var e,i,n;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._readCapability.promise;case 2:if(!this._done){t.next=4;break}return t.abrupt("return",{value:void 0,done:!0});case 4:if(!this._storedError){t.next=6;break}throw this._storedError;case 6:if(null!==(i=this._readableStream.read())){t.next=10;break}return this._readCapability=Promise.withResolvers(),t.abrupt("return",this.read());case 10:return this._loaded+=i.length,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded,total:this._contentLength}),n=new Uint8Array(i).buffer,t.abrupt("return",{value:n,done:!1});case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"cancel",value:function(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}},{key:"_error",value:function(t){this._storedError=t,this._readCapability.resolve()}},{key:"_setReadableStream",value:function(t){var e=this;this._readableStream=t,t.on("readable",(function(){e._readCapability.resolve()})),t.on("end",(function(){t.destroy(),e._done=!0,e._readCapability.resolve()})),t.on("error",(function(t){e._error(t)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Xt("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}]),t}(),yl=function(){function t(e){(0,T.Z)(this,t),this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();var i=e.source;this._isStreamingSupported=!i.disableStream}return(0,Z.Z)(t,[{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:function(){var t=(0,w.Z)(L.mark((function t(){var e,i,n;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._readCapability.promise;case 2:if(!this._done){t.next=4;break}return t.abrupt("return",{value:void 0,done:!0});case 4:if(!this._storedError){t.next=6;break}throw this._storedError;case 6:if(null!==(i=this._readableStream.read())){t.next=10;break}return this._readCapability=Promise.withResolvers(),t.abrupt("return",this.read());case 10:return this._loaded+=i.length,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded}),n=new Uint8Array(i).buffer,t.abrupt("return",{value:n,done:!1});case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"cancel",value:function(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}},{key:"_error",value:function(t){this._storedError=t,this._readCapability.resolve()}},{key:"_setReadableStream",value:function(t){var e=this;this._readableStream=t,t.on("readable",(function(){e._readCapability.resolve()})),t.on("end",(function(){t.destroy(),e._done=!0,e._readCapability.resolve()})),t.on("error",(function(t){e._error(t)})),this._storedError&&this._readableStream.destroy(this._storedError)}}]),t}();function kl(t,e){return{protocol:t.protocol,auth:t.auth,host:t.hostname,port:t.port,path:t.path,method:"GET",headers:e}}var bl=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;(0,T.Z)(this,i);var a=function(e){if(404===e.statusCode){var i=new Vt('Missing PDF "'.concat(n._url,'".'));return n._storedError=i,void n._headersCapability.reject(i)}n._headersCapability.resolve(),n._setReadableStream(e);var a=function(t){return n._readableStream.headers[t.toLowerCase()]},r=el({getResponseHeader:a,isHttp:t.isHttp,rangeChunkSize:n._rangeChunkSize,disableRange:n._disableRange}),s=r.allowRangeRequests,o=r.suggestedLength;n._isRangeSupported=s,n._contentLength=o||n._contentLength,n._filename=il(a)};if((n=e.call(this,t))._request=null,"http:"===n._url.protocol){var r=Es.get("http");n._request=r.request(kl(n._url,t.httpHeaders),a)}else{var s=Es.get("https");n._request=s.request(kl(n._url,t.httpHeaders),a)}return n._request.on("error",(function(t){n._storedError=t,n._headersCapability.reject(t)})),n._request.end(),n}return(0,Z.Z)(i)}(ml),wl=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t,n,a){var r;for(var s in(0,T.Z)(this,i),(r=e.call(this,t))._httpHeaders={},t.httpHeaders){var o=t.httpHeaders[s];void 0!==o&&(r._httpHeaders[s]=o)}r._httpHeaders.Range="bytes=".concat(n,"-").concat(a-1);var l=function(t){if(404!==t.statusCode)r._setReadableStream(t);else{var e=new Vt('Missing PDF "'.concat(r._url,'".'));r._storedError=e}};if(r._request=null,"http:"===r._url.protocol){var h=Es.get("http");r._request=h.request(kl(r._url,r._httpHeaders),l)}else{var u=Es.get("https");r._request=u.request(kl(r._url,r._httpHeaders),l)}return r._request.on("error",(function(t){r._storedError=t})),r._request.end(),r}return(0,Z.Z)(i)}(yl),Al=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;(0,T.Z)(this,i),n=e.call(this,t);var a=decodeURIComponent(n._url.path);pl.test(n._url.href)&&(a=a.replace(/^\//,""));var r=Es.get("fs");return r.promises.lstat(a).then((function(t){n._contentLength=t.size,n._setReadableStream(r.createReadStream(a)),n._headersCapability.resolve()}),(function(t){"ENOENT"===t.code&&(t=new Vt('Missing PDF "'.concat(a,'".'))),n._storedError=t,n._headersCapability.reject(t)})),n}return(0,Z.Z)(i)}(ml),_l=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t,n,a){var r;(0,T.Z)(this,i),r=e.call(this,t);var s=decodeURIComponent(r._url.path);pl.test(r._url.href)&&(s=s.replace(/^\//,""));var o=Es.get("fs");return r._setReadableStream(o.createReadStream(s,{start:n,end:a-1})),r}return(0,Z.Z)(i)}(yl),xl=30,Sl=new WeakMap,Ml=new WeakMap,El=new WeakMap,Cl=new WeakMap,Zl=new WeakMap,Tl=new WeakMap,Rl=new WeakMap,Pl=new WeakMap,Ll=new WeakMap,Il=new WeakMap,Fl=new WeakMap,Dl=new WeakMap,Wl=new WeakMap,Nl=new WeakMap,Ol=new WeakMap,Bl=new WeakMap,Hl=new WeakMap,zl=new WeakMap,jl=new WeakSet,Ul=new WeakSet,Vl=new WeakSet,Gl=function(){function t(e){var i,n=this,a=e.textContentSource,r=e.container,s=e.viewport;if((0,T.Z)(this,t),y(this,Vl),y(this,Ul),y(this,jl),A(this,Sl,{writable:!0,value:Promise.withResolvers()}),A(this,Ml,{writable:!0,value:null}),A(this,El,{writable:!0,value:!1}),A(this,Cl,{writable:!0,value:!(null===(i=globalThis.FontInspector)||void 0===i||!i.enabled)}),A(this,Zl,{writable:!0,value:null}),A(this,Tl,{writable:!0,value:null}),A(this,Rl,{writable:!0,value:0}),A(this,Pl,{writable:!0,value:0}),A(this,Ll,{writable:!0,value:null}),A(this,Il,{writable:!0,value:null}),A(this,Fl,{writable:!0,value:0}),A(this,Dl,{writable:!0,value:0}),A(this,Wl,{writable:!0,value:Object.create(null)}),A(this,Nl,{writable:!0,value:[]}),A(this,Ol,{writable:!0,value:null}),A(this,Bl,{writable:!0,value:[]}),A(this,Hl,{writable:!0,value:new WeakMap}),A(this,zl,{writable:!0,value:null}),a instanceof ReadableStream)x(this,Ol,a);else{if("object"!==typeof a)throw new Error('No "textContentSource" parameter specified.');x(this,Ol,new ReadableStream({start:function(t){t.enqueue(a),t.close()}}))}x(this,Ml,x(this,Il,r)),x(this,Dl,s.scale*(globalThis.devicePixelRatio||1)),x(this,Fl,s.rotation),x(this,Tl,{prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:null});var o=s.rawDims,l=o.pageWidth,h=o.pageHeight,u=o.pageX,c=o.pageY;x(this,zl,[1,0,0,-1,-u,c+h]),x(this,Pl,l),x(this,Rl,h),S(t,t,Ql).call(t),Si(r,s),_(this,Sl).promise.catch((function(){})).then((function(){f(t,t,ih).delete(n),x(n,Tl,null),x(n,Wl,null)}))}return(0,Z.Z)(t,[{key:"render",value:function(){var e=this;return x(this,Ll,_(this,Ol).getReader()),f(t,t,ih).add(this),function t(){_(e,Ll).read().then((function(i){var n,a=i.value;i.done?_(e,Sl).resolve():(null!==(n=_(e,Zl))&&void 0!==n||x(e,Zl,a.lang),Object.assign(_(e,Wl),a.styles),k(e,jl,ql).call(e,a.items),t())}),_(e,Sl).reject)}(),_(this,Sl).promise}},{key:"update",value:function(e){var i=e.viewport,n=e.onBefore,a=void 0===n?null:n,r=i.scale*(globalThis.devicePixelRatio||1),s=i.rotation;if(s!==_(this,Fl)&&(null===a||void 0===a||a(),x(this,Fl,s),Si(_(this,Il),{rotation:s})),r!==_(this,Dl)){null===a||void 0===a||a(),x(this,Dl,r);var o,l={prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:S(t,t,Yl).call(t,_(this,Zl))},h=C(_(this,Bl));try{for(h.s();!(o=h.n()).done;){var u=o.value;l.properties=_(this,Hl).get(u),l.div=u,k(this,Vl,Kl).call(this,l)}}catch(c){h.e(c)}finally{h.f()}}}},{key:"cancel",value:function(){var t,e=new Xt("TextLayer task cancelled.");null===(t=_(this,Ll))||void 0===t||t.cancel(e).catch((function(){})),x(this,Ll,null),_(this,Sl).reject(e)}},{key:"textDivs",get:function(){return _(this,Bl)}},{key:"textContentItemsStr",get:function(){return _(this,Nl)}}],[{key:"cleanup",value:function(){if(!(f(this,t,ih).size>0)){f(this,t,$l).clear();var e,i=C(f(this,t,th).values());try{for(i.s();!(e=i.n()).done;){e.value.canvas.remove()}}catch(n){i.e(n)}finally{i.f()}f(this,t,th).clear()}}}]),t}();function ql(t){var e,i;if(!_(this,El)){null!==(i=(e=_(this,Tl)).ctx)&&void 0!==i||(e.ctx=S(Gl,Gl,Yl).call(Gl,_(this,Zl)));var n,a=_(this,Bl),r=_(this,Nl),s=C(t);try{for(s.s();!(n=s.n()).done;){var o=n.value;if(a.length>1e5)return Ft("Ignoring additional textDivs for performance reasons."),void x(this,El,!0);if(void 0!==o.str)r.push(o.str),k(this,Ul,Xl).call(this,o);else if("beginMarkedContentProps"===o.type||"beginMarkedContent"===o.type){var l=_(this,Ml);x(this,Ml,document.createElement("span")),_(this,Ml).classList.add("markedContent"),null!==o.id&&_(this,Ml).setAttribute("id","".concat(o.id)),l.append(_(this,Ml))}else"endMarkedContent"===o.type&&x(this,Ml,_(this,Ml).parentNode)}}catch(h){s.e(h)}finally{s.f()}}}function Xl(t){var e=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,fontSize:0};_(this,Bl).push(e);var n=te.transform(_(this,zl),t.transform),a=Math.atan2(n[1],n[0]),r=_(this,Wl)[t.fontName];r.vertical&&(a+=Math.PI/2);var s,o,l=_(this,Cl)&&r.fontSubstitution||r.fontFamily,h=Math.hypot(n[2],n[3]),u=h*S(Gl,Gl,Jl).call(Gl,l,_(this,Zl));0===a?(s=n[4],o=n[5]-u):(s=n[4]+u*Math.sin(a),o=n[5]-u*Math.cos(a));var c="calc(var(--scale-factor)*",d=e.style;_(this,Ml)===_(this,Il)?(d.left="".concat((100*s/_(this,Pl)).toFixed(2),"%"),d.top="".concat((100*o/_(this,Rl)).toFixed(2),"%")):(d.left="".concat(c).concat(s.toFixed(2),"px)"),d.top="".concat(c).concat(o.toFixed(2),"px)")),d.fontSize="".concat(c).concat((f(Gl,Gl,eh)*h).toFixed(2),"px)"),d.fontFamily=l,i.fontSize=h,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,_(this,Cl)&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),0!==a&&(i.angle=a*(180/Math.PI));var v=!1;if(t.str.length>1)v=!0;else if(" "!==t.str&&t.transform[0]!==t.transform[3]){var p=Math.abs(t.transform[0]),g=Math.abs(t.transform[3]);p!==g&&Math.max(p,g)/Math.min(p,g)>1.5&&(v=!0)}if(v&&(i.canvasWidth=r.vertical?t.height:t.width),_(this,Hl).set(e,i),_(this,Tl).div=e,_(this,Tl).properties=i,k(this,Vl,Kl).call(this,_(this,Tl)),i.hasText&&_(this,Ml).append(e),i.hasEOL){var m=document.createElement("br");m.setAttribute("role","presentation"),_(this,Ml).append(m)}}function Kl(t){var e=t.div,i=t.properties,n=t.ctx,a=t.prevFontSize,r=t.prevFontFamily,s=e.style,o="";if(f(Gl,Gl,eh)>1&&(o="scale(".concat(1/f(Gl,Gl,eh),")")),0!==i.canvasWidth&&i.hasText){var l=s.fontFamily,h=i.canvasWidth,u=i.fontSize;a===u&&r===l||(n.font="".concat(u*_(this,Dl),"px ").concat(l),t.prevFontSize=u,t.prevFontFamily=l);var c=n.measureText(e.textContent).width;c>0&&(o="scaleX(".concat(h*_(this,Dl)/c,") ").concat(o))}0!==i.angle&&(o="rotate(".concat(i.angle,"deg) ").concat(o)),o.length>0&&(s.transform=o)}function Yl(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=f(this,Gl,th).get(t||(t=""));if(!e){var i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=t,document.body.append(i),e=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),f(this,Gl,th).set(t,e)}return e}function Ql(){if(null===f(this,Gl,eh)){var t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),d(this,Gl,eh,t.getBoundingClientRect().height),t.remove()}}function Jl(t,e){var i=f(this,Gl,$l).get(t);if(i)return i;var n=S(this,Gl,Yl).call(this,e),a=n.font;n.canvas.width=n.canvas.height=xl,n.font="".concat(xl,"px ").concat(t);var r=n.measureText(""),s=r.fontBoundingBoxAscent,o=Math.abs(r.fontBoundingBoxDescent);if(s){var l=s/(s+o);return f(this,Gl,$l).set(t,l),n.canvas.width=n.canvas.height=0,n.font=a,l}n.strokeStyle="red",n.clearRect(0,0,xl,xl),n.strokeText("g",0,0);var h=n.getImageData(0,0,xl,xl).data;o=0;for(var u=h.length-1-3;u>=0;u-=4)if(h[u]>0){o=Math.ceil(u/4/xl);break}n.clearRect(0,0,xl,xl),n.strokeText("A",0,xl),s=0;for(var c=0,d=(h=n.getImageData(0,0,xl,xl).data).length;c<d;c+=4)if(h[c]>0){s=xl-Math.floor(c/4/xl);break}n.canvas.width=n.canvas.height=0,n.font=a;var v=s?s/(s+o):.8;return f(this,Gl,$l).set(t,v),v}var $l={writable:!0,value:new Map},th={writable:!0,value:new Map},eh={writable:!0,value:null},ih={writable:!0,value:new Set},nh=function(){function t(){(0,T.Z)(this,t)}return(0,Z.Z)(t,null,[{key:"textContent",value:function(e){var i=[],n={items:i,styles:Object.create(null)};return function e(n){var a;if(n){var r=null,s=n.name;if("#text"===s)r=n.value;else{if(!t.shouldBuildText(s))return;null!==n&&void 0!==n&&null!==(a=n.attributes)&&void 0!==a&&a.textContent?r=n.attributes.textContent:n.value&&(r=n.value)}if(null!==r&&i.push({str:r}),n.children){var o,l=C(n.children);try{for(l.s();!(o=l.n()).done;){e(o.value)}}catch(h){l.e(h)}finally{l.f()}}}}(e),n}},{key:"shouldBuildText",value:function(t){return!("textarea"===t||"input"===t||"option"===t||"select"===t)}}]),t}(),ah=F?Ts:ai,rh=F?Rs:oi,sh=F?Zs:Ve,oh=F?Ps:li;function lh(){var t,e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"string"===typeof i||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});var n=new dh,a=n.docId,r=i.url?hh(i.url):null,s=i.data?uh(i.data):null,o=i.httpHeaders||null,l=!0===i.withCredentials,h=null!==(t=i.password)&&void 0!==t?t:null,u=i.range instanceof fh?i.range:null,c=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:65536,d=i.worker instanceof Ch?i.worker:null,v=i.verbosity,f="string"!==typeof i.docBaseUrl||di(i.docBaseUrl)?null:i.docBaseUrl,p="string"===typeof i.cMapUrl?i.cMapUrl:null,g=!1!==i.cMapPacked,m=i.CMapReaderFactory||rh,y="string"===typeof i.standardFontDataUrl?i.standardFontDataUrl:null,k=i.StandardFontDataFactory||oh,b=!0!==i.stopAtErrors,w=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,A=!1!==i.isEvalSupported,_="boolean"===typeof i.isOffscreenCanvasSupported?i.isOffscreenCanvasSupported:!F,x=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,S="boolean"===typeof i.disableFontFace?i.disableFontFace:F,M=!0===i.fontExtraProperties,E=!0===i.enableXfa,C=i.ownerDocument||globalThis.document,Z=!0===i.disableRange,T=!0===i.disableStream,R=!0===i.disableAutoFetch,P=!0===i.pdfBug,L=!0===i.enableHWA,I=u?u.length:null!==(e=i.length)&&void 0!==e?e:NaN,D="boolean"===typeof i.useSystemFonts?i.useSystemFonts:!F&&!S,W="boolean"===typeof i.useWorkerFetch?i.useWorkerFetch:m===oi&&k===li&&p&&y&&yi(p,document.baseURI)&&yi(y,document.baseURI),N=i.canvasFactory||new ah({ownerDocument:C,enableHWA:L}),O=i.filterFactory||new sh({docId:a,ownerDocument:C}),B=null;Pt(v);var H={canvasFactory:N,filterFactory:O};if(W||(H.cMapReaderFactory=new m({baseUrl:p,isCompressed:g}),H.standardFontDataFactory=new k({baseUrl:y})),!d){var z={verbosity:v,port:fo.workerPort};d=z.port?Ch.fromPort(z):new Ch(z),n._worker=d}var j={docId:a,apiVersion:"4.5.136",data:s,password:h,disableAutoFetch:R,rangeChunkSize:c,length:I,docBaseUrl:f,enableXfa:E,evaluatorOptions:{maxImageSize:w,disableFontFace:S,ignoreErrors:b,isEvalSupported:A,isOffscreenCanvasSupported:_,canvasMaxAreaInBytes:x,fontExtraProperties:M,useSystemFonts:D,cMapUrl:W?p:null,standardFontDataUrl:W?y:null}},U={disableFontFace:S,fontExtraProperties:M,ownerDocument:C,pdfBug:P,styleElement:B,loadingParams:{disableAutoFetch:R,enableXfa:E}};return d.promise.then((function(){if(n.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");var t,e=d.messageHandler.sendWithPromise("GetDocRequest",j,s?[s.buffer]:null);if(u)t=new Jo(u,{disableRange:Z,disableStream:T});else if(!s){if(!r)throw new Error("getDocument - no `url` parameter provided.");t=function(t){if(F){return"undefined"!==typeof fetch&&"undefined"!==typeof Response&&"body"in Response.prototype&&yi(t.url)?new ll(t):new gl(t)}return yi(t.url)?new ll(t):new dl(t)}({url:r,length:I,httpHeaders:o,withCredentials:l,rangeChunkSize:c,disableRange:Z,disableStream:T})}return e.then((function(e){if(n.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");var i=new Ro(a,e,d.port),r=new Nh(i,n,t,U,H);n._transport=r,i.send("Ready",null)}))})).catch(n._capability.reject),n}function hh(t){if(t instanceof URL)return t.href;try{return new URL(t,window.location).href}catch(e){if(F&&"string"===typeof t)return t}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function uh(t){if(F&&"undefined"!==typeof Buffer&&t instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength)return t;if("string"===typeof t)return Yt(t);if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)||"object"===typeof t&&!isNaN(null===t||void 0===t?void 0:t.length))return new Uint8Array(t);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function ch(t){return"object"===typeof t&&Number.isInteger(null===t||void 0===t?void 0:t.num)&&t.num>=0&&Number.isInteger(null===t||void 0===t?void 0:t.gen)&&t.gen>=0}var dh=function(){function t(){var e;(0,T.Z)(this,t),this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId="d".concat((d(t,t,vh,1+(e=+f(t,t,vh))),e)),this.destroyed=!1,this.onPassword=null,this.onProgress=null}return(0,Z.Z)(t,[{key:"promise",get:function(){return this._capability.promise}},{key:"destroy",value:function(){var t=(0,w.Z)(L.mark((function t(){var e,i,n;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.destroyed=!0,t.prev=1,null!==(e=this._worker)&&void 0!==e&&e.port&&(this._worker._pendingDestroy=!0),t.next=5,null===(i=this._transport)||void 0===i?void 0:i.destroy();case 5:t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(1),null!==(n=this._worker)&&void 0!==n&&n.port&&delete this._worker._pendingDestroy,t.t0;case 11:this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null);case 13:case"end":return t.stop()}}),t,this,[[1,7]])})));return function(){return t.apply(this,arguments)}}()}]),t}(),vh={writable:!0,value:0},fh=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,T.Z)(this,t),this.length=e,this.initialData=i,this.progressiveDone=n,this.contentDispositionFilename=a,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}return(0,Z.Z)(t,[{key:"addRangeListener",value:function(t){this._rangeListeners.push(t)}},{key:"addProgressListener",value:function(t){this._progressListeners.push(t)}},{key:"addProgressiveReadListener",value:function(t){this._progressiveReadListeners.push(t)}},{key:"addProgressiveDoneListener",value:function(t){this._progressiveDoneListeners.push(t)}},{key:"onDataRange",value:function(t,e){var i,n=C(this._rangeListeners);try{for(n.s();!(i=n.n()).done;){(0,i.value)(t,e)}}catch(a){n.e(a)}finally{n.f()}}},{key:"onDataProgress",value:function(t,e){var i=this;this._readyCapability.promise.then((function(){var n,a=C(i._progressListeners);try{for(a.s();!(n=a.n()).done;){(0,n.value)(t,e)}}catch(r){a.e(r)}finally{a.f()}}))}},{key:"onDataProgressiveRead",value:function(t){var e=this;this._readyCapability.promise.then((function(){var i,n=C(e._progressiveReadListeners);try{for(n.s();!(i=n.n()).done;){(0,i.value)(t)}}catch(a){n.e(a)}finally{n.f()}}))}},{key:"onDataProgressiveDone",value:function(){var t=this;this._readyCapability.promise.then((function(){var e,i=C(t._progressiveDoneListeners);try{for(i.s();!(e=i.n()).done;){(0,e.value)()}}catch(n){i.e(n)}finally{i.f()}}))}},{key:"transportReady",value:function(){this._readyCapability.resolve()}},{key:"requestDataRange",value:function(t,e){Dt("Abstract method PDFDataRangeTransport.requestDataRange")}},{key:"abort",value:function(){}}]),t}(),ph=function(){function t(e,i){(0,T.Z)(this,t),this._pdfInfo=e,this._transport=i}return(0,Z.Z)(t,[{key:"annotationStorage",get:function(){return this._transport.annotationStorage}},{key:"filterFactory",get:function(){return this._transport.filterFactory}},{key:"numPages",get:function(){return this._pdfInfo.numPages}},{key:"fingerprints",get:function(){return this._pdfInfo.fingerprints}},{key:"isPureXfa",get:function(){return Bt(this,"isPureXfa",!!this._transport._htmlForXfa)}},{key:"allXfaHtml",get:function(){return this._transport._htmlForXfa}},{key:"getPage",value:function(t){return this._transport.getPage(t)}},{key:"getPageIndex",value:function(t){return this._transport.getPageIndex(t)}},{key:"getDestinations",value:function(){return this._transport.getDestinations()}},{key:"getDestination",value:function(t){return this._transport.getDestination(t)}},{key:"getPageLabels",value:function(){return this._transport.getPageLabels()}},{key:"getPageLayout",value:function(){return this._transport.getPageLayout()}},{key:"getPageMode",value:function(){return this._transport.getPageMode()}},{key:"getViewerPreferences",value:function(){return this._transport.getViewerPreferences()}},{key:"getOpenAction",value:function(){return this._transport.getOpenAction()}},{key:"getAttachments",value:function(){return this._transport.getAttachments()}},{key:"getJSActions",value:function(){return this._transport.getDocJSActions()}},{key:"getOutline",value:function(){return this._transport.getOutline()}},{key:"getOptionalContentConfig",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.intent,i=void 0===e?"display":e,n=this._transport.getRenderingIntent(i),a=n.renderingIntent;return this._transport.getOptionalContentConfig(a)}},{key:"getPermissions",value:function(){return this._transport.getPermissions()}},{key:"getMetadata",value:function(){return this._transport.getMetadata()}},{key:"getMarkInfo",value:function(){return this._transport.getMarkInfo()}},{key:"getData",value:function(){return this._transport.getData()}},{key:"saveDocument",value:function(){return this._transport.saveDocument()}},{key:"getDownloadInfo",value:function(){return this._transport.downloadInfoCapability.promise}},{key:"cleanup",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._transport.startCleanup(t||this.isPureXfa)}},{key:"destroy",value:function(){return this.loadingTask.destroy()}},{key:"cachedPageNumber",value:function(t){return this._transport.cachedPageNumber(t)}},{key:"loadingParams",get:function(){return this._transport.loadingParams}},{key:"loadingTask",get:function(){return this._transport.loadingTask}},{key:"getFieldObjects",value:function(){return this._transport.getFieldObjects()}},{key:"hasJSActions",value:function(){return this._transport.hasJSActions()}},{key:"getCalculationOrderIds",value:function(){return this._transport.getCalculationOrderIds()}}]),t}(),gh=new WeakMap,mh=new WeakMap,yh=new WeakSet,kh=new WeakSet,bh=function(){function t(e,i,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,T.Z)(this,t),y(this,kh),y(this,yh),A(this,gh,{writable:!0,value:null}),A(this,mh,{writable:!0,value:!1}),this._pageIndex=e,this._pageInfo=i,this._transport=n,this._stats=a?new mi:null,this._pdfBug=a,this.commonObjs=n.commonObjs,this.objs=new jh,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}return(0,Z.Z)(t,[{key:"pageNumber",get:function(){return this._pageIndex+1}},{key:"rotate",get:function(){return this._pageInfo.rotate}},{key:"ref",get:function(){return this._pageInfo.ref}},{key:"userUnit",get:function(){return this._pageInfo.userUnit}},{key:"view",get:function(){return this._pageInfo.view}},{key:"getViewport",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.scale,i=t.rotation,n=void 0===i?this.rotate:i,a=t.offsetX,r=void 0===a?0:a,s=t.offsetY,o=void 0===s?0:s,l=t.dontFlip,h=void 0!==l&&l;return new ui({viewBox:this.view,scale:e,rotation:n,offsetX:r,offsetY:o,dontFlip:h})}},{key:"getAnnotations",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.intent,i=void 0===e?"display":e,n=this._transport.getRenderingIntent(i),a=n.renderingIntent;return this._transport.getAnnotations(this._pageIndex,a)}},{key:"getJSActions",value:function(){return this._transport.getPageJSActions(this._pageIndex)}},{key:"filterFactory",get:function(){return this._transport.filterFactory}},{key:"isPureXfa",get:function(){return Bt(this,"isPureXfa",!!this._transport._htmlForXfa)}},{key:"getXfa",value:function(){var t=(0,w.Z)(L.mark((function t(){var e;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(null===(e=this._transport._htmlForXfa)||void 0===e?void 0:e.children[this._pageIndex])||null);case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(t){var e,i,n=this,a=t.canvasContext,r=t.viewport,s=t.intent,o=void 0===s?"display":s,l=t.annotationMode,h=void 0===l?q.ENABLE:l,u=t.transform,c=void 0===u?null:u,d=t.background,v=void 0===d?null:d,f=t.optionalContentConfigPromise,p=void 0===f?null:f,g=t.annotationCanvasMap,m=void 0===g?null:g,y=t.pageColors,b=void 0===y?null:y,w=t.printAnnotationStorage,A=void 0===w?null:w,_=t.isEditing,S=void 0!==_&&_;null===(e=this._stats)||void 0===e||e.time("Overall");var E=this._transport.getRenderingIntent(o,h,A,S),C=E.renderingIntent,Z=E.cacheKey;x(this,mh,!1),k(this,kh,Ah).call(this),p||(p=this._transport.getOptionalContentConfig(C));var T=this._intentStates.get(Z);T||(T=Object.create(null),this._intentStates.set(Z,T)),T.streamReaderCancelTimeout&&(clearTimeout(T.streamReaderCancelTimeout),T.streamReaderCancelTimeout=null);var R,P=!!(C&H);T.displayReadyCapability||(T.displayReadyCapability=Promise.withResolvers(),T.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null===(R=this._stats)||void 0===R||R.time("Page Request"),this._pumpOperatorList(E));var L=function(t){var e;(T.renderTasks.delete(I),(n._maybeCleanupAfterRender||P)&&x(n,mh,!0),k(n,yh,wh).call(n,!P),t?(I.capability.reject(t),n._abortOperatorList({intentState:T,reason:t instanceof Error?t:new Error(t)})):I.capability.resolve(),n._stats)&&(n._stats.timeEnd("Rendering"),n._stats.timeEnd("Overall"),null!==(e=globalThis.Stats)&&void 0!==e&&e.enabled&&globalThis.Stats.add(n.pageNumber,n._stats))},I=new Xh({callback:L,params:{canvasContext:a,viewport:r,transform:c,background:v},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:m,operatorList:T.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!P,pdfBug:this._pdfBug,pageColors:b});((i=T).renderTasks||(i.renderTasks=new Set)).add(I);var F=I.task;return Promise.all([T.displayReadyCapability.promise,p]).then((function(t){var e,i=(0,M.Z)(t,2),a=i[0],r=i[1];if(n.destroyed)L();else{if(null===(e=n._stats)||void 0===e||e.time("Rendering"),!(r.renderingIntent&C))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");I.initializeGraphics({transparency:a,optionalContentConfig:r}),I.operatorListChanged()}})).catch(L),F}},{key:"getOperatorList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.intent,i=void 0===e?"display":e,n=t.annotationMode,a=void 0===n?q.ENABLE:n,r=t.printAnnotationStorage,s=void 0===r?null:r,o=t.isEditing,l=void 0!==o&&o;function h(){f.operatorList.lastChunk&&(f.opListReadCapability.resolve(f.operatorList),f.renderTasks.delete(u))}var u,c,d,v=this._transport.getRenderingIntent(i,a,s,l,!0),f=this._intentStates.get(v.cacheKey);(f||(f=Object.create(null),this._intentStates.set(v.cacheKey,f)),f.opListReadCapability)||((u=Object.create(null)).operatorListChanged=h,f.opListReadCapability=Promise.withResolvers(),((c=f).renderTasks||(c.renderTasks=new Set)).add(u),f.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null===(d=this._stats)||void 0===d||d.time("Page Request"),this._pumpOperatorList(v));return f.opListReadCapability.promise}},{key:"streamTextContent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.includeMarkedContent,i=void 0!==e&&e,n=t.disableNormalization,a=void 0!==n&&n,r=100;return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===i,disableNormalization:!0===a},{highWaterMark:r,size:function(t){return t.items.length}})}},{key:"getTextContent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then((function(t){return nh.textContent(t)}));var e=this.streamTextContent(t);return new Promise((function(t,i){var n=e.getReader(),a={items:[],styles:Object.create(null),lang:null};!function e(){n.read().then((function(i){var n,r,s=i.value;i.done?t(a):(null!==(n=a.lang)&&void 0!==n||(a.lang=s.lang),Object.assign(a.styles,s.styles),(r=a.items).push.apply(r,(0,p.Z)(s.items)),e())}),i)}()}))}},{key:"getStructTree",value:function(){return this._transport.getStructTree(this._pageIndex)}},{key:"_destroy",value:function(){this.destroyed=!0;var t,e=[],i=C(this._intentStates.values());try{for(i.s();!(t=i.n()).done;){var n=t.value;if(this._abortOperatorList({intentState:n,reason:new Error("Page was destroyed."),force:!0}),!n.opListReadCapability){var a,r=C(n.renderTasks);try{for(r.s();!(a=r.n()).done;){var s=a.value;e.push(s.completed),s.cancel()}}catch(o){r.e(o)}finally{r.f()}}}}catch(o){i.e(o)}finally{i.f()}return this.objs.clear(),x(this,mh,!1),k(this,kh,Ah).call(this),Promise.all(e)}},{key:"cleanup",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];x(this,mh,!0);var e=k(this,yh,wh).call(this,!1);return t&&e&&this._stats&&(this._stats=new mi),e}},{key:"_startRenderPage",value:function(t,e){var i,n,a=this._intentStates.get(e);a&&(null===(i=this._stats)||void 0===i||i.timeEnd("Page Request"),null===(n=a.displayReadyCapability)||void 0===n||n.resolve(t))}},{key:"_renderPageChunk",value:function(t,e){for(var i=0,n=t.length;i<n;i++)e.operatorList.fnArray.push(t.fnArray[i]),e.operatorList.argsArray.push(t.argsArray[i]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;var a,r=C(e.renderTasks);try{for(r.s();!(a=r.n()).done;){a.value.operatorListChanged()}}catch(s){r.e(s)}finally{r.f()}t.lastChunk&&k(this,yh,wh).call(this,!0)}},{key:"_pumpOperatorList",value:function(t){var e=this,i=t.renderingIntent,n=t.cacheKey,a=t.annotationStorageSerializable,r=t.modifiedIds,s=a.map,o=a.transfer,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:i,cacheKey:n,annotationStorage:s,modifiedIds:r},o).getReader(),h=this._intentStates.get(n);h.streamReader=l;!function t(){l.read().then((function(i){var n=i.value;i.done?h.streamReader=null:e._transport.destroyed||(e._renderPageChunk(n,h),t())}),(function(t){if(h.streamReader=null,!e._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;var i,n=C(h.renderTasks);try{for(n.s();!(i=n.n()).done;){i.value.operatorListChanged()}}catch(a){n.e(a)}finally{n.f()}k(e,yh,wh).call(e,!0)}if(h.displayReadyCapability)h.displayReadyCapability.reject(t);else{if(!h.opListReadCapability)throw t;h.opListReadCapability.reject(t)}}}))}()}},{key:"_abortOperatorList",value:function(t){var e=this,i=t.intentState,n=t.reason,a=t.force,r=void 0!==a&&a;if(i.streamReader){if(i.streamReaderCancelTimeout&&(clearTimeout(i.streamReaderCancelTimeout),i.streamReaderCancelTimeout=null),!r){if(i.renderTasks.size>0)return;if(n instanceof ci){var s=100;return n.extraDelay>0&&n.extraDelay<1e3&&(s+=n.extraDelay),void(i.streamReaderCancelTimeout=setTimeout((function(){i.streamReaderCancelTimeout=null,e._abortOperatorList({intentState:i,reason:n,force:!0})}),s))}}if(i.streamReader.cancel(new Xt(n.message)).catch((function(){})),i.streamReader=null,!this._transport.destroyed){var o,l=C(this._intentStates);try{for(l.s();!(o=l.n()).done;){var h=(0,M.Z)(o.value,2),u=h[0];if(h[1]===i){this._intentStates.delete(u);break}}}catch(c){l.e(c)}finally{l.f()}this.cleanup()}}}},{key:"stats",get:function(){return this._stats}}]),t}();function wh(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(k(this,kh,Ah).call(this),!_(this,mh)||this.destroyed)return!1;if(e)return x(this,gh,setTimeout((function(){x(t,gh,null),k(t,yh,wh).call(t,!1)}),5e3)),!1;var i,n=C(this._intentStates.values());try{for(n.s();!(i=n.n()).done;){var a=i.value,r=a.renderTasks,s=a.operatorList;if(r.size>0||!s.lastChunk)return!1}}catch(o){n.e(o)}finally{n.f()}return this._intentStates.clear(),this.objs.clear(),x(this,mh,!1),!0}function Ah(){_(this,gh)&&(clearTimeout(_(this,gh)),x(this,gh,null))}var _h=new WeakMap,xh=new WeakMap,Sh=function(){function t(){(0,T.Z)(this,t),A(this,_h,{writable:!0,value:new Set}),A(this,xh,{writable:!0,value:Promise.resolve()})}return(0,Z.Z)(t,[{key:"postMessage",value:function(t,e){var i=this,n={data:structuredClone(t,e?{transfer:e}:null)};_(this,xh).then((function(){var t,e=C(_(i,_h));try{for(e.s();!(t=e.n()).done;){t.value.call(i,n)}}catch(a){e.e(a)}finally{e.f()}}))}},{key:"addEventListener",value:function(t,e){_(this,_h).add(e)}},{key:"removeEventListener",value:function(t,e){_(this,_h).delete(e)}},{key:"terminate",value:function(){_(this,_h).clear()}}]),t}(),Mh={isWorkerDisabled:!1,fakeWorkerId:0};F&&(Mh.isWorkerDisabled=!0,fo.workerSrc||(fo.workerSrc="./pdf.worker.mjs")),Mh.isSameOrigin=function(t,e){var i;try{if(!(i=new URL(t)).origin||"null"===i.origin)return!1}catch(a){return!1}var n=new URL(e,i);return i.origin===n.origin},Mh.createCDNWrapper=function(t){var e='await import("'.concat(t,'");');return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};var Eh=new WeakSet,Ch=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.name,n=void 0===i?null:i,a=e.port,r=void 0===a?null:a,s=e.verbosity,o=void 0===s?Lt():s;if((0,T.Z)(this,t),y(this,Eh),this.name=n,this.destroyed=!1,this.verbosity=o,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,r){var l;if(null!==(l=f(t,t,Rh))&&void 0!==l&&l.has(r))throw new Error("Cannot use more than one PDFWorker per port.");return(f(t,t,Rh)||d(t,t,Rh,new WeakMap)).set(r,this),void this._initializeFromPort(r)}this._initialize()}return(0,Z.Z)(t,[{key:"promise",get:function(){return F?Promise.all([Es.promise,this._readyCapability.promise]):this._readyCapability.promise}},{key:"port",get:function(){return this._port}},{key:"messageHandler",get:function(){return this._messageHandler}},{key:"_initializeFromPort",value:function(t){this._port=t,this._messageHandler=new Ro("main","worker",t),this._messageHandler.on("ready",(function(){})),k(this,Eh,Zh).call(this)}},{key:"_initialize",value:function(){var e=this;if(Mh.isWorkerDisabled||f(t,t,Th))this._setupFakeWorker();else{var i=t.workerSrc;try{Mh.isSameOrigin(window.location.href,i)||(i=Mh.createCDNWrapper(new URL(i,window.location).href));var n=new Worker(i,{type:"module"}),a=new Ro("main","worker",n),r=function(){s.abort(),a.destroy(),n.terminate(),e.destroyed?e._readyCapability.reject(new Error("Worker was destroyed")):e._setupFakeWorker()},s=new AbortController;n.addEventListener("error",(function(){e._webWorker||r()}),{signal:s.signal}),a.on("test",(function(t){s.abort(),!e.destroyed&&t?(e._messageHandler=a,e._port=n,e._webWorker=n,k(e,Eh,Zh).call(e)):r()})),a.on("ready",(function(t){if(s.abort(),e.destroyed)r();else try{o()}catch(i){e._setupFakeWorker()}}));var o=function(){var t=new Uint8Array;a.send("test",t,[t.buffer])};return void o()}catch(l){It("The worker has been disabled.")}this._setupFakeWorker()}}},{key:"_setupFakeWorker",value:function(){var e=this;Mh.isWorkerDisabled||(Ft("Setting up fake worker."),Mh.isWorkerDisabled=!0),t._setupFakeWorkerGlobal.then((function(t){if(e.destroyed)e._readyCapability.reject(new Error("Worker was destroyed"));else{var i=new Sh;e._port=i;var n="fake".concat(Mh.fakeWorkerId++),a=new Ro(n+"_worker",n,i);t.setup(a,i),e._messageHandler=new Ro(n,n+"_worker",i),k(e,Eh,Zh).call(e)}})).catch((function(t){e._readyCapability.reject(new Error('Setting up fake worker failed: "'.concat(t.message,'".')))}))}},{key:"destroy",value:function(){var e;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),null===(e=f(t,t,Rh))||void 0===e||e.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}}],[{key:"fromPort",value:function(e){var i;if(null===e||void 0===e||!e.port)throw new Error("PDFWorker.fromPort - invalid method signature.");var n=null===(i=f(this,t,Rh))||void 0===i?void 0:i.get(e.port);if(n){if(n._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return n}return new t(e)}},{key:"workerSrc",get:function(){if(fo.workerSrc)return fo.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}},{key:"_setupFakeWorkerGlobal",get:function(){var e=this,i=function(){var i=(0,w.Z)(L.mark((function i(){var n;return L.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!f(e,t,Th)){i.next=2;break}return i.abrupt("return",f(e,t,Th));case 2:return i.next=4,import(e.workerSrc);case 4:return n=i.sent,i.abrupt("return",n.WorkerMessageHandler);case 6:case"end":return i.stop()}}),i)})));return function(){return i.apply(this,arguments)}}();return Bt(this,"_setupFakeWorkerGlobal",i())}}]),t}();function Zh(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}var Th={get:function(){try{var t;return(null===(t=globalThis.pdfjsWorker)||void 0===t?void 0:t.WorkerMessageHandler)||null}catch(e){return null}},set:void 0},Rh={writable:!0,value:void 0},Ph=new WeakMap,Lh=new WeakMap,Ih=new WeakMap,Fh=new WeakMap,Dh=new WeakMap,Wh=new WeakSet,Nh=function(){function t(e,i,n,a,r){(0,T.Z)(this,t),y(this,Wh),A(this,Ph,{writable:!0,value:new Map}),A(this,Lh,{writable:!0,value:new Map}),A(this,Ih,{writable:!0,value:new Map}),A(this,Fh,{writable:!0,value:new Map}),A(this,Dh,{writable:!0,value:null}),this.messageHandler=e,this.loadingTask=i,this.commonObjs=new jh,this.fontLoader=new As({ownerDocument:a.ownerDocument,styleElement:a.styleElement}),this.loadingParams=a.loadingParams,this._params=a,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}return(0,Z.Z)(t,[{key:"annotationStorage",get:function(){return Bt(this,"annotationStorage",new ms)}},{key:"getRenderingIntent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.ENABLE,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=B,s=ds;switch(t){case"any":r=O;break;case"display":break;case"print":r=H;break;default:Ft("getRenderingIntent - invalid intent: ".concat(t))}var o=r&H&&i instanceof bs?i:this.annotationStorage;switch(e){case q.DISABLE:r+=U;break;case q.ENABLE:break;case q.ENABLE_FORMS:r+=z;break;case q.ENABLE_STORAGE:r+=j,s=o.serializable;break;default:Ft("getRenderingIntent - invalid annotationMode: ".concat(e))}n&&(r+=V),a&&(r+=G);var l=o.modifiedIds,h=l.ids,u=l.hash,c=[r,s.hash,u];return{renderingIntent:r,cacheKey:c.join("_"),annotationStorageSerializable:s,modifiedIds:h}}},{key:"destroy",value:function(){var t,e=this;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),null===(t=_(this,Dh))||void 0===t||t.reject(new Error("Worker was destroyed during onPassword callback"));var i,n=[],a=C(_(this,Lh).values());try{for(a.s();!(i=a.n()).done;){var r=i.value;n.push(r._destroy())}}catch(o){a.e(o)}finally{a.f()}_(this,Lh).clear(),_(this,Ih).clear(),_(this,Fh).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();var s=this.messageHandler.sendWithPromise("Terminate",null);return n.push(s),Promise.all(n).then((function(){var t;e.commonObjs.clear(),e.fontLoader.clear(),_(e,Ph).clear(),e.filterFactory.destroy(),Gl.cleanup(),null===(t=e._networkStream)||void 0===t||t.cancelAllRequests(new Xt("Worker was terminated.")),e.messageHandler&&(e.messageHandler.destroy(),e.messageHandler=null),e.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}},{key:"setupMessageHandler",value:function(){var t=this,e=this.messageHandler,i=this.loadingTask;e.on("GetReader",(function(e,i){Wt(t._networkStream,"GetReader - no `IPDFStream` instance available."),t._fullReader=t._networkStream.getFullReader(),t._fullReader.onProgress=function(e){t._lastProgress={loaded:e.loaded,total:e.total}},i.onPull=function(){t._fullReader.read().then((function(t){var e=t.value;t.done?i.close():(Wt(e instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(e),1,[e]))})).catch((function(t){i.error(t)}))},i.onCancel=function(e){t._fullReader.cancel(e),i.ready.catch((function(e){if(!t.destroyed)throw e}))}})),e.on("ReaderHeadersReady",(function(e){var n=Promise.withResolvers(),a=t._fullReader;return a.headersReady.then((function(){if(!a.isStreamingSupported||!a.isRangeSupported){var e;if(t._lastProgress)null===(e=i.onProgress)||void 0===e||e.call(i,t._lastProgress);a.onProgress=function(t){var e;null===(e=i.onProgress)||void 0===e||e.call(i,{loaded:t.loaded,total:t.total})}}n.resolve({isStreamingSupported:a.isStreamingSupported,isRangeSupported:a.isRangeSupported,contentLength:a.contentLength})}),n.reject),n.promise})),e.on("GetRangeReader",(function(e,i){Wt(t._networkStream,"GetRangeReader - no `IPDFStream` instance available.");var n=t._networkStream.getRangeReader(e.begin,e.end);n?(i.onPull=function(){n.read().then((function(t){var e=t.value;t.done?i.close():(Wt(e instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(e),1,[e]))})).catch((function(t){i.error(t)}))},i.onCancel=function(e){n.cancel(e),i.ready.catch((function(e){if(!t.destroyed)throw e}))}):i.close()})),e.on("GetDoc",(function(e){var n=e.pdfInfo;t._numPages=n.numPages,t._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,i._capability.resolve(new ph(n,t))})),e.on("DocException",(function(t){var e;switch(t.name){case"PasswordException":e=new zt(t.message,t.code);break;case"InvalidPDFException":e=new Ut(t.message);break;case"MissingPDFException":e=new Vt(t.message);break;case"UnexpectedResponseException":e=new Gt(t.message,t.status);break;case"UnknownErrorException":e=new jt(t.message,t.details);break;default:Dt("DocException - expected a valid Error.")}i._capability.reject(e)})),e.on("PasswordRequest",(function(e){if(x(t,Dh,Promise.withResolvers()),i.onPassword){try{i.onPassword((function(e){e instanceof Error?_(t,Dh).reject(e):_(t,Dh).resolve({password:e})}),e.code)}catch(n){_(t,Dh).reject(n)}}else _(t,Dh).reject(new zt(e.message,e.code));return _(t,Dh).promise})),e.on("DataLoaded",(function(e){var n;null===(n=i.onProgress)||void 0===n||n.call(i,{loaded:e.length,total:e.length}),t.downloadInfoCapability.resolve(e)})),e.on("StartRenderPage",(function(e){t.destroyed||_(t,Lh).get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)})),e.on("commonobj",(function(i){var n,a=(0,M.Z)(i,3),r=a[0],s=a[1],o=a[2];if(t.destroyed)return null;if(t.commonObjs.has(r))return null;switch(s){case"Font":var l=t._params,h=l.disableFontFace,u=l.fontExtraProperties,c=l.pdfBug;if("error"in o){var d=o.error;Ft("Error during font loading: ".concat(d)),t.commonObjs.resolve(r,d);break}var v=c&&null!==(n=globalThis.FontInspector)&&void 0!==n&&n.enabled?function(t,e){return globalThis.FontInspector.fontAdded(t,e)}:null,f=new _s(o,{disableFontFace:h,inspectFont:v});t.fontLoader.bind(f).catch((function(){return e.sendWithPromise("FontFallback",{id:r})})).finally((function(){!u&&f.data&&(f.data=null),t.commonObjs.resolve(r,f)}));break;case"CopyLocalImage":var p=o.imageRef;Wt(p,"The imageRef must be defined.");var g,m=C(_(t,Lh).values());try{for(m.s();!(g=m.n()).done;){var y,k=C(g.value.objs);try{for(k.s();!(y=k.n()).done;){var b=(0,M.Z)(y.value,2)[1];if((null===b||void 0===b?void 0:b.ref)===p)return b.dataLen?(t.commonObjs.resolve(r,structuredClone(b)),b.dataLen):null}}catch(w){k.e(w)}finally{k.f()}}}catch(w){m.e(w)}finally{m.f()}break;case"FontPath":case"Image":case"Pattern":t.commonObjs.resolve(r,o);break;default:throw new Error("Got unknown common object type ".concat(s))}return null})),e.on("obj",(function(e){var i=(0,M.Z)(e,4),n=i[0],a=i[1],r=i[2],s=i[3];if(!t.destroyed){var o,l=_(t,Lh).get(a);if(!l.objs.has(n))if(0!==l._intentStates.size)switch(r){case"Image":l.objs.resolve(n,s),(null===s||void 0===s?void 0:s.dataLen)>1e7&&(l._maybeCleanupAfterRender=!0);break;case"Pattern":l.objs.resolve(n,s);break;default:throw new Error("Got unknown object type ".concat(r))}else null===s||void 0===s||null===(o=s.bitmap)||void 0===o||o.close()}})),e.on("DocProgress",(function(e){var n;t.destroyed||null===(n=i.onProgress)||void 0===n||n.call(i,{loaded:e.loaded,total:e.total})})),e.on("FetchBuiltInCMap",(function(e){return t.destroyed?Promise.reject(new Error("Worker was destroyed.")):t.cMapReaderFactory?t.cMapReaderFactory.fetch(e):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))})),e.on("FetchStandardFontData",(function(e){return t.destroyed?Promise.reject(new Error("Worker was destroyed.")):t.standardFontDataFactory?t.standardFontDataFactory.fetch(e):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter."))}))}},{key:"getData",value:function(){return this.messageHandler.sendWithPromise("GetData",null)}},{key:"saveDocument",value:function(){var t,e,i=this;this.annotationStorage.size<=0&&Ft("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");var n=this.annotationStorage.serializable,a=n.map,r=n.transfer;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:a,filename:null!==(t=null===(e=this._fullReader)||void 0===e?void 0:e.filename)&&void 0!==t?t:null},r).finally((function(){i.annotationStorage.resetModified()}))}},{key:"getPage",value:function(t){var e=this;if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));var i=t-1,n=_(this,Ih).get(i);if(n)return n;var a=this.messageHandler.sendWithPromise("GetPage",{pageIndex:i}).then((function(n){if(e.destroyed)throw new Error("Transport destroyed");n.refStr&&_(e,Fh).set(n.refStr,t);var a=new bh(i,n,e,e._params.pdfBug);return _(e,Lh).set(i,a),a}));return _(this,Ih).set(i,a),a}},{key:"getPageIndex",value:function(t){return ch(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}},{key:"getAnnotations",value:function(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}},{key:"getFieldObjects",value:function(){return k(this,Wh,Oh).call(this,"GetFieldObjects")}},{key:"hasJSActions",value:function(){return k(this,Wh,Oh).call(this,"HasJSActions")}},{key:"getCalculationOrderIds",value:function(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}},{key:"getDestinations",value:function(){return this.messageHandler.sendWithPromise("GetDestinations",null)}},{key:"getDestination",value:function(t){return"string"!==typeof t?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}},{key:"getPageLabels",value:function(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}},{key:"getPageLayout",value:function(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}},{key:"getPageMode",value:function(){return this.messageHandler.sendWithPromise("GetPageMode",null)}},{key:"getViewerPreferences",value:function(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}},{key:"getOpenAction",value:function(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}},{key:"getAttachments",value:function(){return this.messageHandler.sendWithPromise("GetAttachments",null)}},{key:"getDocJSActions",value:function(){return k(this,Wh,Oh).call(this,"GetDocJSActions")}},{key:"getPageJSActions",value:function(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}},{key:"getStructTree",value:function(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}},{key:"getOutline",value:function(){return this.messageHandler.sendWithPromise("GetOutline",null)}},{key:"getOptionalContentConfig",value:function(t){return k(this,Wh,Oh).call(this,"GetOptionalContentConfig").then((function(e){return new Yo(e,t)}))}},{key:"getPermissions",value:function(){return this.messageHandler.sendWithPromise("GetPermissions",null)}},{key:"getMetadata",value:function(){var t=this,e="GetMetadata",i=_(this,Ph).get(e);if(i)return i;var n=this.messageHandler.sendWithPromise(e,null).then((function(e){var i,n,a,r;return{info:e[0],metadata:e[1]?new No(e[1]):null,contentDispositionFilename:null!==(i=null===(n=t._fullReader)||void 0===n?void 0:n.filename)&&void 0!==i?i:null,contentLength:null!==(a=null===(r=t._fullReader)||void 0===r?void 0:r.contentLength)&&void 0!==a?a:null}}));return _(this,Ph).set(e,n),n}},{key:"getMarkInfo",value:function(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}},{key:"startCleanup",value:function(){var t=(0,w.Z)(L.mark((function t(){var e,i,n,a,r=arguments;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=r.length>0&&void 0!==r[0]&&r[0],!this.destroyed){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.messageHandler.sendWithPromise("Cleanup",null);case 5:i=C(_(this,Lh).values()),t.prev=6,i.s();case 8:if((n=i.n()).done){t.next=15;break}if(a=n.value,a.cleanup()){t.next=13;break}throw new Error("startCleanup: Page ".concat(a.pageNumber," is currently rendering."));case 13:t.next=8;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(6),i.e(t.t0);case 20:return t.prev=20,i.f(),t.finish(20);case 23:this.commonObjs.clear(),e||this.fontLoader.clear(),_(this,Ph).clear(),this.filterFactory.destroy(!0),Gl.cleanup();case 28:case"end":return t.stop()}}),t,this,[[6,17,20,23]])})));return function(){return t.apply(this,arguments)}}()},{key:"cachedPageNumber",value:function(t){var e;if(!ch(t))return null;var i=0===t.gen?"".concat(t.num,"R"):"".concat(t.num,"R").concat(t.gen);return null!==(e=_(this,Fh).get(i))&&void 0!==e?e:null}}]),t}();function Oh(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=_(this,Ph).get(t);if(i)return i;var n=this.messageHandler.sendWithPromise(t,e);return _(this,Ph).set(t,n),n}var Bh=Symbol("INITIAL_DATA"),Hh=new WeakMap,zh=new WeakSet,jh=function(t){function e(){(0,T.Z)(this,e),y(this,zh),A(this,Hh,{writable:!0,value:Object.create(null)})}return(0,Z.Z)(e,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){var i=k(this,zh,Uh).call(this,t);return i.promise.then((function(){return e(i.data)})),null}var n=_(this,Hh)[t];if(!n||n.data===Bh)throw new Error("Requesting object that isn't resolved yet ".concat(t,"."));return n.data}},{key:"has",value:function(t){var e=_(this,Hh)[t];return!!e&&e.data!==Bh}},{key:"resolve",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=k(this,zh,Uh).call(this,t);i.data=e,i.resolve()}},{key:"clear",value:function(){for(var t in _(this,Hh)){var e,i=_(this,Hh)[t].data;null===i||void 0===i||null===(e=i.bitmap)||void 0===e||e.close()}x(this,Hh,Object.create(null))}},{key:t,value:L.mark((function t(){var e,i;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=L.keys(_(this,Hh));case 1:if((t.t1=t.t0()).done){t.next=10;break}if(e=t.t1.value,(i=_(this,Hh)[e].data)!==Bh){t.next=6;break}return t.abrupt("continue",1);case 6:return t.next=8,[e,i];case 8:t.next=1;break;case 10:case"end":return t.stop()}}),t,this)}))}]),e}(Symbol.iterator);function Uh(t){var e;return(e=_(this,Hh))[t]||(e[t]=(0,n.Z)((0,n.Z)({},Promise.withResolvers()),{},{data:Bh}))}var Vh=new WeakMap,Gh=function(){function t(e){(0,T.Z)(this,t),A(this,Vh,{writable:!0,value:null}),x(this,Vh,e),this.onContinue=null}return(0,Z.Z)(t,[{key:"promise",get:function(){return _(this,Vh).capability.promise}},{key:"cancel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;_(this,Vh).cancel(null,t)}},{key:"separateAnnots",get:function(){var t=_(this,Vh).operatorList.separateAnnots;if(!t)return!1;var e=_(this,Vh).annotationCanvasMap;return t.form||t.canvas&&(null===e||void 0===e?void 0:e.size)>0}}]),t}(),qh=new WeakMap,Xh=function(){function t(e){var i=e.callback,n=e.params,a=e.objs,r=e.commonObjs,s=e.annotationCanvasMap,o=e.operatorList,l=e.pageIndex,h=e.canvasFactory,u=e.filterFactory,c=e.useRequestAnimationFrame,d=void 0!==c&&c,v=e.pdfBug,f=void 0!==v&&v,p=e.pageColors,g=void 0===p?null:p;(0,T.Z)(this,t),A(this,qh,{writable:!0,value:null}),this.callback=i,this.params=n,this.objs=a,this.commonObjs=r,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=l,this.canvasFactory=h,this.filterFactory=u,this._pdfBug=f,this.pageColors=g,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===d&&"undefined"!==typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Gh(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=n.canvasContext.canvas}return(0,Z.Z)(t,[{key:"completed",get:function(){return this.capability.promise.catch((function(){}))}},{key:"initializeGraphics",value:function(e){var i,n,a=e.transparency,r=void 0!==a&&a,s=e.optionalContentConfig;if(!this.cancelled){if(this._canvas){if(f(t,t,Kh).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");f(t,t,Kh).add(this._canvas)}this._pdfBug&&null!==(i=globalThis.StepperManager)&&void 0!==i&&i.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());var o=this.params,l=o.canvasContext,h=o.viewport,u=o.transform,c=o.background;this.gfx=new ho(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:s},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:u,viewport:h,transparency:r,background:c}),this.operatorListIdx=0,this.graphicsReady=!0,null===(n=this.graphicsReadyCallback)||void 0===n||n.call(this)}}},{key:"cancel",value:function(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.running=!1,this.cancelled=!0,null===(e=this.gfx)||void 0===e||e.endDrawing(),_(this,qh)&&(window.cancelAnimationFrame(_(this,qh)),x(this,qh,null)),f(t,t,Kh).delete(this._canvas),this.callback(i||new ci("Rendering cancelled, page ".concat(this._pageIndex+1),n))}},{key:"operatorListChanged",value:function(){var t;this.graphicsReady?(null===(t=this.stepper)||void 0===t||t.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}},{key:"_continue",value:function(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}},{key:"_scheduleNext",value:function(){var t=this;this._useRequestAnimationFrame?x(this,qh,window.requestAnimationFrame((function(){x(t,qh,null),t._nextBound().catch(t._cancelBound)}))):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}},{key:"_next",value:function(){var e=(0,w.Z)(L.mark((function e(){return L.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cancelled){e.next=2;break}return e.abrupt("return");case 2:this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),f(t,t,Kh).delete(this._canvas),this.callback()));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(),Kh={writable:!0,value:new WeakSet},Yh="4.5.136",Qh="3a21f03b0";function Jh(t){return Math.floor(255*Math.max(0,Math.min(1,t))).toString(16).padStart(2,"0")}function $h(t){return Math.max(0,Math.min(255,255*t))}var tu=function(){function t(){(0,T.Z)(this,t)}return(0,Z.Z)(t,null,[{key:"CMYK_G",value:function(t){var e=(0,M.Z)(t,4),i=e[0],n=e[1],a=e[2],r=e[3];return["G",1-Math.min(1,.3*i+.59*a+.11*n+r)]}},{key:"G_CMYK",value:function(t){return["CMYK",0,0,0,1-(0,M.Z)(t,1)[0]]}},{key:"G_RGB",value:function(t){var e=(0,M.Z)(t,1)[0];return["RGB",e,e,e]}},{key:"G_rgb",value:function(t){var e=(0,M.Z)(t,1)[0];return[e=$h(e),e,e]}},{key:"G_HTML",value:function(t){var e=Jh((0,M.Z)(t,1)[0]);return"#".concat(e).concat(e).concat(e)}},{key:"RGB_G",value:function(t){var e=(0,M.Z)(t,3);return["G",.3*e[0]+.59*e[1]+.11*e[2]]}},{key:"RGB_rgb",value:function(t){return t.map($h)}},{key:"RGB_HTML",value:function(t){return"#".concat(t.map(Jh).join(""))}},{key:"T_HTML",value:function(){return"#00000000"}},{key:"T_rgb",value:function(){return[null]}},{key:"CMYK_RGB",value:function(t){var e=(0,M.Z)(t,4),i=e[0],n=e[1],a=e[2],r=e[3];return["RGB",1-Math.min(1,i+r),1-Math.min(1,a+r),1-Math.min(1,n+r)]}},{key:"CMYK_rgb",value:function(t){var e=(0,M.Z)(t,4),i=e[0],n=e[1],a=e[2],r=e[3];return[$h(1-Math.min(1,i+r)),$h(1-Math.min(1,a+r)),$h(1-Math.min(1,n+r))]}},{key:"CMYK_HTML",value:function(t){var e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}},{key:"RGB_CMYK",value:function(t){var e=(0,M.Z)(t,3),i=1-e[0],n=1-e[1],a=1-e[2];return["CMYK",i,n,a,Math.min(i,n,a)]}}]),t}(),eu=function(){function t(){(0,T.Z)(this,t)}return(0,Z.Z)(t,null,[{key:"setupStorage",value:function(t,e,i,n,a){var r=n.getValue(e,{value:null});switch(i.name){case"textarea":if(null!==r.value&&(t.textContent=r.value),"print"===a)break;t.addEventListener("input",(function(t){n.setValue(e,{value:t.target.value})}));break;case"input":if("radio"===i.attributes.type||"checkbox"===i.attributes.type){if(r.value===i.attributes.xfaOn?t.setAttribute("checked",!0):r.value===i.attributes.xfaOff&&t.removeAttribute("checked"),"print"===a)break;t.addEventListener("change",(function(t){n.setValue(e,{value:t.target.checked?t.target.getAttribute("xfaOn"):t.target.getAttribute("xfaOff")})}))}else{if(null!==r.value&&t.setAttribute("value",r.value),"print"===a)break;t.addEventListener("input",(function(t){n.setValue(e,{value:t.target.value})}))}break;case"select":if(null!==r.value){t.setAttribute("value",r.value);var s,o=C(i.children);try{for(o.s();!(s=o.n()).done;){var l=s.value;l.attributes.value===r.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}}catch(h){o.e(h)}finally{o.f()}}t.addEventListener("input",(function(t){var i=t.target.options,a=-1===i.selectedIndex?"":i[i.selectedIndex].value;n.setValue(e,{value:a})}))}}},{key:"setAttributes",value:function(t){var e=t.html,i=t.element,n=t.storage,a=void 0===n?null:n,r=t.intent,s=t.linkService,o=i.attributes,l=e instanceof HTMLAnchorElement;"radio"===o.type&&(o.name="".concat(o.name,"-").concat(r));for(var h=0,u=Object.entries(o);h<u.length;h++){var c=(0,M.Z)(u[h],2),d=c[0],v=c[1];if(null!==v&&void 0!==v)switch(d){case"class":v.length&&e.setAttribute(d,v.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",v);break;case"style":Object.assign(e.style,v);break;case"textContent":e.textContent=v;break;default:(!l||"href"!==d&&"newWindow"!==d)&&e.setAttribute(d,v)}}l&&s.addLinkAttributes(e,o.href,o.newWindow),a&&o.dataId&&this.setupStorage(e,o.dataId,i,a)}},{key:"render",value:function(t){var e=t.annotationStorage,i=t.linkService,n=t.xfaHtml,a=t.intent||"display",r=document.createElement(n.name);n.attributes&&this.setAttributes({html:r,element:n,intent:a,linkService:i});var s="richText"!==a,o=t.div;if(o.append(r),t.viewport){var l="matrix(".concat(t.viewport.transform.join(","),")");o.style.transform=l}s&&o.setAttribute("class","xfaLayer xfaFont");var h=[];if(0===n.children.length){if(n.value){var u=document.createTextNode(n.value);r.append(u),s&&nh.shouldBuildText(n.name)&&h.push(u)}return{textDivs:h}}for(var c=[[n,-1,r]];c.length>0;){var d,v,f=c.at(-1),p=(0,M.Z)(f,3),g=p[0],m=p[1],y=p[2];if(m+1!==g.children.length){var k=g.children[++c.at(-1)[1]];if(null!==k){var b=k.name;if("#text"!==b){var w=null!==k&&void 0!==k&&null!==(d=k.attributes)&&void 0!==d&&d.xmlns?document.createElementNS(k.attributes.xmlns,b):document.createElement(b);if(y.append(w),k.attributes&&this.setAttributes({html:w,element:k,storage:e,intent:a,linkService:i}),(null===(v=k.children)||void 0===v?void 0:v.length)>0)c.push([k,-1,w]);else if(k.value){var A=document.createTextNode(k.value);s&&nh.shouldBuildText(b)&&h.push(A),w.append(A)}}else{var _=document.createTextNode(k.value);h.push(_),y.append(_)}}}else c.pop()}var x,S=C(o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"));try{for(S.s();!(x=S.n()).done;){x.value.setAttribute("readOnly",!0)}}catch(E){S.e(E)}finally{S.f()}return{textDivs:h}}},{key:"update",value:function(t){var e="matrix(".concat(t.viewport.transform.join(","),")");t.div.style.transform=e,t.div.hidden=!1}}]),t}(),iu=1e3,nu=new WeakSet;function au(t){return{width:t[2]-t[0],height:t[3]-t[1]}}var ru=function(){function t(){(0,T.Z)(this,t)}return(0,Z.Z)(t,null,[{key:"create",value:function(t){switch(t.data.annotationType){case rt:return new pu(t);case at:return new ku(t);case wt:switch(t.data.fieldType){case"Tx":return new wu(t);case"Btn":return t.data.radioButton?new xu(t):t.data.checkBox?new _u(t):new Su(t);case"Ch":return new Mu(t);case"Sig":return new Au(t)}return new bu(t);case kt:return new Eu(t);case st:return new dc(t);case ot:return new fc(t);case lt:return new gc(t);case ht:return new yc(t);case ct:return new bc(t);case mt:return new Ac(t);case yt:return new xc(t);case ut:return new wc(t);case dt:return new Sc(t);case vt:return new Mc(t);case ft:return new Ec(t);case pt:return new Cc(t);case gt:return new Zc(t);case bt:return new Pc(t);default:return new uu(t)}}}]),t}(),su=new WeakMap,ou=new WeakMap,lu=new WeakMap,hu=new WeakSet,uu=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.isRenderable,a=void 0!==n&&n,r=i.ignoreBorder,s=void 0!==r&&r,o=i.createQuadrilaterals,l=void 0!==o&&o;(0,T.Z)(this,t),y(this,hu),A(this,su,{writable:!0,value:null}),A(this,ou,{writable:!0,value:!1}),A(this,lu,{writable:!0,value:null}),this.isRenderable=a,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,a&&(this.container=this._createContainer(s)),l&&this._createQuadrilaterals()}return(0,Z.Z)(t,[{key:"_isEditable",get:function(){return this.data.isEditable}},{key:"hasPopupData",get:function(){return t._hasPopupData(this.data)}},{key:"updateEdited",value:function(t){var e;if(this.container){_(this,su)||x(this,su,{rect:this.data.rect.slice(0)});var i=t.rect;i&&k(this,hu,cu).call(this,i),null===(e=_(this,lu))||void 0===e||e.popup.updateEdited(t)}}},{key:"resetEdited",value:function(){var t;_(this,su)&&(k(this,hu,cu).call(this,_(this,su).rect),null===(t=_(this,lu))||void 0===t||t.popup.resetEdited(),x(this,su,null))}},{key:"_createContainer",value:function(t){var e=this.data,i=this.parent,n=i.page,a=i.viewport,r=document.createElement("section");r.setAttribute("data-annotation-id",e.id),this instanceof bu||(r.tabIndex=iu);var s=r.style;if(s.zIndex=this.parent.zIndex++,e.popupRef&&r.setAttribute("aria-haspopup","dialog"),e.alternativeText&&(r.title=e.alternativeText),e.noRotate&&r.classList.add("norotate"),!e.rect||this instanceof Eu){var o=e.rotation;return e.hasOwnCanvas||0===o||this.setRotation(o,r),r}var l=au(e.rect),h=l.width,u=l.height;if(!t&&e.borderStyle.width>0){s.borderWidth="".concat(e.borderStyle.width,"px");var c=e.borderStyle.horizontalCornerRadius,d=e.borderStyle.verticalCornerRadius;if(c>0||d>0){var v="calc(".concat(c,"px * var(--scale-factor)) / calc(").concat(d,"px * var(--scale-factor))");s.borderRadius=v}else if(this instanceof xu){var f="calc(".concat(h,"px * var(--scale-factor)) / calc(").concat(u,"px * var(--scale-factor))");s.borderRadius=f}switch(e.borderStyle.style){case At:s.borderStyle="solid";break;case _t:s.borderStyle="dashed";break;case xt:Ft("Unimplemented border style: beveled");break;case St:Ft("Unimplemented border style: inset");break;case Mt:s.borderBottomStyle="solid"}var p=e.borderColor||null;p?(x(this,ou,!0),s.borderColor=te.makeHexColor(0|p[0],0|p[1],0|p[2])):s.borderWidth=0}var g=te.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]),m=a.rawDims,y=m.pageWidth,k=m.pageHeight,b=m.pageX,w=m.pageY;s.left="".concat(100*(g[0]-b)/y,"%"),s.top="".concat(100*(g[1]-w)/k,"%");var A=e.rotation;return e.hasOwnCanvas||0===A?(s.width="".concat(100*h/y,"%"),s.height="".concat(100*u/k,"%")):this.setRotation(A,r),r}},{key:"setRotation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.container;if(this.data.rect){var i,n,a=this.parent.viewport.rawDims,r=a.pageWidth,s=a.pageHeight,o=au(this.data.rect),l=o.width,h=o.height;t%180===0?(i=100*l/r,n=100*h/s):(i=100*h/r,n=100*l/s),e.style.width="".concat(i,"%"),e.style.height="".concat(n,"%"),e.setAttribute("data-main-rotation",(360-t)%360)}}},{key:"_commonActions",get:function(){var t=this,e=function(e,i,n){var a=n.detail[e],r=a[0],s=a.slice(1);n.target.style[i]=tu["".concat(r,"_HTML")](s),t.annotationStorage.setValue(t.data.id,(0,b.Z)({},i,tu["".concat(r,"_rgb")](s)))};return Bt(this,"_commonActions",{display:function(e){var i=e.detail.display,n=i%2===1;t.container.style.visibility=n?"hidden":"visible",t.annotationStorage.setValue(t.data.id,{noView:n,noPrint:1===i||2===i})},print:function(e){t.annotationStorage.setValue(t.data.id,{noPrint:!e.detail.print})},hidden:function(e){var i=e.detail.hidden;t.container.style.visibility=i?"hidden":"visible",t.annotationStorage.setValue(t.data.id,{noPrint:i,noView:i})},focus:function(t){setTimeout((function(){return t.target.focus({preventScroll:!1})}),0)},userName:function(t){t.target.title=t.detail.userName},readonly:function(t){t.target.disabled=t.detail.readonly},required:function(e){t._setRequired(e.target,e.detail.required)},bgColor:function(t){e("bgColor","backgroundColor",t)},fillColor:function(t){e("fillColor","backgroundColor",t)},fgColor:function(t){e("fgColor","color",t)},textColor:function(t){e("textColor","color",t)},borderColor:function(t){e("borderColor","borderColor",t)},strokeColor:function(t){e("strokeColor","borderColor",t)},rotation:function(e){var i=e.detail.rotation;t.setRotation(i),t.annotationStorage.setValue(t.data.id,{rotation:i})}})}},{key:"_dispatchEventFromSandbox",value:function(t,e){for(var i=this._commonActions,n=0,a=Object.keys(e.detail);n<a.length;n++){var r=a[n],s=t[r]||i[r];null===s||void 0===s||s(e)}}},{key:"_setDefaultPropertiesFromJS",value:function(t){if(this.enableScripting){var e=this.annotationStorage.getRawValue(this.data.id);if(e)for(var i=this._commonActions,n=0,a=Object.entries(e);n<a.length;n++){var r=(0,M.Z)(a[n],2),s=r[0],o=r[1],l=i[s];if(l)l({detail:(0,b.Z)({},s,o),target:t}),delete e[s]}}}},{key:"_createQuadrilaterals",value:function(){if(this.container){var t=this.data.quadPoints;if(t){var e=this.data.rect.map((function(t){return Math.fround(t)})),i=(0,M.Z)(e,4),n=i[0],a=i[1],r=i[2],s=i[3];if(8===t.length){var o=t.subarray(2,6),l=(0,M.Z)(o,4),h=l[0],u=l[1],c=l[2],d=l[3];if(r===h&&s===u&&n===c&&a===d)return}var v,f=this.container.style;if(_(this,ou)){var p=f.borderColor,g=f.borderWidth;f.borderWidth=0,v=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">','<g fill="transparent" stroke="'.concat(p,'" stroke-width="').concat(g,'">')],this.container.classList.add("hasBorder")}var m=r-n,y=s-a,k=this.svgFactory,b=k.createElement("svg");b.classList.add("quadrilateralsContainer"),b.setAttribute("width",0),b.setAttribute("height",0);var w=k.createElement("defs");b.append(w);var A=k.createElement("clipPath"),x="clippath_".concat(this.data.id);A.setAttribute("id",x),A.setAttribute("clipPathUnits","objectBoundingBox"),w.append(A);for(var S=2,E=t.length;S<E;S+=8){var C,Z=t[S],T=t[S+1],R=t[S+2],P=t[S+3],L=k.createElement("rect"),I=(R-n)/m,F=(s-T)/y,D=(Z-R)/m,W=(T-P)/y;L.setAttribute("x",I),L.setAttribute("y",F),L.setAttribute("width",D),L.setAttribute("height",W),A.append(L),null===(C=v)||void 0===C||C.push('<rect vector-effect="non-scaling-stroke" x="'.concat(I,'" y="').concat(F,'" width="').concat(D,'" height="').concat(W,'"/>'))}_(this,ou)&&(v.push("</g></svg>')"),f.backgroundImage=v.join("")),this.container.append(b),this.container.style.clipPath="url(#".concat(x,")")}}}},{key:"_createPopup",value:function(){var t=this.container,e=this.data;t.setAttribute("aria-haspopup","dialog");var i=x(this,lu,new Eu({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:"popup_".concat(e.id),rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(i.render())}},{key:"render",value:function(){Dt("Abstract method `AnnotationElement.render` called")}},{key:"_getElementsByName",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=[];if(this._fieldObjects){var n=this._fieldObjects[t];if(n){var a,r=C(n);try{for(r.s();!(a=r.n()).done;){var s=a.value,o=s.page,l=s.id,h=s.exportValues;if(-1!==o&&l!==e){var u="string"===typeof h?h:null,c=document.querySelector('[data-element-id="'.concat(l,'"]'));!c||nu.has(c)?i.push({id:l,exportValue:u,domElement:c}):Ft("_getElementsByName - element not allowed: ".concat(l))}}}catch(m){r.e(m)}finally{r.f()}}return i}var d,v=C(document.getElementsByName(t));try{for(v.s();!(d=v.n()).done;){var f=d.value,p=f.exportValue,g=f.getAttribute("data-element-id");g!==e&&(nu.has(f)&&i.push({id:g,exportValue:p,domElement:f}))}}catch(m){v.e(m)}finally{v.f()}return i}},{key:"show",value:function(){var t;this.container&&(this.container.hidden=!1),null===(t=this.popup)||void 0===t||t.maybeShow()}},{key:"hide",value:function(){var t;this.container&&(this.container.hidden=!0),null===(t=this.popup)||void 0===t||t.forceHide()}},{key:"getElementsToTriggerPopup",value:function(){return this.container}},{key:"addHighlightArea",value:function(){var t=this.getElementsToTriggerPopup();if(Array.isArray(t)){var e,i=C(t);try{for(i.s();!(e=i.n()).done;){e.value.classList.add("highlightArea")}}catch(n){i.e(n)}finally{i.f()}}else t.classList.add("highlightArea")}},{key:"_editOnDoubleClick",value:function(){var t=this;if(this._isEditable){var e=this.annotationEditorType,i=this.data.id;this.container.addEventListener("dblclick",(function(){var n;null===(n=t.linkService.eventBus)||void 0===n||n.dispatch("switchannotationeditormode",{source:t,mode:e,editId:i})}))}}}],[{key:"_hasPopupData",value:function(t){var e=t.titleObj,i=t.contentsObj,n=t.richText;return!!(null!==e&&void 0!==e&&e.str||null!==i&&void 0!==i&&i.str||null!==n&&void 0!==n&&n.str)}}]),t}();function cu(t){var e=this.container.style,i=this.data,n=i.rect,a=i.rotation,r=this.parent.viewport.rawDims,s=r.pageWidth,o=r.pageHeight,l=r.pageX,h=r.pageY;null===n||void 0===n||n.splice.apply(n,[0,4].concat((0,p.Z)(t)));var u=au(t),c=u.width,d=u.height;e.left="".concat(100*(t[0]-l)/s,"%"),e.top="".concat(100*(o-t[3]+h)/o,"%"),0===a?(e.width="".concat(100*c/s,"%"),e.height="".concat(100*d/o,"%")):this.setRotation(a)}var du=new WeakSet,vu=new WeakSet,fu=new WeakSet,pu=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,T.Z)(this,i),n=e.call(this,t,{isRenderable:!0,ignoreBorder:!(null===a||void 0===a||!a.ignoreBorder),createQuadrilaterals:!0}),y((0,g.Z)(n),fu),y((0,g.Z)(n),vu),y((0,g.Z)(n),du),n.isTooltipOnly=t.data.isTooltipOnly,n}return(0,Z.Z)(i,[{key:"render",value:function(){var t=this.data,e=this.linkService,i=document.createElement("a");i.setAttribute("data-element-id",t.id);var n=!1;return t.url?(e.addLinkAttributes(i,t.url,t.newWindow),n=!0):t.action?(this._bindNamedAction(i,t.action),n=!0):t.attachment?(k(this,vu,mu).call(this,i,t.attachment,t.attachmentDest),n=!0):t.setOCGState?(k(this,fu,yu).call(this,i,t.setOCGState),n=!0):t.dest?(this._bindLink(i,t.dest),n=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),n=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(i,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(i),this.container}},{key:"_bindLink",value:function(t,e){var i=this;t.href=this.linkService.getDestinationHash(e),t.onclick=function(){return e&&i.linkService.goToDestination(e),!1},(e||""===e)&&k(this,du,gu).call(this)}},{key:"_bindNamedAction",value:function(t,e){var i=this;t.href=this.linkService.getAnchorUrl(""),t.onclick=function(){return i.linkService.executeNamedAction(e),!1},k(this,du,gu).call(this)}},{key:"_bindJSAction",value:function(t,e){var i=this;t.href=this.linkService.getAnchorUrl("");for(var n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]),a=function(){var a=s[r],o=n.get(a);if(!o)return"continue";t[o]=function(){var t;return null===(t=i.linkService.eventBus)||void 0===t||t.dispatch("dispatcheventinsandbox",{source:i,detail:{id:e.id,name:a}}),!1}},r=0,s=Object.keys(e.actions);r<s.length;r++)a();t.onclick||(t.onclick=function(){return!1}),k(this,du,gu).call(this)}},{key:"_bindResetFormAction",value:function(t,e){var i=this,n=t.onclick;if(n||(t.href=this.linkService.getAnchorUrl("")),k(this,du,gu).call(this),!this._fieldObjects)return Ft('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(n||(t.onclick=function(){return!1}));t.onclick=function(){null===n||void 0===n||n();var t=e.fields,a=e.refs,r=e.include,s=[];if(0!==t.length||0!==a.length){var o,l=new Set(a),h=C(t);try{for(h.s();!(o=h.n()).done;){var u,c=o.value,d=C(i._fieldObjects[c]||[]);try{for(d.s();!(u=d.n()).done;){var v=u.value.id;l.add(v)}}catch(F){d.e(F)}finally{d.f()}}}catch(F){h.e(F)}finally{h.f()}for(var f=0,g=Object.values(i._fieldObjects);f<g.length;f++){var m,y=C(g[f]);try{for(y.s();!(m=y.n()).done;){var k=m.value;l.has(k.id)===r&&s.push(k)}}catch(F){y.e(F)}finally{y.f()}}}else for(var b=0,w=Object.values(i._fieldObjects);b<w.length;b++){var A=w[b];s.push.apply(s,(0,p.Z)(A))}for(var _,x=i.annotationStorage,S=[],M=0,E=s;M<E.length;M++){var Z=E[M],T=Z.id;switch(S.push(T),Z.type){case"text":var R=Z.defaultValue||"";x.setValue(T,{value:R});break;case"checkbox":case"radiobutton":var P=Z.defaultValue===Z.exportValues;x.setValue(T,{value:P});break;case"combobox":case"listbox":var L=Z.defaultValue||"";x.setValue(T,{value:L});break;default:continue}var I=document.querySelector('[data-element-id="'.concat(T,'"]'));I&&(nu.has(I)?I.dispatchEvent(new Event("resetform")):Ft("_bindResetFormAction - element not allowed: ".concat(T)))}i.enableScripting&&(null===(_=i.linkService.eventBus)||void 0===_||_.dispatch("dispatcheventinsandbox",{source:i,detail:{id:"app",ids:S,name:"ResetForm"}}));return!1}}}]),i}(uu);function gu(){this.container.setAttribute("data-internal-link","")}function mu(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.href=this.linkService.getAnchorUrl(""),e.description&&(t.title=e.description),t.onclick=function(){var t;return null===(t=i.downloadManager)||void 0===t||t.openOrDownloadData(e.content,e.filename,n),!1},k(this,du,gu).call(this)}function yu(t,e){var i=this;t.href=this.linkService.getAnchorUrl(""),t.onclick=function(){return i.linkService.executeSetOCGState(e),!1},k(this,du,gu).call(this)}var ku=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,{isRenderable:!0})}return(0,Z.Z)(i,[{key:"render",value:function(){this.container.classList.add("textAnnotation");var t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}]),i}(uu),bu=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(){return(0,T.Z)(this,i),e.apply(this,arguments)}return(0,Z.Z)(i,[{key:"render",value:function(){return this.container}},{key:"showElementAndHideCanvas",value:function(t){var e;this.data.hasOwnCanvas&&("CANVAS"===(null===(e=t.previousSibling)||void 0===e?void 0:e.nodeName)&&(t.previousSibling.hidden=!0),t.hidden=!1)}},{key:"_getKeyModifier",value:function(t){return Jt.platform.isMac?t.metaKey:t.ctrlKey}},{key:"_setEventListener",value:function(t,e,i,n,a){var r=this;i.includes("mouse")?t.addEventListener(i,(function(t){var e;null===(e=r.linkService.eventBus)||void 0===e||e.dispatch("dispatcheventinsandbox",{source:r,detail:{id:r.data.id,name:n,value:a(t),shift:t.shiftKey,modifier:r._getKeyModifier(t)}})})):t.addEventListener(i,(function(t){var s;if("blur"===i){if(!e.focused||!t.relatedTarget)return;e.focused=!1}else if("focus"===i){if(e.focused)return;e.focused=!0}a&&(null===(s=r.linkService.eventBus)||void 0===s||s.dispatch("dispatcheventinsandbox",{source:r,detail:{id:r.data.id,name:n,value:a(t)}}))}))}},{key:"_setEventListeners",value:function(t,e,i,n){var a,r=C(i);try{for(r.s();!(a=r.n()).done;){var s,o,l,h=(0,M.Z)(a.value,2),u=h[0],c=h[1];if("Action"===c||null!==(s=this.data.actions)&&void 0!==s&&s[c])"Focus"!==c&&"Blur"!==c||e||(e={focused:!1}),this._setEventListener(t,e,u,c,n),"Focus"!==c||null!==(o=this.data.actions)&&void 0!==o&&o.Blur?"Blur"!==c||null!==(l=this.data.actions)&&void 0!==l&&l.Focus||this._setEventListener(t,e,"focus","Focus",null):this._setEventListener(t,e,"blur","Blur",null)}}catch(d){r.e(d)}finally{r.f()}}},{key:"_setBackgroundColor",value:function(t){var e=this.data.backgroundColor||null;t.style.backgroundColor=null===e?"transparent":te.makeHexColor(e[0],e[1],e[2])}},{key:"_setTextStyle",value:function(t){var e,i=this.data.defaultAppearanceData.fontColor,n=this.data.defaultAppearanceData.fontSize||9,a=t.style,r=function(t){return Math.round(10*t)/10};if(this.data.multiLine){var s=Math.abs(this.data.rect[3]-this.data.rect[1]-2),o=s/(Math.round(s/(N*n))||1);e=Math.min(n,r(o/N))}else{var l=Math.abs(this.data.rect[3]-this.data.rect[1]-2);e=Math.min(n,r(l/N))}a.fontSize="calc(".concat(e,"px * var(--scale-factor))"),a.color=te.makeHexColor(i[0],i[1],i[2]),null!==this.data.textAlignment&&(a.textAlign=["left","center","right"][this.data.textAlignment])}},{key:"_setRequired",value:function(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}]),i}(uu),wu=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){(0,T.Z)(this,i);var n=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;return e.call(this,t,{isRenderable:n})}return(0,Z.Z)(i,[{key:"setPropertyOnSiblings",value:function(t,e,i,n){var a,r=this.annotationStorage,s=C(this._getElementsByName(t.name,t.id));try{for(s.s();!(a=s.n()).done;){var o=a.value;o.domElement&&(o.domElement[e]=i),r.setValue(o.id,(0,b.Z)({},n,i))}}catch(l){s.e(l)}finally{s.f()}}},{key:"render",value:function(){var t=this,e=this.annotationStorage,i=this.data.id;this.container.classList.add("textWidgetAnnotation");var n=null;if(this.renderForms){var a,r=e.getValue(i,{value:this.data.fieldValue}),s=r.value||"",o=e.getValue(i,{charLimit:this.data.maxLen}).charLimit;o&&s.length>o&&(s=s.slice(0,o));var l=r.formattedValue||(null===(a=this.data.textContent)||void 0===a?void 0:a.join("\n"))||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));var h,u,c={userValue:s,formattedValue:l,lastCommittedValue:null,commitKey:1,focused:!1};if(this.data.multiLine)(n=document.createElement("textarea")).textContent=null!==(h=l)&&void 0!==h?h:s,this.data.doNotScroll&&(n.style.overflowY="hidden");else(n=document.createElement("input")).type="text",n.setAttribute("value",null!==(u=l)&&void 0!==u?u:s),this.data.doNotScroll&&(n.style.overflowX="hidden");this.data.hasOwnCanvas&&(n.hidden=!0),nu.add(n),n.setAttribute("data-element-id",i),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=iu,this._setRequired(n,this.data.required),o&&(n.maxLength=o),n.addEventListener("input",(function(a){e.setValue(i,{value:a.target.value}),t.setPropertyOnSiblings(n,"value",a.target.value,"value"),c.formattedValue=null})),n.addEventListener("resetform",(function(e){var i,a=null!==(i=t.data.defaultFieldValue)&&void 0!==i?i:"";n.value=c.userValue=a,c.formattedValue=null}));var d=function(t){var e=c.formattedValue;null!==e&&void 0!==e&&(t.target.value=e),t.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){var v;n.addEventListener("focus",(function(e){var i;if(!c.focused){var n=e.target;c.userValue&&(n.value=c.userValue),c.lastCommittedValue=n.value,c.commitKey=1,null!==(i=t.data.actions)&&void 0!==i&&i.Focus||(c.focused=!0)}})),n.addEventListener("updatefromsandbox",(function(n){t.showElementAndHideCanvas(n.target);var a={value:function(t){var n;c.userValue=null!==(n=t.detail.value)&&void 0!==n?n:"",e.setValue(i,{value:c.userValue.toString()}),t.target.value=c.userValue},formattedValue:function(t){var n=t.detail.formattedValue;c.formattedValue=n,null!==n&&void 0!==n&&t.target!==document.activeElement&&(t.target.value=n),e.setValue(i,{formattedValue:n})},selRange:function(t){var e;(e=t.target).setSelectionRange.apply(e,(0,p.Z)(t.detail.selRange))},charLimit:function(n){var a,r=n.detail.charLimit,s=n.target;if(0!==r){s.setAttribute("maxLength",r);var o=c.userValue;!o||o.length<=r||(o=o.slice(0,r),s.value=c.userValue=o,e.setValue(i,{value:o}),null===(a=t.linkService.eventBus)||void 0===a||a.dispatch("dispatcheventinsandbox",{source:t,detail:{id:i,name:"Keystroke",value:o,willCommit:!0,commitKey:1,selStart:s.selectionStart,selEnd:s.selectionEnd}}))}else s.removeAttribute("maxLength")}};t._dispatchEventFromSandbox(a,n)})),n.addEventListener("keydown",(function(e){var n;c.commitKey=1;var a=-1;if("Escape"===e.key?a=0:"Enter"!==e.key||t.data.multiLine?"Tab"===e.key&&(c.commitKey=3):a=2,-1!==a){var r=e.target.value;c.lastCommittedValue!==r&&(c.lastCommittedValue=r,c.userValue=r,null===(n=t.linkService.eventBus)||void 0===n||n.dispatch("dispatcheventinsandbox",{source:t,detail:{id:i,name:"Keystroke",value:r,willCommit:!0,commitKey:a,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))}}));var f=d;d=null,n.addEventListener("blur",(function(e){var n;if(c.focused&&e.relatedTarget){null!==(n=t.data.actions)&&void 0!==n&&n.Blur||(c.focused=!1);var a,r=e.target.value;if(c.userValue=r,c.lastCommittedValue!==r)null===(a=t.linkService.eventBus)||void 0===a||a.dispatch("dispatcheventinsandbox",{source:t,detail:{id:i,name:"Keystroke",value:r,willCommit:!0,commitKey:c.commitKey,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}});f(e)}})),null!==(v=this.data.actions)&&void 0!==v&&v.Keystroke&&n.addEventListener("beforeinput",(function(e){var n;c.lastCommittedValue=null;var a=e.data,r=e.target,s=r.value,o=r.selectionStart,l=r.selectionEnd,h=o,u=l;switch(e.inputType){case"deleteWordBackward":var d=s.substring(0,o).match(/\w*[^\w]*$/);d&&(h-=d[0].length);break;case"deleteWordForward":var v=s.substring(o).match(/^[^\w]*\w*/);v&&(u+=v[0].length);break;case"deleteContentBackward":o===l&&(h-=1);break;case"deleteContentForward":o===l&&(u+=1)}e.preventDefault(),null===(n=t.linkService.eventBus)||void 0===n||n.dispatch("dispatcheventinsandbox",{source:t,detail:{id:i,name:"Keystroke",value:s,change:a||"",willCommit:!1,selStart:h,selEnd:u}})})),this._setEventListeners(n,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(function(t){return t.target.value}))}if(d&&n.addEventListener("blur",d),this.data.comb){var g=(this.data.rect[2]-this.data.rect[0])/o;n.classList.add("comb"),n.style.letterSpacing="calc(".concat(g,"px * var(--scale-factor) - 1ch)")}}else(n=document.createElement("div")).textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}]),i}(bu),Au=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,{isRenderable:!!t.data.hasOwnCanvas})}return(0,Z.Z)(i)}(bu),_u=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,{isRenderable:t.renderForms})}return(0,Z.Z)(i,[{key:"render",value:function(){var t=this,e=this.annotationStorage,i=this.data,n=i.id,a=e.getValue(n,{value:i.exportValue===i.fieldValue}).value;"string"===typeof a&&(a="Off"!==a,e.setValue(n,{value:a})),this.container.classList.add("buttonWidgetAnnotation","checkBox");var r=document.createElement("input");return nu.add(r),r.setAttribute("data-element-id",n),r.disabled=i.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=i.fieldName,a&&r.setAttribute("checked",!0),r.setAttribute("exportValue",i.exportValue),r.tabIndex=iu,r.addEventListener("change",(function(a){var r,s=a.target,o=s.name,l=s.checked,h=C(t._getElementsByName(o,n));try{for(h.s();!(r=h.n()).done;){var u=r.value,c=l&&u.exportValue===i.exportValue;u.domElement&&(u.domElement.checked=c),e.setValue(u.id,{value:c})}}catch(d){h.e(d)}finally{h.f()}e.setValue(n,{value:l})})),r.addEventListener("resetform",(function(t){var e=i.defaultFieldValue||"Off";t.target.checked=e===i.exportValue})),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",(function(i){var a={value:function(t){t.target.checked="Off"!==t.detail.value,e.setValue(n,{value:t.target.checked})}};t._dispatchEventFromSandbox(a,i)})),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(function(t){return t.target.checked}))),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}]),i}(bu),xu=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,{isRenderable:t.renderForms})}return(0,Z.Z)(i,[{key:"render",value:function(){var t=this;this.container.classList.add("buttonWidgetAnnotation","radioButton");var e=this.annotationStorage,i=this.data,n=i.id,a=e.getValue(n,{value:i.fieldValue===i.buttonValue}).value;if("string"===typeof a&&(a=a!==i.buttonValue,e.setValue(n,{value:a})),a){var r,s=C(this._getElementsByName(i.fieldName,n));try{for(s.s();!(r=s.n()).done;){var o=r.value;e.setValue(o.id,{value:!1})}}catch(u){s.e(u)}finally{s.f()}}var l=document.createElement("input");if(nu.add(l),l.setAttribute("data-element-id",n),l.disabled=i.readOnly,this._setRequired(l,this.data.required),l.type="radio",l.name=i.fieldName,a&&l.setAttribute("checked",!0),l.tabIndex=iu,l.addEventListener("change",(function(i){var a,r=i.target,s=r.name,o=r.checked,l=C(t._getElementsByName(s,n));try{for(l.s();!(a=l.n()).done;){var h=a.value;e.setValue(h.id,{value:!1})}}catch(u){l.e(u)}finally{l.f()}e.setValue(n,{value:o})})),l.addEventListener("resetform",(function(t){var e=i.defaultFieldValue;t.target.checked=null!==e&&void 0!==e&&e===i.buttonValue})),this.enableScripting&&this.hasJSActions){var h=i.buttonValue;l.addEventListener("updatefromsandbox",(function(i){var a={value:function(i){var a,r=h===i.detail.value,s=C(t._getElementsByName(i.target.name));try{for(s.s();!(a=s.n()).done;){var o=a.value,l=r&&o.id===n;o.domElement&&(o.domElement.checked=l),e.setValue(o.id,{value:l})}}catch(u){s.e(u)}finally{s.f()}}};t._dispatchEventFromSandbox(a,i)})),this._setEventListeners(l,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(function(t){return t.target.checked}))}return this._setBackgroundColor(l),this._setDefaultPropertiesFromJS(l),this.container.append(l),this.container}}]),i}(bu),Su=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,{ignoreBorder:t.data.hasAppearance})}return(0,Z.Z)(i,[{key:"render",value:function(){var t=this,e=h((0,o.Z)(i.prototype),"render",this).call(this);e.classList.add("buttonWidgetAnnotation","pushButton");var n=e.lastChild;return this.enableScripting&&this.hasJSActions&&n&&(this._setDefaultPropertiesFromJS(n),n.addEventListener("updatefromsandbox",(function(e){t._dispatchEventFromSandbox({},e)}))),e}}]),i}(pu),Mu=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,{isRenderable:t.renderForms})}return(0,Z.Z)(i,[{key:"render",value:function(){var t=this;this.container.classList.add("choiceWidgetAnnotation");var e=this.annotationStorage,i=this.data.id,n=e.getValue(i,{value:this.data.fieldValue}),a=document.createElement("select");nu.add(a),a.setAttribute("data-element-id",i),a.disabled=this.data.readOnly,this._setRequired(a,this.data.required),a.name=this.data.fieldName,a.tabIndex=iu;var r=this.data.combo&&this.data.options.length>0;this.data.combo||(a.size=this.data.options.length,this.data.multiSelect&&(a.multiple=!0)),a.addEventListener("resetform",(function(e){var i,n=t.data.defaultFieldValue,r=C(a.options);try{for(r.s();!(i=r.n()).done;){var s=i.value;s.selected=s.value===n}}catch(o){r.e(o)}finally{r.f()}}));var s,o=C(this.data.options);try{for(o.s();!(s=o.n()).done;){var l=s.value,h=document.createElement("option");h.textContent=l.displayValue,h.value=l.exportValue,n.value.includes(l.exportValue)&&(h.setAttribute("selected",!0),r=!1),a.append(h)}}catch(p){o.e(p)}finally{o.f()}var u=null;if(r){var c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),a.prepend(c),u=function(){c.remove(),a.removeEventListener("input",u),u=null},a.addEventListener("input",u)}var d=function(t){var e=t?"value":"textContent",i=a.options;return a.multiple?Array.prototype.filter.call(i,(function(t){return t.selected})).map((function(t){return t[e]})):-1===i.selectedIndex?null:i[i.selectedIndex][e]},v=d(!1),f=function(t){var e=t.target.options;return Array.prototype.map.call(e,(function(t){return{displayValue:t.textContent,exportValue:t.value}}))};return this.enableScripting&&this.hasJSActions?(a.addEventListener("updatefromsandbox",(function(n){var r={value:function(t){var n;null===(n=u)||void 0===n||n();var r,s=t.detail.value,o=new Set(Array.isArray(s)?s:[s]),l=C(a.options);try{for(l.s();!(r=l.n()).done;){var h=r.value;h.selected=o.has(h.value)}}catch(p){l.e(p)}finally{l.f()}e.setValue(i,{value:d(!0)}),v=d(!1)},multipleSelection:function(t){a.multiple=!0},remove:function(t){var n=a.options,r=t.detail.remove;if(n[r].selected=!1,a.remove(r),n.length>0){var s=Array.prototype.findIndex.call(n,(function(t){return t.selected}));-1===s&&(n[0].selected=!0)}e.setValue(i,{value:d(!0),items:f(t)}),v=d(!1)},clear:function(t){for(;0!==a.length;)a.remove(0);e.setValue(i,{value:null,items:[]}),v=d(!1)},insert:function(t){var n=t.detail.insert,r=n.index,s=n.displayValue,o=n.exportValue,l=a.children[r],h=document.createElement("option");h.textContent=s,h.value=o,l?l.before(h):a.append(h),e.setValue(i,{value:d(!0),items:f(t)}),v=d(!1)},items:function(t){for(var n=t.detail.items;0!==a.length;)a.remove(0);var r,s=C(n);try{for(s.s();!(r=s.n()).done;){var o=r.value,l=o.displayValue,h=o.exportValue,u=document.createElement("option");u.textContent=l,u.value=h,a.append(u)}}catch(p){s.e(p)}finally{s.f()}a.options.length>0&&(a.options[0].selected=!0),e.setValue(i,{value:d(!0),items:f(t)}),v=d(!1)},indices:function(t){var n,a=new Set(t.detail.indices),r=C(t.target.options);try{for(r.s();!(n=r.n()).done;){var s=n.value;s.selected=a.has(s.index)}}catch(p){r.e(p)}finally{r.f()}e.setValue(i,{value:d(!0)}),v=d(!1)},editable:function(t){t.target.disabled=!t.detail.editable}};t._dispatchEventFromSandbox(r,n)})),a.addEventListener("input",(function(n){var a,r=d(!0),s=d(!1);e.setValue(i,{value:r}),n.preventDefault(),null===(a=t.linkService.eventBus)||void 0===a||a.dispatch("dispatcheventinsandbox",{source:t,detail:{id:i,name:"Keystroke",value:v,change:s,changeEx:r,willCommit:!1,commitKey:1,keyDown:!1}})})),this._setEventListeners(a,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(function(t){return t.target.value}))):a.addEventListener("input",(function(t){e.setValue(i,{value:d(!0)})})),this.data.combo&&this._setTextStyle(a),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}]),i}(bu),Eu=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;(0,T.Z)(this,i);var a=t.data,r=t.elements;return(n=e.call(this,t,{isRenderable:uu._hasPopupData(a)})).elements=r,n.popup=null,n}return(0,Z.Z)(i,[{key:"render",value:function(){this.container.classList.add("popupAnnotation");var t,e=this.popup=new ic({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),i=[],n=C(this.elements);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.popup=e,i.push(a.data.id),a.addHighlightArea()}}catch(r){n.e(r)}finally{n.f()}return this.container.setAttribute("aria-controls",i.map((function(t){return"".concat(le).concat(t)})).join(",")),this.container}}]),i}(uu),Cu=new WeakMap,Zu=new WeakMap,Tu=new WeakMap,Ru=new WeakMap,Pu=new WeakMap,Lu=new WeakMap,Iu=new WeakMap,Fu=new WeakMap,Du=new WeakMap,Wu=new WeakMap,Nu=new WeakMap,Ou=new WeakMap,Bu=new WeakMap,Hu=new WeakMap,zu=new WeakMap,ju=new WeakMap,Uu=new WeakMap,Vu=new WeakMap,Gu=new WeakMap,qu=new WeakMap,Xu=new WeakMap,Ku=new WeakMap,Yu=new WeakSet,Qu=new WeakSet,Ju=new WeakSet,$u=new WeakSet,tc=new WeakSet,ec=new WeakSet,ic=function(){function t(e){var i=e.container,n=e.color,a=e.elements,r=e.titleObj,s=e.modificationDate,o=e.contentsObj,l=e.richText,h=e.parent,u=e.rect,c=e.parentRect,d=e.open;(0,T.Z)(this,t),y(this,ec),y(this,tc),y(this,$u),y(this,Ju),y(this,Qu),y(this,Yu),A(this,Ku,{get:rc,set:void 0}),A(this,Xu,{get:ac,set:void 0}),A(this,qu,{get:nc,set:void 0}),A(this,Cu,{writable:!0,value:k(this,Qu,oc).bind(this)}),A(this,Zu,{writable:!0,value:k(this,ec,cc).bind(this)}),A(this,Tu,{writable:!0,value:k(this,tc,uc).bind(this)}),A(this,Ru,{writable:!0,value:k(this,$u,hc).bind(this)}),A(this,Pu,{writable:!0,value:null}),A(this,Lu,{writable:!0,value:null}),A(this,Iu,{writable:!0,value:null}),A(this,Fu,{writable:!0,value:null}),A(this,Du,{writable:!0,value:null}),A(this,Wu,{writable:!0,value:null}),A(this,Nu,{writable:!0,value:null}),A(this,Ou,{writable:!0,value:!1}),A(this,Bu,{writable:!0,value:null}),A(this,Hu,{writable:!0,value:null}),A(this,zu,{writable:!0,value:null}),A(this,ju,{writable:!0,value:null}),A(this,Uu,{writable:!0,value:null}),A(this,Vu,{writable:!0,value:null}),A(this,Gu,{writable:!0,value:!1}),x(this,Lu,i),x(this,Uu,r),x(this,Iu,o),x(this,ju,l),x(this,Wu,h),x(this,Pu,n),x(this,zu,u),x(this,Nu,c),x(this,Du,a),x(this,Fu,bi.toDateObject(s)),this.trigger=a.flatMap((function(t){return t.getElementsToTriggerPopup()}));var v,f=C(this.trigger);try{for(f.s();!(v=f.n()).done;){var p=v.value;p.addEventListener("click",_(this,Ru)),p.addEventListener("mouseenter",_(this,Tu)),p.addEventListener("mouseleave",_(this,Zu)),p.classList.add("popupTriggerArea")}}catch(w){f.e(w)}finally{f.f()}var g,m=C(a);try{for(m.s();!(g=m.n()).done;){var b;null===(b=g.value.container)||void 0===b||b.addEventListener("keydown",_(this,Cu))}}catch(w){m.e(w)}finally{m.f()}_(this,Lu).hidden=!0,d&&k(this,$u,hc).call(this)}return(0,Z.Z)(t,[{key:"render",value:function(){if(!_(this,Bu)){var t=x(this,Bu,document.createElement("div"));if(t.className="popup",_(this,Pu)){var e=t.style.outlineColor=te.makeHexColor.apply(te,(0,p.Z)(_(this,Pu)));if(CSS.supports("background-color","color-mix(in srgb, red 30%, white)"))t.style.backgroundColor="color-mix(in srgb, ".concat(e," 30%, white)");else{t.style.backgroundColor=te.makeHexColor.apply(te,(0,p.Z)(_(this,Pu).map((function(t){return Math.floor(.7*(255-t)+t)}))))}}var i=document.createElement("span");i.className="header";var n=document.createElement("h1");i.append(n);var a=_(this,Uu);if(n.dir=a.dir,n.textContent=a.str,t.append(i),_(this,Fu)){var r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),r.setAttribute("data-l10n-args",JSON.stringify({date:_(this,Fu).toLocaleDateString(),time:_(this,Fu).toLocaleTimeString()})),i.append(r)}var s=_(this,qu);if(s)eu.render({xfaHtml:s,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{var o=this._formatContents(_(this,Iu));t.append(o)}_(this,Lu).append(t)}}},{key:"_formatContents",value:function(t){var e=t.str,i=t.dir,n=document.createElement("p");n.classList.add("popupContent"),n.dir=i;for(var a=e.split(/(?:\r\n?|\n)/),r=0,s=a.length;r<s;++r){var o=a[r];n.append(document.createTextNode(o)),r<s-1&&n.append(document.createElement("br"))}return n}},{key:"updateEdited",value:function(t){var e,i=t.rect,n=t.popupContent;_(this,Vu)||x(this,Vu,{contentsObj:_(this,Iu),richText:_(this,ju)}),i&&x(this,Hu,null),n&&(x(this,ju,k(this,Yu,sc).call(this,n)),x(this,Iu,null)),null===(e=_(this,Bu))||void 0===e||e.remove(),x(this,Bu,null)}},{key:"resetEdited",value:function(){var t;if(_(this,Vu)){var e=_(this,Vu);s(this,Iu).value=e.contentsObj,s(this,ju).value=e.richText,x(this,Vu,null),null===(t=_(this,Bu))||void 0===t||t.remove(),x(this,Bu,null),x(this,Hu,null)}}},{key:"forceHide",value:function(){x(this,Gu,this.isVisible),_(this,Gu)&&(_(this,Lu).hidden=!0)}},{key:"maybeShow",value:function(){_(this,Gu)&&(_(this,Bu)||k(this,tc,uc).call(this),x(this,Gu,!1),_(this,Lu).hidden=!1)}},{key:"isVisible",get:function(){return!1===_(this,Lu).hidden}}]),t}();function nc(){var t=_(this,ju),e=_(this,Iu);return null===t||void 0===t||!t.str||null!==e&&void 0!==e&&e.str&&e.str!==t.str?null:_(this,ju).html||null}function ac(){var t,e,i;return(null===(t=_(this,qu))||void 0===t||null===(e=t.attributes)||void 0===e||null===(i=e.style)||void 0===i?void 0:i.fontSize)||0}function rc(){var t,e,i;return(null===(t=_(this,qu))||void 0===t||null===(e=t.attributes)||void 0===e||null===(i=e.style)||void 0===i?void 0:i.color)||null}function sc(t){var e,i=[],n={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:i}]}},a={style:{color:_(this,Ku),fontSize:_(this,Xu)?"calc(".concat(_(this,Xu),"px * var(--scale-factor))"):""}},r=C(t.split("\n"));try{for(r.s();!(e=r.n()).done;){var s=e.value;i.push({name:"span",value:s,attributes:a})}}catch(o){r.e(o)}finally{r.f()}return n}function oc(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||("Enter"===t.key||"Escape"===t.key&&_(this,Ou))&&k(this,$u,hc).call(this)}function lc(){if(null===_(this,Hu)){var t,e=_(this,Wu),i=e.page.view,n=e.viewport.rawDims,a=n.pageWidth,r=n.pageHeight,s=n.pageX,o=n.pageY,l=!!_(this,Nu),h=_(this,l?Nu:zu),u=C(_(this,Du));try{for(u.s();!(t=u.n()).done;){var c=t.value;if(!h||null!==te.intersect(c.data.rect,h)){h=c.data.rect,l=!0;break}}}catch(m){u.e(m)}finally{u.f()}var d=te.normalizeRect([h[0],i[3]-h[1]+i[1],h[2],i[3]-h[3]+i[1]]),v=l?h[2]-h[0]+5:0,f=d[0]+v,p=d[1];x(this,Hu,[100*(f-s)/a,100*(p-o)/r]);var g=_(this,Lu).style;g.left="".concat(_(this,Hu)[0],"%"),g.top="".concat(_(this,Hu)[1],"%")}}function hc(){x(this,Ou,!_(this,Ou)),_(this,Ou)?(k(this,tc,uc).call(this),_(this,Lu).addEventListener("click",_(this,Ru)),_(this,Lu).addEventListener("keydown",_(this,Cu))):(k(this,ec,cc).call(this),_(this,Lu).removeEventListener("click",_(this,Ru)),_(this,Lu).removeEventListener("keydown",_(this,Cu)))}function uc(){_(this,Bu)||this.render(),this.isVisible?_(this,Ou)&&_(this,Lu).classList.add("focused"):(k(this,Ju,lc).call(this),_(this,Lu).hidden=!1,_(this,Lu).style.zIndex=parseInt(_(this,Lu).style.zIndex)+1e3)}function cc(){_(this,Lu).classList.remove("focused"),!_(this,Ou)&&this.isVisible&&(_(this,Lu).hidden=!0,_(this,Lu).style.zIndex=parseInt(_(this,Lu).style.zIndex)-1e3)}var dc=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;return(0,T.Z)(this,i),(n=e.call(this,t,{isRenderable:!0,ignoreBorder:!0})).textContent=t.data.textContent,n.textPosition=t.data.textPosition,n.annotationEditorType=X.FREETEXT,n}return(0,Z.Z)(i,[{key:"render",value:function(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){var t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");var e,i=C(this.textContent);try{for(i.s();!(e=i.n()).done;){var n=e.value,a=document.createElement("span");a.textContent=n,t.append(a)}}catch(r){i.e(r)}finally{i.f()}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}]),i}(uu),vc=new WeakMap,fc=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;return(0,T.Z)(this,i),n=e.call(this,t,{isRenderable:!0,ignoreBorder:!0}),A((0,g.Z)(n),vc,{writable:!0,value:null}),n}return(0,Z.Z)(i,[{key:"render",value:function(){this.container.classList.add("lineAnnotation");var t=this.data,e=au(t.rect),i=e.width,n=e.height,a=this.svgFactory.create(i,n,!0),r=x(this,vc,this.svgFactory.createElement("svg:line"));return r.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),r.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),r.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),r.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),r.setAttribute("stroke-width",t.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),a.append(r),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return _(this,vc)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}]),i}(uu),pc=new WeakMap,gc=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;return(0,T.Z)(this,i),n=e.call(this,t,{isRenderable:!0,ignoreBorder:!0}),A((0,g.Z)(n),pc,{writable:!0,value:null}),n}return(0,Z.Z)(i,[{key:"render",value:function(){this.container.classList.add("squareAnnotation");var t=this.data,e=au(t.rect),i=e.width,n=e.height,a=this.svgFactory.create(i,n,!0),r=t.borderStyle.width,s=x(this,pc,this.svgFactory.createElement("svg:rect"));return s.setAttribute("x",r/2),s.setAttribute("y",r/2),s.setAttribute("width",i-r),s.setAttribute("height",n-r),s.setAttribute("stroke-width",r||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),a.append(s),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return _(this,pc)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}]),i}(uu),mc=new WeakMap,yc=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;return(0,T.Z)(this,i),n=e.call(this,t,{isRenderable:!0,ignoreBorder:!0}),A((0,g.Z)(n),mc,{writable:!0,value:null}),n}return(0,Z.Z)(i,[{key:"render",value:function(){this.container.classList.add("circleAnnotation");var t=this.data,e=au(t.rect),i=e.width,n=e.height,a=this.svgFactory.create(i,n,!0),r=t.borderStyle.width,s=x(this,mc,this.svgFactory.createElement("svg:ellipse"));return s.setAttribute("cx",i/2),s.setAttribute("cy",n/2),s.setAttribute("rx",i/2-r/2),s.setAttribute("ry",n/2-r/2),s.setAttribute("stroke-width",r||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),a.append(s),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return _(this,mc)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}]),i}(uu),kc=new WeakMap,bc=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;return(0,T.Z)(this,i),n=e.call(this,t,{isRenderable:!0,ignoreBorder:!0}),A((0,g.Z)(n),kc,{writable:!0,value:null}),n.containerClassName="polylineAnnotation",n.svgElementName="svg:polyline",n}return(0,Z.Z)(i,[{key:"render",value:function(){this.container.classList.add(this.containerClassName);var t=this.data,e=t.rect,i=t.vertices,n=t.borderStyle,a=t.popupRef;if(!i)return this.container;for(var r=au(e),s=r.width,o=r.height,l=this.svgFactory.create(s,o,!0),h=[],u=0,c=i.length;u<c;u+=2){var d=i[u]-e[0],v=e[3]-i[u+1];h.push("".concat(d,",").concat(v))}h=h.join(" ");var f=x(this,kc,this.svgFactory.createElement(this.svgElementName));return f.setAttribute("points",h),f.setAttribute("stroke-width",n.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),l.append(f),this.container.append(l),!a&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return _(this,kc)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}]),i}(uu),wc=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;return(0,T.Z)(this,i),(n=e.call(this,t)).containerClassName="polygonAnnotation",n.svgElementName="svg:polygon",n}return(0,Z.Z)(i)}(bc),Ac=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,{isRenderable:!0,ignoreBorder:!0})}return(0,Z.Z)(i,[{key:"render",value:function(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}]),i}(uu),_c=new WeakMap,xc=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var n;return(0,T.Z)(this,i),n=e.call(this,t,{isRenderable:!0,ignoreBorder:!0}),A((0,g.Z)(n),_c,{writable:!0,value:[]}),n.containerClassName="inkAnnotation",n.svgElementName="svg:polyline",n.annotationEditorType=X.INK,n}return(0,Z.Z)(i,[{key:"render",value:function(){this.container.classList.add(this.containerClassName);var t,e=this.data,i=e.rect,n=e.inkLists,a=e.borderStyle,r=e.popupRef,s=au(i),o=s.width,l=s.height,h=this.svgFactory.create(o,l,!0),u=C(n);try{for(u.s();!(t=u.n()).done;){for(var c=t.value,d=[],v=0,f=c.length;v<f;v+=2){var p=c[v]-i[0],g=i[3]-c[v+1];d.push("".concat(p,",").concat(g))}d=d.join(" ");var m=this.svgFactory.createElement(this.svgElementName);_(this,_c).push(m),m.setAttribute("points",d),m.setAttribute("stroke-width",a.width||1),m.setAttribute("stroke","transparent"),m.setAttribute("fill","transparent"),!r&&this.hasPopupData&&this._createPopup(),h.append(m)}}catch(y){u.e(y)}finally{u.f()}return this.container.append(h),this.container}},{key:"getElementsToTriggerPopup",value:function(){return _(this,_c)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}]),i}(uu),Sc=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}return(0,Z.Z)(i,[{key:"render",value:function(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}]),i}(uu),Mc=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}return(0,Z.Z)(i,[{key:"render",value:function(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}]),i}(uu),Ec=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}return(0,Z.Z)(i,[{key:"render",value:function(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}]),i}(uu),Cc=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}return(0,Z.Z)(i,[{key:"render",value:function(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}]),i}(uu),Zc=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){return(0,T.Z)(this,i),e.call(this,t,{isRenderable:!0,ignoreBorder:!0})}return(0,Z.Z)(i,[{key:"render",value:function(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}]),i}(uu),Tc=new WeakMap,Rc=new WeakSet,Pc=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var a,r;(0,T.Z)(this,i),r=e.call(this,t,{isRenderable:!0}),y((0,g.Z)(r),Rc),A((0,g.Z)(r),Tc,{writable:!0,value:null});var s=r.data.file;return r.filename=s.filename,r.content=s.content,null===(a=r.linkService.eventBus)||void 0===a||a.dispatch("fileattachmentannotation",(0,n.Z)({source:(0,g.Z)(r)},s)),r}return(0,Z.Z)(i,[{key:"render",value:function(){var t=this;this.container.classList.add("fileAttachmentAnnotation");var e,i=this.container,n=this.data;n.hasAppearance||0===n.fillAlpha?e=document.createElement("div"):((e=document.createElement("img")).src="".concat(this.imageResourcesPath,"annotation-").concat(/paperclip/i.test(n.name)?"paperclip":"pushpin",".svg"),n.fillAlpha&&n.fillAlpha<1&&(e.style="filter: opacity(".concat(Math.round(100*n.fillAlpha),"%);"))),e.addEventListener("dblclick",k(this,Rc,Lc).bind(this)),x(this,Tc,e);var a=Jt.platform.isMac;return i.addEventListener("keydown",(function(e){"Enter"===e.key&&(a?e.metaKey:e.ctrlKey)&&k(t,Rc,Lc).call(t)})),!n.popupRef&&this.hasPopupData?this._createPopup():e.classList.add("popupTriggerArea"),i.append(e),i}},{key:"getElementsToTriggerPopup",value:function(){return _(this,Tc)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}]),i}(uu);function Lc(){var t;null===(t=this.downloadManager)||void 0===t||t.openOrDownloadData(this.content,this.filename)}var Ic=new WeakMap,Fc=new WeakMap,Dc=new WeakMap,Wc=new WeakSet,Nc=new WeakSet,Oc=function(){function t(e){var i=e.div,n=e.accessibilityManager,a=e.annotationCanvasMap,r=e.annotationEditorUIManager,s=e.page,o=e.viewport;(0,T.Z)(this,t),y(this,Nc),y(this,Wc),A(this,Ic,{writable:!0,value:null}),A(this,Fc,{writable:!0,value:null}),A(this,Dc,{writable:!0,value:new Map}),this.div=i,x(this,Ic,n),x(this,Fc,a),this.page=s,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=r}return(0,Z.Z)(t,[{key:"hasEditableAnnotations",value:function(){return _(this,Dc).size>0}},{key:"render",value:function(){var t=(0,w.Z)(L.mark((function t(e){var i,n,a,r,s,o,l,h,u,c,d,v,f,p,g,m;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=e.annotations,Si(n=this.div,this.viewport),a=new Map,r={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new hi,annotationStorage:e.annotationStorage||new ms,enableScripting:!0===e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null},s=C(i),t.prev=6,s.s();case 8:if((o=s.n()).done){t.next=34;break}if(!(l=o.value).noHTML){t.next=12;break}return t.abrupt("continue",32);case 12:if(h=l.annotationType===kt){t.next=19;break}if(u=au(l.rect),c=u.width,d=u.height,!(c<=0||d<=0)){t.next=17;break}return t.abrupt("continue",32);case 17:t.next=23;break;case 19:if(v=a.get(l.id)){t.next=22;break}return t.abrupt("continue",32);case 22:r.elements=v;case 23:if(r.data=l,(f=ru.create(r)).isRenderable){t.next=27;break}return t.abrupt("continue",32);case 27:!h&&l.popupRef&&((p=a.get(l.popupRef))?p.push(f):a.set(l.popupRef,[f])),g=f.render(),l.hidden&&(g.style.visibility="hidden"),k(this,Wc,Bc).call(this,g,l.id),f._isEditable&&(_(this,Dc).set(f.data.id,f),null===(m=this._annotationEditorUIManager)||void 0===m||m.renderAnnotationElement(f));case 32:t.next=8;break;case 34:t.next=39;break;case 36:t.prev=36,t.t0=t.catch(6),s.e(t.t0);case 39:return t.prev=39,s.f(),t.finish(39);case 42:k(this,Nc,Hc).call(this);case 43:case"end":return t.stop()}}),t,this,[[6,36,39,42]])})));return function(e){return t.apply(this,arguments)}}()},{key:"update",value:function(t){var e=t.viewport,i=this.div;this.viewport=e,Si(i,{rotation:e.rotation}),k(this,Nc,Hc).call(this),i.hidden=!1}},{key:"getEditableAnnotations",value:function(){return Array.from(_(this,Dc).values())}},{key:"getEditableAnnotation",value:function(t){return _(this,Dc).get(t)}}]),t}();function Bc(t,e){var i,n=t.firstChild||t;n.id="".concat(le).concat(e),this.div.append(t),null===(i=_(this,Ic))||void 0===i||i.moveElementInDOM(this.div,t,n,!1)}function Hc(){if(_(this,Fc)){var t,e=this.div,i=C(_(this,Fc));try{for(i.s();!(t=i.n()).done;){var n=(0,M.Z)(t.value,2),a=n[0],r=n[1],s=e.querySelector('[data-annotation-id="'.concat(a,'"]'));if(s){r.className="annotationContent";var o=s.firstChild;o?"CANVAS"===o.nodeName?o.replaceWith(r):o.classList.contains("annotationContent")?o.after(r):o.before(r):s.append(r)}}}catch(l){i.e(l)}finally{i.f()}_(this,Fc).clear()}}var zc=/\r\n?|\n/g,jc=new WeakMap,Uc=new WeakMap,Vc=new WeakMap,Gc=new WeakMap,qc=new WeakMap,Xc=new WeakMap,Kc=new WeakMap,Yc=new WeakMap,Qc=new WeakMap,Jc=new WeakMap,$c=new WeakSet,td=new WeakSet,ed=new WeakSet,id=new WeakSet,nd=new WeakSet,ad=new WeakSet,rd=new WeakSet,sd=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var a;return(0,T.Z)(this,i),a=e.call(this,(0,n.Z)((0,n.Z)({},t),{},{name:"freeTextEditor"})),y((0,g.Z)(a),rd),y((0,g.Z)(a),ad),y((0,g.Z)(a),nd),y((0,g.Z)(a),id),y((0,g.Z)(a),ed),y((0,g.Z)(a),td),y((0,g.Z)(a),$c),A((0,g.Z)(a),jc,{writable:!0,value:a.editorDivBlur.bind((0,g.Z)(a))}),A((0,g.Z)(a),Uc,{writable:!0,value:a.editorDivFocus.bind((0,g.Z)(a))}),A((0,g.Z)(a),Vc,{writable:!0,value:a.editorDivInput.bind((0,g.Z)(a))}),A((0,g.Z)(a),Gc,{writable:!0,value:a.editorDivKeydown.bind((0,g.Z)(a))}),A((0,g.Z)(a),qc,{writable:!0,value:a.editorDivPaste.bind((0,g.Z)(a))}),A((0,g.Z)(a),Xc,{writable:!0,value:void 0}),A((0,g.Z)(a),Kc,{writable:!0,value:""}),A((0,g.Z)(a),Yc,{writable:!0,value:"".concat(a.id,"-editor")}),A((0,g.Z)(a),Qc,{writable:!0,value:void 0}),A((0,g.Z)(a),Jc,{writable:!0,value:null}),x((0,g.Z)(a),Xc,t.color||i._defaultColor||Gr._defaultLineColor),x((0,g.Z)(a),Qc,t.fontSize||i._defaultFontSize),a}return(0,Z.Z)(i,[{key:"updateParams",value:function(t,e){switch(t){case K.FREETEXT_SIZE:k(this,$c,od).call(this,e);break;case K.FREETEXT_COLOR:k(this,td,ld).call(this,e)}}},{key:"propertiesToUpdate",get:function(){return[[K.FREETEXT_SIZE,_(this,Qc)],[K.FREETEXT_COLOR,_(this,Xc)]]}},{key:"_translateEmpty",value:function(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}},{key:"getInitialTranslation",value:function(){var t=this.parentScale;return[-i._internalPadding*t,-(i._internalPadding+_(this,Qc))*t]}},{key:"rebuild",value:function(){this.parent&&(h((0,o.Z)(i.prototype),"rebuild",this).call(this),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}},{key:"enableEditMode",value:function(){if(!this.isInEditMode()){this.parent.setEditingState(!1),this.parent.updateToolbar(X.FREETEXT),h((0,o.Z)(i.prototype),"enableEditMode",this).call(this),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant");var t=this._uiManager._signal;this.editorDiv.addEventListener("keydown",_(this,Gc),{signal:t}),this.editorDiv.addEventListener("focus",_(this,Uc),{signal:t}),this.editorDiv.addEventListener("blur",_(this,jc),{signal:t}),this.editorDiv.addEventListener("input",_(this,Vc),{signal:t}),this.editorDiv.addEventListener("paste",_(this,qc),{signal:t})}}},{key:"disableEditMode",value:function(){this.isInEditMode()&&(this.parent.setEditingState(!0),h((0,o.Z)(i.prototype),"disableEditMode",this).call(this),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",_(this,Yc)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",_(this,Gc)),this.editorDiv.removeEventListener("focus",_(this,Uc)),this.editorDiv.removeEventListener("blur",_(this,jc)),this.editorDiv.removeEventListener("input",_(this,Vc)),this.editorDiv.removeEventListener("paste",_(this,qc)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}},{key:"focusin",value:function(t){this._focusEventsAllowed&&(h((0,o.Z)(i.prototype),"focusin",this).call(this,t),t.target!==this.editorDiv&&this.editorDiv.focus())}},{key:"onceAdded",value:function(){var t;this.width||(this.enableEditMode(),this.editorDiv.focus(),null!==(t=this._initialOptions)&&void 0!==t&&t.isCentered&&this.center(),this._initialOptions=null)}},{key:"isEmpty",value:function(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}},{key:"remove",value:function(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),h((0,o.Z)(i.prototype),"remove",this).call(this)}},{key:"commit",value:function(){var t=this;if(this.isInEditMode()){h((0,o.Z)(i.prototype),"commit",this).call(this),this.disableEditMode();var e=_(this,Kc),n=x(this,Kc,k(this,ed,hd).call(this).trimEnd());if(e!==n){var a=function(e){x(t,Kc,e),e?(k(t,nd,dd).call(t),t._uiManager.rebuild(t),k(t,id,ud).call(t)):t.remove()};this.addCommands({cmd:function(){a(n)},undo:function(){a(e)},mustExec:!1}),k(this,id,ud).call(this)}}}},{key:"shouldGetKeyboardEvents",value:function(){return this.isInEditMode()}},{key:"enterInEditMode",value:function(){this.enableEditMode(),this.editorDiv.focus()}},{key:"dblclick",value:function(t){this.enterInEditMode()}},{key:"keydown",value:function(t){t.target===this.div&&"Enter"===t.key&&(this.enterInEditMode(),t.preventDefault())}},{key:"editorDivKeydown",value:function(t){i._keyboardManager.exec(this,t)}},{key:"editorDivFocus",value:function(t){this.isEditing=!0}},{key:"editorDivBlur",value:function(t){this.isEditing=!1}},{key:"editorDivInput",value:function(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}},{key:"disableEditing",value:function(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}},{key:"enableEditing",value:function(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}},{key:"render",value:function(){var t,e,n=this;if(this.div)return this.div;this.width&&(t=this.x,e=this.y),h((0,o.Z)(i.prototype),"render",this).call(this),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",_(this,Yc)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),Gr._l10nPromise.get("pdfjs-free-text-default-content").then((function(t){var e;return null===(e=n.editorDiv)||void 0===e?void 0:e.setAttribute("default-content",t)})),this.editorDiv.contentEditable=!0;var a=this.editorDiv.style;if(a.fontSize="calc(".concat(_(this,Qc),"px * var(--scale-factor))"),a.color=_(this,Xc),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Ji(this,this.div,["dblclick","keydown"]),this.width){var r=(0,M.Z)(this.parentDimensions,2),s=r[0],l=r[1];if(this.annotationElementId){var u=_(this,Jc).position,c=this.getInitialTranslation(),d=(0,M.Z)(c,2),v=d[0],f=d[1],p=this.pageTranslationToScreen(v,f),g=(0,M.Z)(p,2);v=g[0],f=g[1];var m,y,b=(0,M.Z)(this.pageDimensions,2),w=b[0],A=b[1],x=(0,M.Z)(this.pageTranslation,2),S=x[0],E=x[1];switch(this.rotation){case 0:m=t+(u[0]-S)/w,y=e+this.height-(u[1]-E)/A;break;case 90:m=t+(u[0]-S)/w,y=e-(u[1]-E)/A;var C=[f,-v];v=C[0],f=C[1];break;case 180:m=t-this.width+(u[0]-S)/w,y=e-(u[1]-E)/A;var Z=[-v,-f];v=Z[0],f=Z[1];break;case 270:m=t+(u[0]-S-this.height*A)/w,y=e+(u[1]-E-this.width*w)/A;var T=[-f,v];v=T[0],f=T[1]}this.setAt(m*s,y*l,v,f)}else this.setAt(t*s,e*l,this.width*s,this.height*l);k(this,nd,dd).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}},{key:"editorDivPaste",value:function(t){var e=t.clipboardData||window.clipboardData,n=e.types;if(1!==n.length||"text/plain"!==n[0]){t.preventDefault();var a=S(i,i,fd).call(i,e.getData("text")||"").replaceAll(zc,"\n");if(a){var r=window.getSelection();if(r.rangeCount){this.editorDiv.normalize(),r.deleteFromDocument();var s=r.getRangeAt(0);if(!a.includes("\n"))return s.insertNode(document.createTextNode(a)),this.editorDiv.normalize(),void r.collapseToStart();var o=s.startContainer,l=s.startOffset,h=[],u=[];if(o.nodeType===Node.TEXT_NODE){var c=o.parentElement;if(u.push(o.nodeValue.slice(l).replaceAll(zc,"")),c!==this.editorDiv){var d,v=h,f=C(this.editorDiv.childNodes);try{for(f.s();!(d=f.n()).done;){var p=d.value;p!==c?v.push(S(i,i,cd).call(i,p)):v=u}}catch(R){f.e(R)}finally{f.f()}}h.push(o.nodeValue.slice(0,l).replaceAll(zc,""))}else if(o===this.editorDiv){var g,m=h,y=0,b=C(this.editorDiv.childNodes);try{for(b.s();!(g=b.n()).done;){var w=g.value;y++===l&&(m=u),m.push(S(i,i,cd).call(i,w))}}catch(R){b.e(R)}finally{b.f()}}x(this,Kc,"".concat(h.join("\n")).concat(a).concat(u.join("\n"))),k(this,nd,dd).call(this);var A,_=new Range,M=h.reduce((function(t,e){return t+e.length}),0),E=C(this.editorDiv.childNodes);try{for(E.s();!(A=E.n()).done;){var Z=A.value.firstChild;if(Z.nodeType===Node.TEXT_NODE){var T=Z.nodeValue.length;if(M<=T){_.setStart(Z,M),_.setEnd(Z,M);break}M-=T}}}catch(R){E.e(R)}finally{E.f()}r.removeAllRanges(),r.addRange(_)}}}}},{key:"contentDiv",get:function(){return this.editorDiv}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};var e=i._internalPadding*this.parentScale,n=this.getRect(e,e),a=Gr._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:_(this,Xc)),r={annotationType:X.FREETEXT,color:a,fontSize:_(this,Qc),value:k(this,ad,vd).call(this),pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?r:this.annotationElementId&&!k(this,rd,pd).call(this,r)?null:(r.id=this.annotationElementId,r)}},{key:"renderAnnotationElement",value:function(t){var e=h((0,o.Z)(i.prototype),"renderAnnotationElement",this).call(this,t);if(this.deleted)return e;var n=e.style;n.fontSize="calc(".concat(_(this,Qc),"px * var(--scale-factor))"),n.color=_(this,Xc),e.replaceChildren();var a,r=C(_(this,Kc).split("\n"));try{for(r.s();!(a=r.n()).done;){var s=a.value,l=document.createElement("div");l.append(s?document.createTextNode(s):document.createElement("br")),e.append(l)}}catch(c){r.e(c)}finally{r.f()}var u=i._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(u,u),popupContent:_(this,Kc)}),e}},{key:"resetAnnotationElement",value:function(t){h((0,o.Z)(i.prototype),"resetAnnotationElement",this).call(this,t),t.resetEdited()}}],[{key:"_keyboardManager",get:function(){var t=i.prototype,e=function(t){return t.isEmpty()},n=Pa.TRANSLATE_SMALL,a=Pa.TRANSLATE_BIG;return Bt(this,"_keyboardManager",new pn([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-a,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[a,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-a],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,a],checker:e}]]))}},{key:"initialize",value:function(t,e){Gr.initialize(t,e,{strings:["pdfjs-free-text-default-content"]});var i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}},{key:"updateDefaultParams",value:function(t,e){switch(t){case K.FREETEXT_SIZE:i._defaultFontSize=e;break;case K.FREETEXT_COLOR:i._defaultColor=e}}},{key:"defaultPropertiesToUpdate",get:function(){return[[K.FREETEXT_SIZE,i._defaultFontSize],[K.FREETEXT_COLOR,i._defaultColor||Gr._defaultLineColor]]}},{key:"deserialize",value:function(t,e,n){var a=null;if(t instanceof dc){var r=t,s=r.data,l=s.defaultAppearanceData,u=l.fontSize,c=l.fontColor,d=s.rect,v=s.rotation,f=s.id,g=r.textContent,m=r.textPosition,y=r.parent.page.pageNumber;if(!g||0===g.length)return null;a=t={annotationType:X.FREETEXT,color:Array.from(c),fontSize:u,value:g.join("\n"),position:m,pageIndex:y-1,rect:d.slice(0),rotation:v,id:f,deleted:!1}}var k=h((0,o.Z)(i),"deserialize",this).call(this,t,e,n);return x(k,Qc,t.fontSize),x(k,Xc,te.makeHexColor.apply(te,(0,p.Z)(t.color))),x(k,Kc,S(i,i,fd).call(i,t.value)),k.annotationElementId=t.id||null,x(k,Jc,a),k}}]),i}(Gr);function od(t){var e=this,i=function(t){e.editorDiv.style.fontSize="calc(".concat(t,"px * var(--scale-factor))"),e.translate(0,-(t-_(e,Qc))*e.parentScale),x(e,Qc,t),k(e,id,ud).call(e)},n=_(this,Qc);this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}function ld(t){var e=this,i=function(t){x(e,Xc,e.editorDiv.style.color=t)},n=_(this,Xc);this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}function hd(){var t=[];this.editorDiv.normalize();var e,i=C(this.editorDiv.childNodes);try{for(i.s();!(e=i.n()).done;){var n=e.value;t.push(S(sd,sd,cd).call(sd,n))}}catch(a){i.e(a)}finally{i.f()}return t.join("\n")}function ud(){var t,e=(0,M.Z)(this.parentDimensions,2),i=e[0],n=e[1];if(this.isAttachedToDOM)t=this.div.getBoundingClientRect();else{var a=this.currentLayer,r=this.div,s=r.style.display,o=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",a.div.append(this.div),t=r.getBoundingClientRect(),r.remove(),r.style.display=s,r.classList.toggle("hidden",o)}this.rotation%180===this.parentRotation%180?(this.width=t.width/i,this.height=t.height/n):(this.width=t.height/i,this.height=t.width/n),this.fixAndSetPosition()}function cd(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(zc,"")}function dd(){if(this.editorDiv.replaceChildren(),_(this,Kc)){var t,e=C(_(this,Kc).split("\n"));try{for(e.s();!(t=e.n()).done;){var i=t.value,n=document.createElement("div");n.append(i?document.createTextNode(i):document.createElement("br")),this.editorDiv.append(n)}}catch(a){e.e(a)}finally{e.f()}}}function vd(){return _(this,Kc).replaceAll("\xa0"," ")}function fd(t){return t.replaceAll(" ","\xa0")}function pd(t){var e=_(this,Jc),i=e.value,n=e.fontSize,a=e.color,r=e.pageIndex;return this._hasBeenMoved||t.value!==i||t.fontSize!==n||t.color.some((function(t,e){return t!==a[e]}))||t.pageIndex!==r}(0,b.Z)(sd,"_freeTextDefaultContent",""),(0,b.Z)(sd,"_internalPadding",0),(0,b.Z)(sd,"_defaultColor",null),(0,b.Z)(sd,"_defaultFontSize",10),(0,b.Z)(sd,"_type","freetext"),(0,b.Z)(sd,"_editorType",X.FREETEXT);var gd=new WeakMap,md=new WeakMap,yd=new WeakMap,kd=new WeakSet,bd=new WeakSet,wd=new WeakSet,Ad=new WeakSet,_d=new WeakSet,xd=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];(0,T.Z)(this,t),y(this,_d),y(this,Ad),y(this,wd),y(this,bd),y(this,kd),A(this,gd,{writable:!0,value:void 0}),A(this,md,{writable:!0,value:[]}),A(this,yd,{writable:!0,value:[]});var r,s=1/0,o=-1/0,l=1/0,h=-1/0,u=4,c=Math.pow(10,-u),d=C(e);try{for(d.s();!(r=d.n()).done;){var v=r.value,f=v.x,p=v.y,g=v.width,m=v.height,k=Math.floor((f-i)/c)*c,b=Math.ceil((f+g+i)/c)*c,w=Math.floor((p-i)/c)*c,S=Math.ceil((p+m+i)/c)*c,E=[k,w,S,!0],Z=[b,w,S,!1];_(this,md).push(E,Z),s=Math.min(s,k),o=Math.max(o,b),l=Math.min(l,w),h=Math.max(h,S)}}catch(U){d.e(U)}finally{d.f()}var R,P=o-s+2*n,L=h-l+2*n,I=s-n,F=l-n,D=_(this,md).at(a?-1:-2),W=[D[0],D[2]],N=C(_(this,md));try{for(N.s();!(R=N.n()).done;){var O=R.value,B=(0,M.Z)(O,3),H=B[0],z=B[1],j=B[2];O[0]=(H-I)/P,O[1]=(z-F)/L,O[2]=(j-F)/L}}catch(U){N.e(U)}finally{N.f()}x(this,gd,{x:I,y:F,width:P,height:L,lastPoint:W})}return(0,Z.Z)(t,[{key:"getOutlines",value:function(){_(this,md).sort((function(t,e){return t[0]-e[0]||t[1]-e[1]||t[2]-e[2]}));var t,e=[],i=C(_(this,md));try{for(i.s();!(t=i.n()).done;){var n=t.value;n[3]?(e.push.apply(e,(0,p.Z)(k(this,_d,Zd).call(this,n))),k(this,wd,Ed).call(this,n)):(k(this,Ad,Cd).call(this,n),e.push.apply(e,(0,p.Z)(k(this,_d,Zd).call(this,n))))}}catch(a){i.e(a)}finally{i.f()}return k(this,kd,Sd).call(this,e)}}]),t}();function Sd(t){var e,i=[],n=new Set,a=C(t);try{for(a.s();!(e=a.n()).done;){var r=e.value,s=(0,M.Z)(r,3),o=s[0],l=s[1],h=s[2];i.push([o,l,r],[o,h,r])}}catch(R){a.e(R)}finally{a.f()}i.sort((function(t,e){return t[1]-e[1]||t[0]-e[0]}));for(var u=0,c=i.length;u<c;u+=2){var d=i[u][2],v=i[u+1][2];d.push(v),v.push(d),n.add(d),n.add(v)}for(var f,p=[];n.size>0;){var g=n.values().next().value,m=(0,M.Z)(g,5),y=m[0],k=m[1],b=m[2],w=m[3],A=m[4];n.delete(g);var x=y,S=k;for(f=[y,b],p.push(f);;){var E=void 0;if(n.has(w))E=w;else{if(!n.has(A))break;E=A}n.delete(E);var Z=E,T=(0,M.Z)(Z,5);y=T[0],k=T[1],b=T[2],w=T[3],A=T[4],x!==y&&(f.push(x,S,y,S===k?k:b),x=y),S=S===k?b:k}f.push(x,S)}return new Ld(p,_(this,gd))}function Md(t){for(var e=_(this,yd),i=0,n=e.length-1;i<=n;){var a=i+n>>1,r=e[a][0];if(r===t)return a;r<t?i=a+1:n=a-1}return n+1}function Ed(t){var e=(0,M.Z)(t,3),i=e[1],n=e[2],a=k(this,bd,Md).call(this,i);_(this,yd).splice(a,0,[i,n])}function Cd(t){for(var e=(0,M.Z)(t,3),i=e[1],n=e[2],a=k(this,bd,Md).call(this,i),r=a;r<_(this,yd).length;r++){var s=(0,M.Z)(_(this,yd)[r],2),o=s[0],l=s[1];if(o!==i)break;if(o===i&&l===n)return void _(this,yd).splice(r,1)}for(var h=a-1;h>=0;h--){var u=(0,M.Z)(_(this,yd)[h],2),c=u[0],d=u[1];if(c!==i)break;if(c===i&&d===n)return void _(this,yd).splice(h,1)}}function Zd(t){for(var e=(0,M.Z)(t,3),i=e[0],n=e[1],a=e[2],r=[[i,n,a]],s=k(this,bd,Md).call(this,a),o=0;o<s;o++)for(var l=(0,M.Z)(_(this,yd)[o],2),h=l[0],u=l[1],c=0,d=r.length;c<d;c++){var v=(0,M.Z)(r[c],3),f=v[1],p=v[2];if(!(u<=f||p<=h))if(f>=h)if(p>u)r[c][1]=u;else{if(1===d)return[];r.splice(c,1),c--,d--}else r[c][2]=h,p>u&&r.push([i,u,p])}return r}var Td=function(){function t(){(0,T.Z)(this,t)}return(0,Z.Z)(t,[{key:"toSVGPath",value:function(){throw new Error("Abstract method `toSVGPath` must be implemented.")}},{key:"box",get:function(){throw new Error("Abstract getter `box` must be implemented.")}},{key:"serialize",value:function(t,e){throw new Error("Abstract method `serialize` must be implemented.")}},{key:"free",get:function(){return this instanceof lv}}]),t}(),Rd=new WeakMap,Pd=new WeakMap,Ld=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t,n){var a;return(0,T.Z)(this,i),a=e.call(this),A((0,g.Z)(a),Rd,{writable:!0,value:void 0}),A((0,g.Z)(a),Pd,{writable:!0,value:void 0}),x((0,g.Z)(a),Pd,t),x((0,g.Z)(a),Rd,n),a}return(0,Z.Z)(i,[{key:"toSVGPath",value:function(){var t,e=[],i=C(_(this,Pd));try{for(i.s();!(t=i.n()).done;){var n=t.value,a=(0,M.Z)(n,2),r=a[0],s=a[1];e.push("M".concat(r," ").concat(s));for(var o=2;o<n.length;o+=2){var l=n[o],h=n[o+1];l===r?(e.push("V".concat(h)),s=h):h===s&&(e.push("H".concat(l)),r=l)}e.push("Z")}}catch(u){i.e(u)}finally{i.f()}return e.join(" ")}},{key:"serialize",value:function(t,e){var i,n=(0,M.Z)(t,4),a=n[0],r=n[1],s=n[2],o=n[3],l=[],h=s-a,u=o-r,c=C(_(this,Pd));try{for(c.s();!(i=c.n()).done;){for(var d=i.value,v=new Array(d.length),f=0;f<d.length;f+=2)v[f]=a+d[f]*h,v[f+1]=o-d[f+1]*u;l.push(v)}}catch(p){c.e(p)}finally{c.f()}return l}},{key:"box",get:function(){return _(this,Rd)}}]),i}(Td),Id=new WeakMap,Fd=new WeakMap,Dd=new WeakMap,Wd=new WeakMap,Nd=new WeakMap,Od=new WeakMap,Bd=new WeakMap,Hd=new WeakMap,zd=new WeakMap,jd=new WeakMap,Ud=new WeakMap,Vd=new WeakMap,Gd=new WeakMap,qd=new WeakSet,Xd=function(){function t(e,i,n,a,r){var s=e.x,o=e.y,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;(0,T.Z)(this,t),y(this,qd),A(this,Id,{writable:!0,value:void 0}),A(this,Fd,{writable:!0,value:[]}),A(this,Dd,{writable:!0,value:void 0}),A(this,Wd,{writable:!0,value:void 0}),A(this,Nd,{writable:!0,value:[]}),A(this,Od,{writable:!0,value:new Float64Array(18)}),A(this,Bd,{writable:!0,value:void 0}),A(this,Hd,{writable:!0,value:void 0}),A(this,zd,{writable:!0,value:void 0}),A(this,jd,{writable:!0,value:void 0}),A(this,Ud,{writable:!0,value:void 0}),A(this,Vd,{writable:!0,value:void 0}),A(this,Gd,{writable:!0,value:[]}),x(this,Id,i),x(this,Vd,a*n),x(this,Wd,r),_(this,Od).set([NaN,NaN,NaN,NaN,s,o],6),x(this,Dd,l),x(this,jd,f(t,t,Yd)*n),x(this,zd,f(t,t,Qd)*n),x(this,Ud,n),_(this,Gd).push(s,o)}return(0,Z.Z)(t,[{key:"free",get:function(){return!0}},{key:"isEmpty",value:function(){return isNaN(_(this,Od)[8])}},{key:"add",value:function(t){var e,i=t.x,n=t.y;x(this,Bd,i),x(this,Hd,n);var a=_(this,Id),r=(0,M.Z)(a,4),s=r[0],o=r[1],l=r[2],h=r[3],u=_(this,Od).subarray(8,12),c=(0,M.Z)(u,4),d=c[0],v=c[1],f=c[2],p=c[3],g=i-f,m=n-p,y=Math.hypot(g,m);if(y<_(this,zd))return!1;var k=y-_(this,jd),b=k/y,w=b*g,A=b*m,S=d,E=v;d=f,v=p,f+=w,p+=A,null===(e=_(this,Gd))||void 0===e||e.push(i,n);var C=w/k,Z=-A/k*_(this,Vd),T=C*_(this,Vd);if(_(this,Od).set(_(this,Od).subarray(2,8),0),_(this,Od).set([f+Z,p+T],4),_(this,Od).set(_(this,Od).subarray(14,18),12),_(this,Od).set([f-Z,p-T],16),isNaN(_(this,Od)[6]))return 0===_(this,Nd).length&&(_(this,Od).set([d+Z,v+T],2),_(this,Nd).push(NaN,NaN,NaN,NaN,(d+Z-s)/l,(v+T-o)/h),_(this,Od).set([d-Z,v-T],14),_(this,Fd).push(NaN,NaN,NaN,NaN,(d-Z-s)/l,(v-T-o)/h)),_(this,Od).set([S,E,d,v,f,p],6),!this.isEmpty();if(_(this,Od).set([S,E,d,v,f,p],6),Math.abs(Math.atan2(E-v,S-d)-Math.atan2(A,w))<Math.PI/2){var R=_(this,Od).subarray(2,6),P=(0,M.Z)(R,4);d=P[0],v=P[1],f=P[2],p=P[3],_(this,Nd).push(NaN,NaN,NaN,NaN,((d+f)/2-s)/l,((v+p)/2-o)/h);var L=_(this,Od).subarray(14,18),I=(0,M.Z)(L,4);return d=I[0],v=I[1],S=I[2],E=I[3],_(this,Fd).push(NaN,NaN,NaN,NaN,((S+d)/2-s)/l,((E+v)/2-o)/h),!0}var F=_(this,Od).subarray(0,6),D=(0,M.Z)(F,6);S=D[0],E=D[1],d=D[2],v=D[3],f=D[4],p=D[5],_(this,Nd).push(((S+5*d)/6-s)/l,((E+5*v)/6-o)/h,((5*d+f)/6-s)/l,((5*v+p)/6-o)/h,((d+f)/2-s)/l,((v+p)/2-o)/h);var W=_(this,Od).subarray(12,18),N=(0,M.Z)(W,6);return f=N[0],p=N[1],d=N[2],v=N[3],S=N[4],E=N[5],_(this,Fd).push(((S+5*d)/6-s)/l,((E+5*v)/6-o)/h,((5*d+f)/6-s)/l,((5*v+p)/6-o)/h,((d+f)/2-s)/l,((v+p)/2-o)/h),!0}},{key:"toSVGPath",value:function(){if(this.isEmpty())return"";var t=_(this,Nd),e=_(this,Fd),i=_(this,Od).subarray(4,6),n=_(this,Od).subarray(16,18),a=_(this,Id),r=(0,M.Z)(a,4),s=r[0],o=r[1],l=r[2],h=r[3],u=k(this,qd,Kd).call(this),c=(0,M.Z)(u,4),d=c[0],v=c[1],f=c[2],p=c[3];if(isNaN(_(this,Od)[6])&&!this.isEmpty())return"M".concat((_(this,Od)[2]-s)/l," ").concat((_(this,Od)[3]-o)/h," L").concat((_(this,Od)[4]-s)/l," ").concat((_(this,Od)[5]-o)/h," L").concat(d," ").concat(v," L").concat(f," ").concat(p," L").concat((_(this,Od)[16]-s)/l," ").concat((_(this,Od)[17]-o)/h," L").concat((_(this,Od)[14]-s)/l," ").concat((_(this,Od)[15]-o)/h," Z");var g=[];g.push("M".concat(t[4]," ").concat(t[5]));for(var m=6;m<t.length;m+=6)isNaN(t[m])?g.push("L".concat(t[m+4]," ").concat(t[m+5])):g.push("C".concat(t[m]," ").concat(t[m+1]," ").concat(t[m+2]," ").concat(t[m+3]," ").concat(t[m+4]," ").concat(t[m+5]));g.push("L".concat((i[0]-s)/l," ").concat((i[1]-o)/h," L").concat(d," ").concat(v," L").concat(f," ").concat(p," L").concat((n[0]-s)/l," ").concat((n[1]-o)/h));for(var y=e.length-6;y>=6;y-=6)isNaN(e[y])?g.push("L".concat(e[y+4]," ").concat(e[y+5])):g.push("C".concat(e[y]," ").concat(e[y+1]," ").concat(e[y+2]," ").concat(e[y+3]," ").concat(e[y+4]," ").concat(e[y+5]));return g.push("L".concat(e[4]," ").concat(e[5]," Z")),g.join(" ")}},{key:"getOutlines",value:function(){for(var t,e,i=_(this,Nd),n=_(this,Fd),a=_(this,Od),r=a.subarray(4,6),s=a.subarray(16,18),o=_(this,Id),l=(0,M.Z)(o,4),h=l[0],u=l[1],c=l[2],d=l[3],v=new Float64Array((null!==(t=null===(e=_(this,Gd))||void 0===e?void 0:e.length)&&void 0!==t?t:0)+2),f=0,p=v.length-2;f<p;f+=2)v[f]=(_(this,Gd)[f]-h)/c,v[f+1]=(_(this,Gd)[f+1]-u)/d;v[v.length-2]=(_(this,Bd)-h)/c,v[v.length-1]=(_(this,Hd)-u)/d;var g=k(this,qd,Kd).call(this),m=(0,M.Z)(g,4),y=m[0],b=m[1],w=m[2],A=m[3];if(isNaN(a[6])&&!this.isEmpty()){var x=new Float64Array(36);return x.set([NaN,NaN,NaN,NaN,(a[2]-h)/c,(a[3]-u)/d,NaN,NaN,NaN,NaN,(a[4]-h)/c,(a[5]-u)/d,NaN,NaN,NaN,NaN,y,b,NaN,NaN,NaN,NaN,w,A,NaN,NaN,NaN,NaN,(a[16]-h)/c,(a[17]-u)/d,NaN,NaN,NaN,NaN,(a[14]-h)/c,(a[15]-u)/d],0),new lv(x,v,_(this,Id),_(this,Ud),_(this,Dd),_(this,Wd))}for(var S=new Float64Array(_(this,Nd).length+24+_(this,Fd).length),E=i.length,C=0;C<E;C+=2)isNaN(i[C])?S[C]=S[C+1]=NaN:(S[C]=i[C],S[C+1]=i[C+1]);S.set([NaN,NaN,NaN,NaN,(r[0]-h)/c,(r[1]-u)/d,NaN,NaN,NaN,NaN,y,b,NaN,NaN,NaN,NaN,w,A,NaN,NaN,NaN,NaN,(s[0]-h)/c,(s[1]-u)/d],E),E+=24;for(var Z=n.length-6;Z>=6;Z-=6)for(var T=0;T<6;T+=2)isNaN(n[Z+T])?(S[E]=S[E+1]=NaN,E+=2):(S[E]=n[Z+T],S[E+1]=n[Z+T+1],E+=2);return S.set([NaN,NaN,NaN,NaN,n[4],n[5]],E),new lv(S,v,_(this,Id),_(this,Ud),_(this,Dd),_(this,Wd))}}]),t}();function Kd(){var t=_(this,Od).subarray(4,6),e=_(this,Od).subarray(16,18),i=_(this,Id),n=(0,M.Z)(i,4),a=n[0],r=n[1],s=n[2],o=n[3];return[(_(this,Bd)+(t[0]-e[0])/2-a)/s,(_(this,Hd)+(t[1]-e[1])/2-r)/o,(_(this,Bd)+(e[0]-t[0])/2-a)/s,(_(this,Hd)+(e[1]-t[1])/2-r)/o]}var Yd={writable:!0,value:8},Qd={writable:!0,value:f(Xd,Xd,Yd)+f(Xd,Xd,{writable:!0,value:2})},Jd=new WeakMap,$d=new WeakMap,tv=new WeakMap,ev=new WeakMap,iv=new WeakMap,nv=new WeakMap,av=new WeakMap,rv=new WeakSet,sv=new WeakSet,ov=new WeakSet,lv=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t,n,a,r,s,o){var l;(0,T.Z)(this,i),l=e.call(this),y((0,g.Z)(l),ov),y((0,g.Z)(l),sv),y((0,g.Z)(l),rv),A((0,g.Z)(l),Jd,{writable:!0,value:void 0}),A((0,g.Z)(l),$d,{writable:!0,value:null}),A((0,g.Z)(l),tv,{writable:!0,value:void 0}),A((0,g.Z)(l),ev,{writable:!0,value:void 0}),A((0,g.Z)(l),iv,{writable:!0,value:void 0}),A((0,g.Z)(l),nv,{writable:!0,value:void 0}),A((0,g.Z)(l),av,{writable:!0,value:void 0}),x((0,g.Z)(l),av,t),x((0,g.Z)(l),iv,n),x((0,g.Z)(l),Jd,a),x((0,g.Z)(l),nv,r),x((0,g.Z)(l),tv,s),x((0,g.Z)(l),ev,o),k((0,g.Z)(l),ov,cv).call((0,g.Z)(l),o);for(var h=_((0,g.Z)(l),$d),u=h.x,c=h.y,d=h.width,v=h.height,f=0,p=t.length;f<p;f+=2)t[f]=(t[f]-u)/d,t[f+1]=(t[f+1]-c)/v;for(var m=0,b=n.length;m<b;m+=2)n[m]=(n[m]-u)/d,n[m+1]=(n[m+1]-c)/v;return l}return(0,Z.Z)(i,[{key:"toSVGPath",value:function(){for(var t=["M".concat(_(this,av)[4]," ").concat(_(this,av)[5])],e=6,i=_(this,av).length;e<i;e+=6)isNaN(_(this,av)[e])?t.push("L".concat(_(this,av)[e+4]," ").concat(_(this,av)[e+5])):t.push("C".concat(_(this,av)[e]," ").concat(_(this,av)[e+1]," ").concat(_(this,av)[e+2]," ").concat(_(this,av)[e+3]," ").concat(_(this,av)[e+4]," ").concat(_(this,av)[e+5]));return t.push("Z"),t.join(" ")}},{key:"serialize",value:function(t,e){var i,n,a=(0,M.Z)(t,4),r=a[0],s=a[1],o=a[2],l=a[3],h=o-r,u=l-s;switch(e){case 0:i=k(this,rv,hv).call(this,_(this,av),r,l,h,-u),n=k(this,rv,hv).call(this,_(this,iv),r,l,h,-u);break;case 90:i=k(this,sv,uv).call(this,_(this,av),r,s,h,u),n=k(this,sv,uv).call(this,_(this,iv),r,s,h,u);break;case 180:i=k(this,rv,hv).call(this,_(this,av),o,s,-h,u),n=k(this,rv,hv).call(this,_(this,iv),o,s,-h,u);break;case 270:i=k(this,sv,uv).call(this,_(this,av),o,l,-h,-u),n=k(this,sv,uv).call(this,_(this,iv),o,l,-h,-u)}return{outline:Array.from(i),points:[Array.from(n)]}}},{key:"box",get:function(){return _(this,$d)}},{key:"getNewOutline",value:function(t,e){for(var i=_(this,$d),n=i.x,a=i.y,r=i.width,s=i.height,o=_(this,Jd),l=(0,M.Z)(o,4),h=l[0],u=l[1],c=l[2],d=l[3],v=r*c,f=s*d,p=n*c+h,g=a*d+u,m=new Xd({x:_(this,iv)[0]*v+p,y:_(this,iv)[1]*f+g},_(this,Jd),_(this,nv),t,_(this,ev),null!==e&&void 0!==e?e:_(this,tv)),y=2;y<_(this,iv).length;y+=2)m.add({x:_(this,iv)[y]*v+p,y:_(this,iv)[y+1]*f+g});return m.getOutlines()}}]),i}(Td);function hv(t,e,i,n,a){for(var r=new Float64Array(t.length),s=0,o=t.length;s<o;s+=2)r[s]=e+t[s]*n,r[s+1]=i+t[s+1]*a;return r}function uv(t,e,i,n,a){for(var r=new Float64Array(t.length),s=0,o=t.length;s<o;s+=2)r[s]=e+t[s+1]*n,r[s+1]=i+t[s]*a;return r}function cv(t){for(var e=_(this,av),i=e[4],n=e[5],a=i,r=n,s=i,o=n,l=i,h=n,u=t?Math.max:Math.min,c=6,d=e.length;c<d;c+=6){if(isNaN(e[c]))a=Math.min(a,e[c+4]),r=Math.min(r,e[c+5]),s=Math.max(s,e[c+4]),o=Math.max(o,e[c+5]),h<e[c+5]?(l=e[c+4],h=e[c+5]):h===e[c+5]&&(l=u(l,e[c+4]));else{var v=te.bezierBoundingBox.apply(te,[i,n].concat((0,p.Z)(e.slice(c,c+6))));a=Math.min(a,v[0]),r=Math.min(r,v[1]),s=Math.max(s,v[2]),o=Math.max(o,v[3]),h<v[3]?(l=v[2],h=v[3]):h===v[3]&&(l=u(l,v[2]))}i=e[c+4],n=e[c+5]}var f=a-_(this,tv),g=r-_(this,tv),m=s-a+2*_(this,tv),y=o-r+2*_(this,tv);x(this,$d,{x:f,y:g,width:m,height:y,lastPoint:[l,h]})}var dv=new WeakMap,vv=new WeakMap,fv=new WeakMap,pv=new WeakMap,gv=new WeakMap,mv=new WeakMap,yv=new WeakMap,kv=new WeakMap,bv=new WeakMap,wv=new WeakMap,Av=new WeakMap,_v=new WeakMap,xv=new WeakSet,Sv=new WeakSet,Mv=new WeakSet,Ev=new WeakSet,Cv=new WeakSet,Zv=new WeakMap,Tv=function(){function t(e){var i,n=e.editor,a=void 0===n?null:n,r=e.uiManager,s=void 0===r?null:r;(0,T.Z)(this,t),A(this,Zv,{get:Dv,set:void 0}),y(this,Cv),y(this,Ev),y(this,Mv),y(this,Sv),y(this,xv),A(this,dv,{writable:!0,value:k(this,Mv,Lv).bind(this)}),A(this,vv,{writable:!0,value:k(this,Cv,Fv).bind(this)}),A(this,fv,{writable:!0,value:null}),A(this,pv,{writable:!0,value:null}),A(this,gv,{writable:!0,value:void 0}),A(this,mv,{writable:!0,value:null}),A(this,yv,{writable:!0,value:!1}),A(this,kv,{writable:!0,value:!1}),A(this,bv,{writable:!0,value:null}),A(this,wv,{writable:!0,value:void 0}),A(this,Av,{writable:!0,value:null}),A(this,_v,{writable:!0,value:void 0}),a?(x(this,kv,!1),x(this,_v,K.HIGHLIGHT_COLOR),x(this,bv,a)):(x(this,kv,!0),x(this,_v,K.HIGHLIGHT_DEFAULT_COLOR)),x(this,Av,(null===a||void 0===a?void 0:a._uiManager)||s),x(this,wv,_(this,Av)._eventBus),x(this,gv,(null===a||void 0===a?void 0:a.color)||(null===(i=_(this,Av))||void 0===i?void 0:i.highlightColors.values().next().value)||"#FFFF98")}return(0,Z.Z)(t,[{key:"renderButton",value:function(){var t=x(this,fv,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);var e=_(this,Av)._signal;t.addEventListener("click",k(this,Ev,Iv).bind(this),{signal:e}),t.addEventListener("keydown",_(this,dv),{signal:e});var i=x(this,pv,document.createElement("span"));return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=_(this,gv),t.append(i),t}},{key:"renderMainDropdown",value:function(){var t=x(this,mv,k(this,xv,Rv).call(this));return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}},{key:"_colorSelectFromKeyboard",value:function(t){if(t.target!==_(this,fv)){var e=t.target.getAttribute("data-color");e&&k(this,Sv,Pv).call(this,e,t)}else k(this,Ev,Iv).call(this,t)}},{key:"_moveToNext",value:function(t){var e,i;_(this,Zv)?t.target!==_(this,fv)?null===(e=t.target.nextSibling)||void 0===e||e.focus():null===(i=_(this,mv).firstChild)||void 0===i||i.focus():k(this,Ev,Iv).call(this,t)}},{key:"_moveToPrevious",value:function(t){var e,i;t.target!==(null===(e=_(this,mv))||void 0===e?void 0:e.firstChild)&&t.target!==_(this,fv)?(_(this,Zv)||k(this,Ev,Iv).call(this,t),null===(i=t.target.previousSibling)||void 0===i||i.focus()):_(this,Zv)&&this._hideDropdownFromKeyboard()}},{key:"_moveToBeginning",value:function(t){var e;_(this,Zv)?null===(e=_(this,mv).firstChild)||void 0===e||e.focus():k(this,Ev,Iv).call(this,t)}},{key:"_moveToEnd",value:function(t){var e;_(this,Zv)?null===(e=_(this,mv).lastChild)||void 0===e||e.focus():k(this,Ev,Iv).call(this,t)}},{key:"hideDropdown",value:function(){var t;null===(t=_(this,mv))||void 0===t||t.classList.add("hidden"),window.removeEventListener("pointerdown",_(this,vv))}},{key:"_hideDropdownFromKeyboard",value:function(){var t;_(this,kv)||(_(this,Zv)?(this.hideDropdown(),_(this,fv).focus({preventScroll:!0,focusVisible:_(this,yv)})):null===(t=_(this,bv))||void 0===t||t.unselect())}},{key:"updateColor",value:function(t){if(_(this,pv)&&(_(this,pv).style.backgroundColor=t),_(this,mv)){var e,i=_(this,Av).highlightColors.values(),n=C(_(this,mv).children);try{for(n.s();!(e=n.n()).done;){e.value.setAttribute("aria-selected",i.next().value===t)}}catch(a){n.e(a)}finally{n.f()}}}},{key:"destroy",value:function(){var t,e;null===(t=_(this,fv))||void 0===t||t.remove(),x(this,fv,null),x(this,pv,null),null===(e=_(this,mv))||void 0===e||e.remove(),x(this,mv,null)}}],[{key:"_keyboardManager",get:function(){return Bt(this,"_keyboardManager",new pn([[["Escape","mac+Escape"],t.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],t.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],t.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],t.prototype._moveToPrevious],[["Home","mac+Home"],t.prototype._moveToBeginning],[["End","mac+End"],t.prototype._moveToEnd]]))}}]),t}();function Rv(){var t=document.createElement("div"),e=_(this,Av)._signal;t.addEventListener("contextmenu",ki,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");var i,n=C(_(this,Av).highlightColors);try{for(n.s();!(i=n.n()).done;){var a=(0,M.Z)(i.value,2),r=a[0],s=a[1],o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",s),o.title=r,o.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-".concat(r));var l=document.createElement("span");o.append(l),l.className="swatch",l.style.backgroundColor=s,o.setAttribute("aria-selected",s===_(this,gv)),o.addEventListener("click",k(this,Sv,Pv).bind(this,s),{signal:e}),t.append(o)}}catch(h){n.e(h)}finally{n.f()}return t.addEventListener("keydown",_(this,dv),{signal:e}),t}function Pv(t,e){e.stopPropagation(),_(this,wv).dispatch("switchannotationeditorparams",{source:this,type:_(this,_v),value:t})}function Lv(t){Tv._keyboardManager.exec(this,t)}function Iv(t){if(_(this,Zv))this.hideDropdown();else if(x(this,yv,0===t.detail),window.addEventListener("pointerdown",_(this,vv),{signal:_(this,Av)._signal}),_(this,mv))_(this,mv).classList.remove("hidden");else{var e=x(this,mv,k(this,xv,Rv).call(this));_(this,fv).append(e)}}function Fv(t){var e;null!==(e=_(this,mv))&&void 0!==e&&e.contains(t.target)||this.hideDropdown()}function Dv(){return _(this,mv)&&!_(this,mv).classList.contains("hidden")}var Wv=new WeakMap,Nv=new WeakMap,Ov=new WeakMap,Bv=new WeakMap,Hv=new WeakMap,zv=new WeakMap,jv=new WeakMap,Uv=new WeakMap,Vv=new WeakMap,Gv=new WeakMap,qv=new WeakMap,Xv=new WeakMap,Kv=new WeakMap,Yv=new WeakMap,Qv=new WeakMap,Jv=new WeakMap,$v=new WeakMap,tf=new WeakMap,ef=new WeakMap,nf=new WeakSet,af=new WeakSet,rf=new WeakSet,sf=new WeakSet,of=new WeakSet,lf=new WeakSet,hf=new WeakSet,uf=new WeakSet,cf=new WeakSet,df=new WeakSet,vf=new WeakSet,ff=new WeakSet,pf=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var a;return(0,T.Z)(this,i),a=e.call(this,(0,n.Z)((0,n.Z)({},t),{},{name:"highlightEditor"})),y((0,g.Z)(a),ff),y((0,g.Z)(a),vf),y((0,g.Z)(a),df),y((0,g.Z)(a),cf),y((0,g.Z)(a),uf),y((0,g.Z)(a),hf),y((0,g.Z)(a),lf),y((0,g.Z)(a),of),y((0,g.Z)(a),sf),y((0,g.Z)(a),rf),y((0,g.Z)(a),af),y((0,g.Z)(a),nf),A((0,g.Z)(a),Wv,{writable:!0,value:null}),A((0,g.Z)(a),Nv,{writable:!0,value:0}),A((0,g.Z)(a),Ov,{writable:!0,value:void 0}),A((0,g.Z)(a),Bv,{writable:!0,value:null}),A((0,g.Z)(a),Hv,{writable:!0,value:null}),A((0,g.Z)(a),zv,{writable:!0,value:null}),A((0,g.Z)(a),jv,{writable:!0,value:null}),A((0,g.Z)(a),Uv,{writable:!0,value:0}),A((0,g.Z)(a),Vv,{writable:!0,value:null}),A((0,g.Z)(a),Gv,{writable:!0,value:null}),A((0,g.Z)(a),qv,{writable:!0,value:null}),A((0,g.Z)(a),Xv,{writable:!0,value:!1}),A((0,g.Z)(a),Kv,{writable:!0,value:k((0,g.Z)(a),uf,xf).bind((0,g.Z)(a))}),A((0,g.Z)(a),Yv,{writable:!0,value:null}),A((0,g.Z)(a),Qv,{writable:!0,value:void 0}),A((0,g.Z)(a),Jv,{writable:!0,value:null}),A((0,g.Z)(a),$v,{writable:!0,value:""}),A((0,g.Z)(a),tf,{writable:!0,value:void 0}),A((0,g.Z)(a),ef,{writable:!0,value:""}),a.color=t.color||i._defaultColor,x((0,g.Z)(a),tf,t.thickness||i._defaultThickness),x((0,g.Z)(a),Qv,t.opacity||i._defaultOpacity),x((0,g.Z)(a),Ov,t.boxes||null),x((0,g.Z)(a),ef,t.methodOfCreation||""),x((0,g.Z)(a),$v,t.text||""),a._isDraggable=!1,t.highlightId>-1?(x((0,g.Z)(a),Xv,!0),k((0,g.Z)(a),af,mf).call((0,g.Z)(a),t),k((0,g.Z)(a),hf,Af).call((0,g.Z)(a))):(x((0,g.Z)(a),Wv,t.anchorNode),x((0,g.Z)(a),Nv,t.anchorOffset),x((0,g.Z)(a),jv,t.focusNode),x((0,g.Z)(a),Uv,t.focusOffset),k((0,g.Z)(a),nf,gf).call((0,g.Z)(a)),k((0,g.Z)(a),hf,Af).call((0,g.Z)(a)),a.rotate(a.rotation)),a}return(0,Z.Z)(i,[{key:"telemetryInitialData",get:function(){return{action:"added",type:_(this,Xv)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:_(this,tf),methodOfCreation:_(this,ef)}}},{key:"telemetryFinalData",get:function(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}},{key:"translateInPage",value:function(t,e){}},{key:"toolbarPosition",get:function(){return _(this,Yv)}},{key:"updateParams",value:function(t,e){switch(t){case K.HIGHLIGHT_COLOR:k(this,rf,yf).call(this,e);break;case K.HIGHLIGHT_THICKNESS:k(this,sf,kf).call(this,e)}}},{key:"propertiesToUpdate",get:function(){return[[K.HIGHLIGHT_COLOR,this.color||i._defaultColor],[K.HIGHLIGHT_THICKNESS,_(this,tf)||i._defaultThickness],[K.HIGHLIGHT_FREE,_(this,Xv)]]}},{key:"addEditToolbar",value:function(){var t=(0,w.Z)(L.mark((function t(){var e;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h((0,o.Z)(i.prototype),"addEditToolbar",this).call(this);case 2:if(e=t.sent){t.next=5;break}return t.abrupt("return",null);case 5:return this._uiManager.highlightColors&&(x(this,Hv,new Tv({editor:this})),e.addColorPicker(_(this,Hv))),t.abrupt("return",e);case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"disableEditing",value:function(){h((0,o.Z)(i.prototype),"disableEditing",this).call(this),this.div.classList.toggle("disabled",!0)}},{key:"enableEditing",value:function(){h((0,o.Z)(i.prototype),"enableEditing",this).call(this),this.div.classList.toggle("disabled",!1)}},{key:"fixAndSetPosition",value:function(){return h((0,o.Z)(i.prototype),"fixAndSetPosition",this).call(this,k(this,df,Mf).call(this))}},{key:"getBaseTranslation",value:function(){return[0,0]}},{key:"getRect",value:function(t,e){return h((0,o.Z)(i.prototype),"getRect",this).call(this,t,e,k(this,df,Mf).call(this))}},{key:"onceAdded",value:function(){this.parent.addUndoableEditor(this),this.div.focus()}},{key:"remove",value:function(){k(this,lf,wf).call(this),this._reportTelemetry({action:"deleted"}),h((0,o.Z)(i.prototype),"remove",this).call(this)}},{key:"rebuild",value:function(){this.parent&&(h((0,o.Z)(i.prototype),"rebuild",this).call(this),null!==this.div&&(k(this,hf,Af).call(this),this.isAttachedToDOM||this.parent.add(this)))}},{key:"setParent",value:function(t){var e=!1;if(this.parent&&!t)k(this,lf,wf).call(this);else if(t){var n;k(this,hf,Af).call(this,t),e=!this.parent&&(null===(n=this.div)||void 0===n?void 0:n.classList.contains("selectedEditor"))}h((0,o.Z)(i.prototype),"setParent",this).call(this,t),this.show(this._isVisible),e&&this.select()}},{key:"rotate",value:function(t){var e,n=this.parent.drawLayer;_(this,Xv)?(t=(t-this.rotation+360)%360,e=S(i,i,_f).call(i,_(this,Gv).box,t)):e=S(i,i,_f).call(i,this,t),n.rotate(_(this,qv),t),n.rotate(_(this,Jv),t),n.updateBox(_(this,qv),e),n.updateBox(_(this,Jv),S(i,i,_f).call(i,_(this,zv).box,t))}},{key:"render",value:function(){if(this.div)return this.div;var t=h((0,o.Z)(i.prototype),"render",this).call(this);_(this,$v)&&(t.setAttribute("aria-label",_(this,$v)),t.setAttribute("role","mark")),_(this,Xv)?t.classList.add("free"):this.div.addEventListener("keydown",_(this,Kv),{signal:this._uiManager._signal});var e=x(this,Vv,document.createElement("div"));t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=_(this,Bv);var n=(0,M.Z)(this.parentDimensions,2),a=n[0],r=n[1];return this.setDims(this.width*a,this.height*r),Ji(this,_(this,Vv),["pointerover","pointerleave"]),this.enableEditing(),t}},{key:"pointerover",value:function(){this.parent.drawLayer.addClass(_(this,Jv),"hovered")}},{key:"pointerleave",value:function(){this.parent.drawLayer.removeClass(_(this,Jv),"hovered")}},{key:"_moveCaret",value:function(t){switch(this.parent.unselect(this),t){case 0:case 2:k(this,cf,Sf).call(this,!0);break;case 1:case 3:k(this,cf,Sf).call(this,!1)}}},{key:"select",value:function(){var t,e;h((0,o.Z)(i.prototype),"select",this).call(this),_(this,Jv)&&(null===(t=this.parent)||void 0===t||t.drawLayer.removeClass(_(this,Jv),"hovered"),null===(e=this.parent)||void 0===e||e.drawLayer.addClass(_(this,Jv),"selected"))}},{key:"unselect",value:function(){var t;h((0,o.Z)(i.prototype),"unselect",this).call(this),_(this,Jv)&&(null===(t=this.parent)||void 0===t||t.drawLayer.removeClass(_(this,Jv),"selected"),_(this,Xv)||k(this,cf,Sf).call(this,!1))}},{key:"_mustFixPosition",get:function(){return!_(this,Xv)}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;h((0,o.Z)(i.prototype),"show",this).call(this,t),this.parent&&(this.parent.drawLayer.show(_(this,qv),t),this.parent.drawLayer.show(_(this,Jv),t))}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty()||t)return null;var e=this.getRect(0,0),i=Gr._colorManager.convert(this.color);return{annotationType:X.HIGHLIGHT,color:i,opacity:_(this,Qv),thickness:_(this,tf),quadPoints:k(this,vf,Ef).call(this),outlines:k(this,ff,Cf).call(this,e),pageIndex:this.pageIndex,rect:e,rotation:k(this,df,Mf).call(this),structTreeParentId:this._structTreeParentId}}}],[{key:"_keyboardManager",get:function(){var t=i.prototype;return Bt(this,"_keyboardManager",new pn([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}},{key:"computeTelemetryFinalData",value:function(t){return{numberOfColors:t.get("color").size}}},{key:"initialize",value:function(t,e){var n;Gr.initialize(t,e),i._defaultColor||(i._defaultColor=(null===(n=e.highlightColors)||void 0===n?void 0:n.values().next().value)||"#fff066")}},{key:"updateDefaultParams",value:function(t,e){switch(t){case K.HIGHLIGHT_DEFAULT_COLOR:i._defaultColor=e;break;case K.HIGHLIGHT_THICKNESS:i._defaultThickness=e}}},{key:"defaultPropertiesToUpdate",get:function(){return[[K.HIGHLIGHT_DEFAULT_COLOR,i._defaultColor],[K.HIGHLIGHT_THICKNESS,i._defaultThickness]]}},{key:"startHighlighting",value:function(t,e,n){var a=this,r=n.target,s=n.x,o=n.y,l=r.getBoundingClientRect(),h=l.x,u=l.y,c=l.width,d=l.height,v=function(e){S(a,i,Zf).call(a,t,e)},f=t._signal,p={capture:!0,passive:!1,signal:f},g=function(t){t.preventDefault(),t.stopPropagation()},m=function e(n){r.removeEventListener("pointermove",v),window.removeEventListener("blur",e),window.removeEventListener("pointerup",e),window.removeEventListener("pointerdown",g,p),window.removeEventListener("contextmenu",ki),S(a,i,Tf).call(a,t,n)};window.addEventListener("blur",m,{signal:f}),window.addEventListener("pointerup",m,{signal:f}),window.addEventListener("pointerdown",g,p),window.addEventListener("contextmenu",ki,{signal:f}),r.addEventListener("pointermove",v,{signal:f}),this._freeHighlight=new Xd({x:s,y:o},[h,u,c,d],t.scale,this._defaultThickness/2,e,.001);var y=t.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0);this._freeHighlightId=y.id,this._freeHighlightClipId=y.clipPathId}},{key:"deserialize",value:function(t,e,n){var a=h((0,o.Z)(i),"deserialize",this).call(this,t,e,n),r=(0,M.Z)(t.rect,4),s=r[0],l=r[1],u=r[2],c=r[3],d=t.color,v=t.quadPoints;a.color=te.makeHexColor.apply(te,(0,p.Z)(d)),x(a,Qv,t.opacity);var f=(0,M.Z)(a.pageDimensions,2),g=f[0],m=f[1];a.width=(u-s)/g,a.height=(c-l)/m;for(var y=x(a,Ov,[]),b=0;b<v.length;b+=8)y.push({x:(v[4]-u)/g,y:(c-(1-v[b+5]))/m,width:(v[b+2]-v[b])/g,height:(v[b+5]-v[b+1])/m});return k(a,nf,gf).call(a),a}},{key:"canCreateNewEmptyEditor",value:function(){return!1}}]),i}(Gr);function gf(){var t=new xd(_(this,Ov),.001);x(this,Gv,t.getOutlines());var e=_(this,Gv).box;this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height;var i=new xd(_(this,Ov),.0025,.001,"ltr"===this._uiManager.direction);x(this,zv,i.getOutlines());var n=_(this,zv).box.lastPoint;x(this,Yv,[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height])}function mf(t){var e=t.highlightOutlines,i=t.highlightId,n=t.clipPathId;x(this,Gv,e);if(x(this,zv,e.getNewOutline(_(this,tf)/2+1.5,.0025)),i>=0)x(this,qv,i),x(this,Bv,n),this.parent.drawLayer.finalizeLine(i,e),x(this,Jv,this.parent.drawLayer.highlightOutline(_(this,zv)));else if(this.parent){var a=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(_(this,qv),e),this.parent.drawLayer.updateBox(_(this,qv),S(pf,pf,_f).call(pf,_(this,Gv).box,(a-this.rotation+360)%360)),this.parent.drawLayer.updateLine(_(this,Jv),_(this,zv)),this.parent.drawLayer.updateBox(_(this,Jv),S(pf,pf,_f).call(pf,_(this,zv).box,a))}var r=e.box,s=r.x,o=r.y,l=r.width,h=r.height;switch(this.rotation){case 0:this.x=s,this.y=o,this.width=l,this.height=h;break;case 90:var u=(0,M.Z)(this.parentDimensions,2),c=u[0],d=u[1];this.x=o,this.y=1-s,this.width=l*d/c,this.height=h*c/d;break;case 180:this.x=1-s,this.y=1-o,this.width=l,this.height=h;break;case 270:var v=(0,M.Z)(this.parentDimensions,2),f=v[0],p=v[1];this.x=1-o,this.y=s,this.width=l*p/f,this.height=h*f/p}var g=_(this,zv).box.lastPoint;x(this,Yv,[(g[0]-s)/l,(g[1]-o)/h])}function yf(t){var e=this,i=function(t){var i,n;e.color=t,null===(i=e.parent)||void 0===i||i.drawLayer.changeColor(_(e,qv),t),null===(n=_(e,Hv))||void 0===n||n.updateColor(t)},n=this.color;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)}function kf(t){var e=this,i=_(this,tf),n=function(t){x(e,tf,t),k(e,of,bf).call(e,t)};this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}function bf(t){if(_(this,Xv)){k(this,af,mf).call(this,{highlightOutlines:_(this,Gv).getNewOutline(t/2)}),this.fixAndSetPosition();var e=(0,M.Z)(this.parentDimensions,2),i=e[0],n=e[1];this.setDims(this.width*i,this.height*n)}}function wf(){null!==_(this,qv)&&this.parent&&(this.parent.drawLayer.remove(_(this,qv)),x(this,qv,null),this.parent.drawLayer.remove(_(this,Jv)),x(this,Jv,null))}function Af(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;if(null===_(this,qv)){var e=t.drawLayer.highlight(_(this,Gv),this.color,_(this,Qv));s(this,qv).value=e.id,s(this,Bv).value=e.clipPathId,x(this,Jv,t.drawLayer.highlightOutline(_(this,zv))),_(this,Vv)&&(_(this,Vv).style.clipPath=_(this,Bv))}}function _f(t,e){var i=t.x,n=t.y,a=t.width,r=t.height;switch(e){case 90:return{x:1-n-r,y:i,width:r,height:a};case 180:return{x:1-i-a,y:1-n-r,width:a,height:r};case 270:return{x:n,y:1-i-a,width:r,height:a}}return{x:i,y:n,width:a,height:r}}function xf(t){pf._keyboardManager.exec(this,t)}function Sf(t){if(_(this,Wv)){var e=window.getSelection();t?e.setPosition(_(this,Wv),_(this,Nv)):e.setPosition(_(this,jv),_(this,Uv))}}function Mf(){return _(this,Xv)?this.rotation:0}function Ef(){if(_(this,Xv))return null;var t,e=(0,M.Z)(this.pageDimensions,2),i=e[0],n=e[1],a=(0,M.Z)(this.pageTranslation,2),r=a[0],s=a[1],o=_(this,Ov),l=new Float32Array(8*o.length),h=0,u=C(o);try{for(u.s();!(t=u.n()).done;){var c=t.value,d=c.x,v=c.y,f=c.width,p=c.height,g=d*i+r,m=(1-v-p)*n+s;l[h]=l[h+4]=g,l[h+1]=l[h+3]=m,l[h+2]=l[h+6]=g+f*i,l[h+5]=l[h+7]=m+p*n,h+=8}}catch(y){u.e(y)}finally{u.f()}return l}function Cf(t){return _(this,Gv).serialize(t,k(this,df,Mf).call(this))}function Zf(t,e){this._freeHighlight.add(e)&&t.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}function Tf(t,e){this._freeHighlight.isEmpty()?t.drawLayer.removeFreeHighlight(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}(0,b.Z)(pf,"_defaultColor",null),(0,b.Z)(pf,"_defaultOpacity",1),(0,b.Z)(pf,"_defaultThickness",12),(0,b.Z)(pf,"_l10nPromise",void 0),(0,b.Z)(pf,"_type","highlight"),(0,b.Z)(pf,"_editorType",X.HIGHLIGHT),(0,b.Z)(pf,"_freeHighlightId",-1),(0,b.Z)(pf,"_freeHighlight",null),(0,b.Z)(pf,"_freeHighlightClipId","");var Rf=new WeakMap,Pf=new WeakMap,Lf=new WeakMap,If=new WeakMap,Ff=new WeakMap,Df=new WeakMap,Wf=new WeakMap,Nf=new WeakMap,Of=new WeakMap,Bf=new WeakMap,Hf=new WeakMap,zf=new WeakMap,jf=new WeakMap,Uf=new WeakMap,Vf=new WeakMap,Gf=new WeakSet,qf=new WeakSet,Xf=new WeakSet,Kf=new WeakSet,Yf=new WeakSet,Qf=new WeakSet,Jf=new WeakSet,$f=new WeakSet,tp=new WeakSet,ep=new WeakSet,ip=new WeakSet,np=new WeakSet,ap=new WeakSet,rp=new WeakSet,sp=new WeakSet,op=new WeakSet,lp=new WeakSet,hp=new WeakSet,up=new WeakSet,cp=new WeakSet,dp=new WeakSet,vp=new WeakSet,fp=new WeakSet,pp=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var a;return(0,T.Z)(this,i),a=e.call(this,(0,n.Z)((0,n.Z)({},t),{},{name:"inkEditor"})),y((0,g.Z)(a),fp),y((0,g.Z)(a),vp),y((0,g.Z)(a),dp),y((0,g.Z)(a),cp),y((0,g.Z)(a),up),y((0,g.Z)(a),hp),y((0,g.Z)(a),lp),y((0,g.Z)(a),op),y((0,g.Z)(a),sp),y((0,g.Z)(a),rp),y((0,g.Z)(a),ap),y((0,g.Z)(a),np),y((0,g.Z)(a),ip),y((0,g.Z)(a),ep),y((0,g.Z)(a),tp),y((0,g.Z)(a),$f),y((0,g.Z)(a),Jf),y((0,g.Z)(a),Qf),y((0,g.Z)(a),Yf),y((0,g.Z)(a),Kf),y((0,g.Z)(a),Xf),y((0,g.Z)(a),qf),y((0,g.Z)(a),Gf),A((0,g.Z)(a),Rf,{writable:!0,value:0}),A((0,g.Z)(a),Pf,{writable:!0,value:0}),A((0,g.Z)(a),Lf,{writable:!0,value:a.canvasPointermove.bind((0,g.Z)(a))}),A((0,g.Z)(a),If,{writable:!0,value:a.canvasPointerleave.bind((0,g.Z)(a))}),A((0,g.Z)(a),Ff,{writable:!0,value:a.canvasPointerup.bind((0,g.Z)(a))}),A((0,g.Z)(a),Df,{writable:!0,value:a.canvasPointerdown.bind((0,g.Z)(a))}),A((0,g.Z)(a),Wf,{writable:!0,value:null}),A((0,g.Z)(a),Nf,{writable:!0,value:new Path2D}),A((0,g.Z)(a),Of,{writable:!0,value:!1}),A((0,g.Z)(a),Bf,{writable:!0,value:!1}),A((0,g.Z)(a),Hf,{writable:!0,value:!1}),A((0,g.Z)(a),zf,{writable:!0,value:null}),A((0,g.Z)(a),jf,{writable:!0,value:0}),A((0,g.Z)(a),Uf,{writable:!0,value:0}),A((0,g.Z)(a),Vf,{writable:!0,value:null}),a.color=t.color||null,a.thickness=t.thickness||null,a.opacity=t.opacity||null,a.paths=[],a.bezierPath2D=[],a.allRawPaths=[],a.currentPath=[],a.scaleFactor=1,a.translationX=a.translationY=0,a.x=0,a.y=0,a._willKeepAspectRatio=!0,a}return(0,Z.Z)(i,[{key:"updateParams",value:function(t,e){switch(t){case K.INK_THICKNESS:k(this,Gf,gp).call(this,e);break;case K.INK_COLOR:k(this,qf,mp).call(this,e);break;case K.INK_OPACITY:k(this,Xf,yp).call(this,e)}}},{key:"propertiesToUpdate",get:function(){var t;return[[K.INK_THICKNESS,this.thickness||i._defaultThickness],[K.INK_COLOR,this.color||i._defaultColor||Gr._defaultLineColor],[K.INK_OPACITY,Math.round(100*(null!==(t=this.opacity)&&void 0!==t?t:i._defaultOpacity))]]}},{key:"rebuild",value:function(){this.parent&&(h((0,o.Z)(i.prototype),"rebuild",this).call(this),null!==this.div&&(this.canvas||(k(this,sp,Tp).call(this),k(this,op,Rp).call(this)),this.isAttachedToDOM||(this.parent.add(this),k(this,lp,Pp).call(this)),k(this,fp,Hp).call(this)))}},{key:"remove",value:function(){var t;null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,_(this,Wf)&&(clearTimeout(_(this,Wf)),x(this,Wf,null)),null===(t=_(this,zf))||void 0===t||t.disconnect(),x(this,zf,null),h((0,o.Z)(i.prototype),"remove",this).call(this))}},{key:"setParent",value:function(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&null===t&&this._uiManager.addShouldRescale(this),h((0,o.Z)(i.prototype),"setParent",this).call(this,t)}},{key:"onScaleChanging",value:function(){var t=(0,M.Z)(this.parentDimensions,2),e=t[0],i=t[1],n=this.width*e,a=this.height*i;this.setDimensions(n,a)}},{key:"enableEditMode",value:function(){_(this,Of)||null===this.canvas||(h((0,o.Z)(i.prototype),"enableEditMode",this).call(this),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",_(this,Df),{signal:this._uiManager._signal}))}},{key:"disableEditMode",value:function(){this.isInEditMode()&&null!==this.canvas&&(h((0,o.Z)(i.prototype),"disableEditMode",this).call(this),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",_(this,Df)))}},{key:"onceAdded",value:function(){this._isDraggable=!this.isEmpty()}},{key:"isEmpty",value:function(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}},{key:"commit",value:function(){_(this,Of)||(h((0,o.Z)(i.prototype),"commit",this).call(this),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),x(this,Of,!0),this.div.classList.add("disabled"),k(this,fp,Hp).call(this,!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}},{key:"focusin",value:function(t){this._focusEventsAllowed&&(h((0,o.Z)(i.prototype),"focusin",this).call(this,t),this.enableEditMode())}},{key:"canvasPointerdown",value:function(t){0===t.button&&this.isInEditMode()&&!_(this,Of)&&(this.setInForeground(),t.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),k(this,Qf,wp).call(this,t.offsetX,t.offsetY))}},{key:"canvasPointermove",value:function(t){t.preventDefault(),k(this,Jf,Ap).call(this,t.offsetX,t.offsetY)}},{key:"canvasPointerup",value:function(t){t.preventDefault(),k(this,rp,Zp).call(this,t)}},{key:"canvasPointerleave",value:function(t){k(this,rp,Zp).call(this,t)}},{key:"isResizable",get:function(){return!this.isEmpty()&&_(this,Of)}},{key:"render",value:function(){if(this.div)return this.div;var t,e;this.width&&(t=this.x,e=this.y),h((0,o.Z)(i.prototype),"render",this).call(this),this.div.setAttribute("data-l10n-id","pdfjs-ink");var n=k(this,Kf,kp).call(this),a=(0,M.Z)(n,4),r=a[0],s=a[1],l=a[2],u=a[3];if(this.setAt(r,s,0,0),this.setDims(l,u),k(this,sp,Tp).call(this),this.width){var c=(0,M.Z)(this.parentDimensions,2),d=c[0],v=c[1];this.setAspectRatio(this.width*d,this.height*v),this.setAt(t*d,e*v,this.width*d,this.height*v),x(this,Hf,!0),k(this,lp,Pp).call(this),this.setDims(this.width*d,this.height*v),k(this,ap,Cp).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return k(this,op,Rp).call(this),this.div}},{key:"setDimensions",value:function(t,e){var i=Math.round(t),n=Math.round(e);if(_(this,jf)!==i||_(this,Uf)!==n){x(this,jf,i),x(this,Uf,n),this.canvas.style.visibility="hidden";var a=(0,M.Z)(this.parentDimensions,2),r=a[0],s=a[1];this.width=t/r,this.height=e/s,this.fixAndSetPosition(),_(this,Of)&&k(this,hp,Lp).call(this,t,e),k(this,lp,Pp).call(this),k(this,ap,Cp).call(this),this.canvas.style.visibility="visible",this.fixDims()}}},{key:"serialize",value:function(){if(this.isEmpty())return null;var t=this.getRect(0,0),e=Gr._colorManager.convert(this.ctx.strokeStyle);return{annotationType:X.INK,color:e,thickness:this.thickness,opacity:this.opacity,paths:k(this,cp,Np).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}],[{key:"initialize",value:function(t,e){Gr.initialize(t,e)}},{key:"updateDefaultParams",value:function(t,e){switch(t){case K.INK_THICKNESS:i._defaultThickness=e;break;case K.INK_COLOR:i._defaultColor=e;break;case K.INK_OPACITY:i._defaultOpacity=e/100}}},{key:"defaultPropertiesToUpdate",get:function(){return[[K.INK_THICKNESS,i._defaultThickness],[K.INK_COLOR,i._defaultColor||Gr._defaultLineColor],[K.INK_OPACITY,Math.round(100*i._defaultOpacity)]]}},{key:"deserialize",value:function(t,e,n){if(t instanceof xc)return null;var a=h((0,o.Z)(i),"deserialize",this).call(this,t,e,n);a.thickness=t.thickness,a.color=te.makeHexColor.apply(te,(0,p.Z)(t.color)),a.opacity=t.opacity;var r=(0,M.Z)(a.pageDimensions,2),s=r[0],l=r[1],u=a.width*s,c=a.height*l,d=a.parentScale,v=t.thickness/2;x(a,Of,!0),x(a,jf,Math.round(u)),x(a,Uf,Math.round(c));var f,g=t.paths,m=t.rect,y=t.rotation,b=C(g);try{for(b.s();!(f=b.n()).done;){var w=f.value.bezier;w=S(i,i,Wp).call(i,w,m,y);var A=[];a.paths.push(A);for(var _=d*(w[0]-v),E=d*(w[1]-v),Z=2,T=w.length;Z<T;Z+=6){var R=d*(w[Z]-v),P=d*(w[Z+1]-v),L=d*(w[Z+2]-v),I=d*(w[Z+3]-v),F=d*(w[Z+4]-v),D=d*(w[Z+5]-v);A.push([[_,E],[R,P],[L,I],[F,D]]),_=F,E=D}var W=S(this,i,Fp).call(this,A);a.bezierPath2D.push(W)}}catch(O){b.e(O)}finally{b.f()}var N=k(a,dp,Op).call(a);return x(a,Pf,Math.max(Gr.MIN_SIZE,N[2]-N[0])),x(a,Rf,Math.max(Gr.MIN_SIZE,N[3]-N[1])),k(a,hp,Lp).call(a,u,c),a}}]),i}(Gr);function gp(t){var e=this,i=function(t){e.thickness=t,k(e,fp,Hp).call(e)},n=this.thickness;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}function mp(t){var e=this,i=function(t){e.color=t,k(e,ap,Cp).call(e)},n=this.color;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}function yp(t){var e=this,i=function(t){e.opacity=t,k(e,ap,Cp).call(e)};t/=100;var n=this.opacity;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:K.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}function kp(){var t=this.parentRotation,e=(0,M.Z)(this.parentDimensions,2),i=e[0],n=e[1];switch(t){case 90:return[0,n,n,i];case 180:return[i,n,i,n];case 270:return[i,0,n,i];default:return[0,0,i,n]}}function bp(){var t=this.ctx,e=this.color,i=this.opacity,n=this.thickness,a=this.parentScale,r=this.scaleFactor;t.lineWidth=n*a/r,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle="".concat(e).concat(function(t){return Math.round(Math.min(255,Math.max(1,255*t))).toString(16).padStart(2,"0")}(i))}function wp(t,e){var i,n=this,a=this._uiManager._signal;(this.canvas.addEventListener("contextmenu",ki,{signal:a}),this.canvas.addEventListener("pointerleave",_(this,If),{signal:a}),this.canvas.addEventListener("pointermove",_(this,Lf),{signal:a}),this.canvas.addEventListener("pointerup",_(this,Ff),{signal:a}),this.canvas.removeEventListener("pointerdown",_(this,Df)),this.isEditing=!0,_(this,Hf))||(x(this,Hf,!0),k(this,lp,Pp).call(this),this.thickness||(this.thickness=pp._defaultThickness),this.color||(this.color=pp._defaultColor||Gr._defaultLineColor),null!==(i=this.opacity)&&void 0!==i||(this.opacity=pp._defaultOpacity));this.currentPath.push([t,e]),x(this,Bf,!1),k(this,Yf,bp).call(this),x(this,Vf,(function(){k(n,ep,Sp).call(n),_(n,Vf)&&window.requestAnimationFrame(_(n,Vf))})),window.requestAnimationFrame(_(this,Vf))}function Ap(t,e){var i,n=this.currentPath.at(-1),a=(0,M.Z)(n,2),r=a[0],s=a[1];if(!(this.currentPath.length>1&&t===r&&e===s)){var o,l,h=this.currentPath,u=_(this,Nf);if(h.push([t,e]),x(this,Bf,!0),h.length<=2)return(o=u).moveTo.apply(o,(0,p.Z)(h[0])),void u.lineTo(t,e);if(3===h.length)x(this,Nf,u=new Path2D),(l=u).moveTo.apply(l,(0,p.Z)(h[0]));(i=k(this,ip,Mp)).call.apply(i,[this,u].concat((0,p.Z)(h.at(-3)),(0,p.Z)(h.at(-2)),[t,e]))}}function _p(){var t;if(0!==this.currentPath.length){var e=this.currentPath.at(-1);(t=_(this,Nf)).lineTo.apply(t,(0,p.Z)(e))}}function xp(t,e){var i,n=this;if(x(this,Vf,null),t=Math.min(Math.max(t,0),this.canvas.width),e=Math.min(Math.max(e,0),this.canvas.height),k(this,Jf,Ap).call(this,t,e),k(this,$f,_p).call(this),1!==this.currentPath.length)i=k(this,np,Ep).call(this);else{var a=[t,e];i=[[a,a.slice(),a.slice(),a]]}var r=_(this,Nf),s=this.currentPath;this.currentPath=[],x(this,Nf,new Path2D);this.addCommands({cmd:function(){n.allRawPaths.push(s),n.paths.push(i),n.bezierPath2D.push(r),n._uiManager.rebuild(n)},undo:function(){n.allRawPaths.pop(),n.paths.pop(),n.bezierPath2D.pop(),0===n.paths.length?n.remove():(n.canvas||(k(n,sp,Tp).call(n),k(n,op,Rp).call(n)),k(n,fp,Hp).call(n))},mustExec:!0})}function Sp(){if(_(this,Bf)){x(this,Bf,!1);var t=Math.ceil(this.thickness*this.parentScale),e=this.currentPath.slice(-3),i=e.map((function(t){return t[0]})),n=e.map((function(t){return t[1]})),a=(Math.min.apply(Math,(0,p.Z)(i)),Math.max.apply(Math,(0,p.Z)(i)),Math.min.apply(Math,(0,p.Z)(n)),Math.max.apply(Math,(0,p.Z)(n)),this.ctx);a.save(),a.clearRect(0,0,this.canvas.width,this.canvas.height);var r,s=C(this.bezierPath2D);try{for(s.s();!(r=s.n()).done;){var o=r.value;a.stroke(o)}}catch(l){s.e(l)}finally{s.f()}a.stroke(_(this,Nf)),a.restore()}}function Mp(t,e,i,n,a,r,s){var o=(e+n)/2,l=(i+a)/2,h=(n+r)/2,u=(a+s)/2;t.bezierCurveTo(o+2*(n-o)/3,l+2*(a-l)/3,h+2*(n-h)/3,u+2*(a-u)/3,h,u)}function Ep(){var t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];var e,i=[],n=(0,M.Z)(t[0],2),a=n[0],r=n[1];for(e=1;e<t.length-2;e++){var s=(0,M.Z)(t[e],2),o=s[0],l=s[1],h=(0,M.Z)(t[e+1],2),u=(o+h[0])/2,c=(l+h[1])/2,d=[a+2*(o-a)/3,r+2*(l-r)/3],v=[u+2*(o-u)/3,c+2*(l-c)/3];i.push([[a,r],d,v,[u,c]]),a=u,r=c}var f=(0,M.Z)(t[e],2),p=f[0],g=f[1],m=(0,M.Z)(t[e+1],2),y=m[0],k=m[1],b=[a+2*(p-a)/3,r+2*(g-r)/3],w=[y+2*(p-y)/3,k+2*(g-k)/3];return i.push([[a,r],b,w,[y,k]]),i}function Cp(){if(this.isEmpty())k(this,up,Ip).call(this);else{k(this,Yf,bp).call(this);var t=this.canvas,e=this.ctx;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height),k(this,up,Ip).call(this);var i,n=C(this.bezierPath2D);try{for(n.s();!(i=n.n()).done;){var a=i.value;e.stroke(a)}}catch(r){n.e(r)}finally{n.f()}}}function Zp(t){var e=this;this.canvas.removeEventListener("pointerleave",_(this,If)),this.canvas.removeEventListener("pointermove",_(this,Lf)),this.canvas.removeEventListener("pointerup",_(this,Ff)),this.canvas.addEventListener("pointerdown",_(this,Df),{signal:this._uiManager._signal}),_(this,Wf)&&clearTimeout(_(this,Wf)),x(this,Wf,setTimeout((function(){x(e,Wf,null),e.canvas.removeEventListener("contextmenu",ki)}),10)),k(this,tp,xp).call(this,t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}function Tp(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}function Rp(){var t=this;x(this,zf,new ResizeObserver((function(e){var i=e[0].contentRect;i.width&&i.height&&t.setDimensions(i.width,i.height)}))),_(this,zf).observe(this.div),this._uiManager._signal.addEventListener("abort",(function(){var e;null===(e=_(t,zf))||void 0===e||e.disconnect(),x(t,zf,null)}),{once:!0})}function Pp(){if(_(this,Hf)){var t=(0,M.Z)(this.parentDimensions,2),e=t[0],i=t[1];this.canvas.width=Math.ceil(this.width*e),this.canvas.height=Math.ceil(this.height*i),k(this,up,Ip).call(this)}}function Lp(t,e){var i=k(this,vp,Bp).call(this),n=(t-i)/_(this,Pf),a=(e-i)/_(this,Rf);this.scaleFactor=Math.min(n,a)}function Ip(){var t=k(this,vp,Bp).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}function Fp(t){for(var e=new Path2D,i=0,n=t.length;i<n;i++){var a=(0,M.Z)(t[i],4),r=a[0],s=a[1],o=a[2],l=a[3];0===i&&e.moveTo.apply(e,(0,p.Z)(r)),e.bezierCurveTo(s[0],s[1],o[0],o[1],l[0],l[1])}return e}function Dp(t,e,i){var n=(0,M.Z)(e,4),a=n[0],r=n[1],s=n[2],o=n[3];switch(i){case 0:for(var l=0,h=t.length;l<h;l+=2)t[l]+=a,t[l+1]=o-t[l+1];break;case 90:for(var u=0,c=t.length;u<c;u+=2){var d=t[u];t[u]=t[u+1]+a,t[u+1]=d+r}break;case 180:for(var v=0,f=t.length;v<f;v+=2)t[v]=s-t[v],t[v+1]+=r;break;case 270:for(var p=0,g=t.length;p<g;p+=2){var m=t[p];t[p]=s-t[p+1],t[p+1]=o-m}break;default:throw new Error("Invalid rotation")}return t}function Wp(t,e,i){var n=(0,M.Z)(e,4),a=n[0],r=n[1],s=n[2],o=n[3];switch(i){case 0:for(var l=0,h=t.length;l<h;l+=2)t[l]-=a,t[l+1]=o-t[l+1];break;case 90:for(var u=0,c=t.length;u<c;u+=2){var d=t[u];t[u]=t[u+1]-r,t[u+1]=d-a}break;case 180:for(var v=0,f=t.length;v<f;v+=2)t[v]=s-t[v],t[v+1]-=r;break;case 270:for(var p=0,g=t.length;p<g;p+=2){var m=t[p];t[p]=o-t[p+1],t[p+1]=s-m}break;default:throw new Error("Invalid rotation")}return t}function Np(t,e,i,n){var a,r=[],s=this.thickness/2,o=t*e+s,l=t*i+s,h=C(this.paths);try{for(h.s();!(a=h.n()).done;){for(var u=a.value,c=[],d=[],v=0,f=u.length;v<f;v++){var p=(0,M.Z)(u[v],4),g=p[0],m=p[1],y=p[2],k=p[3];if(g[0]===k[0]&&g[1]===k[1]&&1===f){var b=t*g[0]+o,w=t*g[1]+l;c.push(b,w),d.push(b,w);break}var A=t*g[0]+o,_=t*g[1]+l,x=t*m[0]+o,E=t*m[1]+l,Z=t*y[0]+o,T=t*y[1]+l,R=t*k[0]+o,P=t*k[1]+l;0===v&&(c.push(A,_),d.push(A,_)),c.push(x,E,Z,T,R,P),d.push(x,E),v===f-1&&d.push(R,P)}r.push({bezier:S(pp,pp,Dp).call(pp,c,n,this.rotation),points:S(pp,pp,Dp).call(pp,d,n,this.rotation)})}}catch(L){h.e(L)}finally{h.f()}return r}function Op(){var t,e=1/0,i=-1/0,n=1/0,a=-1/0,r=C(this.paths);try{for(r.s();!(t=r.n()).done;){var s,o=C(t.value);try{for(o.s();!(s=o.n()).done;){var l=(0,M.Z)(s.value,4),h=l[0],u=l[1],c=l[2],d=l[3],v=te.bezierBoundingBox.apply(te,(0,p.Z)(h).concat((0,p.Z)(u),(0,p.Z)(c),(0,p.Z)(d)));e=Math.min(e,v[0]),n=Math.min(n,v[1]),i=Math.max(i,v[2]),a=Math.max(a,v[3])}}catch(f){o.e(f)}finally{o.f()}}}catch(f){r.e(f)}finally{r.f()}return[e,n,i,a]}function Bp(){return _(this,Of)?Math.ceil(this.thickness*this.parentScale):0}function Hp(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEmpty())if(_(this,Of)){var e=k(this,dp,Op).call(this),i=k(this,vp,Bp).call(this);x(this,Pf,Math.max(Gr.MIN_SIZE,e[2]-e[0])),x(this,Rf,Math.max(Gr.MIN_SIZE,e[3]-e[1]));var n=Math.ceil(i+_(this,Pf)*this.scaleFactor),a=Math.ceil(i+_(this,Rf)*this.scaleFactor),r=(0,M.Z)(this.parentDimensions,2),s=r[0],o=r[1];this.width=n/s,this.height=a/o,this.setAspectRatio(n,a);var l=this.translationX,h=this.translationY;this.translationX=-e[0],this.translationY=-e[1],k(this,lp,Pp).call(this),k(this,ap,Cp).call(this),x(this,jf,n),x(this,Uf,a),this.setDims(n,a);var u=t?i/this.scaleFactor/2:0;this.translate(l-this.translationX-u,h-this.translationY-u)}else k(this,ap,Cp).call(this)}(0,b.Z)(pp,"_defaultColor",null),(0,b.Z)(pp,"_defaultOpacity",1),(0,b.Z)(pp,"_defaultThickness",1),(0,b.Z)(pp,"_type","ink"),(0,b.Z)(pp,"_editorType",X.INK);var zp=new WeakMap,jp=new WeakMap,Up=new WeakMap,Vp=new WeakMap,Gp=new WeakMap,qp=new WeakMap,Xp=new WeakMap,Kp=new WeakMap,Yp=new WeakMap,Qp=new WeakMap,Jp=new WeakMap,$p=new WeakMap,tg=new WeakSet,eg=new WeakSet,ig=new WeakSet,ng=new WeakSet,ag=new WeakSet,rg=new WeakSet,sg=new WeakSet,og=new WeakSet,lg=new WeakSet,hg=new WeakSet,ug=function(t){(0,R.Z)(i,t);var e=(0,P.Z)(i);function i(t){var a;return(0,T.Z)(this,i),a=e.call(this,(0,n.Z)((0,n.Z)({},t),{},{name:"stampEditor"})),y((0,g.Z)(a),hg),y((0,g.Z)(a),lg),y((0,g.Z)(a),og),y((0,g.Z)(a),sg),y((0,g.Z)(a),rg),y((0,g.Z)(a),ag),y((0,g.Z)(a),ng),y((0,g.Z)(a),ig),y((0,g.Z)(a),eg),y((0,g.Z)(a),tg),A((0,g.Z)(a),zp,{writable:!0,value:null}),A((0,g.Z)(a),jp,{writable:!0,value:null}),A((0,g.Z)(a),Up,{writable:!0,value:null}),A((0,g.Z)(a),Vp,{writable:!0,value:null}),A((0,g.Z)(a),Gp,{writable:!0,value:null}),A((0,g.Z)(a),qp,{writable:!0,value:""}),A((0,g.Z)(a),Xp,{writable:!0,value:null}),A((0,g.Z)(a),Kp,{writable:!0,value:!1}),A((0,g.Z)(a),Yp,{writable:!0,value:null}),A((0,g.Z)(a),Qp,{writable:!0,value:null}),A((0,g.Z)(a),Jp,{writable:!0,value:!1}),A((0,g.Z)(a),$p,{writable:!0,value:!1}),x((0,g.Z)(a),Vp,t.bitmapUrl),x((0,g.Z)(a),Gp,t.bitmapFile),a}return(0,Z.Z)(i,[{key:"remove",value:function(){var t,e;_(this,jp)&&(x(this,zp,null),this._uiManager.imageManager.deleteId(_(this,jp)),null===(t=_(this,Xp))||void 0===t||t.remove(),x(this,Xp,null),null===(e=_(this,Yp))||void 0===e||e.disconnect(),x(this,Yp,null),_(this,Qp)&&(clearTimeout(_(this,Qp)),x(this,Qp,null)));h((0,o.Z)(i.prototype),"remove",this).call(this)}},{key:"rebuild",value:function(){this.parent?(h((0,o.Z)(i.prototype),"rebuild",this).call(this),null!==this.div&&(_(this,jp)&&null===_(this,Xp)&&k(this,ig,vg).call(this),this.isAttachedToDOM||this.parent.add(this))):_(this,jp)&&k(this,ig,vg).call(this)}},{key:"onceAdded",value:function(){this._isDraggable=!0,this.div.focus()}},{key:"isEmpty",value:function(){return!(_(this,Up)||_(this,zp)||_(this,Vp)||_(this,Gp)||_(this,jp))}},{key:"isResizable",get:function(){return!0}},{key:"render",value:function(){if(this.div)return this.div;var t,e;if(this.width&&(t=this.x,e=this.y),h((0,o.Z)(i.prototype),"render",this).call(this),this.div.hidden=!0,this.addAltTextButton(),_(this,zp)?k(this,ng,fg).call(this):k(this,ig,vg).call(this),this.width){var n=(0,M.Z)(this.parentDimensions,2),a=n[0],r=n[1];this.setAt(t*a,e*r,this.width*a,this.height*r)}return this.div}},{key:"getImageForAltText",value:function(){return _(this,Xp)}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isEmpty())return null;var i={annotationType:X.STAMP,bitmapId:_(this,jp),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:_(this,Jp),structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=k(this,lg,bg).call(this,!0),i.accessibilityData=this.altTextData,i;var n=this.altTextData,a=n.decorative,r=n.altText;if(!a&&r&&(i.accessibilityData={type:"Figure",alt:r}),null===e)return i;e.stamps||(e.stamps=new Map);var s=_(this,Jp)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(e.stamps.has(_(this,jp))){if(_(this,Jp)){var o=e.stamps.get(_(this,jp));s>o.area&&(o.area=s,o.serialized.bitmap.close(),o.serialized.bitmap=k(this,lg,bg).call(this,!1))}}else e.stamps.set(_(this,jp),{area:s,serialized:i}),i.bitmap=k(this,lg,bg).call(this,!1);return i}}],[{key:"initialize",value:function(t,e){Gr.initialize(t,e)}},{key:"supportedTypes",get:function(){return Bt(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map((function(t){return"image/".concat(t)})))}},{key:"supportedTypesStr",get:function(){return Bt(this,"supportedTypesStr",this.supportedTypes.join(","))}},{key:"isHandlingMimeForPasting",value:function(t){return this.supportedTypes.includes(t)}},{key:"paste",value:function(t,e){e.pasteEditor(X.STAMP,{bitmapFile:t.getAsFile()})}},{key:"deserialize",value:function(t,e,n){if(t instanceof Zc)return null;var a=h((0,o.Z)(i),"deserialize",this).call(this,t,e,n),r=t.rect,s=t.bitmapUrl,l=t.bitmapId,u=t.isSvg,c=t.accessibilityData;l&&n.imageManager.isValidId(l)?x(a,jp,l):x(a,Vp,s),x(a,Jp,u);var d=(0,M.Z)(a.pageDimensions,2),v=d[0],f=d[1];return a.width=(r[2]-r[0])/v,a.height=(r[3]-r[1])/f,c&&(a.altTextData=c),a}}]),i}(Gr);function cg(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?(x(this,zp,t.bitmap),e||(x(this,jp,t.id),x(this,Jp,t.isSvg)),t.file&&x(this,qp,t.file.name),k(this,ng,fg).call(this)):this.remove()}function dg(){x(this,Up,null),this._uiManager.enableWaiting(!1),_(this,Xp)&&this.div.focus()}function vg(){var t=this;if(_(this,jp))return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(_(this,jp)).then((function(e){return k(t,tg,cg).call(t,e,!0)})).finally((function(){return k(t,eg,dg).call(t)}));if(_(this,Vp)){var e=_(this,Vp);return x(this,Vp,null),this._uiManager.enableWaiting(!0),void x(this,Up,this._uiManager.imageManager.getFromUrl(e).then((function(e){return k(t,tg,cg).call(t,e)})).finally((function(){return k(t,eg,dg).call(t)})))}if(_(this,Gp)){var i=_(this,Gp);return x(this,Gp,null),this._uiManager.enableWaiting(!0),void x(this,Up,this._uiManager.imageManager.getFromFile(i).then((function(e){return k(t,tg,cg).call(t,e)})).finally((function(){return k(t,eg,dg).call(t)})))}var n=document.createElement("input");n.type="file",n.accept=ug.supportedTypesStr;var a=this._uiManager._signal;x(this,Up,new Promise((function(e){n.addEventListener("change",(0,w.Z)(L.mark((function i(){var a;return L.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n.files&&0!==n.files.length){i.next=4;break}t.remove(),i.next=9;break;case 4:return t._uiManager.enableWaiting(!0),i.next=7,t._uiManager.imageManager.getFromFile(n.files[0]);case 7:a=i.sent,k(t,tg,cg).call(t,a);case 9:e();case 10:case"end":return i.stop()}}),i)}))),{signal:a}),n.addEventListener("cancel",(function(){t.remove(),e()}),{signal:a})})).finally((function(){return k(t,eg,dg).call(t)}))),n.click()}function fg(){var t=this.div,e=_(this,zp),i=e.width,n=e.height,a=(0,M.Z)(this.pageDimensions,2),r=a[0],s=a[1],o=.75;if(this.width)i=this.width*r,n=this.height*s;else if(i>o*r||n>o*s){var l=Math.min(o*r/i,o*s/n);i*=l,n*=l}var h=(0,M.Z)(this.parentDimensions,2),u=h[0],c=h[1];this.setDims(i*u/r,n*c/s),this._uiManager.enableWaiting(!1);var d=x(this,Xp,document.createElement("canvas"));t.append(d),t.hidden=!1,k(this,og,kg).call(this,i,n),k(this,hg,wg).call(this),_(this,$p)||(this.parent.addUndoableEditor(this),x(this,$p,!0)),this._reportTelemetry({action:"inserted_image"}),_(this,qp)&&d.setAttribute("aria-label",_(this,qp))}function pg(t,e){var i,n=this,a=(0,M.Z)(this.parentDimensions,2),r=a[0],s=a[1];this.width=t/r,this.height=e/s,this.setDims(t,e),null!==(i=this._initialOptions)&&void 0!==i&&i.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,null!==_(this,Qp)&&clearTimeout(_(this,Qp));x(this,Qp,setTimeout((function(){x(n,Qp,null),k(n,og,kg).call(n,t,e)}),200))}function gg(t,e){for(var i=_(this,zp),n=i.width,a=i.height,r=_(this,zp);n>2*t||a>2*e;){var s=n,o=a;n>2*t&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));var l=new OffscreenCanvas(n,a);l.getContext("2d").drawImage(r,0,0,s,o,0,0,n,a),r=l.transferToImageBitmap()}return r}function mg(t,e,i){return yg.apply(this,arguments)}function yg(){return(yg=(0,w.Z)(L.mark((function t(e,i,n){var a,r,s,o;return L.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!_(this,Kp)){t.next=2;break}return t.abrupt("return");case 2:return x(this,Kp,!0),t.next=5,this._uiManager.isMLEnabledFor("altText");case 5:if(t.sent&&!this.hasAltText()){t.next=8;break}return t.abrupt("return");case 8:return a=new OffscreenCanvas(i,n),(r=a.getContext("2d",{willReadFrequently:!0})).drawImage(e,0,0,e.width,e.height,0,0,i,n),t.next=13,this._uiManager.mlGuess({service:"moz-image-to-text",request:{data:r.getImageData(0,0,i,n).data,width:i,height:n,channels:4}});case 13:s=t.sent,o=(null===s||void 0===s?void 0:s.output)||"",this.parent&&o&&!this.hasAltText()&&(this.altTextData={altText:o,decorative:!1});case 16:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function kg(t,e){t=Math.ceil(t),e=Math.ceil(e);var i=_(this,Xp);if(i&&(i.width!==t||i.height!==e)){i.width=t,i.height=e;var n=_(this,Jp)?_(this,zp):k(this,rg,gg).call(this,t,e);k(this,sg,mg).call(this,n,t,e);var a=i.getContext("2d");a.filter=this._uiManager.hcmFilter,a.drawImage(n,0,0,n.width,n.height,0,0,t,e)}}function bg(t){if(t){if(_(this,Jp)){var e=this._uiManager.imageManager.getSvgUrl(_(this,jp));if(e)return e}var i=document.createElement("canvas"),n=_(this,zp);return i.width=n.width,i.height=n.height,i.getContext("2d").drawImage(_(this,zp),0,0),i.toDataURL()}if(_(this,Jp)){var a=(0,M.Z)(this.pageDimensions,2),r=a[0],s=a[1],o=Math.round(this.width*r*Se.PDF_TO_CSS_UNITS),l=Math.round(this.height*s*Se.PDF_TO_CSS_UNITS),h=new OffscreenCanvas(o,l);return h.getContext("2d").drawImage(_(this,zp),0,0,_(this,zp).width,_(this,zp).height,0,0,o,l),h.transferToImageBitmap()}return structuredClone(_(this,zp))}function wg(){var t=this;this._uiManager._signal&&(x(this,Yp,new ResizeObserver((function(e){var i=e[0].contentRect;i.width&&i.height&&k(t,ag,pg).call(t,i.width,i.height)}))),_(this,Yp).observe(this.div),this._uiManager._signal.addEventListener("abort",(function(){var e;null===(e=_(t,Yp))||void 0===e||e.disconnect(),x(t,Yp,null)}),{once:!0}))}(0,b.Z)(ug,"_type","stamp"),(0,b.Z)(ug,"_editorType",X.STAMP);var Ag=new WeakMap,_g=new WeakMap,xg=new WeakMap,Sg=new WeakMap,Mg=new WeakMap,Eg=new WeakMap,Cg=new WeakMap,Zg=new WeakMap,Tg=new WeakMap,Rg=new WeakMap,Pg=new WeakMap,Lg=new WeakMap,Ig=new WeakMap,Fg=new WeakSet,Dg=new WeakMap,Wg=new WeakSet,Ng=new WeakSet,Og=new WeakSet,Bg=function(){function t(e){var i=e.uiManager,n=e.pageIndex,a=e.div,r=e.accessibilityManager,s=e.annotationLayer,o=e.drawLayer,l=e.textLayer,h=e.viewport,u=e.l10n;(0,T.Z)(this,t),y(this,Og),y(this,Ng),y(this,Wg),A(this,Dg,{get:zg,set:void 0}),y(this,Fg),A(this,Ag,{writable:!0,value:void 0}),A(this,_g,{writable:!0,value:!1}),A(this,xg,{writable:!0,value:null}),A(this,Sg,{writable:!0,value:null}),A(this,Mg,{writable:!0,value:null}),A(this,Eg,{writable:!0,value:null}),A(this,Cg,{writable:!0,value:null}),A(this,Zg,{writable:!0,value:new Map}),A(this,Tg,{writable:!0,value:!1}),A(this,Rg,{writable:!0,value:!1}),A(this,Pg,{writable:!0,value:!1}),A(this,Lg,{writable:!0,value:null}),A(this,Ig,{writable:!0,value:void 0});var c=(0,p.Z)(f(t,t,Gg).values());if(!t._initialized){t._initialized=!0;var d,v=C(c);try{for(v.s();!(d=v.n()).done;){d.value.initialize(u,i)}}catch(g){v.e(g)}finally{v.f()}}i.registerEditorTypes(c),x(this,Ig,i),this.pageIndex=n,this.div=a,x(this,Ag,r),x(this,xg,s),this.viewport=h,x(this,Lg,l),this.drawLayer=o,_(this,Ig).addLayer(this)}return(0,Z.Z)(t,[{key:"isEmpty",get:function(){return 0===_(this,Zg).size}},{key:"isInvisible",get:function(){return this.isEmpty&&_(this,Ig).getMode()===X.NONE}},{key:"updateToolbar",value:function(t){_(this,Ig).updateToolbar(t)}},{key:"updateMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_(this,Ig).getMode();switch(k(this,Og,Vg).call(this),e){case X.NONE:return this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case X.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case X.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);var i,n=this.div.classList,a=C(f(t,t,Gg).values());try{for(a.s();!(i=a.n()).done;){var r=i.value;n.toggle("".concat(r._type,"Editing"),e===r._editorType)}}catch(s){a.e(s)}finally{a.f()}this.div.hidden=!1}},{key:"hasTextLayer",value:function(t){var e;return t===(null===(e=_(this,Lg))||void 0===e?void 0:e.div)}},{key:"addInkEditorIfNeeded",value:function(t){if(_(this,Ig).getMode()===X.INK){if(!t){var e,i=C(_(this,Zg).values());try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.isEmpty())return void n.setInBackground()}}catch(a){i.e(a)}finally{i.f()}}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}}},{key:"setEditingState",value:function(t){_(this,Ig).setEditingState(t)}},{key:"addCommands",value:function(t){_(this,Ig).addCommands(t)}},{key:"toggleDrawing",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("drawing",!t)}},{key:"togglePointerEvents",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("disabled",!t)}},{key:"toggleAnnotationLayerPointerEvents",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===(t=_(this,xg))||void 0===t||t.div.classList.toggle("disabled",!e)}},{key:"enable",value:function(){this.div.tabIndex=0,this.togglePointerEvents(!0);var t,e=new Set,i=C(_(this,Zg).values());try{for(i.s();!(t=i.n()).done;){var n=t.value;n.enableEditing(),n.show(!0),n.annotationElementId&&(_(this,Ig).removeChangedExistingAnnotation(n),e.add(n.annotationElementId))}}catch(l){i.e(l)}finally{i.f()}if(_(this,xg)){var a,r=C(_(this,xg).getEditableAnnotations());try{for(r.s();!(a=r.n()).done;){var s=a.value;if(s.hide(),!_(this,Ig).isDeletedAnnotationElement(s.data.id)&&!e.has(s.data.id)){var o=this.deserialize(s);o&&(this.addOrRebuild(o),o.enableEditing())}}}catch(l){r.e(l)}finally{r.f()}}}},{key:"disable",value:function(){x(this,Pg,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);var e,i=new Map,n=new Map,a=C(_(this,Zg).values());try{for(a.s();!(e=a.n()).done;){var r,s=e.value;s.disableEditing(),s.annotationElementId&&(null===s.serialize()?(n.set(s.annotationElementId,s),null===(r=this.getEditableAnnotation(s.annotationElementId))||void 0===r||r.show(),s.remove()):i.set(s.annotationElementId,s))}}catch(m){a.e(m)}finally{a.f()}if(_(this,xg)){var o,l=C(_(this,xg).getEditableAnnotations());try{for(l.s();!(o=l.n()).done;){var h=o.value,u=h.data.id;if(!_(this,Ig).isDeletedAnnotationElement(u)){var c=n.get(u);c?(c.resetAnnotationElement(h),c.show(!1),h.show()):((c=i.get(u))&&(_(this,Ig).addChangedExistingAnnotation(c),c.renderAnnotationElement(h),c.show(!1)),h.show())}}}catch(m){l.e(m)}finally{l.f()}}k(this,Og,Vg).call(this),this.isEmpty&&(this.div.hidden=!0);var d,v=this.div.classList,p=C(f(t,t,Gg).values());try{for(p.s();!(d=p.n()).done;){var g=d.value;v.remove("".concat(g._type,"Editing"))}}catch(m){p.e(m)}finally{p.f()}this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),x(this,Pg,!1)}},{key:"getEditableAnnotation",value:function(t){var e;return(null===(e=_(this,xg))||void 0===e?void 0:e.getEditableAnnotation(t))||null}},{key:"setActiveEditor",value:function(t){_(this,Ig).getActive()!==t&&_(this,Ig).setActiveEditor(t)}},{key:"enableTextSelection",value:function(){var t;this.div.tabIndex=-1,null!==(t=_(this,Lg))&&void 0!==t&&t.div&&!_(this,Eg)&&(x(this,Eg,k(this,Fg,Hg).bind(this)),_(this,Lg).div.addEventListener("pointerdown",_(this,Eg),{signal:_(this,Ig)._signal}),_(this,Lg).div.classList.add("highlighting"))}},{key:"disableTextSelection",value:function(){var t;this.div.tabIndex=0,null!==(t=_(this,Lg))&&void 0!==t&&t.div&&_(this,Eg)&&(_(this,Lg).div.removeEventListener("pointerdown",_(this,Eg)),x(this,Eg,null),_(this,Lg).div.classList.remove("highlighting"))}},{key:"enableClick",value:function(){if(!_(this,Mg)){var t=_(this,Ig)._signal;x(this,Mg,this.pointerdown.bind(this)),x(this,Sg,this.pointerup.bind(this)),this.div.addEventListener("pointerdown",_(this,Mg),{signal:t}),this.div.addEventListener("pointerup",_(this,Sg),{signal:t})}}},{key:"disableClick",value:function(){_(this,Mg)&&(this.div.removeEventListener("pointerdown",_(this,Mg)),this.div.removeEventListener("pointerup",_(this,Sg)),x(this,Mg,null),x(this,Sg,null))}},{key:"attach",value:function(t){_(this,Zg).set(t.id,t);var e=t.annotationElementId;e&&_(this,Ig).isDeletedAnnotationElement(e)&&_(this,Ig).removeDeletedAnnotationElement(t)}},{key:"detach",value:function(t){var e;_(this,Zg).delete(t.id),null===(e=_(this,Ag))||void 0===e||e.removePointerInTextLayer(t.contentDiv),!_(this,Pg)&&t.annotationElementId&&_(this,Ig).addDeletedAnnotationElement(t)}},{key:"remove",value:function(t){this.detach(t),_(this,Ig).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1,_(this,Rg)||this.addInkEditorIfNeeded(!1)}},{key:"changeParent",value:function(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(_(this,Ig).addDeletedAnnotationElement(t.annotationElementId),Gr.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),null===(e=t.parent)||void 0===e||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}},{key:"add",value:function(t){if(t.parent!==this||!t.isAttachedToDOM){if(this.changeParent(t),_(this,Ig).addEditor(t),this.attach(t),!t.isAttachedToDOM){var e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(),_(this,Ig).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}},{key:"moveEditorInDOM",value:function(t){var e,i=this;if(t.isAttachedToDOM){var n=document.activeElement;t.div.contains(n)&&!_(this,Cg)&&(t._focusEventsAllowed=!1,x(this,Cg,setTimeout((function(){x(i,Cg,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",(function(){t._focusEventsAllowed=!0}),{once:!0,signal:_(i,Ig)._signal}),n.focus())}),0))),t._structTreeParentId=null===(e=_(this,Ag))||void 0===e?void 0:e.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}}},{key:"addOrRebuild",value:function(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}},{key:"addUndoableEditor",value:function(t){this.addCommands({cmd:function(){return t._uiManager.rebuild(t)},undo:function(){t.remove()},mustExec:!1})}},{key:"getNextId",value:function(){return _(this,Ig).getId()}},{key:"_signal",get:function(){return _(this,Ig)._signal}},{key:"canCreateNewEmptyEditor",value:function(){var t;return null===(t=_(this,Dg))||void 0===t?void 0:t.canCreateNewEmptyEditor()}},{key:"pasteEditor",value:function(t,e){_(this,Ig).updateToolbar(t),_(this,Ig).updateMode(t);var i=k(this,Ng,Ug).call(this),a=i.offsetX,r=i.offsetY,s=this.getNextId(),o=k(this,Wg,jg).call(this,(0,n.Z)({parent:this,id:s,x:a,y:r,uiManager:_(this,Ig),isCentered:!0},e));o&&this.add(o)}},{key:"deserialize",value:function(e){var i,n;return(null===(i=f(t,t,Gg).get(null!==(n=e.annotationType)&&void 0!==n?n:e.annotationEditorType))||void 0===i?void 0:i.deserialize(e,this,_(this,Ig)))||null}},{key:"createAndAddNewEditor",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=this.getNextId(),r=k(this,Wg,jg).call(this,(0,n.Z)({parent:this,id:a,x:t.offsetX,y:t.offsetY,uiManager:_(this,Ig),isCentered:e},i));return r&&this.add(r),r}},{key:"addNewEditor",value:function(){this.createAndAddNewEditor(k(this,Ng,Ug).call(this),!0)}},{key:"setSelected",value:function(t){_(this,Ig).setSelected(t)}},{key:"toggleSelected",value:function(t){_(this,Ig).toggleSelected(t)}},{key:"isSelected",value:function(t){return _(this,Ig).isSelected(t)}},{key:"unselect",value:function(t){_(this,Ig).unselect(t)}},{key:"pointerup",value:function(t){var e=Jt.platform.isMac;0!==t.button||t.ctrlKey&&e||t.target===this.div&&_(this,Tg)&&(x(this,Tg,!1),_(this,_g)?_(this,Ig).getMode()!==X.STAMP?this.createAndAddNewEditor(t,!1):_(this,Ig).unselectAll():x(this,_g,!0))}},{key:"pointerdown",value:function(t){if(_(this,Ig).getMode()===X.HIGHLIGHT&&this.enableTextSelection(),_(this,Tg))x(this,Tg,!1);else{var e=Jt.platform.isMac;if(!(0!==t.button||t.ctrlKey&&e)&&t.target===this.div){x(this,Tg,!0);var i=_(this,Ig).getActive();x(this,_g,!i||i.isEmpty())}}}},{key:"findNewParent",value:function(t,e,i){var n=_(this,Ig).findParent(e,i);return null!==n&&n!==this&&(n.changeParent(t),!0)}},{key:"destroy",value:function(){var t;(null===(t=_(this,Ig).getActive())||void 0===t?void 0:t.parent)===this&&(_(this,Ig).commitOrRemove(),_(this,Ig).setActiveEditor(null)),_(this,Cg)&&(clearTimeout(_(this,Cg)),x(this,Cg,null));var e,i=C(_(this,Zg).values());try{for(i.s();!(e=i.n()).done;){var n,a=e.value;null===(n=_(this,Ag))||void 0===n||n.removePointerInTextLayer(a.contentDiv),a.setParent(null),a.isAttachedToDOM=!1,a.div.remove()}}catch(r){i.e(r)}finally{i.f()}this.div=null,_(this,Zg).clear(),_(this,Ig).removeLayer(this)}},{key:"render",value:function(t){var e=t.viewport;this.viewport=e,Si(this.div,e);var i,n=C(_(this,Ig).getEditors(this.pageIndex));try{for(n.s();!(i=n.n()).done;){var a=i.value;this.add(a),a.rebuild()}}catch(r){n.e(r)}finally{n.f()}this.updateMode()}},{key:"update",value:function(t){var e=t.viewport;_(this,Ig).commitOrRemove(),k(this,Og,Vg).call(this);var i=this.viewport.rotation,n=e.rotation;if(this.viewport=e,Si(this.div,{rotation:n}),i!==n){var a,r=C(_(this,Zg).values());try{for(r.s();!(a=r.n()).done;){a.value.rotate(n)}}catch(s){r.e(s)}finally{r.f()}}this.addInkEditorIfNeeded(!1)}},{key:"pageDimensions",get:function(){var t=this.viewport.rawDims;return[t.pageWidth,t.pageHeight]}},{key:"scale",get:function(){return _(this,Ig).viewParameters.realScale}}]),t}();function Hg(t){var e=this;_(this,Ig).unselectAll();var i=t.target;if(i===_(this,Lg).div||i.classList.contains("endOfContent")&&_(this,Lg).div.contains(i)){var n=Jt.platform.isMac;if(0!==t.button||t.ctrlKey&&n)return;_(this,Ig).showAllEditors("highlight",!0,!0),_(this,Lg).div.classList.add("free"),this.toggleDrawing(),pf.startHighlighting(this,"ltr"===_(this,Ig).direction,t),_(this,Lg).div.addEventListener("pointerup",(function(){_(e,Lg).div.classList.remove("free"),e.toggleDrawing(!0)}),{once:!0,signal:_(this,Ig)._signal}),t.preventDefault()}}function zg(){return f(Bg,Bg,Gg).get(_(this,Ig).getMode())}function jg(t){var e=_(this,Dg);return e?new e.prototype.constructor(t):null}function Ug(){var t=this.div.getBoundingClientRect(),e=t.x,i=t.y,n=t.width,a=t.height,r=Math.max(0,e),s=Math.max(0,i),o=(r+Math.min(window.innerWidth,e+n))/2-e,l=(s+Math.min(window.innerHeight,i+a))/2-i,h=this.viewport.rotation%180===0?[o,l]:[l,o],u=(0,M.Z)(h,2);return{offsetX:u[0],offsetY:u[1]}}function Vg(){x(this,Rg,!0);var t,e=C(_(this,Zg).values());try{for(e.s();!(t=e.n()).done;){var i=t.value;i.isEmpty()&&i.remove()}}catch(n){e.e(n)}finally{e.f()}x(this,Rg,!1)}(0,b.Z)(Bg,"_initialized",!1);var Gg={writable:!0,value:new Map([sd,pp,ug,pf].map((function(t){return[t._editorType,t]})))},qg=new WeakMap,Xg=new WeakMap,Kg=new WeakMap,Yg=new WeakMap,Qg=new WeakSet,Jg=new WeakSet,$g=function(){function t(e){var i=e.pageIndex;(0,T.Z)(this,t),y(this,Jg),y(this,Qg),A(this,qg,{writable:!0,value:null}),A(this,Xg,{writable:!0,value:0}),A(this,Kg,{writable:!0,value:new Map}),A(this,Yg,{writable:!0,value:new Map}),this.pageIndex=i}return(0,Z.Z)(t,[{key:"setParent",value:function(t){if(_(this,qg)){if(_(this,qg)!==t){if(_(this,Kg).size>0){var e,i=C(_(this,Kg).values());try{for(i.s();!(e=i.n()).done;){var n=e.value;n.remove(),t.append(n)}}catch(a){i.e(a)}finally{i.f()}}x(this,qg,t)}}else x(this,qg,t)}},{key:"highlight",value:function(e,i,n){var a,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=(x(this,Xg,1+(a=+_(this,Xg))),a),o=k(this,Qg,em).call(this,e.box);o.classList.add("highlight"),e.free&&o.classList.add("free");var l=t._svgFactory.createElement("defs");o.append(l);var h=t._svgFactory.createElement("path");l.append(h);var u="path_p".concat(this.pageIndex,"_").concat(s);h.setAttribute("id",u),h.setAttribute("d",e.toSVGPath()),r&&_(this,Yg).set(s,h);var c=k(this,Jg,im).call(this,l,u),d=t._svgFactory.createElement("use");return o.append(d),o.setAttribute("fill",i),o.setAttribute("fill-opacity",n),d.setAttribute("href","#".concat(u)),_(this,Kg).set(s,o),{id:s,clipPathId:"url(#".concat(c,")")}}},{key:"highlightOutline",value:function(e){var i,n=(x(this,Xg,1+(i=+_(this,Xg))),i),a=k(this,Qg,em).call(this,e.box);a.classList.add("highlightOutline");var r=t._svgFactory.createElement("defs");a.append(r);var s=t._svgFactory.createElement("path");r.append(s);var o,l="path_p".concat(this.pageIndex,"_").concat(n);if(s.setAttribute("id",l),s.setAttribute("d",e.toSVGPath()),s.setAttribute("vector-effect","non-scaling-stroke"),e.free){a.classList.add("free");var h=t._svgFactory.createElement("mask");r.append(h),o="mask_p".concat(this.pageIndex,"_").concat(n),h.setAttribute("id",o),h.setAttribute("maskUnits","objectBoundingBox");var u=t._svgFactory.createElement("rect");h.append(u),u.setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","white");var c=t._svgFactory.createElement("use");h.append(c),c.setAttribute("href","#".concat(l)),c.setAttribute("stroke","none"),c.setAttribute("fill","black"),c.setAttribute("fill-rule","nonzero"),c.classList.add("mask")}var d=t._svgFactory.createElement("use");a.append(d),d.setAttribute("href","#".concat(l)),o&&d.setAttribute("mask","url(#".concat(o,")"));var v=d.cloneNode();return a.append(v),d.classList.add("mainOutline"),v.classList.add("secondaryOutline"),_(this,Kg).set(n,a),n}},{key:"finalizeLine",value:function(t,e){var i=_(this,Yg).get(t);_(this,Yg).delete(t),this.updateBox(t,e.box),i.setAttribute("d",e.toSVGPath())}},{key:"updateLine",value:function(t,e){_(this,Kg).get(t).firstChild.firstChild.setAttribute("d",e.toSVGPath())}},{key:"removeFreeHighlight",value:function(t){this.remove(t),_(this,Yg).delete(t)}},{key:"updatePath",value:function(t,e){_(this,Yg).get(t).setAttribute("d",e.toSVGPath())}},{key:"updateBox",value:function(e,i){S(t,t,tm).call(t,_(this,Kg).get(e),i)}},{key:"show",value:function(t,e){_(this,Kg).get(t).classList.toggle("hidden",!e)}},{key:"rotate",value:function(t,e){_(this,Kg).get(t).setAttribute("data-main-rotation",e)}},{key:"changeColor",value:function(t,e){_(this,Kg).get(t).setAttribute("fill",e)}},{key:"changeOpacity",value:function(t,e){_(this,Kg).get(t).setAttribute("fill-opacity",e)}},{key:"addClass",value:function(t,e){_(this,Kg).get(t).classList.add(e)}},{key:"removeClass",value:function(t,e){_(this,Kg).get(t).classList.remove(e)}},{key:"remove",value:function(t){null!==_(this,qg)&&(_(this,Kg).get(t).remove(),_(this,Kg).delete(t))}},{key:"destroy",value:function(){x(this,qg,null);var t,e=C(_(this,Kg).values());try{for(e.s();!(t=e.n()).done;){t.value.remove()}}catch(i){e.e(i)}finally{e.f()}_(this,Kg).clear()}}],[{key:"_svgFactory",get:function(){return Bt(this,"_svgFactory",new hi)}}]),t}();function tm(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.x,n=void 0===i?0:i,a=e.y,r=void 0===a?0:a,s=e.width,o=void 0===s?1:s,l=e.height,h=void 0===l?1:l,u=t.style;u.top="".concat(100*r,"%"),u.left="".concat(100*n,"%"),u.width="".concat(100*o,"%"),u.height="".concat(100*h,"%")}function em(t){var e=$g._svgFactory.create(1,1,!0);return _(this,qg).append(e),e.setAttribute("aria-hidden",!0),S($g,$g,tm).call($g,e,t),e}function im(t,e){var i=$g._svgFactory.createElement("clipPath");t.append(i);var n="clip_".concat(e);i.setAttribute("id",n),i.setAttribute("clipPathUnits","objectBoundingBox");var a=$g._svgFactory.createElement("use");return i.append(a),a.setAttribute("href","#".concat(e)),a.classList.add("clip"),n}e.AbortException,e.AnnotationEditorLayer,e.AnnotationEditorParamsType,e.AnnotationEditorType,e.AnnotationEditorUIManager,e.AnnotationLayer,e.AnnotationMode,e.CMapCompressionType,e.ColorPicker,e.DOMSVGFactory,e.DrawLayer,e.FeatureTest;var nm=e.GlobalWorkerOptions,am=(e.ImageKind,e.InvalidPDFException,e.MissingPDFException,e.OPS,e.PDFDataRangeTransport,e.PDFDateString,e.PDFWorker,e.PasswordResponses,e.PermissionFlag,e.PixelsPerInch,e.RenderingCancelledException,e.TextLayer,e.UnexpectedResponseException,e.Util,e.VerbosityLevel,e.XfaLayer,e.build,e.createValidAbsoluteUrl,e.fetchData,e.getDocument);e.getFilenameFromUrl,e.getPdfFilenameFromUrl,e.getXfaPageViewport,e.isDataScheme,e.isPdfFile,e.noContextMenu,e.normalizeUnicode,e.setLayerDimensions,e.shadow,e.version;"undefined"!==typeof window&&"Worker"in window&&(nm.workerPort=new Worker(new URL(i.p+i.u(705),i.b),{type:void 0}))},20354:function(t,e,i){"use strict";function n(t,e,i){this.x=t,this.y=e,this.time=i||(new Date).getTime()}function a(t,e,i,n){this.startPoint=t,this.control1=e,this.control2=i,this.endPoint=n}function r(t,e){var i=this,n=e||{};this.velocityFilterWeight=n.velocityFilterWeight||.7,this.minWidth=n.minWidth||.5,this.maxWidth=n.maxWidth||2.5,this.throttle="throttle"in n?n.throttle:16,this.minDistance="minDistance"in n?n.minDistance:5,this.throttle?this._strokeMoveUpdate=function(t,e,i){var n,a,r,s=null,o=0;i||(i={});var l=function(){o=!1===i.leading?0:Date.now(),s=null,r=t.apply(n,a),s||(n=a=null)};return function(){var h=Date.now();o||!1!==i.leading||(o=h);var u=e-(h-o);return n=this,a=arguments,u<=0||u>e?(s&&(clearTimeout(s),s=null),o=h,r=t.apply(n,a),s||(n=a=null)):s||!1===i.trailing||(s=setTimeout(l,u)),r}}(r.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=r.prototype._strokeUpdate,this.dotSize=n.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=n.penColor||"black",this.backgroundColor=n.backgroundColor||"rgba(0,0,0,0)",this.onBegin=n.onBegin,this.onEnd=n.onEnd,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(t){1===t.which&&(i._mouseButtonDown=!0,i._strokeBegin(t))},this._handleMouseMove=function(t){i._mouseButtonDown&&i._strokeMoveUpdate(t)},this._handleMouseUp=function(t){1===t.which&&i._mouseButtonDown&&(i._mouseButtonDown=!1,i._strokeEnd(t))},this._handleTouchStart=function(t){if(1===t.targetTouches.length){var e=t.changedTouches[0];i._strokeBegin(e)}},this._handleTouchMove=function(t){t.preventDefault();var e=t.targetTouches[0];i._strokeMoveUpdate(e)},this._handleTouchEnd=function(t){t.target===i._canvas&&(t.preventDefault(),i._strokeEnd(t))},this.on()}i.r(e),n.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1},n.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},n.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time},a.prototype.length=function(){for(var t=0,e=void 0,i=void 0,n=0;n<=10;n+=1){var a=n/10,r=this._point(a,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),s=this._point(a,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(n>0){var o=r-e,l=s-i;t+=Math.sqrt(o*o+l*l)}e=r,i=s}return t},a.prototype._point=function(t,e,i,n,a){return e*(1-t)*(1-t)*(1-t)+3*i*(1-t)*(1-t)*t+3*n*(1-t)*t*t+a*t*t*t},r.prototype.clear=function(){var t=this._ctx,e=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._data=[],this._reset(),this._isEmpty=!0},r.prototype.fromDataURL=function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new Image,a=i.ratio||window.devicePixelRatio||1,r=i.width||this._canvas.width/a,s=i.height||this._canvas.height/a;this._reset(),n.src=t,n.onload=function(){e._ctx.drawImage(n,0,0,r,s)},this._isEmpty=!1},r.prototype.toDataURL=function(t){var e;if("image/svg+xml"===t)return this._toSVG();for(var i=arguments.length,n=Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];return(e=this._canvas).toDataURL.apply(e,[t].concat(n))},r.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},r.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},r.prototype.isEmpty=function(){return this._isEmpty},r.prototype._strokeBegin=function(t){this._data.push([]),this._reset(),this._strokeUpdate(t),"function"===typeof this.onBegin&&this.onBegin(t)},r.prototype._strokeUpdate=function(t){var e=t.clientX,i=t.clientY,n=this._createPoint(e,i),a=this._data[this._data.length-1],r=a&&a[a.length-1],s=r&&n.distanceTo(r)<this.minDistance;if(!r||!s){var o=this._addPoint(n),l=o.curve,h=o.widths;l&&h&&this._drawCurve(l,h.start,h.end),this._data[this._data.length-1].push({x:n.x,y:n.y,time:n.time,color:this.penColor})}},r.prototype._strokeEnd=function(t){var e=this.points.length>2,i=this.points[0];if(!e&&i&&this._drawDot(i),i){var n=this._data[this._data.length-1],a=n[n.length-1];i.equals(a)||n.push({x:i.x,y:i.y,time:i.time,color:this.penColor})}"function"===typeof this.onEnd&&this.onEnd(t)},r.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},r.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},r.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},r.prototype._createPoint=function(t,e,i){var a=this._canvas.getBoundingClientRect();return new n(t-a.left,e-a.top,i||(new Date).getTime())},r.prototype._addPoint=function(t){var e=this.points;if(e.push(t),e.length>2){3===e.length&&e.unshift(e[0]);var i=this._calculateCurveControlPoints(e[0],e[1],e[2]).c2,n=this._calculateCurveControlPoints(e[1],e[2],e[3]).c1,r=new a(e[1],i,n,e[2]),s=this._calculateCurveWidths(r);return e.shift(),{curve:r,widths:s}}return{}},r.prototype._calculateCurveControlPoints=function(t,e,i){var a=t.x-e.x,r=t.y-e.y,s=e.x-i.x,o=e.y-i.y,l=(t.x+e.x)/2,h=(t.y+e.y)/2,u=(e.x+i.x)/2,c=(e.y+i.y)/2,d=Math.sqrt(a*a+r*r),v=Math.sqrt(s*s+o*o),f=v/(d+v),p=u+(l-u)*f,g=c+(h-c)*f,m=e.x-p,y=e.y-g;return{c1:new n(l+m,h+y),c2:new n(u+m,c+y)}},r.prototype._calculateCurveWidths=function(t){var e=t.startPoint,i=t.endPoint,n={start:null,end:null},a=this.velocityFilterWeight*i.velocityFrom(e)+(1-this.velocityFilterWeight)*this._lastVelocity,r=this._strokeWidth(a);return n.start=this._lastWidth,n.end=r,this._lastVelocity=a,this._lastWidth=r,n},r.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)},r.prototype._drawPoint=function(t,e,i){var n=this._ctx;n.moveTo(t,e),n.arc(t,e,i,0,2*Math.PI,!1),this._isEmpty=!1},r.prototype._drawCurve=function(t,e,i){var n=this._ctx,a=i-e,r=Math.floor(t.length());n.beginPath();for(var s=0;s<r;s+=1){var o=s/r,l=o*o,h=l*o,u=1-o,c=u*u,d=c*u,v=d*t.startPoint.x;v+=3*c*o*t.control1.x,v+=3*u*l*t.control2.x,v+=h*t.endPoint.x;var f=d*t.startPoint.y;f+=3*c*o*t.control1.y,f+=3*u*l*t.control2.y,f+=h*t.endPoint.y;var p=e+h*a;this._drawPoint(v,f,p)}n.closePath(),n.fill()},r.prototype._drawDot=function(t){var e=this._ctx,i="function"===typeof this.dotSize?this.dotSize():this.dotSize;e.beginPath(),this._drawPoint(t.x,t.y,i),e.closePath(),e.fill()},r.prototype._fromData=function(t,e,i){for(var a=0;a<t.length;a+=1){var r=t[a];if(r.length>1)for(var s=0;s<r.length;s+=1){var o=r[s],l=new n(o.x,o.y,o.time),h=o.color;if(0===s)this.penColor=h,this._reset(),this._addPoint(l);else if(s!==r.length-1){var u=this._addPoint(l),c=u.curve,d=u.widths;c&&d&&e(c,d,h)}}else this._reset(),i(r[0])}},r.prototype._toSVG=function(){var t=this,e=this._data,i=this._canvas,n=Math.max(window.devicePixelRatio||1,1),a=i.width/n,r=i.height/n,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttributeNS(null,"width",i.width),s.setAttributeNS(null,"height",i.height),this._fromData(e,(function(t,e,i){var n=document.createElement("path");if(!isNaN(t.control1.x)&&!isNaN(t.control1.y)&&!isNaN(t.control2.x)&&!isNaN(t.control2.y)){var a="M "+t.startPoint.x.toFixed(3)+","+t.startPoint.y.toFixed(3)+" C "+t.control1.x.toFixed(3)+","+t.control1.y.toFixed(3)+" "+t.control2.x.toFixed(3)+","+t.control2.y.toFixed(3)+" "+t.endPoint.x.toFixed(3)+","+t.endPoint.y.toFixed(3);n.setAttribute("d",a),n.setAttribute("stroke-width",(2.25*e.end).toFixed(3)),n.setAttribute("stroke",i),n.setAttribute("fill","none"),n.setAttribute("stroke-linecap","round"),s.appendChild(n)}}),(function(e){var i=document.createElement("circle"),n="function"===typeof t.dotSize?t.dotSize():t.dotSize;i.setAttribute("r",n),i.setAttribute("cx",e.x),i.setAttribute("cy",e.y),i.setAttribute("fill",e.color),s.appendChild(i)}));var o='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 '+a+" "+r+'" width="'+a+'" height="'+r+'">',l=s.innerHTML;if(void 0===l){var h=document.createElement("dummy"),u=s.childNodes;h.innerHTML="";for(var c=0;c<u.length;c+=1)h.appendChild(u[c].cloneNode(!0));l=h.innerHTML}return"data:image/svg+xml;base64,"+btoa(o+l+"</svg>")},r.prototype.fromData=function(t){var e=this;this.clear(),this._fromData(t,(function(t,i){return e._drawCurve(t,i.start,i.end)}),(function(t){return e._drawDot(t)})),this._data=t},r.prototype.toData=function(){return this._data},e.default=r}}]);
//# sourceMappingURL=328.fa2386ac.chunk.js.map