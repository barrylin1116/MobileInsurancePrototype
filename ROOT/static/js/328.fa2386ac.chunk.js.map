{"version":3,"file":"static/js/328.fa2386ac.chunk.js","mappings":"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","sources":["../node_modules/react-signature-canvas/build/index.js","../node_modules/trim-canvas/build/index.js","../node_modules/@babel/runtime/helpers/esm/assertClassBrand.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldGet2.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldDestructureSet.js","../node_modules/@babel/runtime/helpers/esm/classApplyDescriptorDestructureSet.js","../node_modules/@babel/runtime/helpers/esm/superPropBase.js","../node_modules/@babel/runtime/helpers/esm/get.js","../node_modules/@babel/runtime/helpers/esm/classApplyDescriptorSet.js","../node_modules/@babel/runtime/helpers/esm/classCheckPrivateStaticFieldDescriptor.js","../node_modules/@babel/runtime/helpers/esm/classStaticPrivateFieldSpecSet.js","../node_modules/@babel/runtime/helpers/esm/classApplyDescriptorGet.js","../node_modules/@babel/runtime/helpers/esm/classStaticPrivateFieldSpecGet.js","../node_modules/@babel/runtime/helpers/esm/checkPrivateRedeclaration.js","../node_modules/@babel/runtime/helpers/esm/classPrivateMethodInitSpec.js","../node_modules/@babel/runtime/helpers/esm/classPrivateMethodGet.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldInitSpec.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldGet.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldSet.js","../node_modules/@babel/runtime/helpers/esm/classStaticPrivateMethodGet.js","../node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js","../pdf.js/webpack/bootstrap","../webpack:/pdf.js/webpack/runtime/define property getters","../webpack:/pdf.js/webpack/runtime/hasOwnProperty shorthand","../pdf.js/src/shared/util.js","../pdf.js/src/display/base_factory.js","../pdf.js/src/display/display_utils.js","../pdf.js/src/display/editor/toolbar.js","../pdf.js/src/display/editor/tools.js","../pdf.js/src/display/editor/alt_text.js","../pdf.js/src/display/editor/editor.js","../pdf.js/src/shared/murmurhash3.js","../pdf.js/src/display/annotation_storage.js","../pdf.js/src/display/font_loader.js","../pdf.js/src/display/node_utils.js","../pdf.js/src/display/pattern_helper.js","../pdf.js/src/shared/image_utils.js","../pdf.js/src/display/canvas.js","../pdf.js/src/display/worker_options.js","../pdf.js/src/shared/message_handler.js","../pdf.js/src/display/metadata.js","../pdf.js/src/display/optional_content_config.js","../pdf.js/src/display/transport_stream.js","../pdf.js/src/display/network_utils.js","../pdf.js/src/display/content_disposition.js","../pdf.js/src/display/fetch_stream.js","../pdf.js/src/display/network.js","../pdf.js/src/display/node_stream.js","../pdf.js/src/display/text_layer.js","../pdf.js/src/display/xfa_text.js","../pdf.js/src/display/api.js","../pdf.js/src/shared/scripting_utils.js","../pdf.js/src/display/xfa_layer.js","../pdf.js/src/display/annotation_layer.js","../pdf.js/src/display/editor/freetext.js","../pdf.js/src/display/editor/outliner.js","../pdf.js/src/display/editor/color_picker.js","../pdf.js/src/display/editor/highlight.js","../pdf.js/src/display/editor/ink.js","../pdf.js/src/display/editor/stamp.js","../pdf.js/src/display/editor/annotation_editor_layer.js","../pdf.js/src/display/draw_layer.js","../pdf.js/src/pdf.js","../node_modules/pdfjs-dist/webpack.mjs","../node_modules/signature_pad/dist/signature_pad.mjs"],"sourcesContent":["!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t(require(\"prop-types\"),require(\"react\"),require(\"signature_pad\"),require(\"trim-canvas\")):\"function\"==typeof define&&define.amd?define([\"prop-types\",\"react\",\"signature_pad\",\"trim-canvas\"],t):\"object\"==typeof exports?exports.SignatureCanvas=t(require(\"prop-types\"),require(\"react\"),require(\"signature_pad\"),require(\"trim-canvas\")):e.SignatureCanvas=t(e[\"prop-types\"],e.react,e.signature_pad,e[\"trim-canvas\"])}(this,function(e,t,n,r){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p=\"\",t(0)}([function(e,t,n){\"use strict\";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function o(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function i(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function u(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,\"__esModule\",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(1),p=r(f),l=n(2),d=r(l),v=n(3),h=r(v),_=n(4),g=r(_),m=function(e){function t(){var e,n,r,u;o(this,t);for(var s=arguments.length,c=Array(s),f=0;f<s;f++)c[f]=arguments[f];return n=r=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r._sigPad=null,r._excludeOurProps=function(){var e=r.props,t=(e.canvasProps,e.clearOnResize,a(e,[\"canvasProps\",\"clearOnResize\"]));return t},r.getCanvas=function(){return r._canvas},r.getTrimmedCanvas=function(){var e=document.createElement(\"canvas\");return e.width=r._canvas.width,e.height=r._canvas.height,e.getContext(\"2d\").drawImage(r._canvas,0,0),(0,g.default)(e)},r.getSignaturePad=function(){return r._sigPad},r._checkClearOnResize=function(){r.props.clearOnResize&&r._resizeCanvas()},r._resizeCanvas=function(){var e=r.props.canvasProps||{},t=e.width,n=e.height;if(!t||!n){var a=r._canvas,o=Math.max(window.devicePixelRatio||1,1);t||(a.width=a.offsetWidth*o),n||(a.height=a.offsetHeight*o),a.getContext(\"2d\").scale(o,o),r.clear()}},r.on=function(){return window.addEventListener(\"resize\",r._checkClearOnResize),r._sigPad.on()},r.off=function(){return window.removeEventListener(\"resize\",r._checkClearOnResize),r._sigPad.off()},r.clear=function(){return r._sigPad.clear()},r.isEmpty=function(){return r._sigPad.isEmpty()},r.fromDataURL=function(e,t){return r._sigPad.fromDataURL(e,t)},r.toDataURL=function(e,t){return r._sigPad.toDataURL(e,t)},r.fromData=function(e){return r._sigPad.fromData(e)},r.toData=function(){return r._sigPad.toData()},u=n,i(r,u)}return u(t,e),c(t,[{key:\"componentDidMount\",value:function(){this._sigPad=new h.default(this._canvas,this._excludeOurProps()),this._resizeCanvas(),this.on()}},{key:\"componentWillUnmount\",value:function(){this.off()}},{key:\"componentDidUpdate\",value:function(){Object.assign(this._sigPad,this._excludeOurProps())}},{key:\"render\",value:function(){var e=this,t=this.props.canvasProps;return d.default.createElement(\"canvas\",s({ref:function(t){e._canvas=t}},t))}}]),t}(l.Component);m.propTypes={velocityFilterWeight:p.default.number,minWidth:p.default.number,maxWidth:p.default.number,minDistance:p.default.number,dotSize:p.default.oneOfType([p.default.number,p.default.func]),penColor:p.default.string,throttle:p.default.number,onEnd:p.default.func,onBegin:p.default.func,canvasProps:p.default.object,clearOnResize:p.default.bool},m.defaultProps={clearOnResize:!0},t.default=m},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r}])});","!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define([],t):\"object\"==typeof exports?exports.trimCanvas=t():e.trimCanvas=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p=\"\",t(0)}([function(e,t){\"use strict\";function r(e){var t=e.getContext(\"2d\"),r=e.width,n=e.height,o=t.getImageData(0,0,r,n).data,f=a(!0,r,n,o),i=a(!1,r,n,o),c=u(!0,r,n,o),d=u(!1,r,n,o),p=d-c+1,l=i-f+1,s=t.getImageData(c,f,p,l);return e.width=p,e.height=l,t.clearRect(0,0,p,l),t.putImageData(s,0,0),e}function n(e,t,r,n){return{red:n[4*(r*t+e)],green:n[4*(r*t+e)+1],blue:n[4*(r*t+e)+2],alpha:n[4*(r*t+e)+3]}}function o(e,t,r,o){return n(e,t,r,o).alpha}function a(e,t,r,n){for(var a=e?1:-1,u=e?0:r-1,f=u;e?f<r:f>-1;f+=a)for(var i=0;i<t;i++)if(o(i,f,t,n))return f;return null}function u(e,t,r,n){for(var a=e?1:-1,u=e?0:t-1,f=u;e?f<t:f>-1;f+=a)for(var i=0;i<r;i++)if(o(f,i,t,n))return f;return null}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=r}])});","function _assertClassBrand(e, t, n) {\n  if (\"function\" == typeof e ? e === t : e.has(t)) return arguments.length < 3 ? t : n;\n  throw new TypeError(\"Private element is not present on this object\");\n}\nexport { _assertClassBrand as default };","import assertClassBrand from \"./assertClassBrand.js\";\nfunction _classPrivateFieldGet2(s, a) {\n  return s.get(assertClassBrand(s, a));\n}\nexport { _classPrivateFieldGet2 as default };","import classApplyDescriptorDestructureSet from \"./classApplyDescriptorDestructureSet.js\";\nimport classPrivateFieldGet2 from \"./classPrivateFieldGet2.js\";\nfunction _classPrivateFieldDestructureSet(e, t) {\n  var r = classPrivateFieldGet2(t, e);\n  return classApplyDescriptorDestructureSet(e, r);\n}\nexport { _classPrivateFieldDestructureSet as default };","function _classApplyDescriptorDestructureSet(e, t) {\n  if (t.set) return \"__destrObj\" in t || (t.__destrObj = {\n    set value(r) {\n      t.set.call(e, r);\n    }\n  }), t.__destrObj;\n  if (!t.writable) throw new TypeError(\"attempted to set read only private field\");\n  return t;\n}\nexport { _classApplyDescriptorDestructureSet as default };","import getPrototypeOf from \"./getPrototypeOf.js\";\nfunction _superPropBase(t, o) {\n  for (; !{}.hasOwnProperty.call(t, o) && null !== (t = getPrototypeOf(t)););\n  return t;\n}\nexport { _superPropBase as default };","import superPropBase from \"./superPropBase.js\";\nfunction _get() {\n  return _get = \"undefined\" != typeof Reflect && Reflect.get ? Reflect.get.bind() : function (e, t, r) {\n    var p = superPropBase(e, t);\n    if (p) {\n      var n = Object.getOwnPropertyDescriptor(p, t);\n      return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value;\n    }\n  }, _get.apply(null, arguments);\n}\nexport { _get as default };","function _classApplyDescriptorSet(e, t, l) {\n  if (t.set) t.set.call(e, l);else {\n    if (!t.writable) throw new TypeError(\"attempted to set read only private field\");\n    t.value = l;\n  }\n}\nexport { _classApplyDescriptorSet as default };","function _classCheckPrivateStaticFieldDescriptor(t, e) {\n  if (void 0 === t) throw new TypeError(\"attempted to \" + e + \" private static field before its declaration\");\n}\nexport { _classCheckPrivateStaticFieldDescriptor as default };","import classApplyDescriptorSet from \"./classApplyDescriptorSet.js\";\nimport assertClassBrand from \"./assertClassBrand.js\";\nimport classCheckPrivateStaticFieldDescriptor from \"./classCheckPrivateStaticFieldDescriptor.js\";\nfunction _classStaticPrivateFieldSpecSet(s, t, r, e) {\n  return assertClassBrand(t, s), classCheckPrivateStaticFieldDescriptor(r, \"set\"), classApplyDescriptorSet(s, r, e), e;\n}\nexport { _classStaticPrivateFieldSpecSet as default };","function _classApplyDescriptorGet(e, t) {\n  return t.get ? t.get.call(e) : t.value;\n}\nexport { _classApplyDescriptorGet as default };","import classApplyDescriptorGet from \"./classApplyDescriptorGet.js\";\nimport assertClassBrand from \"./assertClassBrand.js\";\nimport classCheckPrivateStaticFieldDescriptor from \"./classCheckPrivateStaticFieldDescriptor.js\";\nfunction _classStaticPrivateFieldSpecGet(t, s, r) {\n  return assertClassBrand(s, t), classCheckPrivateStaticFieldDescriptor(r, \"get\"), classApplyDescriptorGet(t, r);\n}\nexport { _classStaticPrivateFieldSpecGet as default };","function _checkPrivateRedeclaration(e, t) {\n  if (t.has(e)) throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n}\nexport { _checkPrivateRedeclaration as default };","import checkPrivateRedeclaration from \"./checkPrivateRedeclaration.js\";\nfunction _classPrivateMethodInitSpec(e, a) {\n  checkPrivateRedeclaration(e, a), a.add(e);\n}\nexport { _classPrivateMethodInitSpec as default };","import assertClassBrand from \"./assertClassBrand.js\";\nfunction _classPrivateMethodGet(s, a, r) {\n  return assertClassBrand(a, s), r;\n}\nexport { _classPrivateMethodGet as default };","import checkPrivateRedeclaration from \"./checkPrivateRedeclaration.js\";\nfunction _classPrivateFieldInitSpec(e, t, a) {\n  checkPrivateRedeclaration(e, t), t.set(e, a);\n}\nexport { _classPrivateFieldInitSpec as default };","import classApplyDescriptorGet from \"./classApplyDescriptorGet.js\";\nimport classPrivateFieldGet2 from \"./classPrivateFieldGet2.js\";\nfunction _classPrivateFieldGet(e, t) {\n  var r = classPrivateFieldGet2(t, e);\n  return classApplyDescriptorGet(e, r);\n}\nexport { _classPrivateFieldGet as default };","import classApplyDescriptorSet from \"./classApplyDescriptorSet.js\";\nimport classPrivateFieldGet2 from \"./classPrivateFieldGet2.js\";\nfunction _classPrivateFieldSet(e, t, r) {\n  var s = classPrivateFieldGet2(t, e);\n  return classApplyDescriptorSet(e, s, r), r;\n}\nexport { _classPrivateFieldSet as default };","import assertClassBrand from \"./assertClassBrand.js\";\nfunction _classStaticPrivateMethodGet(s, a, t) {\n  return assertClassBrand(a, s), t;\n}\nexport { _classStaticPrivateMethodGet as default };","import unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nfunction _createForOfIteratorHelper(r, e) {\n  var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (!t) {\n    if (Array.isArray(r) || (t = unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) {\n      t && (r = t);\n      var _n = 0,\n        F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          return _n >= r.length ? {\n            done: !0\n          } : {\n            done: !1,\n            value: r[_n++]\n          };\n        },\n        e: function e(r) {\n          throw r;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var o,\n    a = !0,\n    u = !1;\n  return {\n    s: function s() {\n      t = t.call(r);\n    },\n    n: function n() {\n      var r = t.next();\n      return a = r.done, r;\n    },\n    e: function e(r) {\n      u = !0, o = r;\n    },\n    f: function f() {\n      try {\n        a || null == t[\"return\"] || t[\"return\"]();\n      } finally {\n        if (u) throw o;\n      }\n    }\n  };\n}\nexport { _createForOfIteratorHelper as default };","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* globals process */\n\n// NW.js / Electron is a browser context, but copies some Node.js objects; see\n// http://docs.nwjs.io/en/latest/For%20Users/Advanced/JavaScript%20Contexts%20in%20NW.js/#access-nodejs-and-nwjs-api-in-browser-context\n// https://www.electronjs.org/docs/api/process#processversionselectron-readonly\n// https://www.electronjs.org/docs/api/process#processtype-readonly\nconst isNodeJS =\n  (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n  typeof process === \"object\" &&\n  process + \"\" === \"[object process]\" &&\n  !process.versions.nw &&\n  !(process.versions.electron && process.type && process.type !== \"browser\");\n\nconst IDENTITY_MATRIX = [1, 0, 0, 1, 0, 0];\nconst FONT_IDENTITY_MATRIX = [0.001, 0, 0, 0.001, 0, 0];\n\nconst MAX_IMAGE_SIZE_TO_CACHE = 10e6; // Ten megabytes.\n\n// Represent the percentage of the height of a single-line field over\n// the font size. Acrobat seems to use this value.\nconst LINE_FACTOR = 1.35;\nconst LINE_DESCENT_FACTOR = 0.35;\nconst BASELINE_FACTOR = LINE_DESCENT_FACTOR / LINE_FACTOR;\n\n/**\n * Refer to the `WorkerTransport.getRenderingIntent`-method in the API, to see\n * how these flags are being used:\n *  - ANY, DISPLAY, and PRINT are the normal rendering intents, note the\n *    `PDFPageProxy.{render, getOperatorList, getAnnotations}`-methods.\n *  - SAVE is used, on the worker-thread, when saving modified annotations.\n *  - ANNOTATIONS_FORMS, ANNOTATIONS_STORAGE, ANNOTATIONS_DISABLE control which\n *    annotations are rendered onto the canvas (i.e. by being included in the\n *    operatorList), note the `PDFPageProxy.{render, getOperatorList}`-methods\n *    and their `annotationMode`-option.\n *  - IS_EDITING is used when editing is active in the viewer.\n *  - OPLIST is used with the `PDFPageProxy.getOperatorList`-method, note the\n *    `OperatorList`-constructor (on the worker-thread).\n */\nconst RenderingIntentFlag = {\n  ANY: 0x01,\n  DISPLAY: 0x02,\n  PRINT: 0x04,\n  SAVE: 0x08,\n  ANNOTATIONS_FORMS: 0x10,\n  ANNOTATIONS_STORAGE: 0x20,\n  ANNOTATIONS_DISABLE: 0x40,\n  IS_EDITING: 0x80,\n  OPLIST: 0x100,\n};\n\nconst AnnotationMode = {\n  DISABLE: 0,\n  ENABLE: 1,\n  ENABLE_FORMS: 2,\n  ENABLE_STORAGE: 3,\n};\n\nconst AnnotationEditorPrefix = \"pdfjs_internal_editor_\";\n\nconst AnnotationEditorType = {\n  DISABLE: -1,\n  NONE: 0,\n  FREETEXT: 3,\n  HIGHLIGHT: 9,\n  STAMP: 13,\n  INK: 15,\n};\n\nconst AnnotationEditorParamsType = {\n  RESIZE: 1,\n  CREATE: 2,\n  FREETEXT_SIZE: 11,\n  FREETEXT_COLOR: 12,\n  FREETEXT_OPACITY: 13,\n  INK_COLOR: 21,\n  INK_THICKNESS: 22,\n  INK_OPACITY: 23,\n  HIGHLIGHT_COLOR: 31,\n  HIGHLIGHT_DEFAULT_COLOR: 32,\n  HIGHLIGHT_THICKNESS: 33,\n  HIGHLIGHT_FREE: 34,\n  HIGHLIGHT_SHOW_ALL: 35,\n};\n\n// Permission flags from Table 22, Section 7.6.3.2 of the PDF specification.\nconst PermissionFlag = {\n  PRINT: 0x04,\n  MODIFY_CONTENTS: 0x08,\n  COPY: 0x10,\n  MODIFY_ANNOTATIONS: 0x20,\n  FILL_INTERACTIVE_FORMS: 0x100,\n  COPY_FOR_ACCESSIBILITY: 0x200,\n  ASSEMBLE: 0x400,\n  PRINT_HIGH_QUALITY: 0x800,\n};\n\nconst TextRenderingMode = {\n  FILL: 0,\n  STROKE: 1,\n  FILL_STROKE: 2,\n  INVISIBLE: 3,\n  FILL_ADD_TO_PATH: 4,\n  STROKE_ADD_TO_PATH: 5,\n  FILL_STROKE_ADD_TO_PATH: 6,\n  ADD_TO_PATH: 7,\n  FILL_STROKE_MASK: 3,\n  ADD_TO_PATH_FLAG: 4,\n};\n\nconst ImageKind = {\n  GRAYSCALE_1BPP: 1,\n  RGB_24BPP: 2,\n  RGBA_32BPP: 3,\n};\n\nconst AnnotationType = {\n  TEXT: 1,\n  LINK: 2,\n  FREETEXT: 3,\n  LINE: 4,\n  SQUARE: 5,\n  CIRCLE: 6,\n  POLYGON: 7,\n  POLYLINE: 8,\n  HIGHLIGHT: 9,\n  UNDERLINE: 10,\n  SQUIGGLY: 11,\n  STRIKEOUT: 12,\n  STAMP: 13,\n  CARET: 14,\n  INK: 15,\n  POPUP: 16,\n  FILEATTACHMENT: 17,\n  SOUND: 18,\n  MOVIE: 19,\n  WIDGET: 20,\n  SCREEN: 21,\n  PRINTERMARK: 22,\n  TRAPNET: 23,\n  WATERMARK: 24,\n  THREED: 25,\n  REDACT: 26,\n};\n\nconst AnnotationReplyType = {\n  GROUP: \"Group\",\n  REPLY: \"R\",\n};\n\nconst AnnotationFlag = {\n  INVISIBLE: 0x01,\n  HIDDEN: 0x02,\n  PRINT: 0x04,\n  NOZOOM: 0x08,\n  NOROTATE: 0x10,\n  NOVIEW: 0x20,\n  READONLY: 0x40,\n  LOCKED: 0x80,\n  TOGGLENOVIEW: 0x100,\n  LOCKEDCONTENTS: 0x200,\n};\n\nconst AnnotationFieldFlag = {\n  READONLY: 0x0000001,\n  REQUIRED: 0x0000002,\n  NOEXPORT: 0x0000004,\n  MULTILINE: 0x0001000,\n  PASSWORD: 0x0002000,\n  NOTOGGLETOOFF: 0x0004000,\n  RADIO: 0x0008000,\n  PUSHBUTTON: 0x0010000,\n  COMBO: 0x0020000,\n  EDIT: 0x0040000,\n  SORT: 0x0080000,\n  FILESELECT: 0x0100000,\n  MULTISELECT: 0x0200000,\n  DONOTSPELLCHECK: 0x0400000,\n  DONOTSCROLL: 0x0800000,\n  COMB: 0x1000000,\n  RICHTEXT: 0x2000000,\n  RADIOSINUNISON: 0x2000000,\n  COMMITONSELCHANGE: 0x4000000,\n};\n\nconst AnnotationBorderStyleType = {\n  SOLID: 1,\n  DASHED: 2,\n  BEVELED: 3,\n  INSET: 4,\n  UNDERLINE: 5,\n};\n\nconst AnnotationActionEventType = {\n  E: \"Mouse Enter\",\n  X: \"Mouse Exit\",\n  D: \"Mouse Down\",\n  U: \"Mouse Up\",\n  Fo: \"Focus\",\n  Bl: \"Blur\",\n  PO: \"PageOpen\",\n  PC: \"PageClose\",\n  PV: \"PageVisible\",\n  PI: \"PageInvisible\",\n  K: \"Keystroke\",\n  F: \"Format\",\n  V: \"Validate\",\n  C: \"Calculate\",\n};\n\nconst DocumentActionEventType = {\n  WC: \"WillClose\",\n  WS: \"WillSave\",\n  DS: \"DidSave\",\n  WP: \"WillPrint\",\n  DP: \"DidPrint\",\n};\n\nconst PageActionEventType = {\n  O: \"PageOpen\",\n  C: \"PageClose\",\n};\n\nconst VerbosityLevel = {\n  ERRORS: 0,\n  WARNINGS: 1,\n  INFOS: 5,\n};\n\nconst CMapCompressionType = {\n  NONE: 0,\n  BINARY: 1,\n};\n\n// All the possible operations for an operator list.\nconst OPS = {\n  // Intentionally start from 1 so it is easy to spot bad operators that will be\n  // 0's.\n  // PLEASE NOTE: We purposely keep any removed operators commented out, since\n  //              re-numbering the list would risk breaking third-party users.\n  dependency: 1,\n  setLineWidth: 2,\n  setLineCap: 3,\n  setLineJoin: 4,\n  setMiterLimit: 5,\n  setDash: 6,\n  setRenderingIntent: 7,\n  setFlatness: 8,\n  setGState: 9,\n  save: 10,\n  restore: 11,\n  transform: 12,\n  moveTo: 13,\n  lineTo: 14,\n  curveTo: 15,\n  curveTo2: 16,\n  curveTo3: 17,\n  closePath: 18,\n  rectangle: 19,\n  stroke: 20,\n  closeStroke: 21,\n  fill: 22,\n  eoFill: 23,\n  fillStroke: 24,\n  eoFillStroke: 25,\n  closeFillStroke: 26,\n  closeEOFillStroke: 27,\n  endPath: 28,\n  clip: 29,\n  eoClip: 30,\n  beginText: 31,\n  endText: 32,\n  setCharSpacing: 33,\n  setWordSpacing: 34,\n  setHScale: 35,\n  setLeading: 36,\n  setFont: 37,\n  setTextRenderingMode: 38,\n  setTextRise: 39,\n  moveText: 40,\n  setLeadingMoveText: 41,\n  setTextMatrix: 42,\n  nextLine: 43,\n  showText: 44,\n  showSpacedText: 45,\n  nextLineShowText: 46,\n  nextLineSetSpacingShowText: 47,\n  setCharWidth: 48,\n  setCharWidthAndBounds: 49,\n  setStrokeColorSpace: 50,\n  setFillColorSpace: 51,\n  setStrokeColor: 52,\n  setStrokeColorN: 53,\n  setFillColor: 54,\n  setFillColorN: 55,\n  setStrokeGray: 56,\n  setFillGray: 57,\n  setStrokeRGBColor: 58,\n  setFillRGBColor: 59,\n  setStrokeCMYKColor: 60,\n  setFillCMYKColor: 61,\n  shadingFill: 62,\n  beginInlineImage: 63,\n  beginImageData: 64,\n  endInlineImage: 65,\n  paintXObject: 66,\n  markPoint: 67,\n  markPointProps: 68,\n  beginMarkedContent: 69,\n  beginMarkedContentProps: 70,\n  endMarkedContent: 71,\n  beginCompat: 72,\n  endCompat: 73,\n  paintFormXObjectBegin: 74,\n  paintFormXObjectEnd: 75,\n  beginGroup: 76,\n  endGroup: 77,\n  // beginAnnotations: 78,\n  // endAnnotations: 79,\n  beginAnnotation: 80,\n  endAnnotation: 81,\n  // paintJpegXObject: 82,\n  paintImageMaskXObject: 83,\n  paintImageMaskXObjectGroup: 84,\n  paintImageXObject: 85,\n  paintInlineImageXObject: 86,\n  paintInlineImageXObjectGroup: 87,\n  paintImageXObjectRepeat: 88,\n  paintImageMaskXObjectRepeat: 89,\n  paintSolidColorImageMask: 90,\n  constructPath: 91,\n  setStrokeTransparent: 92,\n  setFillTransparent: 93,\n};\n\nconst PasswordResponses = {\n  NEED_PASSWORD: 1,\n  INCORRECT_PASSWORD: 2,\n};\n\nlet verbosity = VerbosityLevel.WARNINGS;\n\nfunction setVerbosityLevel(level) {\n  if (Number.isInteger(level)) {\n    verbosity = level;\n  }\n}\n\nfunction getVerbosityLevel() {\n  return verbosity;\n}\n\n// A notice for devs. These are good for things that are helpful to devs, such\n// as warning that Workers were disabled, which is important to devs but not\n// end users.\nfunction info(msg) {\n  if (verbosity >= VerbosityLevel.INFOS) {\n    console.log(`Info: ${msg}`);\n  }\n}\n\n// Non-fatal warnings.\nfunction warn(msg) {\n  if (verbosity >= VerbosityLevel.WARNINGS) {\n    console.log(`Warning: ${msg}`);\n  }\n}\n\nfunction unreachable(msg) {\n  throw new Error(msg);\n}\n\nfunction assert(cond, msg) {\n  if (!cond) {\n    unreachable(msg);\n  }\n}\n\n// Checks if URLs use one of the allowed protocols, e.g. to avoid XSS.\nfunction _isValidProtocol(url) {\n  switch (url?.protocol) {\n    case \"http:\":\n    case \"https:\":\n    case \"ftp:\":\n    case \"mailto:\":\n    case \"tel:\":\n      return true;\n    default:\n      return false;\n  }\n}\n\n/**\n * Attempts to create a valid absolute URL.\n *\n * @param {URL|string} url - An absolute, or relative, URL.\n * @param {URL|string} [baseUrl] - An absolute URL.\n * @param {Object} [options]\n * @returns Either a valid {URL}, or `null` otherwise.\n */\nfunction createValidAbsoluteUrl(url, baseUrl = null, options = null) {\n  if (!url) {\n    return null;\n  }\n  try {\n    if (options && typeof url === \"string\") {\n      // Let URLs beginning with \"www.\" default to using the \"http://\" protocol.\n      if (options.addDefaultProtocol && url.startsWith(\"www.\")) {\n        const dots = url.match(/\\./g);\n        // Avoid accidentally matching a *relative* URL pointing to a file named\n        // e.g. \"www.pdf\" or similar.\n        if (dots?.length >= 2) {\n          url = `http://${url}`;\n        }\n      }\n\n      // According to ISO 32000-1:2008, section 12.6.4.7, URIs should be encoded\n      // in 7-bit ASCII. Some bad PDFs use UTF-8 encoding; see bug 1122280.\n      if (options.tryConvertEncoding) {\n        try {\n          url = stringToUTF8String(url);\n        } catch {}\n      }\n    }\n\n    const absoluteUrl = baseUrl ? new URL(url, baseUrl) : new URL(url);\n    if (_isValidProtocol(absoluteUrl)) {\n      return absoluteUrl;\n    }\n  } catch {\n    /* `new URL()` will throw on incorrect data. */\n  }\n  return null;\n}\n\nfunction shadow(obj, prop, value, nonSerializable = false) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      prop in obj,\n      `shadow: Property \"${prop && prop.toString()}\" not found in object.`\n    );\n  }\n  Object.defineProperty(obj, prop, {\n    value,\n    enumerable: !nonSerializable,\n    configurable: true,\n    writable: false,\n  });\n  return value;\n}\n\n/**\n * @type {any}\n */\nconst BaseException = (function BaseExceptionClosure() {\n  // eslint-disable-next-line no-shadow\n  function BaseException(message, name) {\n    if (this.constructor === BaseException) {\n      unreachable(\"Cannot initialize BaseException.\");\n    }\n    this.message = message;\n    this.name = name;\n  }\n  BaseException.prototype = new Error();\n  BaseException.constructor = BaseException;\n\n  return BaseException;\n})();\n\nclass PasswordException extends BaseException {\n  constructor(msg, code) {\n    super(msg, \"PasswordException\");\n    this.code = code;\n  }\n}\n\nclass UnknownErrorException extends BaseException {\n  constructor(msg, details) {\n    super(msg, \"UnknownErrorException\");\n    this.details = details;\n  }\n}\n\nclass InvalidPDFException extends BaseException {\n  constructor(msg) {\n    super(msg, \"InvalidPDFException\");\n  }\n}\n\nclass MissingPDFException extends BaseException {\n  constructor(msg) {\n    super(msg, \"MissingPDFException\");\n  }\n}\n\nclass UnexpectedResponseException extends BaseException {\n  constructor(msg, status) {\n    super(msg, \"UnexpectedResponseException\");\n    this.status = status;\n  }\n}\n\n/**\n * Error caused during parsing PDF data.\n */\nclass FormatError extends BaseException {\n  constructor(msg) {\n    super(msg, \"FormatError\");\n  }\n}\n\n/**\n * Error used to indicate task cancellation.\n */\nclass AbortException extends BaseException {\n  constructor(msg) {\n    super(msg, \"AbortException\");\n  }\n}\n\nfunction bytesToString(bytes) {\n  if (typeof bytes !== \"object\" || bytes?.length === undefined) {\n    unreachable(\"Invalid argument for bytesToString\");\n  }\n  const length = bytes.length;\n  const MAX_ARGUMENT_COUNT = 8192;\n  if (length < MAX_ARGUMENT_COUNT) {\n    return String.fromCharCode.apply(null, bytes);\n  }\n  const strBuf = [];\n  for (let i = 0; i < length; i += MAX_ARGUMENT_COUNT) {\n    const chunkEnd = Math.min(i + MAX_ARGUMENT_COUNT, length);\n    const chunk = bytes.subarray(i, chunkEnd);\n    strBuf.push(String.fromCharCode.apply(null, chunk));\n  }\n  return strBuf.join(\"\");\n}\n\nfunction stringToBytes(str) {\n  if (typeof str !== \"string\") {\n    unreachable(\"Invalid argument for stringToBytes\");\n  }\n  const length = str.length;\n  const bytes = new Uint8Array(length);\n  for (let i = 0; i < length; ++i) {\n    bytes[i] = str.charCodeAt(i) & 0xff;\n  }\n  return bytes;\n}\n\nfunction string32(value) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      typeof value === \"number\" && Math.abs(value) < 2 ** 32,\n      `string32: Unexpected input \"${value}\".`\n    );\n  }\n  return String.fromCharCode(\n    (value >> 24) & 0xff,\n    (value >> 16) & 0xff,\n    (value >> 8) & 0xff,\n    value & 0xff\n  );\n}\n\nfunction objectSize(obj) {\n  return Object.keys(obj).length;\n}\n\n// Ensure that the returned Object has a `null` prototype; hence why\n// `Object.fromEntries(...)` is not used.\nfunction objectFromMap(map) {\n  const obj = Object.create(null);\n  for (const [key, value] of map) {\n    obj[key] = value;\n  }\n  return obj;\n}\n\n// Checks the endianness of the platform.\nfunction isLittleEndian() {\n  const buffer8 = new Uint8Array(4);\n  buffer8[0] = 1;\n  const view32 = new Uint32Array(buffer8.buffer, 0, 1);\n  return view32[0] === 1;\n}\n\n// Checks if it's possible to eval JS expressions.\nfunction isEvalSupported() {\n  try {\n    new Function(\"\"); // eslint-disable-line no-new, no-new-func\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nclass FeatureTest {\n  static get isLittleEndian() {\n    return shadow(this, \"isLittleEndian\", isLittleEndian());\n  }\n\n  static get isEvalSupported() {\n    return shadow(this, \"isEvalSupported\", isEvalSupported());\n  }\n\n  static get isOffscreenCanvasSupported() {\n    return shadow(\n      this,\n      \"isOffscreenCanvasSupported\",\n      typeof OffscreenCanvas !== \"undefined\"\n    );\n  }\n\n  static get platform() {\n    if (\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      (typeof navigator !== \"undefined\" &&\n        typeof navigator?.platform === \"string\")\n    ) {\n      return shadow(this, \"platform\", {\n        isMac: navigator.platform.includes(\"Mac\"),\n      });\n    }\n    return shadow(this, \"platform\", { isMac: false });\n  }\n\n  static get isCSSRoundSupported() {\n    return shadow(\n      this,\n      \"isCSSRoundSupported\",\n      globalThis.CSS?.supports?.(\"width: round(1.5px, 1px)\")\n    );\n  }\n}\n\nconst hexNumbers = Array.from(Array(256).keys(), n =>\n  n.toString(16).padStart(2, \"0\")\n);\n\nclass Util {\n  static makeHexColor(r, g, b) {\n    return `#${hexNumbers[r]}${hexNumbers[g]}${hexNumbers[b]}`;\n  }\n\n  // Apply a scaling matrix to some min/max values.\n  // If a scaling factor is negative then min and max must be\n  // swapped.\n  static scaleMinMax(transform, minMax) {\n    let temp;\n    if (transform[0]) {\n      if (transform[0] < 0) {\n        temp = minMax[0];\n        minMax[0] = minMax[2];\n        minMax[2] = temp;\n      }\n      minMax[0] *= transform[0];\n      minMax[2] *= transform[0];\n\n      if (transform[3] < 0) {\n        temp = minMax[1];\n        minMax[1] = minMax[3];\n        minMax[3] = temp;\n      }\n      minMax[1] *= transform[3];\n      minMax[3] *= transform[3];\n    } else {\n      temp = minMax[0];\n      minMax[0] = minMax[1];\n      minMax[1] = temp;\n      temp = minMax[2];\n      minMax[2] = minMax[3];\n      minMax[3] = temp;\n\n      if (transform[1] < 0) {\n        temp = minMax[1];\n        minMax[1] = minMax[3];\n        minMax[3] = temp;\n      }\n      minMax[1] *= transform[1];\n      minMax[3] *= transform[1];\n\n      if (transform[2] < 0) {\n        temp = minMax[0];\n        minMax[0] = minMax[2];\n        minMax[2] = temp;\n      }\n      minMax[0] *= transform[2];\n      minMax[2] *= transform[2];\n    }\n    minMax[0] += transform[4];\n    minMax[1] += transform[5];\n    minMax[2] += transform[4];\n    minMax[3] += transform[5];\n  }\n\n  // Concatenates two transformation matrices together and returns the result.\n  static transform(m1, m2) {\n    return [\n      m1[0] * m2[0] + m1[2] * m2[1],\n      m1[1] * m2[0] + m1[3] * m2[1],\n      m1[0] * m2[2] + m1[2] * m2[3],\n      m1[1] * m2[2] + m1[3] * m2[3],\n      m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\n      m1[1] * m2[4] + m1[3] * m2[5] + m1[5],\n    ];\n  }\n\n  // For 2d affine transforms\n  static applyTransform(p, m) {\n    const xt = p[0] * m[0] + p[1] * m[2] + m[4];\n    const yt = p[0] * m[1] + p[1] * m[3] + m[5];\n    return [xt, yt];\n  }\n\n  static applyInverseTransform(p, m) {\n    const d = m[0] * m[3] - m[1] * m[2];\n    const xt = (p[0] * m[3] - p[1] * m[2] + m[2] * m[5] - m[4] * m[3]) / d;\n    const yt = (-p[0] * m[1] + p[1] * m[0] + m[4] * m[1] - m[5] * m[0]) / d;\n    return [xt, yt];\n  }\n\n  // Applies the transform to the rectangle and finds the minimum axially\n  // aligned bounding box.\n  static getAxialAlignedBoundingBox(r, m) {\n    const p1 = this.applyTransform(r, m);\n    const p2 = this.applyTransform(r.slice(2, 4), m);\n    const p3 = this.applyTransform([r[0], r[3]], m);\n    const p4 = this.applyTransform([r[2], r[1]], m);\n    return [\n      Math.min(p1[0], p2[0], p3[0], p4[0]),\n      Math.min(p1[1], p2[1], p3[1], p4[1]),\n      Math.max(p1[0], p2[0], p3[0], p4[0]),\n      Math.max(p1[1], p2[1], p3[1], p4[1]),\n    ];\n  }\n\n  static inverseTransform(m) {\n    const d = m[0] * m[3] - m[1] * m[2];\n    return [\n      m[3] / d,\n      -m[1] / d,\n      -m[2] / d,\n      m[0] / d,\n      (m[2] * m[5] - m[4] * m[3]) / d,\n      (m[4] * m[1] - m[5] * m[0]) / d,\n    ];\n  }\n\n  // This calculation uses Singular Value Decomposition.\n  // The SVD can be represented with formula A = USV. We are interested in the\n  // matrix S here because it represents the scale values.\n  static singularValueDecompose2dScale(m) {\n    const transpose = [m[0], m[2], m[1], m[3]];\n\n    // Multiply matrix m with its transpose.\n    const a = m[0] * transpose[0] + m[1] * transpose[2];\n    const b = m[0] * transpose[1] + m[1] * transpose[3];\n    const c = m[2] * transpose[0] + m[3] * transpose[2];\n    const d = m[2] * transpose[1] + m[3] * transpose[3];\n\n    // Solve the second degree polynomial to get roots.\n    const first = (a + d) / 2;\n    const second = Math.sqrt((a + d) ** 2 - 4 * (a * d - c * b)) / 2;\n    const sx = first + second || 1;\n    const sy = first - second || 1;\n\n    // Scale values are the square roots of the eigenvalues.\n    return [Math.sqrt(sx), Math.sqrt(sy)];\n  }\n\n  // Normalize rectangle rect=[x1, y1, x2, y2] so that (x1,y1) < (x2,y2)\n  // For coordinate systems whose origin lies in the bottom-left, this\n  // means normalization to (BL,TR) ordering. For systems with origin in the\n  // top-left, this means (TL,BR) ordering.\n  static normalizeRect(rect) {\n    const r = rect.slice(0); // clone rect\n    if (rect[0] > rect[2]) {\n      r[0] = rect[2];\n      r[2] = rect[0];\n    }\n    if (rect[1] > rect[3]) {\n      r[1] = rect[3];\n      r[3] = rect[1];\n    }\n    return r;\n  }\n\n  // Returns a rectangle [x1, y1, x2, y2] corresponding to the\n  // intersection of rect1 and rect2. If no intersection, returns 'null'\n  // The rectangle coordinates of rect1, rect2 should be [x1, y1, x2, y2]\n  static intersect(rect1, rect2) {\n    const xLow = Math.max(\n      Math.min(rect1[0], rect1[2]),\n      Math.min(rect2[0], rect2[2])\n    );\n    const xHigh = Math.min(\n      Math.max(rect1[0], rect1[2]),\n      Math.max(rect2[0], rect2[2])\n    );\n    if (xLow > xHigh) {\n      return null;\n    }\n    const yLow = Math.max(\n      Math.min(rect1[1], rect1[3]),\n      Math.min(rect2[1], rect2[3])\n    );\n    const yHigh = Math.min(\n      Math.max(rect1[1], rect1[3]),\n      Math.max(rect2[1], rect2[3])\n    );\n    if (yLow > yHigh) {\n      return null;\n    }\n\n    return [xLow, yLow, xHigh, yHigh];\n  }\n\n  static #getExtremumOnCurve(x0, x1, x2, x3, y0, y1, y2, y3, t, minMax) {\n    if (t <= 0 || t >= 1) {\n      return;\n    }\n    const mt = 1 - t;\n    const tt = t * t;\n    const ttt = tt * t;\n    const x = mt * (mt * (mt * x0 + 3 * t * x1) + 3 * tt * x2) + ttt * x3;\n    const y = mt * (mt * (mt * y0 + 3 * t * y1) + 3 * tt * y2) + ttt * y3;\n    minMax[0] = Math.min(minMax[0], x);\n    minMax[1] = Math.min(minMax[1], y);\n    minMax[2] = Math.max(minMax[2], x);\n    minMax[3] = Math.max(minMax[3], y);\n  }\n\n  static #getExtremum(x0, x1, x2, x3, y0, y1, y2, y3, a, b, c, minMax) {\n    if (Math.abs(a) < 1e-12) {\n      if (Math.abs(b) >= 1e-12) {\n        this.#getExtremumOnCurve(\n          x0,\n          x1,\n          x2,\n          x3,\n          y0,\n          y1,\n          y2,\n          y3,\n          -c / b,\n          minMax\n        );\n      }\n      return;\n    }\n\n    const delta = b ** 2 - 4 * c * a;\n    if (delta < 0) {\n      return;\n    }\n    const sqrtDelta = Math.sqrt(delta);\n    const a2 = 2 * a;\n    this.#getExtremumOnCurve(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      (-b + sqrtDelta) / a2,\n      minMax\n    );\n    this.#getExtremumOnCurve(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      (-b - sqrtDelta) / a2,\n      minMax\n    );\n  }\n\n  // From https://github.com/adobe-webplatform/Snap.svg/blob/b365287722a72526000ac4bfcf0ce4cac2faa015/src/path.js#L852\n  static bezierBoundingBox(x0, y0, x1, y1, x2, y2, x3, y3, minMax) {\n    if (minMax) {\n      minMax[0] = Math.min(minMax[0], x0, x3);\n      minMax[1] = Math.min(minMax[1], y0, y3);\n      minMax[2] = Math.max(minMax[2], x0, x3);\n      minMax[3] = Math.max(minMax[3], y0, y3);\n    } else {\n      minMax = [\n        Math.min(x0, x3),\n        Math.min(y0, y3),\n        Math.max(x0, x3),\n        Math.max(y0, y3),\n      ];\n    }\n    this.#getExtremum(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      3 * (-x0 + 3 * (x1 - x2) + x3),\n      6 * (x0 - 2 * x1 + x2),\n      3 * (x1 - x0),\n      minMax\n    );\n    this.#getExtremum(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      3 * (-y0 + 3 * (y1 - y2) + y3),\n      6 * (y0 - 2 * y1 + y2),\n      3 * (y1 - y0),\n      minMax\n    );\n    return minMax;\n  }\n}\n\nconst PDFStringTranslateTable = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x2d8,\n  0x2c7, 0x2c6, 0x2d9, 0x2dd, 0x2db, 0x2da, 0x2dc, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0x2022, 0x2020, 0x2021, 0x2026, 0x2014, 0x2013, 0x192,\n  0x2044, 0x2039, 0x203a, 0x2212, 0x2030, 0x201e, 0x201c, 0x201d, 0x2018,\n  0x2019, 0x201a, 0x2122, 0xfb01, 0xfb02, 0x141, 0x152, 0x160, 0x178, 0x17d,\n  0x131, 0x142, 0x153, 0x161, 0x17e, 0, 0x20ac,\n];\n\nfunction stringToPDFString(str) {\n  // See section 7.9.2.2 Text String Type.\n  // The string can contain some language codes bracketed with 0x0b,\n  // so we must remove them.\n  if (str[0] >= \"\\xEF\") {\n    let encoding;\n    if (str[0] === \"\\xFE\" && str[1] === \"\\xFF\") {\n      encoding = \"utf-16be\";\n      if (str.length % 2 === 1) {\n        str = str.slice(0, -1);\n      }\n    } else if (str[0] === \"\\xFF\" && str[1] === \"\\xFE\") {\n      encoding = \"utf-16le\";\n      if (str.length % 2 === 1) {\n        str = str.slice(0, -1);\n      }\n    } else if (str[0] === \"\\xEF\" && str[1] === \"\\xBB\" && str[2] === \"\\xBF\") {\n      encoding = \"utf-8\";\n    }\n\n    if (encoding) {\n      try {\n        const decoder = new TextDecoder(encoding, { fatal: true });\n        const buffer = stringToBytes(str);\n        const decoded = decoder.decode(buffer);\n        if (!decoded.includes(\"\\x1b\")) {\n          return decoded;\n        }\n        return decoded.replaceAll(/\\x1b[^\\x1b]*(?:\\x1b|$)/g, \"\");\n      } catch (ex) {\n        warn(`stringToPDFString: \"${ex}\".`);\n      }\n    }\n  }\n  // ISO Latin 1\n  const strBuf = [];\n  for (let i = 0, ii = str.length; i < ii; i++) {\n    const charCode = str.charCodeAt(i);\n    if (charCode === 0x1b) {\n      // eslint-disable-next-line no-empty\n      while (++i < ii && str.charCodeAt(i) !== 0x1b) {}\n      continue;\n    }\n    const code = PDFStringTranslateTable[charCode];\n    strBuf.push(code ? String.fromCharCode(code) : str.charAt(i));\n  }\n  return strBuf.join(\"\");\n}\n\nfunction stringToUTF8String(str) {\n  return decodeURIComponent(escape(str));\n}\n\nfunction utf8StringToString(str) {\n  return unescape(encodeURIComponent(str));\n}\n\nfunction isArrayEqual(arr1, arr2) {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (let i = 0, ii = arr1.length; i < ii; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction getModificationDate(date = new Date()) {\n  const buffer = [\n    date.getUTCFullYear().toString(),\n    (date.getUTCMonth() + 1).toString().padStart(2, \"0\"),\n    date.getUTCDate().toString().padStart(2, \"0\"),\n    date.getUTCHours().toString().padStart(2, \"0\"),\n    date.getUTCMinutes().toString().padStart(2, \"0\"),\n    date.getUTCSeconds().toString().padStart(2, \"0\"),\n  ];\n\n  return buffer.join(\"\");\n}\n\nlet NormalizeRegex = null;\nlet NormalizationMap = null;\nfunction normalizeUnicode(str) {\n  if (!NormalizeRegex) {\n    // In order to generate the following regex:\n    //  - create a PDF containing all the chars in the range 0000-FFFF with\n    //    a NFKC which is different of the char.\n    //  - copy and paste all those chars and get the ones where NFKC is\n    //    required.\n    // It appears that most the chars here contain some ligatures.\n    NormalizeRegex =\n      /([\\u00a0\\u00b5\\u037e\\u0eb3\\u2000-\\u200a\\u202f\\u2126\\ufb00-\\ufb04\\ufb06\\ufb20-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40-\\ufb41\\ufb43-\\ufb44\\ufb46-\\ufba1\\ufba4-\\ufba9\\ufbae-\\ufbb1\\ufbd3-\\ufbdc\\ufbde-\\ufbe7\\ufbea-\\ufbf8\\ufbfc-\\ufbfd\\ufc00-\\ufc5d\\ufc64-\\ufcf1\\ufcf5-\\ufd3d\\ufd88\\ufdf4\\ufdfa-\\ufdfb\\ufe71\\ufe77\\ufe79\\ufe7b\\ufe7d]+)|(\\ufb05+)/gu;\n    NormalizationMap = new Map([[\"\", \"t\"]]);\n  }\n  return str.replaceAll(NormalizeRegex, (_, p1, p2) =>\n    p1 ? p1.normalize(\"NFKC\") : NormalizationMap.get(p2)\n  );\n}\n\nfunction getUuid() {\n  if (\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n    (typeof crypto !== \"undefined\" && typeof crypto?.randomUUID === \"function\")\n  ) {\n    return crypto.randomUUID();\n  }\n  const buf = new Uint8Array(32);\n  if (\n    typeof crypto !== \"undefined\" &&\n    typeof crypto?.getRandomValues === \"function\"\n  ) {\n    crypto.getRandomValues(buf);\n  } else {\n    for (let i = 0; i < 32; i++) {\n      buf[i] = Math.floor(Math.random() * 255);\n    }\n  }\n  return bytesToString(buf);\n}\n\nconst AnnotationPrefix = \"pdfjs_internal_id_\";\n\nconst FontRenderOps = {\n  BEZIER_CURVE_TO: 0,\n  MOVE_TO: 1,\n  LINE_TO: 2,\n  QUADRATIC_CURVE_TO: 3,\n  RESTORE: 4,\n  SAVE: 5,\n  SCALE: 6,\n  TRANSFORM: 7,\n  TRANSLATE: 8,\n};\n\nexport {\n  AbortException,\n  AnnotationActionEventType,\n  AnnotationBorderStyleType,\n  AnnotationEditorParamsType,\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  AnnotationFieldFlag,\n  AnnotationFlag,\n  AnnotationMode,\n  AnnotationPrefix,\n  AnnotationReplyType,\n  AnnotationType,\n  assert,\n  BaseException,\n  BASELINE_FACTOR,\n  bytesToString,\n  CMapCompressionType,\n  createValidAbsoluteUrl,\n  DocumentActionEventType,\n  FeatureTest,\n  FONT_IDENTITY_MATRIX,\n  FontRenderOps,\n  FormatError,\n  getModificationDate,\n  getUuid,\n  getVerbosityLevel,\n  IDENTITY_MATRIX,\n  ImageKind,\n  info,\n  InvalidPDFException,\n  isArrayEqual,\n  isNodeJS,\n  LINE_DESCENT_FACTOR,\n  LINE_FACTOR,\n  MAX_IMAGE_SIZE_TO_CACHE,\n  MissingPDFException,\n  normalizeUnicode,\n  objectFromMap,\n  objectSize,\n  OPS,\n  PageActionEventType,\n  PasswordException,\n  PasswordResponses,\n  PermissionFlag,\n  RenderingIntentFlag,\n  setVerbosityLevel,\n  shadow,\n  string32,\n  stringToBytes,\n  stringToPDFString,\n  stringToUTF8String,\n  TextRenderingMode,\n  UnexpectedResponseException,\n  UnknownErrorException,\n  unreachable,\n  utf8StringToString,\n  Util,\n  VerbosityLevel,\n  warn,\n};\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CMapCompressionType, unreachable } from \"../shared/util.js\";\n\nclass BaseFilterFactory {\n  constructor() {\n    if (this.constructor === BaseFilterFactory) {\n      unreachable(\"Cannot initialize BaseFilterFactory.\");\n    }\n  }\n\n  addFilter(maps) {\n    return \"none\";\n  }\n\n  addHCMFilter(fgColor, bgColor) {\n    return \"none\";\n  }\n\n  addAlphaFilter(map) {\n    return \"none\";\n  }\n\n  addLuminosityFilter(map) {\n    return \"none\";\n  }\n\n  addHighlightHCMFilter(filterName, fgColor, bgColor, newFgColor, newBgColor) {\n    return \"none\";\n  }\n\n  destroy(keepHCM = false) {}\n}\n\nclass BaseCanvasFactory {\n  #enableHWA = false;\n\n  constructor({ enableHWA = false } = {}) {\n    if (this.constructor === BaseCanvasFactory) {\n      unreachable(\"Cannot initialize BaseCanvasFactory.\");\n    }\n    this.#enableHWA = enableHWA;\n  }\n\n  create(width, height) {\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid canvas size\");\n    }\n    const canvas = this._createCanvas(width, height);\n    return {\n      canvas,\n      context: canvas.getContext(\"2d\", {\n        willReadFrequently: !this.#enableHWA,\n      }),\n    };\n  }\n\n  reset(canvasAndContext, width, height) {\n    if (!canvasAndContext.canvas) {\n      throw new Error(\"Canvas is not specified\");\n    }\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid canvas size\");\n    }\n    canvasAndContext.canvas.width = width;\n    canvasAndContext.canvas.height = height;\n  }\n\n  destroy(canvasAndContext) {\n    if (!canvasAndContext.canvas) {\n      throw new Error(\"Canvas is not specified\");\n    }\n    // Zeroing the width and height cause Firefox to release graphics\n    // resources immediately, which can greatly reduce memory consumption.\n    canvasAndContext.canvas.width = 0;\n    canvasAndContext.canvas.height = 0;\n    canvasAndContext.canvas = null;\n    canvasAndContext.context = null;\n  }\n\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    unreachable(\"Abstract method `_createCanvas` called.\");\n  }\n}\n\nclass BaseCMapReaderFactory {\n  constructor({ baseUrl = null, isCompressed = true }) {\n    if (this.constructor === BaseCMapReaderFactory) {\n      unreachable(\"Cannot initialize BaseCMapReaderFactory.\");\n    }\n    this.baseUrl = baseUrl;\n    this.isCompressed = isCompressed;\n  }\n\n  async fetch({ name }) {\n    if (!this.baseUrl) {\n      throw new Error(\n        'The CMap \"baseUrl\" parameter must be specified, ensure that ' +\n          'the \"cMapUrl\" and \"cMapPacked\" API parameters are provided.'\n      );\n    }\n    if (!name) {\n      throw new Error(\"CMap name must be specified.\");\n    }\n    const url = this.baseUrl + name + (this.isCompressed ? \".bcmap\" : \"\");\n    const compressionType = this.isCompressed\n      ? CMapCompressionType.BINARY\n      : CMapCompressionType.NONE;\n\n    return this._fetchData(url, compressionType).catch(reason => {\n      throw new Error(\n        `Unable to load ${this.isCompressed ? \"binary \" : \"\"}CMap at: ${url}`\n      );\n    });\n  }\n\n  /**\n   * @ignore\n   */\n  _fetchData(url, compressionType) {\n    unreachable(\"Abstract method `_fetchData` called.\");\n  }\n}\n\nclass BaseStandardFontDataFactory {\n  constructor({ baseUrl = null }) {\n    if (this.constructor === BaseStandardFontDataFactory) {\n      unreachable(\"Cannot initialize BaseStandardFontDataFactory.\");\n    }\n    this.baseUrl = baseUrl;\n  }\n\n  async fetch({ filename }) {\n    if (!this.baseUrl) {\n      throw new Error(\n        'The standard font \"baseUrl\" parameter must be specified, ensure that ' +\n          'the \"standardFontDataUrl\" API parameter is provided.'\n      );\n    }\n    if (!filename) {\n      throw new Error(\"Font filename must be specified.\");\n    }\n    const url = `${this.baseUrl}${filename}`;\n\n    return this._fetchData(url).catch(reason => {\n      throw new Error(`Unable to load font data at: ${url}`);\n    });\n  }\n\n  /**\n   * @ignore\n   */\n  _fetchData(url) {\n    unreachable(\"Abstract method `_fetchData` called.\");\n  }\n}\n\nclass BaseSVGFactory {\n  constructor() {\n    if (this.constructor === BaseSVGFactory) {\n      unreachable(\"Cannot initialize BaseSVGFactory.\");\n    }\n  }\n\n  create(width, height, skipDimensions = false) {\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid SVG dimensions\");\n    }\n    const svg = this._createSVG(\"svg:svg\");\n    svg.setAttribute(\"version\", \"1.1\");\n\n    if (!skipDimensions) {\n      svg.setAttribute(\"width\", `${width}px`);\n      svg.setAttribute(\"height\", `${height}px`);\n    }\n\n    svg.setAttribute(\"preserveAspectRatio\", \"none\");\n    svg.setAttribute(\"viewBox\", `0 0 ${width} ${height}`);\n\n    return svg;\n  }\n\n  createElement(type) {\n    if (typeof type !== \"string\") {\n      throw new Error(\"Invalid SVG element type\");\n    }\n    return this._createSVG(type);\n  }\n\n  /**\n   * @ignore\n   */\n  _createSVG(type) {\n    unreachable(\"Abstract method `_createSVG` called.\");\n  }\n}\n\nexport {\n  BaseCanvasFactory,\n  BaseCMapReaderFactory,\n  BaseFilterFactory,\n  BaseStandardFontDataFactory,\n  BaseSVGFactory,\n};\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BaseCanvasFactory,\n  BaseCMapReaderFactory,\n  BaseFilterFactory,\n  BaseStandardFontDataFactory,\n  BaseSVGFactory,\n} from \"./base_factory.js\";\nimport {\n  BaseException,\n  FeatureTest,\n  shadow,\n  stringToBytes,\n  Util,\n  warn,\n} from \"../shared/util.js\";\n\nconst SVG_NS = \"http://www.w3.org/2000/svg\";\n\nclass PixelsPerInch {\n  static CSS = 96.0;\n\n  static PDF = 72.0;\n\n  static PDF_TO_CSS_UNITS = this.CSS / this.PDF;\n}\n\n/**\n * FilterFactory aims to create some SVG filters we can use when drawing an\n * image (or whatever) on a canvas.\n * Filters aren't applied with ctx.putImageData because it just overwrites the\n * underlying pixels.\n * With these filters, it's possible for example to apply some transfer maps on\n * an image without the need to apply them on the pixel arrays: the renderer\n * does the magic for us.\n */\nclass DOMFilterFactory extends BaseFilterFactory {\n  #baseUrl;\n\n  #_cache;\n\n  #_defs;\n\n  #docId;\n\n  #document;\n\n  #_hcmCache;\n\n  #id = 0;\n\n  constructor({ docId, ownerDocument = globalThis.document } = {}) {\n    super();\n    this.#docId = docId;\n    this.#document = ownerDocument;\n  }\n\n  get #cache() {\n    return (this.#_cache ||= new Map());\n  }\n\n  get #hcmCache() {\n    return (this.#_hcmCache ||= new Map());\n  }\n\n  get #defs() {\n    if (!this.#_defs) {\n      const div = this.#document.createElement(\"div\");\n      const { style } = div;\n      style.visibility = \"hidden\";\n      style.contain = \"strict\";\n      style.width = style.height = 0;\n      style.position = \"absolute\";\n      style.top = style.left = 0;\n      style.zIndex = -1;\n\n      const svg = this.#document.createElementNS(SVG_NS, \"svg\");\n      svg.setAttribute(\"width\", 0);\n      svg.setAttribute(\"height\", 0);\n      this.#_defs = this.#document.createElementNS(SVG_NS, \"defs\");\n      div.append(svg);\n      svg.append(this.#_defs);\n      this.#document.body.append(div);\n    }\n    return this.#_defs;\n  }\n\n  #createTables(maps) {\n    if (maps.length === 1) {\n      const mapR = maps[0];\n      const buffer = new Array(256);\n      for (let i = 0; i < 256; i++) {\n        buffer[i] = mapR[i] / 255;\n      }\n\n      const table = buffer.join(\",\");\n      return [table, table, table];\n    }\n\n    const [mapR, mapG, mapB] = maps;\n    const bufferR = new Array(256);\n    const bufferG = new Array(256);\n    const bufferB = new Array(256);\n    for (let i = 0; i < 256; i++) {\n      bufferR[i] = mapR[i] / 255;\n      bufferG[i] = mapG[i] / 255;\n      bufferB[i] = mapB[i] / 255;\n    }\n    return [bufferR.join(\",\"), bufferG.join(\",\"), bufferB.join(\",\")];\n  }\n\n  #createUrl(id) {\n    if (this.#baseUrl === undefined) {\n      // Unless a `<base>`-element is present a relative URL should work.\n      this.#baseUrl = \"\";\n\n      const url = this.#document.URL;\n      if (url !== this.#document.baseURI) {\n        if (isDataScheme(url)) {\n          warn('#createUrl: ignore \"data:\"-URL for performance reasons.');\n        } else {\n          this.#baseUrl = url.split(\"#\", 1)[0];\n        }\n      }\n    }\n    return `url(${this.#baseUrl}#${id})`;\n  }\n\n  addFilter(maps) {\n    if (!maps) {\n      return \"none\";\n    }\n\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(maps);\n    if (value) {\n      return value;\n    }\n\n    const [tableR, tableG, tableB] = this.#createTables(maps);\n    const key = maps.length === 1 ? tableR : `${tableR}${tableG}${tableB}`;\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(maps, value);\n      return value;\n    }\n\n    // We create a SVG filter: feComponentTransferElement\n    //  https://www.w3.org/TR/SVG11/filters.html#feComponentTransferElement\n\n    const id = `g_${this.#docId}_transfer_map_${this.#id++}`;\n    const url = this.#createUrl(id);\n    this.#cache.set(maps, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addTransferMapConversion(tableR, tableG, tableB, filter);\n\n    return url;\n  }\n\n  addHCMFilter(fgColor, bgColor) {\n    const key = `${fgColor}-${bgColor}`;\n    const filterName = \"base\";\n    let info = this.#hcmCache.get(filterName);\n    if (info?.key === key) {\n      return info.url;\n    }\n\n    if (info) {\n      info.filter?.remove();\n      info.key = key;\n      info.url = \"none\";\n      info.filter = null;\n    } else {\n      info = {\n        key,\n        url: \"none\",\n        filter: null,\n      };\n      this.#hcmCache.set(filterName, info);\n    }\n\n    if (!fgColor || !bgColor) {\n      return info.url;\n    }\n\n    const fgRGB = this.#getRGB(fgColor);\n    fgColor = Util.makeHexColor(...fgRGB);\n    const bgRGB = this.#getRGB(bgColor);\n    bgColor = Util.makeHexColor(...bgRGB);\n    this.#defs.style.color = \"\";\n\n    if (\n      (fgColor === \"#000000\" && bgColor === \"#ffffff\") ||\n      fgColor === bgColor\n    ) {\n      return info.url;\n    }\n\n    // https://developer.mozilla.org/en-US/docs/Web/Accessibility/Understanding_Colors_and_Luminance\n    //\n    // Relative luminance:\n    // https://www.w3.org/TR/WCAG20/#relativeluminancedef\n    //\n    // We compute the rounded luminance of the default background color.\n    // Then for every color in the pdf, if its rounded luminance is the\n    // same as the background one then it's replaced by the new\n    // background color else by the foreground one.\n    const map = new Array(256);\n    for (let i = 0; i <= 255; i++) {\n      const x = i / 255;\n      map[i] = x <= 0.03928 ? x / 12.92 : ((x + 0.055) / 1.055) ** 2.4;\n    }\n    const table = map.join(\",\");\n\n    const id = `g_${this.#docId}_hcm_filter`;\n    const filter = (info.filter = this.#createFilter(id));\n    this.#addTransferMapConversion(table, table, table, filter);\n    this.#addGrayConversion(filter);\n\n    const getSteps = (c, n) => {\n      const start = fgRGB[c] / 255;\n      const end = bgRGB[c] / 255;\n      const arr = new Array(n + 1);\n      for (let i = 0; i <= n; i++) {\n        arr[i] = start + (i / n) * (end - start);\n      }\n      return arr.join(\",\");\n    };\n    this.#addTransferMapConversion(\n      getSteps(0, 5),\n      getSteps(1, 5),\n      getSteps(2, 5),\n      filter\n    );\n\n    info.url = this.#createUrl(id);\n    return info.url;\n  }\n\n  addAlphaFilter(map) {\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(map);\n    if (value) {\n      return value;\n    }\n\n    const [tableA] = this.#createTables([map]);\n    const key = `alpha_${tableA}`;\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(map, value);\n      return value;\n    }\n\n    const id = `g_${this.#docId}_alpha_map_${this.#id++}`;\n    const url = this.#createUrl(id);\n    this.#cache.set(map, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addTransferMapAlphaConversion(tableA, filter);\n\n    return url;\n  }\n\n  addLuminosityFilter(map) {\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(map || \"luminosity\");\n    if (value) {\n      return value;\n    }\n\n    let tableA, key;\n    if (map) {\n      [tableA] = this.#createTables([map]);\n      key = `luminosity_${tableA}`;\n    } else {\n      key = \"luminosity\";\n    }\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(map, value);\n      return value;\n    }\n\n    const id = `g_${this.#docId}_luminosity_map_${this.#id++}`;\n    const url = this.#createUrl(id);\n    this.#cache.set(map, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addLuminosityConversion(filter);\n    if (map) {\n      this.#addTransferMapAlphaConversion(tableA, filter);\n    }\n\n    return url;\n  }\n\n  addHighlightHCMFilter(filterName, fgColor, bgColor, newFgColor, newBgColor) {\n    const key = `${fgColor}-${bgColor}-${newFgColor}-${newBgColor}`;\n    let info = this.#hcmCache.get(filterName);\n    if (info?.key === key) {\n      return info.url;\n    }\n\n    if (info) {\n      info.filter?.remove();\n      info.key = key;\n      info.url = \"none\";\n      info.filter = null;\n    } else {\n      info = {\n        key,\n        url: \"none\",\n        filter: null,\n      };\n      this.#hcmCache.set(filterName, info);\n    }\n\n    if (!fgColor || !bgColor) {\n      return info.url;\n    }\n\n    const [fgRGB, bgRGB] = [fgColor, bgColor].map(this.#getRGB.bind(this));\n    let fgGray = Math.round(\n      0.2126 * fgRGB[0] + 0.7152 * fgRGB[1] + 0.0722 * fgRGB[2]\n    );\n    let bgGray = Math.round(\n      0.2126 * bgRGB[0] + 0.7152 * bgRGB[1] + 0.0722 * bgRGB[2]\n    );\n    let [newFgRGB, newBgRGB] = [newFgColor, newBgColor].map(\n      this.#getRGB.bind(this)\n    );\n    if (bgGray < fgGray) {\n      [fgGray, bgGray, newFgRGB, newBgRGB] = [\n        bgGray,\n        fgGray,\n        newBgRGB,\n        newFgRGB,\n      ];\n    }\n    this.#defs.style.color = \"\";\n\n    // Now we can create the filters to highlight some canvas parts.\n    // The colors in the pdf will almost be Canvas and CanvasText, hence we\n    // want to filter them to finally get Highlight and HighlightText.\n    // Since we're in HCM the background color and the foreground color should\n    // be really different when converted to grayscale (if they're not then it\n    // means that we've a poor contrast). Once the canvas colors are converted\n    // to grayscale we can easily map them on their new colors.\n    // The grayscale step is important because if we've something like:\n    //   fgColor = #FF....\n    //   bgColor = #FF....\n    //   then we are enable to map the red component on the new red components\n    //   which can be different.\n\n    const getSteps = (fg, bg, n) => {\n      const arr = new Array(256);\n      const step = (bgGray - fgGray) / n;\n      const newStart = fg / 255;\n      const newStep = (bg - fg) / (255 * n);\n      let prev = 0;\n      for (let i = 0; i <= n; i++) {\n        const k = Math.round(fgGray + i * step);\n        const value = newStart + i * newStep;\n        for (let j = prev; j <= k; j++) {\n          arr[j] = value;\n        }\n        prev = k + 1;\n      }\n      for (let i = prev; i < 256; i++) {\n        arr[i] = arr[prev - 1];\n      }\n      return arr.join(\",\");\n    };\n\n    const id = `g_${this.#docId}_hcm_${filterName}_filter`;\n    const filter = (info.filter = this.#createFilter(id));\n\n    this.#addGrayConversion(filter);\n    this.#addTransferMapConversion(\n      getSteps(newFgRGB[0], newBgRGB[0], 5),\n      getSteps(newFgRGB[1], newBgRGB[1], 5),\n      getSteps(newFgRGB[2], newBgRGB[2], 5),\n      filter\n    );\n\n    info.url = this.#createUrl(id);\n    return info.url;\n  }\n\n  destroy(keepHCM = false) {\n    if (keepHCM && this.#hcmCache.size !== 0) {\n      return;\n    }\n    if (this.#_defs) {\n      this.#_defs.parentNode.parentNode.remove();\n      this.#_defs = null;\n    }\n    if (this.#_cache) {\n      this.#_cache.clear();\n      this.#_cache = null;\n    }\n    this.#id = 0;\n  }\n\n  #addLuminosityConversion(filter) {\n    const feColorMatrix = this.#document.createElementNS(\n      SVG_NS,\n      \"feColorMatrix\"\n    );\n    feColorMatrix.setAttribute(\"type\", \"matrix\");\n    feColorMatrix.setAttribute(\n      \"values\",\n      \"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0\"\n    );\n    filter.append(feColorMatrix);\n  }\n\n  #addGrayConversion(filter) {\n    const feColorMatrix = this.#document.createElementNS(\n      SVG_NS,\n      \"feColorMatrix\"\n    );\n    feColorMatrix.setAttribute(\"type\", \"matrix\");\n    feColorMatrix.setAttribute(\n      \"values\",\n      \"0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0\"\n    );\n    filter.append(feColorMatrix);\n  }\n\n  #createFilter(id) {\n    const filter = this.#document.createElementNS(SVG_NS, \"filter\");\n    filter.setAttribute(\"color-interpolation-filters\", \"sRGB\");\n    filter.setAttribute(\"id\", id);\n    this.#defs.append(filter);\n\n    return filter;\n  }\n\n  #appendFeFunc(feComponentTransfer, func, table) {\n    const feFunc = this.#document.createElementNS(SVG_NS, func);\n    feFunc.setAttribute(\"type\", \"discrete\");\n    feFunc.setAttribute(\"tableValues\", table);\n    feComponentTransfer.append(feFunc);\n  }\n\n  #addTransferMapConversion(rTable, gTable, bTable, filter) {\n    const feComponentTransfer = this.#document.createElementNS(\n      SVG_NS,\n      \"feComponentTransfer\"\n    );\n    filter.append(feComponentTransfer);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncR\", rTable);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncG\", gTable);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncB\", bTable);\n  }\n\n  #addTransferMapAlphaConversion(aTable, filter) {\n    const feComponentTransfer = this.#document.createElementNS(\n      SVG_NS,\n      \"feComponentTransfer\"\n    );\n    filter.append(feComponentTransfer);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncA\", aTable);\n  }\n\n  #getRGB(color) {\n    this.#defs.style.color = color;\n    return getRGB(getComputedStyle(this.#defs).getPropertyValue(\"color\"));\n  }\n}\n\nclass DOMCanvasFactory extends BaseCanvasFactory {\n  constructor({ ownerDocument = globalThis.document, enableHWA = false } = {}) {\n    super({ enableHWA });\n    this._document = ownerDocument;\n  }\n\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    const canvas = this._document.createElement(\"canvas\");\n    canvas.width = width;\n    canvas.height = height;\n    return canvas;\n  }\n}\n\nasync function fetchData(url, type = \"text\") {\n  if (\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n    isValidFetchUrl(url, document.baseURI)\n  ) {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(response.statusText);\n    }\n    switch (type) {\n      case \"arraybuffer\":\n        return response.arrayBuffer();\n      case \"blob\":\n        return response.blob();\n      case \"json\":\n        return response.json();\n    }\n    return response.text();\n  }\n\n  // The Fetch API is not supported.\n  return new Promise((resolve, reject) => {\n    const request = new XMLHttpRequest();\n    request.open(\"GET\", url, /* async = */ true);\n    request.responseType = type;\n\n    request.onreadystatechange = () => {\n      if (request.readyState !== XMLHttpRequest.DONE) {\n        return;\n      }\n      if (request.status === 200 || request.status === 0) {\n        switch (type) {\n          case \"arraybuffer\":\n          case \"blob\":\n          case \"json\":\n            resolve(request.response);\n            return;\n        }\n        resolve(request.responseText);\n        return;\n      }\n      reject(new Error(request.statusText));\n    };\n\n    request.send(null);\n  });\n}\n\nclass DOMCMapReaderFactory extends BaseCMapReaderFactory {\n  /**\n   * @ignore\n   */\n  _fetchData(url, compressionType) {\n    return fetchData(\n      url,\n      /* type = */ this.isCompressed ? \"arraybuffer\" : \"text\"\n    ).then(data => ({\n      cMapData:\n        data instanceof ArrayBuffer\n          ? new Uint8Array(data)\n          : stringToBytes(data),\n      compressionType,\n    }));\n  }\n}\n\nclass DOMStandardFontDataFactory extends BaseStandardFontDataFactory {\n  /**\n   * @ignore\n   */\n  _fetchData(url) {\n    return fetchData(url, /* type = */ \"arraybuffer\").then(\n      data => new Uint8Array(data)\n    );\n  }\n}\n\nclass DOMSVGFactory extends BaseSVGFactory {\n  /**\n   * @ignore\n   */\n  _createSVG(type) {\n    return document.createElementNS(SVG_NS, type);\n  }\n}\n\n/**\n * @typedef {Object} PageViewportParameters\n * @property {Array<number>} viewBox - The xMin, yMin, xMax and\n *   yMax coordinates.\n * @property {number} scale - The scale of the viewport.\n * @property {number} rotation - The rotation, in degrees, of the viewport.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset. The\n *   default value is `0`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset. The\n *   default value is `0`.\n * @property {boolean} [dontFlip] - If true, the y-axis will not be flipped.\n *   The default value is `false`.\n */\n\n/**\n * @typedef {Object} PageViewportCloneParameters\n * @property {number} [scale] - The scale, overriding the one in the cloned\n *   viewport. The default value is `this.scale`.\n * @property {number} [rotation] - The rotation, in degrees, overriding the one\n *   in the cloned viewport. The default value is `this.rotation`.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset.\n *   The default value is `this.offsetX`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset.\n *   The default value is `this.offsetY`.\n * @property {boolean} [dontFlip] - If true, the x-axis will not be flipped.\n *   The default value is `false`.\n */\n\n/**\n * PDF page viewport created based on scale, rotation and offset.\n */\nclass PageViewport {\n  /**\n   * @param {PageViewportParameters}\n   */\n  constructor({\n    viewBox,\n    scale,\n    rotation,\n    offsetX = 0,\n    offsetY = 0,\n    dontFlip = false,\n  }) {\n    this.viewBox = viewBox;\n    this.scale = scale;\n    this.rotation = rotation;\n    this.offsetX = offsetX;\n    this.offsetY = offsetY;\n\n    // creating transform to convert pdf coordinate system to the normal\n    // canvas like coordinates taking in account scale and rotation\n    const centerX = (viewBox[2] + viewBox[0]) / 2;\n    const centerY = (viewBox[3] + viewBox[1]) / 2;\n    let rotateA, rotateB, rotateC, rotateD;\n    // Normalize the rotation, by clamping it to the [0, 360) range.\n    rotation %= 360;\n    if (rotation < 0) {\n      rotation += 360;\n    }\n    switch (rotation) {\n      case 180:\n        rotateA = -1;\n        rotateB = 0;\n        rotateC = 0;\n        rotateD = 1;\n        break;\n      case 90:\n        rotateA = 0;\n        rotateB = 1;\n        rotateC = 1;\n        rotateD = 0;\n        break;\n      case 270:\n        rotateA = 0;\n        rotateB = -1;\n        rotateC = -1;\n        rotateD = 0;\n        break;\n      case 0:\n        rotateA = 1;\n        rotateB = 0;\n        rotateC = 0;\n        rotateD = -1;\n        break;\n      default:\n        throw new Error(\n          \"PageViewport: Invalid rotation, must be a multiple of 90 degrees.\"\n        );\n    }\n\n    if (dontFlip) {\n      rotateC = -rotateC;\n      rotateD = -rotateD;\n    }\n\n    let offsetCanvasX, offsetCanvasY;\n    let width, height;\n    if (rotateA === 0) {\n      offsetCanvasX = Math.abs(centerY - viewBox[1]) * scale + offsetX;\n      offsetCanvasY = Math.abs(centerX - viewBox[0]) * scale + offsetY;\n      width = (viewBox[3] - viewBox[1]) * scale;\n      height = (viewBox[2] - viewBox[0]) * scale;\n    } else {\n      offsetCanvasX = Math.abs(centerX - viewBox[0]) * scale + offsetX;\n      offsetCanvasY = Math.abs(centerY - viewBox[1]) * scale + offsetY;\n      width = (viewBox[2] - viewBox[0]) * scale;\n      height = (viewBox[3] - viewBox[1]) * scale;\n    }\n    // creating transform for the following operations:\n    // translate(-centerX, -centerY), rotate and flip vertically,\n    // scale, and translate(offsetCanvasX, offsetCanvasY)\n    this.transform = [\n      rotateA * scale,\n      rotateB * scale,\n      rotateC * scale,\n      rotateD * scale,\n      offsetCanvasX - rotateA * scale * centerX - rotateC * scale * centerY,\n      offsetCanvasY - rotateB * scale * centerX - rotateD * scale * centerY,\n    ];\n\n    this.width = width;\n    this.height = height;\n  }\n\n  /**\n   * The original, un-scaled, viewport dimensions.\n   * @type {Object}\n   */\n  get rawDims() {\n    const { viewBox } = this;\n    return shadow(this, \"rawDims\", {\n      pageWidth: viewBox[2] - viewBox[0],\n      pageHeight: viewBox[3] - viewBox[1],\n      pageX: viewBox[0],\n      pageY: viewBox[1],\n    });\n  }\n\n  /**\n   * Clones viewport, with optional additional properties.\n   * @param {PageViewportCloneParameters} [params]\n   * @returns {PageViewport} Cloned viewport.\n   */\n  clone({\n    scale = this.scale,\n    rotation = this.rotation,\n    offsetX = this.offsetX,\n    offsetY = this.offsetY,\n    dontFlip = false,\n  } = {}) {\n    return new PageViewport({\n      viewBox: this.viewBox.slice(),\n      scale,\n      rotation,\n      offsetX,\n      offsetY,\n      dontFlip,\n    });\n  }\n\n  /**\n   * Converts PDF point to the viewport coordinates. For examples, useful for\n   * converting PDF location into canvas pixel coordinates.\n   * @param {number} x - The x-coordinate.\n   * @param {number} y - The y-coordinate.\n   * @returns {Array} Array containing `x`- and `y`-coordinates of the\n   *   point in the viewport coordinate space.\n   * @see {@link convertToPdfPoint}\n   * @see {@link convertToViewportRectangle}\n   */\n  convertToViewportPoint(x, y) {\n    return Util.applyTransform([x, y], this.transform);\n  }\n\n  /**\n   * Converts PDF rectangle to the viewport coordinates.\n   * @param {Array} rect - The xMin, yMin, xMax and yMax coordinates.\n   * @returns {Array} Array containing corresponding coordinates of the\n   *   rectangle in the viewport coordinate space.\n   * @see {@link convertToViewportPoint}\n   */\n  convertToViewportRectangle(rect) {\n    const topLeft = Util.applyTransform([rect[0], rect[1]], this.transform);\n    const bottomRight = Util.applyTransform([rect[2], rect[3]], this.transform);\n    return [topLeft[0], topLeft[1], bottomRight[0], bottomRight[1]];\n  }\n\n  /**\n   * Converts viewport coordinates to the PDF location. For examples, useful\n   * for converting canvas pixel location into PDF one.\n   * @param {number} x - The x-coordinate.\n   * @param {number} y - The y-coordinate.\n   * @returns {Array} Array containing `x`- and `y`-coordinates of the\n   *   point in the PDF coordinate space.\n   * @see {@link convertToViewportPoint}\n   */\n  convertToPdfPoint(x, y) {\n    return Util.applyInverseTransform([x, y], this.transform);\n  }\n}\n\nclass RenderingCancelledException extends BaseException {\n  constructor(msg, extraDelay = 0) {\n    super(msg, \"RenderingCancelledException\");\n    this.extraDelay = extraDelay;\n  }\n}\n\nfunction isDataScheme(url) {\n  const ii = url.length;\n  let i = 0;\n  while (i < ii && url[i].trim() === \"\") {\n    i++;\n  }\n  return url.substring(i, i + 5).toLowerCase() === \"data:\";\n}\n\nfunction isPdfFile(filename) {\n  return typeof filename === \"string\" && /\\.pdf$/i.test(filename);\n}\n\n/**\n * Gets the filename from a given URL.\n * @param {string} url\n * @returns {string}\n */\nfunction getFilenameFromUrl(url) {\n  [url] = url.split(/[#?]/, 1);\n  return url.substring(url.lastIndexOf(\"/\") + 1);\n}\n\n/**\n * Returns the filename or guessed filename from the url (see issue 3455).\n * @param {string} url - The original PDF location.\n * @param {string} defaultFilename - The value returned if the filename is\n *   unknown, or the protocol is unsupported.\n * @returns {string} Guessed PDF filename.\n */\nfunction getPdfFilenameFromUrl(url, defaultFilename = \"document.pdf\") {\n  if (typeof url !== \"string\") {\n    return defaultFilename;\n  }\n  if (isDataScheme(url)) {\n    warn('getPdfFilenameFromUrl: ignore \"data:\"-URL for performance reasons.');\n    return defaultFilename;\n  }\n  const reURI = /^(?:(?:[^:]+:)?\\/\\/[^/]+)?([^?#]*)(\\?[^#]*)?(#.*)?$/;\n  //              SCHEME        HOST        1.PATH  2.QUERY   3.REF\n  // Pattern to get last matching NAME.pdf\n  const reFilename = /[^/?#=]+\\.pdf\\b(?!.*\\.pdf\\b)/i;\n  const splitURI = reURI.exec(url);\n  let suggestedFilename =\n    reFilename.exec(splitURI[1]) ||\n    reFilename.exec(splitURI[2]) ||\n    reFilename.exec(splitURI[3]);\n  if (suggestedFilename) {\n    suggestedFilename = suggestedFilename[0];\n    if (suggestedFilename.includes(\"%\")) {\n      // URL-encoded %2Fpath%2Fto%2Ffile.pdf should be file.pdf\n      try {\n        suggestedFilename = reFilename.exec(\n          decodeURIComponent(suggestedFilename)\n        )[0];\n      } catch {\n        // Possible (extremely rare) errors:\n        // URIError \"Malformed URI\", e.g. for \"%AA.pdf\"\n        // TypeError \"null has no properties\", e.g. for \"%2F.pdf\"\n      }\n    }\n  }\n  return suggestedFilename || defaultFilename;\n}\n\nclass StatTimer {\n  started = Object.create(null);\n\n  times = [];\n\n  time(name) {\n    if (name in this.started) {\n      warn(`Timer is already running for ${name}`);\n    }\n    this.started[name] = Date.now();\n  }\n\n  timeEnd(name) {\n    if (!(name in this.started)) {\n      warn(`Timer has not been started for ${name}`);\n    }\n    this.times.push({\n      name,\n      start: this.started[name],\n      end: Date.now(),\n    });\n    // Remove timer from started so it can be called again.\n    delete this.started[name];\n  }\n\n  toString() {\n    // Find the longest name for padding purposes.\n    const outBuf = [];\n    let longest = 0;\n    for (const { name } of this.times) {\n      longest = Math.max(name.length, longest);\n    }\n    for (const { name, start, end } of this.times) {\n      outBuf.push(`${name.padEnd(longest)} ${end - start}ms\\n`);\n    }\n    return outBuf.join(\"\");\n  }\n}\n\nfunction isValidFetchUrl(url, baseUrl) {\n  if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n    throw new Error(\"Not implemented: isValidFetchUrl\");\n  }\n  try {\n    const { protocol } = baseUrl ? new URL(url, baseUrl) : new URL(url);\n    // The Fetch API only supports the http/https protocols, and not file/ftp.\n    return protocol === \"http:\" || protocol === \"https:\";\n  } catch {\n    return false; // `new URL()` will throw on incorrect data.\n  }\n}\n\n/**\n * Event handler to suppress context menu.\n */\nfunction noContextMenu(e) {\n  e.preventDefault();\n}\n\n// Deprecated API function -- display regardless of the `verbosity` setting.\nfunction deprecated(details) {\n  console.log(\"Deprecated API usage: \" + details);\n}\n\nlet pdfDateStringRegex;\n\nclass PDFDateString {\n  /**\n   * Convert a PDF date string to a JavaScript `Date` object.\n   *\n   * The PDF date string format is described in section 7.9.4 of the official\n   * PDF 32000-1:2008 specification. However, in the PDF 1.7 reference (sixth\n   * edition) Adobe describes the same format including a trailing apostrophe.\n   * This syntax in incorrect, but Adobe Acrobat creates PDF files that contain\n   * them. We ignore all apostrophes as they are not necessary for date parsing.\n   *\n   * Moreover, Adobe Acrobat doesn't handle changing the date to universal time\n   * and doesn't use the user's time zone (effectively ignoring the HH' and mm'\n   * parts of the date string).\n   *\n   * @param {string} input\n   * @returns {Date|null}\n   */\n  static toDateObject(input) {\n    if (!input || typeof input !== \"string\") {\n      return null;\n    }\n\n    // Lazily initialize the regular expression.\n    pdfDateStringRegex ||= new RegExp(\n      \"^D:\" + // Prefix (required)\n        \"(\\\\d{4})\" + // Year (required)\n        \"(\\\\d{2})?\" + // Month (optional)\n        \"(\\\\d{2})?\" + // Day (optional)\n        \"(\\\\d{2})?\" + // Hour (optional)\n        \"(\\\\d{2})?\" + // Minute (optional)\n        \"(\\\\d{2})?\" + // Second (optional)\n        \"([Z|+|-])?\" + // Universal time relation (optional)\n        \"(\\\\d{2})?\" + // Offset hour (optional)\n        \"'?\" + // Splitting apostrophe (optional)\n        \"(\\\\d{2})?\" + // Offset minute (optional)\n        \"'?\" // Trailing apostrophe (optional)\n    );\n\n    // Optional fields that don't satisfy the requirements from the regular\n    // expression (such as incorrect digit counts or numbers that are out of\n    // range) will fall back the defaults from the specification.\n    const matches = pdfDateStringRegex.exec(input);\n    if (!matches) {\n      return null;\n    }\n\n    // JavaScript's `Date` object expects the month to be between 0 and 11\n    // instead of 1 and 12, so we have to correct for that.\n    const year = parseInt(matches[1], 10);\n    let month = parseInt(matches[2], 10);\n    month = month >= 1 && month <= 12 ? month - 1 : 0;\n    let day = parseInt(matches[3], 10);\n    day = day >= 1 && day <= 31 ? day : 1;\n    let hour = parseInt(matches[4], 10);\n    hour = hour >= 0 && hour <= 23 ? hour : 0;\n    let minute = parseInt(matches[5], 10);\n    minute = minute >= 0 && minute <= 59 ? minute : 0;\n    let second = parseInt(matches[6], 10);\n    second = second >= 0 && second <= 59 ? second : 0;\n    const universalTimeRelation = matches[7] || \"Z\";\n    let offsetHour = parseInt(matches[8], 10);\n    offsetHour = offsetHour >= 0 && offsetHour <= 23 ? offsetHour : 0;\n    let offsetMinute = parseInt(matches[9], 10) || 0;\n    offsetMinute = offsetMinute >= 0 && offsetMinute <= 59 ? offsetMinute : 0;\n\n    // Universal time relation 'Z' means that the local time is equal to the\n    // universal time, whereas the relations '+'/'-' indicate that the local\n    // time is later respectively earlier than the universal time. Every date\n    // is normalized to universal time.\n    if (universalTimeRelation === \"-\") {\n      hour += offsetHour;\n      minute += offsetMinute;\n    } else if (universalTimeRelation === \"+\") {\n      hour -= offsetHour;\n      minute -= offsetMinute;\n    }\n\n    return new Date(Date.UTC(year, month, day, hour, minute, second));\n  }\n}\n\n/**\n * NOTE: This is (mostly) intended to support printing of XFA forms.\n */\nfunction getXfaPageViewport(xfaPage, { scale = 1, rotation = 0 }) {\n  const { width, height } = xfaPage.attributes.style;\n  const viewBox = [0, 0, parseInt(width), parseInt(height)];\n\n  return new PageViewport({\n    viewBox,\n    scale,\n    rotation,\n  });\n}\n\nfunction getRGB(color) {\n  if (color.startsWith(\"#\")) {\n    const colorRGB = parseInt(color.slice(1), 16);\n    return [\n      (colorRGB & 0xff0000) >> 16,\n      (colorRGB & 0x00ff00) >> 8,\n      colorRGB & 0x0000ff,\n    ];\n  }\n\n  if (color.startsWith(\"rgb(\")) {\n    // getComputedStyle(...).color returns a `rgb(R, G, B)` color.\n    return color\n      .slice(/* \"rgb(\".length */ 4, -1) // Strip out \"rgb(\" and \")\".\n      .split(\",\")\n      .map(x => parseInt(x));\n  }\n\n  if (color.startsWith(\"rgba(\")) {\n    return color\n      .slice(/* \"rgba(\".length */ 5, -1) // Strip out \"rgba(\" and \")\".\n      .split(\",\")\n      .map(x => parseInt(x))\n      .slice(0, 3);\n  }\n\n  warn(`Not a valid color format: \"${color}\"`);\n  return [0, 0, 0];\n}\n\nfunction getColorValues(colors) {\n  const span = document.createElement(\"span\");\n  span.style.visibility = \"hidden\";\n  document.body.append(span);\n  for (const name of colors.keys()) {\n    span.style.color = name;\n    const computedColor = window.getComputedStyle(span).color;\n    colors.set(name, getRGB(computedColor));\n  }\n  span.remove();\n}\n\nfunction getCurrentTransform(ctx) {\n  const { a, b, c, d, e, f } = ctx.getTransform();\n  return [a, b, c, d, e, f];\n}\n\nfunction getCurrentTransformInverse(ctx) {\n  const { a, b, c, d, e, f } = ctx.getTransform().invertSelf();\n  return [a, b, c, d, e, f];\n}\n\n/**\n * @param {HTMLDivElement} div\n * @param {PageViewport} viewport\n * @param {boolean} mustFlip\n * @param {boolean} mustRotate\n */\nfunction setLayerDimensions(\n  div,\n  viewport,\n  mustFlip = false,\n  mustRotate = true\n) {\n  if (viewport instanceof PageViewport) {\n    const { pageWidth, pageHeight } = viewport.rawDims;\n    const { style } = div;\n    const useRound = FeatureTest.isCSSRoundSupported;\n\n    const w = `var(--scale-factor) * ${pageWidth}px`,\n      h = `var(--scale-factor) * ${pageHeight}px`;\n    const widthStr = useRound ? `round(${w}, 1px)` : `calc(${w})`,\n      heightStr = useRound ? `round(${h}, 1px)` : `calc(${h})`;\n\n    if (!mustFlip || viewport.rotation % 180 === 0) {\n      style.width = widthStr;\n      style.height = heightStr;\n    } else {\n      style.width = heightStr;\n      style.height = widthStr;\n    }\n  }\n\n  if (mustRotate) {\n    div.setAttribute(\"data-main-rotation\", viewport.rotation);\n  }\n}\n\nexport {\n  deprecated,\n  DOMCanvasFactory,\n  DOMCMapReaderFactory,\n  DOMFilterFactory,\n  DOMStandardFontDataFactory,\n  DOMSVGFactory,\n  fetchData,\n  getColorValues,\n  getCurrentTransform,\n  getCurrentTransformInverse,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getRGB,\n  getXfaPageViewport,\n  isDataScheme,\n  isPdfFile,\n  isValidFetchUrl,\n  noContextMenu,\n  PageViewport,\n  PDFDateString,\n  PixelsPerInch,\n  RenderingCancelledException,\n  setLayerDimensions,\n  StatTimer,\n};\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu } from \"../display_utils.js\";\n\nclass EditorToolbar {\n  #toolbar = null;\n\n  #colorPicker = null;\n\n  #editor;\n\n  #buttons = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n  }\n\n  render() {\n    const editToolbar = (this.#toolbar = document.createElement(\"div\"));\n    editToolbar.className = \"editToolbar\";\n    editToolbar.setAttribute(\"role\", \"toolbar\");\n    const signal = this.#editor._uiManager._signal;\n    editToolbar.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    editToolbar.addEventListener(\"pointerdown\", EditorToolbar.#pointerDown, {\n      signal,\n    });\n\n    const buttons = (this.#buttons = document.createElement(\"div\"));\n    buttons.className = \"buttons\";\n    editToolbar.append(buttons);\n\n    const position = this.#editor.toolbarPosition;\n    if (position) {\n      const { style } = editToolbar;\n      const x =\n        this.#editor._uiManager.direction === \"ltr\"\n          ? 1 - position[0]\n          : position[0];\n      style.insetInlineEnd = `${100 * x}%`;\n      style.top = `calc(${\n        100 * position[1]\n      }% + var(--editor-toolbar-vert-offset))`;\n    }\n\n    this.#addDeleteButton();\n\n    return editToolbar;\n  }\n\n  static #pointerDown(e) {\n    e.stopPropagation();\n  }\n\n  #focusIn(e) {\n    this.#editor._focusEventsAllowed = false;\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  #focusOut(e) {\n    this.#editor._focusEventsAllowed = true;\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  #addListenersToElement(element) {\n    // If we're clicking on a button with the keyboard or with\n    // the mouse, we don't want to trigger any focus events on\n    // the editor.\n    const signal = this.#editor._uiManager._signal;\n    element.addEventListener(\"focusin\", this.#focusIn.bind(this), {\n      capture: true,\n      signal,\n    });\n    element.addEventListener(\"focusout\", this.#focusOut.bind(this), {\n      capture: true,\n      signal,\n    });\n    element.addEventListener(\"contextmenu\", noContextMenu, { signal });\n  }\n\n  hide() {\n    this.#toolbar.classList.add(\"hidden\");\n    this.#colorPicker?.hideDropdown();\n  }\n\n  show() {\n    this.#toolbar.classList.remove(\"hidden\");\n  }\n\n  #addDeleteButton() {\n    const button = document.createElement(\"button\");\n    button.className = \"delete\";\n    button.tabIndex = 0;\n    button.setAttribute(\n      \"data-l10n-id\",\n      `pdfjs-editor-remove-${this.#editor.editorType}-button`\n    );\n    this.#addListenersToElement(button);\n    button.addEventListener(\n      \"click\",\n      e => {\n        this.#editor._uiManager.delete();\n      },\n      { signal: this.#editor._uiManager._signal }\n    );\n    this.#buttons.append(button);\n  }\n\n  get #divider() {\n    const divider = document.createElement(\"div\");\n    divider.className = \"divider\";\n    return divider;\n  }\n\n  addAltTextButton(button) {\n    this.#addListenersToElement(button);\n    this.#buttons.prepend(button, this.#divider);\n  }\n\n  addColorPicker(colorPicker) {\n    this.#colorPicker = colorPicker;\n    const button = colorPicker.renderButton();\n    this.#addListenersToElement(button);\n    this.#buttons.prepend(button, this.#divider);\n  }\n\n  remove() {\n    this.#toolbar.remove();\n    this.#colorPicker?.destroy();\n    this.#colorPicker = null;\n  }\n}\n\nclass HighlightToolbar {\n  #buttons = null;\n\n  #toolbar = null;\n\n  #uiManager;\n\n  constructor(uiManager) {\n    this.#uiManager = uiManager;\n  }\n\n  #render() {\n    const editToolbar = (this.#toolbar = document.createElement(\"div\"));\n    editToolbar.className = \"editToolbar\";\n    editToolbar.setAttribute(\"role\", \"toolbar\");\n    editToolbar.addEventListener(\"contextmenu\", noContextMenu, {\n      signal: this.#uiManager._signal,\n    });\n\n    const buttons = (this.#buttons = document.createElement(\"div\"));\n    buttons.className = \"buttons\";\n    editToolbar.append(buttons);\n\n    this.#addHighlightButton();\n\n    return editToolbar;\n  }\n\n  #getLastPoint(boxes, isLTR) {\n    let lastY = 0;\n    let lastX = 0;\n    for (const box of boxes) {\n      const y = box.y + box.height;\n      if (y < lastY) {\n        continue;\n      }\n      const x = box.x + (isLTR ? box.width : 0);\n      if (y > lastY) {\n        lastX = x;\n        lastY = y;\n        continue;\n      }\n      if (isLTR) {\n        if (x > lastX) {\n          lastX = x;\n        }\n      } else if (x < lastX) {\n        lastX = x;\n      }\n    }\n    return [isLTR ? 1 - lastX : lastX, lastY];\n  }\n\n  show(parent, boxes, isLTR) {\n    const [x, y] = this.#getLastPoint(boxes, isLTR);\n    const { style } = (this.#toolbar ||= this.#render());\n    parent.append(this.#toolbar);\n    style.insetInlineEnd = `${100 * x}%`;\n    style.top = `calc(${100 * y}% + var(--editor-toolbar-vert-offset))`;\n  }\n\n  hide() {\n    this.#toolbar.remove();\n  }\n\n  #addHighlightButton() {\n    const button = document.createElement(\"button\");\n    button.className = \"highlightButton\";\n    button.tabIndex = 0;\n    button.setAttribute(\"data-l10n-id\", `pdfjs-highlight-floating-button1`);\n    const span = document.createElement(\"span\");\n    button.append(span);\n    span.className = \"visuallyHidden\";\n    span.setAttribute(\"data-l10n-id\", \"pdfjs-highlight-floating-button-label\");\n    const signal = this.#uiManager._signal;\n    button.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    button.addEventListener(\n      \"click\",\n      () => {\n        this.#uiManager.highlightSelection(\"floating_button\");\n      },\n      { signal }\n    );\n    this.#buttons.append(button);\n  }\n}\n\nexport { EditorToolbar, HighlightToolbar };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./editor.js\").AnnotationEditor} AnnotationEditor */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  FeatureTest,\n  getUuid,\n  shadow,\n  Util,\n  warn,\n} from \"../../shared/util.js\";\nimport {\n  fetchData,\n  getColorValues,\n  getRGB,\n  PixelsPerInch,\n} from \"../display_utils.js\";\nimport { HighlightToolbar } from \"./toolbar.js\";\n\nfunction bindEvents(obj, element, names) {\n  for (const name of names) {\n    element.addEventListener(name, obj[name].bind(obj));\n  }\n}\n\n/**\n * Convert a number between 0 and 100 into an hex number between 0 and 255.\n * @param {number} opacity\n * @return {string}\n */\nfunction opacityToHex(opacity) {\n  return Math.round(Math.min(255, Math.max(1, 255 * opacity)))\n    .toString(16)\n    .padStart(2, \"0\");\n}\n\n/**\n * Class to create some unique ids for the different editors.\n */\nclass IdManager {\n  #id = 0;\n\n  constructor() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      Object.defineProperty(this, \"reset\", {\n        value: () => (this.#id = 0),\n      });\n    }\n  }\n\n  /**\n   * Get a unique id.\n   * @returns {string}\n   */\n  get id() {\n    return `${AnnotationEditorPrefix}${this.#id++}`;\n  }\n}\n\n/**\n * Class to manage the images used by the editors.\n * The main idea is to try to minimize the memory used by the images.\n * The images are cached and reused when possible\n * We use a refCounter to know when an image is not used anymore but we need to\n * be able to restore an image after a remove+undo, so we keep a file reference\n * or an url one.\n */\nclass ImageManager {\n  #baseId = getUuid();\n\n  #id = 0;\n\n  #cache = null;\n\n  static get _isSVGFittingCanvas() {\n    // By default, Firefox doesn't rescale without preserving the aspect ratio\n    // when drawing an SVG image on a canvas, see https://bugzilla.mozilla.org/1547776.\n    // The \"workaround\" is to append \"svgView(preserveAspectRatio(none))\" to the\n    // url, but according to comment #15, it seems that it leads to unexpected\n    // behavior in Safari.\n    const svg = `data:image/svg+xml;charset=UTF-8,<svg viewBox=\"0 0 1 1\" width=\"1\" height=\"1\" xmlns=\"http://www.w3.org/2000/svg\"><rect width=\"1\" height=\"1\" style=\"fill:red;\"/></svg>`;\n    const canvas = new OffscreenCanvas(1, 3);\n    const ctx = canvas.getContext(\"2d\", { willReadFrequently: true });\n    const image = new Image();\n    image.src = svg;\n    const promise = image.decode().then(() => {\n      ctx.drawImage(image, 0, 0, 1, 1, 0, 0, 1, 3);\n      return new Uint32Array(ctx.getImageData(0, 0, 1, 1).data.buffer)[0] === 0;\n    });\n\n    return shadow(this, \"_isSVGFittingCanvas\", promise);\n  }\n\n  async #get(key, rawData) {\n    this.#cache ||= new Map();\n    let data = this.#cache.get(key);\n    if (data === null) {\n      // We already tried to load the image but it failed.\n      return null;\n    }\n    if (data?.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n    try {\n      data ||= {\n        bitmap: null,\n        id: `image_${this.#baseId}_${this.#id++}`,\n        refCounter: 0,\n        isSvg: false,\n      };\n      let image;\n      if (typeof rawData === \"string\") {\n        data.url = rawData;\n        image = await fetchData(rawData, \"blob\");\n      } else {\n        image = data.file = rawData;\n      }\n\n      if (image.type === \"image/svg+xml\") {\n        // Unfortunately, createImageBitmap doesn't work with SVG images.\n        // (see https://bugzilla.mozilla.org/1841972).\n        const mustRemoveAspectRatioPromise = ImageManager._isSVGFittingCanvas;\n        const fileReader = new FileReader();\n        const imageElement = new Image();\n        const imagePromise = new Promise((resolve, reject) => {\n          imageElement.onload = () => {\n            data.bitmap = imageElement;\n            data.isSvg = true;\n            resolve();\n          };\n          fileReader.onload = async () => {\n            const url = (data.svgUrl = fileReader.result);\n            // We need to set the preserveAspectRatio to none in order to let\n            // the image fits the canvas when resizing.\n            imageElement.src = (await mustRemoveAspectRatioPromise)\n              ? `${url}#svgView(preserveAspectRatio(none))`\n              : url;\n          };\n          imageElement.onerror = fileReader.onerror = reject;\n        });\n        fileReader.readAsDataURL(image);\n        await imagePromise;\n      } else {\n        data.bitmap = await createImageBitmap(image);\n      }\n      data.refCounter = 1;\n    } catch (e) {\n      console.error(e);\n      data = null;\n    }\n    this.#cache.set(key, data);\n    if (data) {\n      this.#cache.set(data.id, data);\n    }\n    return data;\n  }\n\n  async getFromFile(file) {\n    const { lastModified, name, size, type } = file;\n    return this.#get(`${lastModified}_${name}_${size}_${type}`, file);\n  }\n\n  async getFromUrl(url) {\n    return this.#get(url, url);\n  }\n\n  async getFromId(id) {\n    this.#cache ||= new Map();\n    const data = this.#cache.get(id);\n    if (!data) {\n      return null;\n    }\n    if (data.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n\n    if (data.file) {\n      return this.getFromFile(data.file);\n    }\n    return this.getFromUrl(data.url);\n  }\n\n  getSvgUrl(id) {\n    const data = this.#cache.get(id);\n    if (!data?.isSvg) {\n      return null;\n    }\n    return data.svgUrl;\n  }\n\n  deleteId(id) {\n    this.#cache ||= new Map();\n    const data = this.#cache.get(id);\n    if (!data) {\n      return;\n    }\n    data.refCounter -= 1;\n    if (data.refCounter !== 0) {\n      return;\n    }\n    data.bitmap = null;\n  }\n\n  // We can use the id only if it belongs this manager.\n  // We must take care of having the right manager because we can copy/paste\n  // some images from other documents, hence it'd be a pity to use an id from an\n  // other manager.\n  isValidId(id) {\n    return id.startsWith(`image_${this.#baseId}_`);\n  }\n}\n\n/**\n * Class to handle undo/redo.\n * Commands are just saved in a buffer.\n * If we hit some memory issues we could likely use a circular buffer.\n * It has to be used as a singleton.\n */\nclass CommandManager {\n  #commands = [];\n\n  #locked = false;\n\n  #maxSize;\n\n  #position = -1;\n\n  constructor(maxSize = 128) {\n    this.#maxSize = maxSize;\n  }\n\n  /**\n   * @typedef {Object} addOptions\n   * @property {function} cmd\n   * @property {function} undo\n   * @property {function} [post]\n   * @property {boolean} mustExec\n   * @property {number} type\n   * @property {boolean} overwriteIfSameType\n   * @property {boolean} keepUndo\n   */\n\n  /**\n   * Add a new couple of commands to be used in case of redo/undo.\n   * @param {addOptions} options\n   */\n  add({\n    cmd,\n    undo,\n    post,\n    mustExec,\n    type = NaN,\n    overwriteIfSameType = false,\n    keepUndo = false,\n  }) {\n    if (mustExec) {\n      cmd();\n    }\n\n    if (this.#locked) {\n      return;\n    }\n\n    const save = { cmd, undo, post, type };\n    if (this.#position === -1) {\n      if (this.#commands.length > 0) {\n        // All the commands have been undone and then a new one is added\n        // hence we clear the queue.\n        this.#commands.length = 0;\n      }\n      this.#position = 0;\n      this.#commands.push(save);\n      return;\n    }\n\n    if (overwriteIfSameType && this.#commands[this.#position].type === type) {\n      // For example when we change a color we don't want to\n      // be able to undo all the steps, hence we only want to\n      // keep the last undoable action in this sequence of actions.\n      if (keepUndo) {\n        save.undo = this.#commands[this.#position].undo;\n      }\n      this.#commands[this.#position] = save;\n      return;\n    }\n\n    const next = this.#position + 1;\n    if (next === this.#maxSize) {\n      this.#commands.splice(0, 1);\n    } else {\n      this.#position = next;\n      if (next < this.#commands.length) {\n        this.#commands.splice(next);\n      }\n    }\n\n    this.#commands.push(save);\n  }\n\n  /**\n   * Undo the last command.\n   */\n  undo() {\n    if (this.#position === -1) {\n      // Nothing to undo.\n      return;\n    }\n\n    // Avoid to insert something during the undo execution.\n    this.#locked = true;\n    const { undo, post } = this.#commands[this.#position];\n    undo();\n    post?.();\n    this.#locked = false;\n\n    this.#position -= 1;\n  }\n\n  /**\n   * Redo the last command.\n   */\n  redo() {\n    if (this.#position < this.#commands.length - 1) {\n      this.#position += 1;\n\n      // Avoid to insert something during the redo execution.\n      this.#locked = true;\n      const { cmd, post } = this.#commands[this.#position];\n      cmd();\n      post?.();\n      this.#locked = false;\n    }\n  }\n\n  /**\n   * Check if there is something to undo.\n   * @returns {boolean}\n   */\n  hasSomethingToUndo() {\n    return this.#position !== -1;\n  }\n\n  /**\n   * Check if there is something to redo.\n   * @returns {boolean}\n   */\n  hasSomethingToRedo() {\n    return this.#position < this.#commands.length - 1;\n  }\n\n  destroy() {\n    this.#commands = null;\n  }\n}\n\n/**\n * Class to handle the different keyboards shortcuts we can have on mac or\n * non-mac OSes.\n */\nclass KeyboardManager {\n  /**\n   * Create a new keyboard manager class.\n   * @param {Array<Array>} callbacks - an array containing an array of shortcuts\n   * and a callback to call.\n   * A shortcut is a string like `ctrl+c` or `mac+ctrl+c` for mac OS.\n   */\n  constructor(callbacks) {\n    this.buffer = [];\n    this.callbacks = new Map();\n    this.allKeys = new Set();\n\n    const { isMac } = FeatureTest.platform;\n    for (const [keys, callback, options = {}] of callbacks) {\n      for (const key of keys) {\n        const isMacKey = key.startsWith(\"mac+\");\n        if (isMac && isMacKey) {\n          this.callbacks.set(key.slice(4), { callback, options });\n          this.allKeys.add(key.split(\"+\").at(-1));\n        } else if (!isMac && !isMacKey) {\n          this.callbacks.set(key, { callback, options });\n          this.allKeys.add(key.split(\"+\").at(-1));\n        }\n      }\n    }\n  }\n\n  /**\n   * Serialize an event into a string in order to match a\n   * potential key for a callback.\n   * @param {KeyboardEvent} event\n   * @returns {string}\n   */\n  #serialize(event) {\n    if (event.altKey) {\n      this.buffer.push(\"alt\");\n    }\n    if (event.ctrlKey) {\n      this.buffer.push(\"ctrl\");\n    }\n    if (event.metaKey) {\n      this.buffer.push(\"meta\");\n    }\n    if (event.shiftKey) {\n      this.buffer.push(\"shift\");\n    }\n    this.buffer.push(event.key);\n    const str = this.buffer.join(\"+\");\n    this.buffer.length = 0;\n\n    return str;\n  }\n\n  /**\n   * Execute a callback, if any, for a given keyboard event.\n   * The self is used as `this` in the callback.\n   * @param {Object} self\n   * @param {KeyboardEvent} event\n   * @returns\n   */\n  exec(self, event) {\n    if (!this.allKeys.has(event.key)) {\n      return;\n    }\n    const info = this.callbacks.get(this.#serialize(event));\n    if (!info) {\n      return;\n    }\n    const {\n      callback,\n      options: { bubbles = false, args = [], checker = null },\n    } = info;\n\n    if (checker && !checker(self, event)) {\n      return;\n    }\n    callback.bind(self, ...args, event)();\n\n    // For example, ctrl+s in a FreeText must be handled by the viewer, hence\n    // the event must bubble.\n    if (!bubbles) {\n      event.stopPropagation();\n      event.preventDefault();\n    }\n  }\n}\n\nclass ColorManager {\n  static _colorsMapping = new Map([\n    [\"CanvasText\", [0, 0, 0]],\n    [\"Canvas\", [255, 255, 255]],\n  ]);\n\n  get _colors() {\n    if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"LIB\") &&\n      typeof document === \"undefined\"\n    ) {\n      return shadow(this, \"_colors\", ColorManager._colorsMapping);\n    }\n\n    const colors = new Map([\n      [\"CanvasText\", null],\n      [\"Canvas\", null],\n    ]);\n    getColorValues(colors);\n    return shadow(this, \"_colors\", colors);\n  }\n\n  /**\n   * In High Contrast Mode, the color on the screen is not always the\n   * real color used in the pdf.\n   * For example in some cases white can appear to be black but when saving\n   * we want to have white.\n   * @param {string} color\n   * @returns {Array<number>}\n   */\n  convert(color) {\n    const rgb = getRGB(color);\n    if (!window.matchMedia(\"(forced-colors: active)\").matches) {\n      return rgb;\n    }\n\n    for (const [name, RGB] of this._colors) {\n      if (RGB.every((x, i) => x === rgb[i])) {\n        return ColorManager._colorsMapping.get(name);\n      }\n    }\n    return rgb;\n  }\n\n  /**\n   * An input element must have its color value as a hex string\n   * and not as color name.\n   * So this function converts a name into an hex string.\n   * @param {string} name\n   * @returns {string}\n   */\n  getHexCode(name) {\n    const rgb = this._colors.get(name);\n    if (!rgb) {\n      return name;\n    }\n    return Util.makeHexColor(...rgb);\n  }\n}\n\n/**\n * A pdf has several pages and each of them when it will rendered\n * will have an AnnotationEditorLayer which will contain the some\n * new Annotations associated to an editor in order to modify them.\n *\n * This class is used to manage all the different layers, editors and\n * some action like copy/paste, undo/redo, ...\n */\nclass AnnotationEditorUIManager {\n  #abortController = new AbortController();\n\n  #activeEditor = null;\n\n  #allEditors = new Map();\n\n  #allLayers = new Map();\n\n  #altTextManager = null;\n\n  #annotationStorage = null;\n\n  #changedExistingAnnotations = null;\n\n  #commandManager = new CommandManager();\n\n  #currentPageIndex = 0;\n\n  #deletedAnnotationsElementIds = new Set();\n\n  #draggingEditors = null;\n\n  #editorTypes = null;\n\n  #editorsToRescale = new Set();\n\n  #enableHighlightFloatingButton = false;\n\n  #enableUpdatedAddImage = false;\n\n  #filterFactory = null;\n\n  #focusMainContainerTimeoutId = null;\n\n  #highlightColors = null;\n\n  #highlightWhenShiftUp = false;\n\n  #highlightToolbar = null;\n\n  #idManager = new IdManager();\n\n  #isEnabled = false;\n\n  #isWaiting = false;\n\n  #lastActiveElement = null;\n\n  #mainHighlightColorPicker = null;\n\n  #mlManager = null;\n\n  #mode = AnnotationEditorType.NONE;\n\n  #selectedEditors = new Set();\n\n  #selectedTextNode = null;\n\n  #pageColors = null;\n\n  #showAllStates = null;\n\n  #boundBlur = this.blur.bind(this);\n\n  #boundFocus = this.focus.bind(this);\n\n  #boundCopy = this.copy.bind(this);\n\n  #boundCut = this.cut.bind(this);\n\n  #boundPaste = this.paste.bind(this);\n\n  #boundKeydown = this.keydown.bind(this);\n\n  #boundKeyup = this.keyup.bind(this);\n\n  #boundOnEditingAction = this.onEditingAction.bind(this);\n\n  #boundOnPageChanging = this.onPageChanging.bind(this);\n\n  #boundOnScaleChanging = this.onScaleChanging.bind(this);\n\n  #boundOnRotationChanging = this.onRotationChanging.bind(this);\n\n  #previousStates = {\n    isEditing: false,\n    isEmpty: true,\n    hasSomethingToUndo: false,\n    hasSomethingToRedo: false,\n    hasSelectedEditor: false,\n    hasSelectedText: false,\n  };\n\n  #translation = [0, 0];\n\n  #translationTimeoutId = null;\n\n  #container = null;\n\n  #viewer = null;\n\n  static TRANSLATE_SMALL = 1; // page units.\n\n  static TRANSLATE_BIG = 10; // page units.\n\n  static get _keyboardManager() {\n    const proto = AnnotationEditorUIManager.prototype;\n\n    /**\n     * If the focused element is an input, we don't want to handle the arrow.\n     * For example, sliders can be controlled with the arrow keys.\n     */\n    const arrowChecker = self =>\n      self.#container.contains(document.activeElement) &&\n      document.activeElement.tagName !== \"BUTTON\" &&\n      self.hasSomethingToControl();\n\n    const textInputChecker = (_self, { target: el }) => {\n      if (el instanceof HTMLInputElement) {\n        const { type } = el;\n        return type !== \"text\" && type !== \"number\";\n      }\n      return true;\n    };\n\n    const small = this.TRANSLATE_SMALL;\n    const big = this.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          [\"ctrl+a\", \"mac+meta+a\"],\n          proto.selectAll,\n          { checker: textInputChecker },\n        ],\n        [[\"ctrl+z\", \"mac+meta+z\"], proto.undo, { checker: textInputChecker }],\n        [\n          // On mac, depending of the OS version, the event.key is either \"z\" or\n          // \"Z\" when the user presses \"meta+shift+z\".\n          [\n            \"ctrl+y\",\n            \"ctrl+shift+z\",\n            \"mac+meta+shift+z\",\n            \"ctrl+shift+Z\",\n            \"mac+meta+shift+Z\",\n          ],\n          proto.redo,\n          { checker: textInputChecker },\n        ],\n        [\n          [\n            \"Backspace\",\n            \"alt+Backspace\",\n            \"ctrl+Backspace\",\n            \"shift+Backspace\",\n            \"mac+Backspace\",\n            \"mac+alt+Backspace\",\n            \"mac+ctrl+Backspace\",\n            \"Delete\",\n            \"ctrl+Delete\",\n            \"shift+Delete\",\n            \"mac+Delete\",\n          ],\n          proto.delete,\n          { checker: textInputChecker },\n        ],\n        [\n          [\"Enter\", \"mac+Enter\"],\n          proto.addNewEditorFromKeyboard,\n          {\n            // Those shortcuts can be used in the toolbar for some other actions\n            // like zooming, hence we need to check if the container has the\n            // focus.\n            checker: (self, { target: el }) =>\n              !(el instanceof HTMLButtonElement) &&\n              self.#container.contains(el) &&\n              !self.isEnterHandled,\n          },\n        ],\n        [\n          [\" \", \"mac+ \"],\n          proto.addNewEditorFromKeyboard,\n          {\n            // Those shortcuts can be used in the toolbar for some other actions\n            // like zooming, hence we need to check if the container has the\n            // focus.\n            checker: (self, { target: el }) =>\n              !(el instanceof HTMLButtonElement) &&\n              self.#container.contains(document.activeElement),\n          },\n        ],\n        [[\"Escape\", \"mac+Escape\"], proto.unselectAll],\n        [\n          [\"ArrowLeft\", \"mac+ArrowLeft\"],\n          proto.translateSelectedEditors,\n          { args: [-small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          proto.translateSelectedEditors,\n          { args: [-big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowRight\", \"mac+ArrowRight\"],\n          proto.translateSelectedEditors,\n          { args: [small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          proto.translateSelectedEditors,\n          { args: [big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowUp\", \"mac+ArrowUp\"],\n          proto.translateSelectedEditors,\n          { args: [0, -small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"],\n          proto.translateSelectedEditors,\n          { args: [0, -big], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowDown\", \"mac+ArrowDown\"],\n          proto.translateSelectedEditors,\n          { args: [0, small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"],\n          proto.translateSelectedEditors,\n          { args: [0, big], checker: arrowChecker },\n        ],\n      ])\n    );\n  }\n\n  constructor(\n    container,\n    viewer,\n    altTextManager,\n    eventBus,\n    pdfDocument,\n    pageColors,\n    highlightColors,\n    enableHighlightFloatingButton,\n    enableUpdatedAddImage,\n    mlManager\n  ) {\n    this._signal = this.#abortController.signal;\n    this.#container = container;\n    this.#viewer = viewer;\n    this.#altTextManager = altTextManager;\n    this._eventBus = eventBus;\n    this._eventBus._on(\"editingaction\", this.#boundOnEditingAction);\n    this._eventBus._on(\"pagechanging\", this.#boundOnPageChanging);\n    this._eventBus._on(\"scalechanging\", this.#boundOnScaleChanging);\n    this._eventBus._on(\"rotationchanging\", this.#boundOnRotationChanging);\n    this.#addSelectionListener();\n    this.#addDragAndDropListeners();\n    this.#addKeyboardManager();\n    this.#annotationStorage = pdfDocument.annotationStorage;\n    this.#filterFactory = pdfDocument.filterFactory;\n    this.#pageColors = pageColors;\n    this.#highlightColors = highlightColors || null;\n    this.#enableHighlightFloatingButton = enableHighlightFloatingButton;\n    this.#enableUpdatedAddImage = enableUpdatedAddImage;\n    this.#mlManager = mlManager || null;\n    this.viewParameters = {\n      realScale: PixelsPerInch.PDF_TO_CSS_UNITS,\n      rotation: 0,\n    };\n    this.isShiftKeyDown = false;\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      Object.defineProperty(this, \"reset\", {\n        value: () => {\n          this.selectAll();\n          this.delete();\n          this.#idManager.reset();\n        },\n      });\n    }\n  }\n\n  destroy() {\n    this.#abortController?.abort();\n    this.#abortController = null;\n    this._signal = null;\n\n    this._eventBus._off(\"editingaction\", this.#boundOnEditingAction);\n    this._eventBus._off(\"pagechanging\", this.#boundOnPageChanging);\n    this._eventBus._off(\"scalechanging\", this.#boundOnScaleChanging);\n    this._eventBus._off(\"rotationchanging\", this.#boundOnRotationChanging);\n    for (const layer of this.#allLayers.values()) {\n      layer.destroy();\n    }\n    this.#allLayers.clear();\n    this.#allEditors.clear();\n    this.#editorsToRescale.clear();\n    this.#activeEditor = null;\n    this.#selectedEditors.clear();\n    this.#commandManager.destroy();\n    this.#altTextManager?.destroy();\n    this.#highlightToolbar?.hide();\n    this.#highlightToolbar = null;\n    if (this.#focusMainContainerTimeoutId) {\n      clearTimeout(this.#focusMainContainerTimeoutId);\n      this.#focusMainContainerTimeoutId = null;\n    }\n    if (this.#translationTimeoutId) {\n      clearTimeout(this.#translationTimeoutId);\n      this.#translationTimeoutId = null;\n    }\n  }\n\n  async mlGuess(data) {\n    return this.#mlManager?.guess(data) || null;\n  }\n\n  async isMLEnabledFor(name) {\n    return !!(await this.#mlManager?.isEnabledFor(name));\n  }\n\n  get useNewAltTextFlow() {\n    return this.#enableUpdatedAddImage;\n  }\n\n  get hcmFilter() {\n    return shadow(\n      this,\n      \"hcmFilter\",\n      this.#pageColors\n        ? this.#filterFactory.addHCMFilter(\n            this.#pageColors.foreground,\n            this.#pageColors.background\n          )\n        : \"none\"\n    );\n  }\n\n  get direction() {\n    return shadow(\n      this,\n      \"direction\",\n      getComputedStyle(this.#container).direction\n    );\n  }\n\n  get highlightColors() {\n    return shadow(\n      this,\n      \"highlightColors\",\n      this.#highlightColors\n        ? new Map(\n            this.#highlightColors\n              .split(\",\")\n              .map(pair => pair.split(\"=\").map(x => x.trim()))\n          )\n        : null\n    );\n  }\n\n  get highlightColorNames() {\n    return shadow(\n      this,\n      \"highlightColorNames\",\n      this.highlightColors\n        ? new Map(Array.from(this.highlightColors, e => e.reverse()))\n        : null\n    );\n  }\n\n  setMainHighlightColorPicker(colorPicker) {\n    this.#mainHighlightColorPicker = colorPicker;\n  }\n\n  editAltText(editor) {\n    this.#altTextManager?.editAltText(this, editor);\n  }\n\n  switchToMode(mode, callback) {\n    // Switching to a mode can be asynchronous.\n    this._eventBus.on(\"annotationeditormodechanged\", callback, {\n      once: true,\n      signal: this._signal,\n    });\n    this._eventBus.dispatch(\"showannotationeditorui\", {\n      source: this,\n      mode,\n    });\n  }\n\n  setPreference(name, value) {\n    this._eventBus.dispatch(\"setpreference\", {\n      source: this,\n      name,\n      value,\n    });\n  }\n\n  onPageChanging({ pageNumber }) {\n    this.#currentPageIndex = pageNumber - 1;\n  }\n\n  focusMainContainer() {\n    this.#container.focus();\n  }\n\n  findParent(x, y) {\n    for (const layer of this.#allLayers.values()) {\n      const {\n        x: layerX,\n        y: layerY,\n        width,\n        height,\n      } = layer.div.getBoundingClientRect();\n      if (\n        x >= layerX &&\n        x <= layerX + width &&\n        y >= layerY &&\n        y <= layerY + height\n      ) {\n        return layer;\n      }\n    }\n    return null;\n  }\n\n  disableUserSelect(value = false) {\n    this.#viewer.classList.toggle(\"noUserSelect\", value);\n  }\n\n  addShouldRescale(editor) {\n    this.#editorsToRescale.add(editor);\n  }\n\n  removeShouldRescale(editor) {\n    this.#editorsToRescale.delete(editor);\n  }\n\n  onScaleChanging({ scale }) {\n    this.commitOrRemove();\n    this.viewParameters.realScale = scale * PixelsPerInch.PDF_TO_CSS_UNITS;\n    for (const editor of this.#editorsToRescale) {\n      editor.onScaleChanging();\n    }\n  }\n\n  onRotationChanging({ pagesRotation }) {\n    this.commitOrRemove();\n    this.viewParameters.rotation = pagesRotation;\n  }\n\n  #getAnchorElementForSelection({ anchorNode }) {\n    return anchorNode.nodeType === Node.TEXT_NODE\n      ? anchorNode.parentElement\n      : anchorNode;\n  }\n\n  #getLayerForTextLayer(textLayer) {\n    const { currentLayer } = this;\n    if (currentLayer.hasTextLayer(textLayer)) {\n      return currentLayer;\n    }\n    for (const layer of this.#allLayers.values()) {\n      if (layer.hasTextLayer(textLayer)) {\n        return layer;\n      }\n    }\n    return null;\n  }\n\n  highlightSelection(methodOfCreation = \"\") {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n      return;\n    }\n    const { anchorNode, anchorOffset, focusNode, focusOffset } = selection;\n    const text = selection.toString();\n    const anchorElement = this.#getAnchorElementForSelection(selection);\n    const textLayer = anchorElement.closest(\".textLayer\");\n    const boxes = this.getSelectionBoxes(textLayer);\n    if (!boxes) {\n      return;\n    }\n    selection.empty();\n\n    const layer = this.#getLayerForTextLayer(textLayer);\n    const isNoneMode = this.#mode === AnnotationEditorType.NONE;\n    const callback = () => {\n      layer?.createAndAddNewEditor({ x: 0, y: 0 }, false, {\n        methodOfCreation,\n        boxes,\n        anchorNode,\n        anchorOffset,\n        focusNode,\n        focusOffset,\n        text,\n      });\n      if (isNoneMode) {\n        this.showAllEditors(\"highlight\", true, /* updateButton = */ true);\n      }\n    };\n    if (isNoneMode) {\n      this.switchToMode(AnnotationEditorType.HIGHLIGHT, callback);\n      return;\n    }\n    callback();\n  }\n\n  #displayHighlightToolbar() {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n      return;\n    }\n    const anchorElement = this.#getAnchorElementForSelection(selection);\n    const textLayer = anchorElement.closest(\".textLayer\");\n    const boxes = this.getSelectionBoxes(textLayer);\n    if (!boxes) {\n      return;\n    }\n    this.#highlightToolbar ||= new HighlightToolbar(this);\n    this.#highlightToolbar.show(textLayer, boxes, this.direction === \"ltr\");\n  }\n\n  /**\n   * Add an editor in the annotation storage.\n   * @param {AnnotationEditor} editor\n   */\n  addToAnnotationStorage(editor) {\n    if (\n      !editor.isEmpty() &&\n      this.#annotationStorage &&\n      !this.#annotationStorage.has(editor.id)\n    ) {\n      this.#annotationStorage.setValue(editor.id, editor);\n    }\n  }\n\n  #selectionChange() {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n      if (this.#selectedTextNode) {\n        this.#highlightToolbar?.hide();\n        this.#selectedTextNode = null;\n        this.#dispatchUpdateStates({\n          hasSelectedText: false,\n        });\n      }\n      return;\n    }\n    const { anchorNode } = selection;\n    if (anchorNode === this.#selectedTextNode) {\n      return;\n    }\n\n    const anchorElement = this.#getAnchorElementForSelection(selection);\n    const textLayer = anchorElement.closest(\".textLayer\");\n    if (!textLayer) {\n      if (this.#selectedTextNode) {\n        this.#highlightToolbar?.hide();\n        this.#selectedTextNode = null;\n        this.#dispatchUpdateStates({\n          hasSelectedText: false,\n        });\n      }\n      return;\n    }\n\n    this.#highlightToolbar?.hide();\n    this.#selectedTextNode = anchorNode;\n    this.#dispatchUpdateStates({\n      hasSelectedText: true,\n    });\n\n    if (\n      this.#mode !== AnnotationEditorType.HIGHLIGHT &&\n      this.#mode !== AnnotationEditorType.NONE\n    ) {\n      return;\n    }\n\n    if (this.#mode === AnnotationEditorType.HIGHLIGHT) {\n      this.showAllEditors(\"highlight\", true, /* updateButton = */ true);\n    }\n\n    this.#highlightWhenShiftUp = this.isShiftKeyDown;\n    if (!this.isShiftKeyDown) {\n      const activeLayer =\n        this.#mode === AnnotationEditorType.HIGHLIGHT\n          ? this.#getLayerForTextLayer(textLayer)\n          : null;\n      activeLayer?.toggleDrawing();\n\n      const signal = this._signal;\n      const pointerup = e => {\n        if (e.type === \"pointerup\" && e.button !== 0) {\n          // Do nothing on right click.\n          return;\n        }\n        activeLayer?.toggleDrawing(true);\n        window.removeEventListener(\"pointerup\", pointerup);\n        window.removeEventListener(\"blur\", pointerup);\n        if (e.type === \"pointerup\") {\n          this.#onSelectEnd(\"main_toolbar\");\n        }\n      };\n      window.addEventListener(\"pointerup\", pointerup, { signal });\n      window.addEventListener(\"blur\", pointerup, { signal });\n    }\n  }\n\n  #onSelectEnd(methodOfCreation = \"\") {\n    if (this.#mode === AnnotationEditorType.HIGHLIGHT) {\n      this.highlightSelection(methodOfCreation);\n    } else if (this.#enableHighlightFloatingButton) {\n      this.#displayHighlightToolbar();\n    }\n  }\n\n  #addSelectionListener() {\n    document.addEventListener(\n      \"selectionchange\",\n      this.#selectionChange.bind(this),\n      {\n        signal: this._signal,\n      }\n    );\n  }\n\n  #addFocusManager() {\n    const signal = this._signal;\n    window.addEventListener(\"focus\", this.#boundFocus, { signal });\n    window.addEventListener(\"blur\", this.#boundBlur, { signal });\n  }\n\n  #removeFocusManager() {\n    window.removeEventListener(\"focus\", this.#boundFocus);\n    window.removeEventListener(\"blur\", this.#boundBlur);\n  }\n\n  blur() {\n    this.isShiftKeyDown = false;\n    if (this.#highlightWhenShiftUp) {\n      this.#highlightWhenShiftUp = false;\n      this.#onSelectEnd(\"main_toolbar\");\n    }\n    if (!this.hasSelection) {\n      return;\n    }\n    // When several editors are selected and the window loses focus, we want to\n    // keep the last active element in order to be able to focus it again when\n    // the window gets the focus back but we don't want to trigger any focus\n    // callbacks else only one editor will be selected.\n    const { activeElement } = document;\n    for (const editor of this.#selectedEditors) {\n      if (editor.div.contains(activeElement)) {\n        this.#lastActiveElement = [editor, activeElement];\n        editor._focusEventsAllowed = false;\n        break;\n      }\n    }\n  }\n\n  focus() {\n    if (!this.#lastActiveElement) {\n      return;\n    }\n    const [lastEditor, lastActiveElement] = this.#lastActiveElement;\n    this.#lastActiveElement = null;\n    lastActiveElement.addEventListener(\n      \"focusin\",\n      () => {\n        lastEditor._focusEventsAllowed = true;\n      },\n      { once: true, signal: this._signal }\n    );\n    lastActiveElement.focus();\n  }\n\n  #addKeyboardManager() {\n    const signal = this._signal;\n    // The keyboard events are caught at the container level in order to be able\n    // to execute some callbacks even if the current page doesn't have focus.\n    window.addEventListener(\"keydown\", this.#boundKeydown, { signal });\n    window.addEventListener(\"keyup\", this.#boundKeyup, { signal });\n  }\n\n  #removeKeyboardManager() {\n    window.removeEventListener(\"keydown\", this.#boundKeydown);\n    window.removeEventListener(\"keyup\", this.#boundKeyup);\n  }\n\n  #addCopyPasteListeners() {\n    const signal = this._signal;\n    document.addEventListener(\"copy\", this.#boundCopy, { signal });\n    document.addEventListener(\"cut\", this.#boundCut, { signal });\n    document.addEventListener(\"paste\", this.#boundPaste, { signal });\n  }\n\n  #removeCopyPasteListeners() {\n    document.removeEventListener(\"copy\", this.#boundCopy);\n    document.removeEventListener(\"cut\", this.#boundCut);\n    document.removeEventListener(\"paste\", this.#boundPaste);\n  }\n\n  #addDragAndDropListeners() {\n    const signal = this._signal;\n    document.addEventListener(\"dragover\", this.dragOver.bind(this), { signal });\n    document.addEventListener(\"drop\", this.drop.bind(this), { signal });\n  }\n\n  addEditListeners() {\n    this.#addKeyboardManager();\n    this.#addCopyPasteListeners();\n  }\n\n  removeEditListeners() {\n    this.#removeKeyboardManager();\n    this.#removeCopyPasteListeners();\n  }\n\n  dragOver(event) {\n    for (const { type } of event.dataTransfer.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(type)) {\n          event.dataTransfer.dropEffect = \"copy\";\n          event.preventDefault();\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Drop callback.\n   * @param {DragEvent} event\n   */\n  drop(event) {\n    for (const item of event.dataTransfer.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(item.type)) {\n          editorType.paste(item, this.currentLayer);\n          event.preventDefault();\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Copy callback.\n   * @param {ClipboardEvent} event\n   */\n  copy(event) {\n    event.preventDefault();\n\n    // An editor is being edited so just commit it.\n    this.#activeEditor?.commitOrRemove();\n\n    if (!this.hasSelection) {\n      return;\n    }\n\n    const editors = [];\n    for (const editor of this.#selectedEditors) {\n      const serialized = editor.serialize(/* isForCopying = */ true);\n      if (serialized) {\n        editors.push(serialized);\n      }\n    }\n    if (editors.length === 0) {\n      return;\n    }\n\n    event.clipboardData.setData(\"application/pdfjs\", JSON.stringify(editors));\n  }\n\n  /**\n   * Cut callback.\n   * @param {ClipboardEvent} event\n   */\n  cut(event) {\n    this.copy(event);\n    this.delete();\n  }\n\n  /**\n   * Paste callback.\n   * @param {ClipboardEvent} event\n   */\n  paste(event) {\n    event.preventDefault();\n    const { clipboardData } = event;\n    for (const item of clipboardData.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(item.type)) {\n          editorType.paste(item, this.currentLayer);\n          return;\n        }\n      }\n    }\n\n    let data = clipboardData.getData(\"application/pdfjs\");\n    if (!data) {\n      return;\n    }\n\n    try {\n      data = JSON.parse(data);\n    } catch (ex) {\n      warn(`paste: \"${ex.message}\".`);\n      return;\n    }\n\n    if (!Array.isArray(data)) {\n      return;\n    }\n\n    this.unselectAll();\n    const layer = this.currentLayer;\n\n    try {\n      const newEditors = [];\n      for (const editor of data) {\n        const deserializedEditor = layer.deserialize(editor);\n        if (!deserializedEditor) {\n          return;\n        }\n        newEditors.push(deserializedEditor);\n      }\n\n      const cmd = () => {\n        for (const editor of newEditors) {\n          this.#addEditorToLayer(editor);\n        }\n        this.#selectEditors(newEditors);\n      };\n      const undo = () => {\n        for (const editor of newEditors) {\n          editor.remove();\n        }\n      };\n      this.addCommands({ cmd, undo, mustExec: true });\n    } catch (ex) {\n      warn(`paste: \"${ex.message}\".`);\n    }\n  }\n\n  /**\n   * Keydown callback.\n   * @param {KeyboardEvent} event\n   */\n  keydown(event) {\n    if (!this.isShiftKeyDown && event.key === \"Shift\") {\n      this.isShiftKeyDown = true;\n    }\n    if (\n      this.#mode !== AnnotationEditorType.NONE &&\n      !this.isEditorHandlingKeyboard\n    ) {\n      AnnotationEditorUIManager._keyboardManager.exec(this, event);\n    }\n  }\n\n  /**\n   * Keyup callback.\n   * @param {KeyboardEvent} event\n   */\n  keyup(event) {\n    if (this.isShiftKeyDown && event.key === \"Shift\") {\n      this.isShiftKeyDown = false;\n      if (this.#highlightWhenShiftUp) {\n        this.#highlightWhenShiftUp = false;\n        this.#onSelectEnd(\"main_toolbar\");\n      }\n    }\n  }\n\n  /**\n   * Execute an action for a given name.\n   * For example, the user can click on the \"Undo\" entry in the context menu\n   * and it'll trigger the undo action.\n   */\n  onEditingAction({ name }) {\n    switch (name) {\n      case \"undo\":\n      case \"redo\":\n      case \"delete\":\n      case \"selectAll\":\n        this[name]();\n        break;\n      case \"highlightSelection\":\n        this.highlightSelection(\"context_menu\");\n        break;\n    }\n  }\n\n  /**\n   * Update the different possible states of this manager, e.g. is there\n   * something to undo, redo, ...\n   * @param {Object} details\n   */\n  #dispatchUpdateStates(details) {\n    const hasChanged = Object.entries(details).some(\n      ([key, value]) => this.#previousStates[key] !== value\n    );\n\n    if (hasChanged) {\n      this._eventBus.dispatch(\"annotationeditorstateschanged\", {\n        source: this,\n        details: Object.assign(this.#previousStates, details),\n      });\n      // We could listen on our own event but it sounds like a bit weird and\n      // it's a way to simpler to handle that stuff here instead of having to\n      // add something in every place where an editor can be unselected.\n      if (\n        this.#mode === AnnotationEditorType.HIGHLIGHT &&\n        details.hasSelectedEditor === false\n      ) {\n        this.#dispatchUpdateUI([\n          [AnnotationEditorParamsType.HIGHLIGHT_FREE, true],\n        ]);\n      }\n    }\n  }\n\n  #dispatchUpdateUI(details) {\n    this._eventBus.dispatch(\"annotationeditorparamschanged\", {\n      source: this,\n      details,\n    });\n  }\n\n  /**\n   * Set the editing state.\n   * It can be useful to temporarily disable it when the user is editing a\n   * FreeText annotation.\n   * @param {boolean} isEditing\n   */\n  setEditingState(isEditing) {\n    if (isEditing) {\n      this.#addFocusManager();\n      this.#addCopyPasteListeners();\n      this.#dispatchUpdateStates({\n        isEditing: this.#mode !== AnnotationEditorType.NONE,\n        isEmpty: this.#isEmpty(),\n        hasSomethingToUndo: this.#commandManager.hasSomethingToUndo(),\n        hasSomethingToRedo: this.#commandManager.hasSomethingToRedo(),\n        hasSelectedEditor: false,\n      });\n    } else {\n      this.#removeFocusManager();\n      this.#removeCopyPasteListeners();\n      this.#dispatchUpdateStates({\n        isEditing: false,\n      });\n      this.disableUserSelect(false);\n    }\n  }\n\n  registerEditorTypes(types) {\n    if (this.#editorTypes) {\n      return;\n    }\n    this.#editorTypes = types;\n    for (const editorType of this.#editorTypes) {\n      this.#dispatchUpdateUI(editorType.defaultPropertiesToUpdate);\n    }\n  }\n\n  /**\n   * Get an id.\n   * @returns {string}\n   */\n  getId() {\n    return this.#idManager.id;\n  }\n\n  get currentLayer() {\n    return this.#allLayers.get(this.#currentPageIndex);\n  }\n\n  getLayer(pageIndex) {\n    return this.#allLayers.get(pageIndex);\n  }\n\n  get currentPageIndex() {\n    return this.#currentPageIndex;\n  }\n\n  /**\n   * Add a new layer for a page which will contains the editors.\n   * @param {AnnotationEditorLayer} layer\n   */\n  addLayer(layer) {\n    this.#allLayers.set(layer.pageIndex, layer);\n    if (this.#isEnabled) {\n      layer.enable();\n    } else {\n      layer.disable();\n    }\n  }\n\n  /**\n   * Remove a layer.\n   * @param {AnnotationEditorLayer} layer\n   */\n  removeLayer(layer) {\n    this.#allLayers.delete(layer.pageIndex);\n  }\n\n  /**\n   * Change the editor mode (None, FreeText, Ink, ...)\n   * @param {number} mode\n   * @param {string|null} editId\n   * @param {boolean} [isFromKeyboard] - true if the mode change is due to a\n   *   keyboard action.\n   */\n  updateMode(mode, editId = null, isFromKeyboard = false) {\n    if (this.#mode === mode) {\n      return;\n    }\n    this.#mode = mode;\n    if (mode === AnnotationEditorType.NONE) {\n      this.setEditingState(false);\n      this.#disableAll();\n      return;\n    }\n    this.setEditingState(true);\n    this.#enableAll();\n    this.unselectAll();\n    for (const layer of this.#allLayers.values()) {\n      layer.updateMode(mode);\n    }\n    if (!editId && isFromKeyboard) {\n      this.addNewEditorFromKeyboard();\n      return;\n    }\n\n    if (!editId) {\n      return;\n    }\n    for (const editor of this.#allEditors.values()) {\n      if (editor.annotationElementId === editId) {\n        this.setSelected(editor);\n        editor.enterInEditMode();\n        break;\n      }\n    }\n  }\n\n  addNewEditorFromKeyboard() {\n    if (this.currentLayer.canCreateNewEmptyEditor()) {\n      this.currentLayer.addNewEditor();\n    }\n  }\n\n  /**\n   * Update the toolbar if it's required to reflect the tool currently used.\n   * @param {number} mode\n   * @returns {undefined}\n   */\n  updateToolbar(mode) {\n    if (mode === this.#mode) {\n      return;\n    }\n    this._eventBus.dispatch(\"switchannotationeditormode\", {\n      source: this,\n      mode,\n    });\n  }\n\n  /**\n   * Update a parameter in the current editor or globally.\n   * @param {number} type\n   * @param {*} value\n   */\n  updateParams(type, value) {\n    if (!this.#editorTypes) {\n      return;\n    }\n\n    switch (type) {\n      case AnnotationEditorParamsType.CREATE:\n        this.currentLayer.addNewEditor();\n        return;\n      case AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:\n        this.#mainHighlightColorPicker?.updateColor(value);\n        break;\n      case AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:\n        this._eventBus.dispatch(\"reporttelemetry\", {\n          source: this,\n          details: {\n            type: \"editing\",\n            data: {\n              type: \"highlight\",\n              action: \"toggle_visibility\",\n            },\n          },\n        });\n        (this.#showAllStates ||= new Map()).set(type, value);\n        this.showAllEditors(\"highlight\", value);\n        break;\n    }\n\n    for (const editor of this.#selectedEditors) {\n      editor.updateParams(type, value);\n    }\n\n    for (const editorType of this.#editorTypes) {\n      editorType.updateDefaultParams(type, value);\n    }\n  }\n\n  showAllEditors(type, visible, updateButton = false) {\n    for (const editor of this.#allEditors.values()) {\n      if (editor.editorType === type) {\n        editor.show(visible);\n      }\n    }\n    const state =\n      this.#showAllStates?.get(AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL) ??\n      true;\n    if (state !== visible) {\n      this.#dispatchUpdateUI([\n        [AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL, visible],\n      ]);\n    }\n  }\n\n  enableWaiting(mustWait = false) {\n    if (this.#isWaiting === mustWait) {\n      return;\n    }\n    this.#isWaiting = mustWait;\n    for (const layer of this.#allLayers.values()) {\n      if (mustWait) {\n        layer.disableClick();\n      } else {\n        layer.enableClick();\n      }\n      layer.div.classList.toggle(\"waiting\", mustWait);\n    }\n  }\n\n  /**\n   * Enable all the layers.\n   */\n  #enableAll() {\n    if (!this.#isEnabled) {\n      this.#isEnabled = true;\n      for (const layer of this.#allLayers.values()) {\n        layer.enable();\n      }\n      for (const editor of this.#allEditors.values()) {\n        editor.enable();\n      }\n    }\n  }\n\n  /**\n   * Disable all the layers.\n   */\n  #disableAll() {\n    this.unselectAll();\n    if (this.#isEnabled) {\n      this.#isEnabled = false;\n      for (const layer of this.#allLayers.values()) {\n        layer.disable();\n      }\n      for (const editor of this.#allEditors.values()) {\n        editor.disable();\n      }\n    }\n  }\n\n  /**\n   * Get all the editors belonging to a given page.\n   * @param {number} pageIndex\n   * @returns {Array<AnnotationEditor>}\n   */\n  getEditors(pageIndex) {\n    const editors = [];\n    for (const editor of this.#allEditors.values()) {\n      if (editor.pageIndex === pageIndex) {\n        editors.push(editor);\n      }\n    }\n    return editors;\n  }\n\n  /**\n   * Get an editor with the given id.\n   * @param {string} id\n   * @returns {AnnotationEditor}\n   */\n  getEditor(id) {\n    return this.#allEditors.get(id);\n  }\n\n  /**\n   * Add a new editor.\n   * @param {AnnotationEditor} editor\n   */\n  addEditor(editor) {\n    this.#allEditors.set(editor.id, editor);\n  }\n\n  /**\n   * Remove an editor.\n   * @param {AnnotationEditor} editor\n   */\n  removeEditor(editor) {\n    if (editor.div.contains(document.activeElement)) {\n      if (this.#focusMainContainerTimeoutId) {\n        clearTimeout(this.#focusMainContainerTimeoutId);\n      }\n      this.#focusMainContainerTimeoutId = setTimeout(() => {\n        // When the div is removed from DOM the focus can move on the\n        // document.body, so we need to move it back to the main container.\n        this.focusMainContainer();\n        this.#focusMainContainerTimeoutId = null;\n      }, 0);\n    }\n    this.#allEditors.delete(editor.id);\n    this.unselect(editor);\n    if (\n      !editor.annotationElementId ||\n      !this.#deletedAnnotationsElementIds.has(editor.annotationElementId)\n    ) {\n      this.#annotationStorage?.remove(editor.id);\n    }\n  }\n\n  /**\n   * The annotation element with the given id has been deleted.\n   * @param {AnnotationEditor} editor\n   */\n  addDeletedAnnotationElement(editor) {\n    this.#deletedAnnotationsElementIds.add(editor.annotationElementId);\n    this.addChangedExistingAnnotation(editor);\n    editor.deleted = true;\n  }\n\n  /**\n   * Check if the annotation element with the given id has been deleted.\n   * @param {string} annotationElementId\n   * @returns {boolean}\n   */\n  isDeletedAnnotationElement(annotationElementId) {\n    return this.#deletedAnnotationsElementIds.has(annotationElementId);\n  }\n\n  /**\n   * The annotation element with the given id have been restored.\n   * @param {AnnotationEditor} editor\n   */\n  removeDeletedAnnotationElement(editor) {\n    this.#deletedAnnotationsElementIds.delete(editor.annotationElementId);\n    this.removeChangedExistingAnnotation(editor);\n    editor.deleted = false;\n  }\n\n  /**\n   * Add an editor to the layer it belongs to or add it to the global map.\n   * @param {AnnotationEditor} editor\n   */\n  #addEditorToLayer(editor) {\n    const layer = this.#allLayers.get(editor.pageIndex);\n    if (layer) {\n      layer.addOrRebuild(editor);\n    } else {\n      this.addEditor(editor);\n      this.addToAnnotationStorage(editor);\n    }\n  }\n\n  /**\n   * Set the given editor as the active one.\n   * @param {AnnotationEditor} editor\n   */\n  setActiveEditor(editor) {\n    if (this.#activeEditor === editor) {\n      return;\n    }\n\n    this.#activeEditor = editor;\n    if (editor) {\n      this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    }\n  }\n\n  get #lastSelectedEditor() {\n    let ed = null;\n    for (ed of this.#selectedEditors) {\n      // Iterate to get the last element.\n    }\n    return ed;\n  }\n\n  /**\n   * Update the UI of the active editor.\n   * @param {AnnotationEditor} editor\n   */\n  updateUI(editor) {\n    if (this.#lastSelectedEditor === editor) {\n      this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    }\n  }\n\n  /**\n   * Add or remove an editor the current selection.\n   * @param {AnnotationEditor} editor\n   */\n  toggleSelected(editor) {\n    if (this.#selectedEditors.has(editor)) {\n      this.#selectedEditors.delete(editor);\n      editor.unselect();\n      this.#dispatchUpdateStates({\n        hasSelectedEditor: this.hasSelection,\n      });\n      return;\n    }\n    this.#selectedEditors.add(editor);\n    editor.select();\n    this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: true,\n    });\n  }\n\n  /**\n   * Set the last selected editor.\n   * @param {AnnotationEditor} editor\n   */\n  setSelected(editor) {\n    for (const ed of this.#selectedEditors) {\n      if (ed !== editor) {\n        ed.unselect();\n      }\n    }\n    this.#selectedEditors.clear();\n\n    this.#selectedEditors.add(editor);\n    editor.select();\n    this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: true,\n    });\n  }\n\n  /**\n   * Check if the editor is selected.\n   * @param {AnnotationEditor} editor\n   */\n  isSelected(editor) {\n    return this.#selectedEditors.has(editor);\n  }\n\n  get firstSelectedEditor() {\n    return this.#selectedEditors.values().next().value;\n  }\n\n  /**\n   * Unselect an editor.\n   * @param {AnnotationEditor} editor\n   */\n  unselect(editor) {\n    editor.unselect();\n    this.#selectedEditors.delete(editor);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: this.hasSelection,\n    });\n  }\n\n  get hasSelection() {\n    return this.#selectedEditors.size !== 0;\n  }\n\n  get isEnterHandled() {\n    return (\n      this.#selectedEditors.size === 1 &&\n      this.firstSelectedEditor.isEnterHandled\n    );\n  }\n\n  /**\n   * Undo the last command.\n   */\n  undo() {\n    this.#commandManager.undo();\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: this.#commandManager.hasSomethingToUndo(),\n      hasSomethingToRedo: true,\n      isEmpty: this.#isEmpty(),\n    });\n  }\n\n  /**\n   * Redo the last undoed command.\n   */\n  redo() {\n    this.#commandManager.redo();\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: true,\n      hasSomethingToRedo: this.#commandManager.hasSomethingToRedo(),\n      isEmpty: this.#isEmpty(),\n    });\n  }\n\n  /**\n   * Add a command to execute (cmd) and another one to undo it.\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this.#commandManager.add(params);\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: true,\n      hasSomethingToRedo: false,\n      isEmpty: this.#isEmpty(),\n    });\n  }\n\n  #isEmpty() {\n    if (this.#allEditors.size === 0) {\n      return true;\n    }\n\n    if (this.#allEditors.size === 1) {\n      for (const editor of this.#allEditors.values()) {\n        return editor.isEmpty();\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Delete the current editor or all.\n   */\n  delete() {\n    this.commitOrRemove();\n    if (!this.hasSelection) {\n      return;\n    }\n\n    const editors = [...this.#selectedEditors];\n    const cmd = () => {\n      for (const editor of editors) {\n        editor.remove();\n      }\n    };\n    const undo = () => {\n      for (const editor of editors) {\n        this.#addEditorToLayer(editor);\n      }\n    };\n\n    this.addCommands({ cmd, undo, mustExec: true });\n  }\n\n  commitOrRemove() {\n    // An editor is being edited so just commit it.\n    this.#activeEditor?.commitOrRemove();\n  }\n\n  hasSomethingToControl() {\n    return this.#activeEditor || this.hasSelection;\n  }\n\n  /**\n   * Select the editors.\n   * @param {Array<AnnotationEditor>} editors\n   */\n  #selectEditors(editors) {\n    for (const editor of this.#selectedEditors) {\n      editor.unselect();\n    }\n    this.#selectedEditors.clear();\n    for (const editor of editors) {\n      if (editor.isEmpty()) {\n        continue;\n      }\n      this.#selectedEditors.add(editor);\n      editor.select();\n    }\n    this.#dispatchUpdateStates({ hasSelectedEditor: this.hasSelection });\n  }\n\n  /**\n   * Select all the editors.\n   */\n  selectAll() {\n    for (const editor of this.#selectedEditors) {\n      editor.commit();\n    }\n    this.#selectEditors(this.#allEditors.values());\n  }\n\n  /**\n   * Unselect all the selected editors.\n   */\n  unselectAll() {\n    if (this.#activeEditor) {\n      // An editor is being edited so just commit it.\n      this.#activeEditor.commitOrRemove();\n      if (this.#mode !== AnnotationEditorType.NONE) {\n        // If the mode is NONE, we want to really unselect the editor, hence we\n        // mustn't return here.\n        return;\n      }\n    }\n\n    if (!this.hasSelection) {\n      return;\n    }\n    for (const editor of this.#selectedEditors) {\n      editor.unselect();\n    }\n    this.#selectedEditors.clear();\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: false,\n    });\n  }\n\n  translateSelectedEditors(x, y, noCommit = false) {\n    if (!noCommit) {\n      this.commitOrRemove();\n    }\n    if (!this.hasSelection) {\n      return;\n    }\n\n    this.#translation[0] += x;\n    this.#translation[1] += y;\n    const [totalX, totalY] = this.#translation;\n    const editors = [...this.#selectedEditors];\n\n    // We don't want to have an undo/redo for each translation so we wait a bit\n    // before adding the command to the command manager.\n    const TIME_TO_WAIT = 1000;\n\n    if (this.#translationTimeoutId) {\n      clearTimeout(this.#translationTimeoutId);\n    }\n\n    this.#translationTimeoutId = setTimeout(() => {\n      this.#translationTimeoutId = null;\n      this.#translation[0] = this.#translation[1] = 0;\n\n      this.addCommands({\n        cmd: () => {\n          for (const editor of editors) {\n            if (this.#allEditors.has(editor.id)) {\n              editor.translateInPage(totalX, totalY);\n            }\n          }\n        },\n        undo: () => {\n          for (const editor of editors) {\n            if (this.#allEditors.has(editor.id)) {\n              editor.translateInPage(-totalX, -totalY);\n            }\n          }\n        },\n        mustExec: false,\n      });\n    }, TIME_TO_WAIT);\n\n    for (const editor of editors) {\n      editor.translateInPage(x, y);\n    }\n  }\n\n  /**\n   * Set up the drag session for moving the selected editors.\n   */\n  setUpDragSession() {\n    // Note: don't use any references to the editor's parent which can be null\n    // if the editor belongs to a destroyed page.\n    if (!this.hasSelection) {\n      return;\n    }\n    // Avoid to have spurious text selection in the text layer when dragging.\n    this.disableUserSelect(true);\n    this.#draggingEditors = new Map();\n    for (const editor of this.#selectedEditors) {\n      this.#draggingEditors.set(editor, {\n        savedX: editor.x,\n        savedY: editor.y,\n        savedPageIndex: editor.pageIndex,\n        newX: 0,\n        newY: 0,\n        newPageIndex: -1,\n      });\n    }\n  }\n\n  /**\n   * Ends the drag session.\n   * @returns {boolean} true if at least one editor has been moved.\n   */\n  endDragSession() {\n    if (!this.#draggingEditors) {\n      return false;\n    }\n    this.disableUserSelect(false);\n    const map = this.#draggingEditors;\n    this.#draggingEditors = null;\n    let mustBeAddedInUndoStack = false;\n\n    for (const [{ x, y, pageIndex }, value] of map) {\n      value.newX = x;\n      value.newY = y;\n      value.newPageIndex = pageIndex;\n      mustBeAddedInUndoStack ||=\n        x !== value.savedX ||\n        y !== value.savedY ||\n        pageIndex !== value.savedPageIndex;\n    }\n\n    if (!mustBeAddedInUndoStack) {\n      return false;\n    }\n\n    const move = (editor, x, y, pageIndex) => {\n      if (this.#allEditors.has(editor.id)) {\n        // The editor can be undone/redone on a page which is not visible (and\n        // which potentially has no annotation editor layer), hence we need to\n        // use the pageIndex instead of the parent.\n        const parent = this.#allLayers.get(pageIndex);\n        if (parent) {\n          editor._setParentAndPosition(parent, x, y);\n        } else {\n          editor.pageIndex = pageIndex;\n          editor.x = x;\n          editor.y = y;\n        }\n      }\n    };\n\n    this.addCommands({\n      cmd: () => {\n        for (const [editor, { newX, newY, newPageIndex }] of map) {\n          move(editor, newX, newY, newPageIndex);\n        }\n      },\n      undo: () => {\n        for (const [editor, { savedX, savedY, savedPageIndex }] of map) {\n          move(editor, savedX, savedY, savedPageIndex);\n        }\n      },\n      mustExec: true,\n    });\n\n    return true;\n  }\n\n  /**\n   * Drag the set of selected editors.\n   * @param {number} tx\n   * @param {number} ty\n   */\n  dragSelectedEditors(tx, ty) {\n    if (!this.#draggingEditors) {\n      return;\n    }\n    for (const editor of this.#draggingEditors.keys()) {\n      editor.drag(tx, ty);\n    }\n  }\n\n  /**\n   * Rebuild the editor (usually on undo/redo actions) on a potentially\n   * non-rendered page.\n   * @param {AnnotationEditor} editor\n   */\n  rebuild(editor) {\n    if (editor.parent === null) {\n      const parent = this.getLayer(editor.pageIndex);\n      if (parent) {\n        parent.changeParent(editor);\n        parent.addOrRebuild(editor);\n      } else {\n        this.addEditor(editor);\n        this.addToAnnotationStorage(editor);\n        editor.rebuild();\n      }\n    } else {\n      editor.parent.addOrRebuild(editor);\n    }\n  }\n\n  get isEditorHandlingKeyboard() {\n    return (\n      this.getActive()?.shouldGetKeyboardEvents() ||\n      (this.#selectedEditors.size === 1 &&\n        this.firstSelectedEditor.shouldGetKeyboardEvents())\n    );\n  }\n\n  /**\n   * Is the current editor the one passed as argument?\n   * @param {AnnotationEditor} editor\n   * @returns\n   */\n  isActive(editor) {\n    return this.#activeEditor === editor;\n  }\n\n  /**\n   * Get the current active editor.\n   * @returns {AnnotationEditor|null}\n   */\n  getActive() {\n    return this.#activeEditor;\n  }\n\n  /**\n   * Get the current editor mode.\n   * @returns {number}\n   */\n  getMode() {\n    return this.#mode;\n  }\n\n  get imageManager() {\n    return shadow(this, \"imageManager\", new ImageManager());\n  }\n\n  getSelectionBoxes(textLayer) {\n    if (!textLayer) {\n      return null;\n    }\n    const selection = document.getSelection();\n    for (let i = 0, ii = selection.rangeCount; i < ii; i++) {\n      if (\n        !textLayer.contains(selection.getRangeAt(i).commonAncestorContainer)\n      ) {\n        return null;\n      }\n    }\n\n    const {\n      x: layerX,\n      y: layerY,\n      width: parentWidth,\n      height: parentHeight,\n    } = textLayer.getBoundingClientRect();\n\n    // We must rotate the boxes because we want to have them in the non-rotated\n    // page coordinates.\n    let rotator;\n    switch (textLayer.getAttribute(\"data-main-rotation\")) {\n      case \"90\":\n        rotator = (x, y, w, h) => ({\n          x: (y - layerY) / parentHeight,\n          y: 1 - (x + w - layerX) / parentWidth,\n          width: h / parentHeight,\n          height: w / parentWidth,\n        });\n        break;\n      case \"180\":\n        rotator = (x, y, w, h) => ({\n          x: 1 - (x + w - layerX) / parentWidth,\n          y: 1 - (y + h - layerY) / parentHeight,\n          width: w / parentWidth,\n          height: h / parentHeight,\n        });\n        break;\n      case \"270\":\n        rotator = (x, y, w, h) => ({\n          x: 1 - (y + h - layerY) / parentHeight,\n          y: (x - layerX) / parentWidth,\n          width: h / parentHeight,\n          height: w / parentWidth,\n        });\n        break;\n      default:\n        rotator = (x, y, w, h) => ({\n          x: (x - layerX) / parentWidth,\n          y: (y - layerY) / parentHeight,\n          width: w / parentWidth,\n          height: h / parentHeight,\n        });\n        break;\n    }\n\n    const boxes = [];\n    for (let i = 0, ii = selection.rangeCount; i < ii; i++) {\n      const range = selection.getRangeAt(i);\n      if (range.collapsed) {\n        continue;\n      }\n      for (const { x, y, width, height } of range.getClientRects()) {\n        if (width === 0 || height === 0) {\n          continue;\n        }\n        boxes.push(rotator(x, y, width, height));\n      }\n    }\n    return boxes.length === 0 ? null : boxes;\n  }\n\n  addChangedExistingAnnotation({ annotationElementId, id }) {\n    (this.#changedExistingAnnotations ||= new Map()).set(\n      annotationElementId,\n      id\n    );\n  }\n\n  removeChangedExistingAnnotation({ annotationElementId }) {\n    this.#changedExistingAnnotations?.delete(annotationElementId);\n  }\n\n  renderAnnotationElement(annotation) {\n    const editorId = this.#changedExistingAnnotations?.get(annotation.data.id);\n    if (!editorId) {\n      return;\n    }\n    const editor = this.#annotationStorage.getRawValue(editorId);\n    if (!editor) {\n      return;\n    }\n    if (this.#mode === AnnotationEditorType.NONE && !editor.hasBeenModified) {\n      return;\n    }\n    editor.renderAnnotationElement(annotation);\n  }\n}\n\nexport {\n  AnnotationEditorUIManager,\n  bindEvents,\n  ColorManager,\n  CommandManager,\n  KeyboardManager,\n  opacityToHex,\n};\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu } from \"../display_utils.js\";\n\nclass AltText {\n  #altText = \"\";\n\n  #altTextDecorative = false;\n\n  #altTextButton = null;\n\n  #altTextTooltip = null;\n\n  #altTextTooltipTimeout = null;\n\n  #altTextWasFromKeyBoard = false;\n\n  #editor = null;\n\n  static _l10nPromise = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n  }\n\n  static initialize(l10nPromise) {\n    AltText._l10nPromise ||= l10nPromise;\n  }\n\n  async render() {\n    const altText = (this.#altTextButton = document.createElement(\"button\"));\n    altText.className = \"altText\";\n    const msg = await AltText._l10nPromise.get(\n      \"pdfjs-editor-alt-text-button-label\"\n    );\n    altText.textContent = msg;\n    altText.setAttribute(\"aria-label\", msg);\n    altText.tabIndex = \"0\";\n    const signal = this.#editor._uiManager._signal;\n    altText.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    altText.addEventListener(\"pointerdown\", event => event.stopPropagation(), {\n      signal,\n    });\n\n    const onClick = event => {\n      event.preventDefault();\n      this.#editor._uiManager.editAltText(this.#editor);\n    };\n    altText.addEventListener(\"click\", onClick, { capture: true, signal });\n    altText.addEventListener(\n      \"keydown\",\n      event => {\n        if (event.target === altText && event.key === \"Enter\") {\n          this.#altTextWasFromKeyBoard = true;\n          onClick(event);\n        }\n      },\n      { signal }\n    );\n    await this.#setState();\n\n    return altText;\n  }\n\n  finish() {\n    if (!this.#altTextButton) {\n      return;\n    }\n    this.#altTextButton.focus({ focusVisible: this.#altTextWasFromKeyBoard });\n    this.#altTextWasFromKeyBoard = false;\n  }\n\n  isEmpty() {\n    return !this.#altText && !this.#altTextDecorative;\n  }\n\n  get data() {\n    return {\n      altText: this.#altText,\n      decorative: this.#altTextDecorative,\n    };\n  }\n\n  /**\n   * Set the alt text data.\n   */\n  set data({ altText, decorative }) {\n    if (this.#altText === altText && this.#altTextDecorative === decorative) {\n      return;\n    }\n    this.#altText = altText;\n    this.#altTextDecorative = decorative;\n    this.#setState();\n  }\n\n  toggle(enabled = false) {\n    if (!this.#altTextButton) {\n      return;\n    }\n    if (!enabled && this.#altTextTooltipTimeout) {\n      clearTimeout(this.#altTextTooltipTimeout);\n      this.#altTextTooltipTimeout = null;\n    }\n    this.#altTextButton.disabled = !enabled;\n  }\n\n  destroy() {\n    this.#altTextButton?.remove();\n    this.#altTextButton = null;\n    this.#altTextTooltip = null;\n  }\n\n  async #setState() {\n    const button = this.#altTextButton;\n    if (!button) {\n      return;\n    }\n    if (!this.#altText && !this.#altTextDecorative) {\n      button.classList.remove(\"done\");\n      this.#altTextTooltip?.remove();\n      return;\n    }\n    button.classList.add(\"done\");\n\n    AltText._l10nPromise\n      .get(\"pdfjs-editor-alt-text-edit-button-label\")\n      .then(msg => {\n        button.setAttribute(\"aria-label\", msg);\n      });\n    let tooltip = this.#altTextTooltip;\n    if (!tooltip) {\n      this.#altTextTooltip = tooltip = document.createElement(\"span\");\n      tooltip.className = \"tooltip\";\n      tooltip.setAttribute(\"role\", \"tooltip\");\n      const id = (tooltip.id = `alt-text-tooltip-${this.#editor.id}`);\n      button.setAttribute(\"aria-describedby\", id);\n\n      const DELAY_TO_SHOW_TOOLTIP = 100;\n      const signal = this.#editor._uiManager._signal;\n      signal.addEventListener(\n        \"abort\",\n        () => {\n          clearTimeout(this.#altTextTooltipTimeout);\n          this.#altTextTooltipTimeout = null;\n        },\n        { once: true }\n      );\n      button.addEventListener(\n        \"mouseenter\",\n        () => {\n          this.#altTextTooltipTimeout = setTimeout(() => {\n            this.#altTextTooltipTimeout = null;\n            this.#altTextTooltip.classList.add(\"show\");\n            this.#editor._reportTelemetry({\n              action: \"alt_text_tooltip\",\n            });\n          }, DELAY_TO_SHOW_TOOLTIP);\n        },\n        { signal }\n      );\n      button.addEventListener(\n        \"mouseleave\",\n        () => {\n          if (this.#altTextTooltipTimeout) {\n            clearTimeout(this.#altTextTooltipTimeout);\n            this.#altTextTooltipTimeout = null;\n          }\n          this.#altTextTooltip?.classList.remove(\"show\");\n        },\n        { signal }\n      );\n    }\n    tooltip.innerText = this.#altTextDecorative\n      ? await AltText._l10nPromise.get(\n          \"pdfjs-editor-alt-text-decorative-tooltip\"\n        )\n      : this.#altText;\n\n    if (!tooltip.parentNode) {\n      button.append(tooltip);\n    }\n\n    const element = this.#editor.getImageForAltText();\n    element?.setAttribute(\"aria-describedby\", tooltip.id);\n  }\n}\n\nexport { AltText };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorUIManager,\n  bindEvents,\n  ColorManager,\n  KeyboardManager,\n} from \"./tools.js\";\nimport { FeatureTest, shadow, unreachable } from \"../../shared/util.js\";\nimport { AltText } from \"./alt_text.js\";\nimport { EditorToolbar } from \"./toolbar.js\";\nimport { noContextMenu } from \"../display_utils.js\";\n\n/**\n * @typedef {Object} AnnotationEditorParameters\n * @property {AnnotationEditorUIManager} uiManager - the global manager\n * @property {AnnotationEditorLayer} parent - the layer containing this editor\n * @property {string} id - editor id\n * @property {number} x - x-coordinate\n * @property {number} y - y-coordinate\n */\n\n/**\n * Base class for editors.\n */\nclass AnnotationEditor {\n  #accessibilityData = null;\n\n  #allResizerDivs = null;\n\n  #altText = null;\n\n  #disabled = false;\n\n  #keepAspectRatio = false;\n\n  #resizersDiv = null;\n\n  #savedDimensions = null;\n\n  #boundFocusin = this.focusin.bind(this);\n\n  #boundFocusout = this.focusout.bind(this);\n\n  #editToolbar = null;\n\n  #focusedResizerName = \"\";\n\n  #hasBeenClicked = false;\n\n  #initialPosition = null;\n\n  #isEditing = false;\n\n  #isInEditMode = false;\n\n  #isResizerEnabledForKeyboard = false;\n\n  #moveInDOMTimeout = null;\n\n  #prevDragX = 0;\n\n  #prevDragY = 0;\n\n  #telemetryTimeouts = null;\n\n  _initialOptions = Object.create(null);\n\n  _isVisible = true;\n\n  _uiManager = null;\n\n  _focusEventsAllowed = true;\n\n  _l10nPromise = null;\n\n  #isDraggable = false;\n\n  #zIndex = AnnotationEditor._zIndex++;\n\n  static _borderLineWidth = -1;\n\n  static _colorManager = new ColorManager();\n\n  static _zIndex = 1;\n\n  // Time to wait (in ms) before sending the telemetry data.\n  // We wait a bit to avoid sending too many requests when changing something\n  // like the thickness of a line.\n  static _telemetryTimeout = 1000;\n\n  static get _resizerKeyboardManager() {\n    const resize = AnnotationEditor.prototype._resizeWithKeyboard;\n    const small = AnnotationEditorUIManager.TRANSLATE_SMALL;\n    const big = AnnotationEditorUIManager.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_resizerKeyboardManager\",\n      new KeyboardManager([\n        [[\"ArrowLeft\", \"mac+ArrowLeft\"], resize, { args: [-small, 0] }],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          resize,\n          { args: [-big, 0] },\n        ],\n        [[\"ArrowRight\", \"mac+ArrowRight\"], resize, { args: [small, 0] }],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          resize,\n          { args: [big, 0] },\n        ],\n        [[\"ArrowUp\", \"mac+ArrowUp\"], resize, { args: [0, -small] }],\n        [[\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"], resize, { args: [0, -big] }],\n        [[\"ArrowDown\", \"mac+ArrowDown\"], resize, { args: [0, small] }],\n        [[\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"], resize, { args: [0, big] }],\n        [\n          [\"Escape\", \"mac+Escape\"],\n          AnnotationEditor.prototype._stopResizingWithKeyboard,\n        ],\n      ])\n    );\n  }\n\n  /**\n   * @param {AnnotationEditorParameters} parameters\n   */\n  constructor(parameters) {\n    if (this.constructor === AnnotationEditor) {\n      unreachable(\"Cannot initialize AnnotationEditor.\");\n    }\n\n    this.parent = parameters.parent;\n    this.id = parameters.id;\n    this.width = this.height = null;\n    this.pageIndex = parameters.parent.pageIndex;\n    this.name = parameters.name;\n    this.div = null;\n    this._uiManager = parameters.uiManager;\n    this.annotationElementId = null;\n    this._willKeepAspectRatio = false;\n    this._initialOptions.isCentered = parameters.isCentered;\n    this._structTreeParentId = null;\n\n    const {\n      rotation,\n      rawDims: { pageWidth, pageHeight, pageX, pageY },\n    } = this.parent.viewport;\n\n    this.rotation = rotation;\n    this.pageRotation =\n      (360 + rotation - this._uiManager.viewParameters.rotation) % 360;\n    this.pageDimensions = [pageWidth, pageHeight];\n    this.pageTranslation = [pageX, pageY];\n\n    const [width, height] = this.parentDimensions;\n    this.x = parameters.x / width;\n    this.y = parameters.y / height;\n\n    this.isAttachedToDOM = false;\n    this.deleted = false;\n  }\n\n  get editorType() {\n    return Object.getPrototypeOf(this).constructor._type;\n  }\n\n  static get _defaultLineColor() {\n    return shadow(\n      this,\n      \"_defaultLineColor\",\n      this._colorManager.getHexCode(\"CanvasText\")\n    );\n  }\n\n  static deleteAnnotationElement(editor) {\n    const fakeEditor = new FakeEditor({\n      id: editor.parent.getNextId(),\n      parent: editor.parent,\n      uiManager: editor._uiManager,\n    });\n    fakeEditor.annotationElementId = editor.annotationElementId;\n    fakeEditor.deleted = true;\n    fakeEditor._uiManager.addToAnnotationStorage(fakeEditor);\n  }\n\n  /**\n   * Initialize the l10n stuff for this type of editor.\n   * @param {Object} l10n\n   */\n  static initialize(l10n, _uiManager, options) {\n    AnnotationEditor._l10nPromise ||= new Map(\n      [\n        \"pdfjs-editor-alt-text-button-label\",\n        \"pdfjs-editor-alt-text-edit-button-label\",\n        \"pdfjs-editor-alt-text-decorative-tooltip\",\n        \"pdfjs-editor-resizer-label-topLeft\",\n        \"pdfjs-editor-resizer-label-topMiddle\",\n        \"pdfjs-editor-resizer-label-topRight\",\n        \"pdfjs-editor-resizer-label-middleRight\",\n        \"pdfjs-editor-resizer-label-bottomRight\",\n        \"pdfjs-editor-resizer-label-bottomMiddle\",\n        \"pdfjs-editor-resizer-label-bottomLeft\",\n        \"pdfjs-editor-resizer-label-middleLeft\",\n      ].map(str => [\n        str,\n        l10n.get(str.replaceAll(/([A-Z])/g, c => `-${c.toLowerCase()}`)),\n      ])\n    );\n    if (options?.strings) {\n      for (const str of options.strings) {\n        AnnotationEditor._l10nPromise.set(str, l10n.get(str));\n      }\n    }\n    if (AnnotationEditor._borderLineWidth !== -1) {\n      return;\n    }\n    const style = getComputedStyle(document.documentElement);\n    AnnotationEditor._borderLineWidth =\n      parseFloat(style.getPropertyValue(\"--outline-width\")) || 0;\n  }\n\n  /**\n   * Update the default parameters for this type of editor.\n   * @param {number} _type\n   * @param {*} _value\n   */\n  static updateDefaultParams(_type, _value) {}\n\n  /**\n   * Get the default properties to set in the UI for this type of editor.\n   * @returns {Array}\n   */\n  static get defaultPropertiesToUpdate() {\n    return [];\n  }\n\n  /**\n   * Check if this kind of editor is able to handle the given mime type for\n   * pasting.\n   * @param {string} mime\n   * @returns {boolean}\n   */\n  static isHandlingMimeForPasting(mime) {\n    return false;\n  }\n\n  /**\n   * Extract the data from the clipboard item and delegate the creation of the\n   * editor to the parent.\n   * @param {DataTransferItem} item\n   * @param {AnnotationEditorLayer} parent\n   */\n  static paste(item, parent) {\n    unreachable(\"Not implemented\");\n  }\n\n  /**\n   * Get the properties to update in the UI for this editor.\n   * @returns {Array}\n   */\n  get propertiesToUpdate() {\n    return [];\n  }\n\n  get _isDraggable() {\n    return this.#isDraggable;\n  }\n\n  set _isDraggable(value) {\n    this.#isDraggable = value;\n    this.div?.classList.toggle(\"draggable\", value);\n  }\n\n  /**\n   * @returns {boolean} true if the editor handles the Enter key itself.\n   */\n  get isEnterHandled() {\n    return true;\n  }\n\n  center() {\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    switch (this.parentRotation) {\n      case 90:\n        this.x -= (this.height * pageHeight) / (pageWidth * 2);\n        this.y += (this.width * pageWidth) / (pageHeight * 2);\n        break;\n      case 180:\n        this.x += this.width / 2;\n        this.y += this.height / 2;\n        break;\n      case 270:\n        this.x += (this.height * pageHeight) / (pageWidth * 2);\n        this.y -= (this.width * pageWidth) / (pageHeight * 2);\n        break;\n      default:\n        this.x -= this.width / 2;\n        this.y -= this.height / 2;\n        break;\n    }\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Add some commands into the CommandManager (undo/redo stuff).\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this._uiManager.addCommands(params);\n  }\n\n  get currentLayer() {\n    return this._uiManager.currentLayer;\n  }\n\n  /**\n   * This editor will be behind the others.\n   */\n  setInBackground() {\n    this.div.style.zIndex = 0;\n  }\n\n  /**\n   * This editor will be in the foreground.\n   */\n  setInForeground() {\n    this.div.style.zIndex = this.#zIndex;\n  }\n\n  setParent(parent) {\n    if (parent !== null) {\n      this.pageIndex = parent.pageIndex;\n      this.pageDimensions = parent.pageDimensions;\n    } else {\n      // The editor is being removed from the DOM, so we need to stop resizing.\n      this.#stopResizing();\n    }\n    this.parent = parent;\n  }\n\n  /**\n   * onfocus callback.\n   */\n  focusin(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n    if (!this.#hasBeenClicked) {\n      this.parent.setSelected(this);\n    } else {\n      this.#hasBeenClicked = false;\n    }\n  }\n\n  /**\n   * onblur callback.\n   * @param {FocusEvent} event\n   */\n  focusout(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n\n    if (!this.isAttachedToDOM) {\n      return;\n    }\n\n    // In case of focusout, the relatedTarget is the element which\n    // is grabbing the focus.\n    // So if the related target is an element under the div for this\n    // editor, then the editor isn't unactive.\n    const target = event.relatedTarget;\n    if (target?.closest(`#${this.id}`)) {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (!this.parent?.isMultipleSelection) {\n      this.commitOrRemove();\n    }\n  }\n\n  commitOrRemove() {\n    if (this.isEmpty()) {\n      this.remove();\n    } else {\n      this.commit();\n    }\n  }\n\n  /**\n   * Commit the data contained in this editor.\n   */\n  commit() {\n    this.addToAnnotationStorage();\n  }\n\n  addToAnnotationStorage() {\n    this._uiManager.addToAnnotationStorage(this);\n  }\n\n  /**\n   * Set the editor position within its parent.\n   * @param {number} x\n   * @param {number} y\n   * @param {number} tx - x-translation in screen coordinates.\n   * @param {number} ty - y-translation in screen coordinates.\n   */\n  setAt(x, y, tx, ty) {\n    const [width, height] = this.parentDimensions;\n    [tx, ty] = this.screenToPageTranslation(tx, ty);\n\n    this.x = (x + tx) / width;\n    this.y = (y + ty) / height;\n\n    this.fixAndSetPosition();\n  }\n\n  #translate([width, height], x, y) {\n    [x, y] = this.screenToPageTranslation(x, y);\n\n    this.x += x / width;\n    this.y += y / height;\n\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Translate the editor position within its parent.\n   * @param {number} x - x-translation in screen coordinates.\n   * @param {number} y - y-translation in screen coordinates.\n   */\n  translate(x, y) {\n    // We don't change the initial position because the move here hasn't been\n    // done by the user.\n    this.#translate(this.parentDimensions, x, y);\n  }\n\n  /**\n   * Translate the editor position within its page and adjust the scroll\n   * in order to have the editor in the view.\n   * @param {number} x - x-translation in page coordinates.\n   * @param {number} y - y-translation in page coordinates.\n   */\n  translateInPage(x, y) {\n    this.#initialPosition ||= [this.x, this.y];\n    this.#translate(this.pageDimensions, x, y);\n    this.div.scrollIntoView({ block: \"nearest\" });\n  }\n\n  drag(tx, ty) {\n    this.#initialPosition ||= [this.x, this.y];\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.x += tx / parentWidth;\n    this.y += ty / parentHeight;\n    if (this.parent && (this.x < 0 || this.x > 1 || this.y < 0 || this.y > 1)) {\n      // It's possible to not have a parent: for example, when the user is\n      // dragging all the selected editors but this one on a page which has been\n      // destroyed.\n      // It's why we need to check for it. In such a situation, it isn't really\n      // a problem to not find a new parent: it's something which is related to\n      // what the user is seeing, hence it depends on how pages are layed out.\n\n      // The element will be outside of its parent so change the parent.\n      const { x, y } = this.div.getBoundingClientRect();\n      if (this.parent.findNewParent(this, x, y)) {\n        this.x -= Math.floor(this.x);\n        this.y -= Math.floor(this.y);\n      }\n    }\n\n    // The editor can be moved wherever the user wants, so we don't need to fix\n    // the position: it'll be done when the user will release the mouse button.\n\n    let { x, y } = this;\n    const [bx, by] = this.getBaseTranslation();\n    x += bx;\n    y += by;\n\n    this.div.style.left = `${(100 * x).toFixed(2)}%`;\n    this.div.style.top = `${(100 * y).toFixed(2)}%`;\n    this.div.scrollIntoView({ block: \"nearest\" });\n  }\n\n  get _hasBeenMoved() {\n    return (\n      !!this.#initialPosition &&\n      (this.#initialPosition[0] !== this.x ||\n        this.#initialPosition[1] !== this.y)\n    );\n  }\n\n  /**\n   * Get the translation to take into account the editor border.\n   * The CSS engine positions the element by taking the border into account so\n   * we must apply the opposite translation to have the editor in the right\n   * position.\n   * @returns {Array<number>}\n   */\n  getBaseTranslation() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const { _borderLineWidth } = AnnotationEditor;\n    const x = _borderLineWidth / parentWidth;\n    const y = _borderLineWidth / parentHeight;\n    switch (this.rotation) {\n      case 90:\n        return [-x, y];\n      case 180:\n        return [x, y];\n      case 270:\n        return [x, -y];\n      default:\n        return [-x, -y];\n    }\n  }\n\n  /**\n   * @returns {boolean} true if position must be fixed (i.e. make the x and y\n   * living in the page).\n   */\n  get _mustFixPosition() {\n    return true;\n  }\n\n  /**\n   * Fix the position of the editor in order to keep it inside its parent page.\n   * @param {number} [rotation] - the rotation of the page.\n   */\n  fixAndSetPosition(rotation = this.rotation) {\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    let { x, y, width, height } = this;\n    width *= pageWidth;\n    height *= pageHeight;\n    x *= pageWidth;\n    y *= pageHeight;\n\n    if (this._mustFixPosition) {\n      switch (rotation) {\n        case 0:\n          x = Math.max(0, Math.min(pageWidth - width, x));\n          y = Math.max(0, Math.min(pageHeight - height, y));\n          break;\n        case 90:\n          x = Math.max(0, Math.min(pageWidth - height, x));\n          y = Math.min(pageHeight, Math.max(width, y));\n          break;\n        case 180:\n          x = Math.min(pageWidth, Math.max(width, x));\n          y = Math.min(pageHeight, Math.max(height, y));\n          break;\n        case 270:\n          x = Math.min(pageWidth, Math.max(height, x));\n          y = Math.max(0, Math.min(pageHeight - width, y));\n          break;\n      }\n    }\n\n    this.x = x /= pageWidth;\n    this.y = y /= pageHeight;\n\n    const [bx, by] = this.getBaseTranslation();\n    x += bx;\n    y += by;\n\n    const { style } = this.div;\n    style.left = `${(100 * x).toFixed(2)}%`;\n    style.top = `${(100 * y).toFixed(2)}%`;\n\n    this.moveInDOM();\n  }\n\n  static #rotatePoint(x, y, angle) {\n    switch (angle) {\n      case 90:\n        return [y, -x];\n      case 180:\n        return [-x, -y];\n      case 270:\n        return [-y, x];\n      default:\n        return [x, y];\n    }\n  }\n\n  /**\n   * Convert a screen translation into a page one.\n   * @param {number} x\n   * @param {number} y\n   */\n  screenToPageTranslation(x, y) {\n    return AnnotationEditor.#rotatePoint(x, y, this.parentRotation);\n  }\n\n  /**\n   * Convert a page translation into a screen one.\n   * @param {number} x\n   * @param {number} y\n   */\n  pageTranslationToScreen(x, y) {\n    return AnnotationEditor.#rotatePoint(x, y, 360 - this.parentRotation);\n  }\n\n  #getRotationMatrix(rotation) {\n    switch (rotation) {\n      case 90: {\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        return [0, -pageWidth / pageHeight, pageHeight / pageWidth, 0];\n      }\n      case 180:\n        return [-1, 0, 0, -1];\n      case 270: {\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        return [0, pageWidth / pageHeight, -pageHeight / pageWidth, 0];\n      }\n      default:\n        return [1, 0, 0, 1];\n    }\n  }\n\n  get parentScale() {\n    return this._uiManager.viewParameters.realScale;\n  }\n\n  get parentRotation() {\n    return (this._uiManager.viewParameters.rotation + this.pageRotation) % 360;\n  }\n\n  get parentDimensions() {\n    const {\n      parentScale,\n      pageDimensions: [pageWidth, pageHeight],\n    } = this;\n    const scaledWidth = pageWidth * parentScale;\n    const scaledHeight = pageHeight * parentScale;\n    return FeatureTest.isCSSRoundSupported\n      ? [Math.round(scaledWidth), Math.round(scaledHeight)]\n      : [scaledWidth, scaledHeight];\n  }\n\n  /**\n   * Set the dimensions of this editor.\n   * @param {number} width\n   * @param {number} height\n   */\n  setDims(width, height) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.div.style.width = `${((100 * width) / parentWidth).toFixed(2)}%`;\n    if (!this.#keepAspectRatio) {\n      this.div.style.height = `${((100 * height) / parentHeight).toFixed(2)}%`;\n    }\n  }\n\n  fixDims() {\n    const { style } = this.div;\n    const { height, width } = style;\n    const widthPercent = width.endsWith(\"%\");\n    const heightPercent = !this.#keepAspectRatio && height.endsWith(\"%\");\n    if (widthPercent && heightPercent) {\n      return;\n    }\n\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    if (!widthPercent) {\n      style.width = `${((100 * parseFloat(width)) / parentWidth).toFixed(2)}%`;\n    }\n    if (!this.#keepAspectRatio && !heightPercent) {\n      style.height = `${((100 * parseFloat(height)) / parentHeight).toFixed(\n        2\n      )}%`;\n    }\n  }\n\n  /**\n   * Get the translation used to position this editor when it's created.\n   * @returns {Array<number>}\n   */\n  getInitialTranslation() {\n    return [0, 0];\n  }\n\n  #createResizers() {\n    if (this.#resizersDiv) {\n      return;\n    }\n    this.#resizersDiv = document.createElement(\"div\");\n    this.#resizersDiv.classList.add(\"resizers\");\n    // When the resizers are used with the keyboard, they're focusable, hence\n    // we want to have them in this order (top left, top middle, top right, ...)\n    // in the DOM to have the focus order correct.\n    const classes = this._willKeepAspectRatio\n      ? [\"topLeft\", \"topRight\", \"bottomRight\", \"bottomLeft\"]\n      : [\n          \"topLeft\",\n          \"topMiddle\",\n          \"topRight\",\n          \"middleRight\",\n          \"bottomRight\",\n          \"bottomMiddle\",\n          \"bottomLeft\",\n          \"middleLeft\",\n        ];\n    const signal = this._uiManager._signal;\n    for (const name of classes) {\n      const div = document.createElement(\"div\");\n      this.#resizersDiv.append(div);\n      div.classList.add(\"resizer\", name);\n      div.setAttribute(\"data-resizer-name\", name);\n      div.addEventListener(\n        \"pointerdown\",\n        this.#resizerPointerdown.bind(this, name),\n        { signal }\n      );\n      div.addEventListener(\"contextmenu\", noContextMenu, { signal });\n      div.tabIndex = -1;\n    }\n    this.div.prepend(this.#resizersDiv);\n  }\n\n  #resizerPointerdown(name, event) {\n    event.preventDefault();\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      return;\n    }\n\n    this.#altText?.toggle(false);\n\n    const boundResizerPointermove = this.#resizerPointermove.bind(this, name);\n    const savedDraggable = this._isDraggable;\n    this._isDraggable = false;\n    const signal = this._uiManager._signal;\n    const pointerMoveOptions = { passive: true, capture: true, signal };\n    this.parent.togglePointerEvents(false);\n    window.addEventListener(\n      \"pointermove\",\n      boundResizerPointermove,\n      pointerMoveOptions\n    );\n    window.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    const savedX = this.x;\n    const savedY = this.y;\n    const savedWidth = this.width;\n    const savedHeight = this.height;\n    const savedParentCursor = this.parent.div.style.cursor;\n    const savedCursor = this.div.style.cursor;\n    this.div.style.cursor = this.parent.div.style.cursor =\n      window.getComputedStyle(event.target).cursor;\n\n    const pointerUpCallback = () => {\n      this.parent.togglePointerEvents(true);\n      this.#altText?.toggle(true);\n      this._isDraggable = savedDraggable;\n      window.removeEventListener(\"pointerup\", pointerUpCallback);\n      window.removeEventListener(\"blur\", pointerUpCallback);\n      window.removeEventListener(\n        \"pointermove\",\n        boundResizerPointermove,\n        pointerMoveOptions\n      );\n      window.removeEventListener(\"contextmenu\", noContextMenu);\n      this.parent.div.style.cursor = savedParentCursor;\n      this.div.style.cursor = savedCursor;\n\n      this.#addResizeToUndoStack(savedX, savedY, savedWidth, savedHeight);\n    };\n    window.addEventListener(\"pointerup\", pointerUpCallback, { signal });\n    // If the user switches to another window (with alt+tab), then we end the\n    // resize session.\n    window.addEventListener(\"blur\", pointerUpCallback, { signal });\n  }\n\n  #addResizeToUndoStack(savedX, savedY, savedWidth, savedHeight) {\n    const newX = this.x;\n    const newY = this.y;\n    const newWidth = this.width;\n    const newHeight = this.height;\n    if (\n      newX === savedX &&\n      newY === savedY &&\n      newWidth === savedWidth &&\n      newHeight === savedHeight\n    ) {\n      return;\n    }\n\n    this.addCommands({\n      cmd: () => {\n        this.width = newWidth;\n        this.height = newHeight;\n        this.x = newX;\n        this.y = newY;\n        const [parentWidth, parentHeight] = this.parentDimensions;\n        this.setDims(parentWidth * newWidth, parentHeight * newHeight);\n        this.fixAndSetPosition();\n      },\n      undo: () => {\n        this.width = savedWidth;\n        this.height = savedHeight;\n        this.x = savedX;\n        this.y = savedY;\n        const [parentWidth, parentHeight] = this.parentDimensions;\n        this.setDims(parentWidth * savedWidth, parentHeight * savedHeight);\n        this.fixAndSetPosition();\n      },\n      mustExec: true,\n    });\n  }\n\n  #resizerPointermove(name, event) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const savedX = this.x;\n    const savedY = this.y;\n    const savedWidth = this.width;\n    const savedHeight = this.height;\n    const minWidth = AnnotationEditor.MIN_SIZE / parentWidth;\n    const minHeight = AnnotationEditor.MIN_SIZE / parentHeight;\n\n    // 10000 because we multiply by 100 and use toFixed(2) in fixAndSetPosition.\n    // Without rounding, the positions of the corners other than the top left\n    // one can be slightly wrong.\n    const round = x => Math.round(x * 10000) / 10000;\n    const rotationMatrix = this.#getRotationMatrix(this.rotation);\n    const transf = (x, y) => [\n      rotationMatrix[0] * x + rotationMatrix[2] * y,\n      rotationMatrix[1] * x + rotationMatrix[3] * y,\n    ];\n    const invRotationMatrix = this.#getRotationMatrix(360 - this.rotation);\n    const invTransf = (x, y) => [\n      invRotationMatrix[0] * x + invRotationMatrix[2] * y,\n      invRotationMatrix[1] * x + invRotationMatrix[3] * y,\n    ];\n    let getPoint;\n    let getOpposite;\n    let isDiagonal = false;\n    let isHorizontal = false;\n\n    switch (name) {\n      case \"topLeft\":\n        isDiagonal = true;\n        getPoint = (w, h) => [0, 0];\n        getOpposite = (w, h) => [w, h];\n        break;\n      case \"topMiddle\":\n        getPoint = (w, h) => [w / 2, 0];\n        getOpposite = (w, h) => [w / 2, h];\n        break;\n      case \"topRight\":\n        isDiagonal = true;\n        getPoint = (w, h) => [w, 0];\n        getOpposite = (w, h) => [0, h];\n        break;\n      case \"middleRight\":\n        isHorizontal = true;\n        getPoint = (w, h) => [w, h / 2];\n        getOpposite = (w, h) => [0, h / 2];\n        break;\n      case \"bottomRight\":\n        isDiagonal = true;\n        getPoint = (w, h) => [w, h];\n        getOpposite = (w, h) => [0, 0];\n        break;\n      case \"bottomMiddle\":\n        getPoint = (w, h) => [w / 2, h];\n        getOpposite = (w, h) => [w / 2, 0];\n        break;\n      case \"bottomLeft\":\n        isDiagonal = true;\n        getPoint = (w, h) => [0, h];\n        getOpposite = (w, h) => [w, 0];\n        break;\n      case \"middleLeft\":\n        isHorizontal = true;\n        getPoint = (w, h) => [0, h / 2];\n        getOpposite = (w, h) => [w, h / 2];\n        break;\n    }\n\n    const point = getPoint(savedWidth, savedHeight);\n    const oppositePoint = getOpposite(savedWidth, savedHeight);\n    let transfOppositePoint = transf(...oppositePoint);\n    const oppositeX = round(savedX + transfOppositePoint[0]);\n    const oppositeY = round(savedY + transfOppositePoint[1]);\n    let ratioX = 1;\n    let ratioY = 1;\n\n    let [deltaX, deltaY] = this.screenToPageTranslation(\n      event.movementX,\n      event.movementY\n    );\n    [deltaX, deltaY] = invTransf(deltaX / parentWidth, deltaY / parentHeight);\n\n    if (isDiagonal) {\n      const oldDiag = Math.hypot(savedWidth, savedHeight);\n      ratioX = ratioY = Math.max(\n        Math.min(\n          Math.hypot(\n            oppositePoint[0] - point[0] - deltaX,\n            oppositePoint[1] - point[1] - deltaY\n          ) / oldDiag,\n          // Avoid the editor to be larger than the page.\n          1 / savedWidth,\n          1 / savedHeight\n        ),\n        // Avoid the editor to be smaller than the minimum size.\n        minWidth / savedWidth,\n        minHeight / savedHeight\n      );\n    } else if (isHorizontal) {\n      ratioX =\n        Math.max(\n          minWidth,\n          Math.min(1, Math.abs(oppositePoint[0] - point[0] - deltaX))\n        ) / savedWidth;\n    } else {\n      ratioY =\n        Math.max(\n          minHeight,\n          Math.min(1, Math.abs(oppositePoint[1] - point[1] - deltaY))\n        ) / savedHeight;\n    }\n\n    const newWidth = round(savedWidth * ratioX);\n    const newHeight = round(savedHeight * ratioY);\n    transfOppositePoint = transf(...getOpposite(newWidth, newHeight));\n    const newX = oppositeX - transfOppositePoint[0];\n    const newY = oppositeY - transfOppositePoint[1];\n\n    this.width = newWidth;\n    this.height = newHeight;\n    this.x = newX;\n    this.y = newY;\n\n    this.setDims(parentWidth * newWidth, parentHeight * newHeight);\n    this.fixAndSetPosition();\n  }\n\n  altTextFinish() {\n    this.#altText?.finish();\n  }\n\n  /**\n   * Add a toolbar for this editor.\n   * @returns {Promise<EditorToolbar|null>}\n   */\n  async addEditToolbar() {\n    if (this.#editToolbar || this.#isInEditMode) {\n      return this.#editToolbar;\n    }\n    this.#editToolbar = new EditorToolbar(this);\n    this.div.append(this.#editToolbar.render());\n    if (this.#altText) {\n      this.#editToolbar.addAltTextButton(await this.#altText.render());\n    }\n\n    return this.#editToolbar;\n  }\n\n  removeEditToolbar() {\n    if (!this.#editToolbar) {\n      return;\n    }\n    this.#editToolbar.remove();\n    this.#editToolbar = null;\n\n    // We destroy the alt text but we don't null it because we want to be able\n    // to restore it in case the user undoes the deletion.\n    this.#altText?.destroy();\n  }\n\n  getClientDimensions() {\n    return this.div.getBoundingClientRect();\n  }\n\n  async addAltTextButton() {\n    if (this.#altText) {\n      return;\n    }\n    AltText.initialize(AnnotationEditor._l10nPromise);\n    this.#altText = new AltText(this);\n    if (this.#accessibilityData) {\n      this.#altText.data = this.#accessibilityData;\n      this.#accessibilityData = null;\n    }\n    await this.addEditToolbar();\n  }\n\n  get altTextData() {\n    return this.#altText?.data;\n  }\n\n  /**\n   * Set the alt text data.\n   */\n  set altTextData(data) {\n    if (!this.#altText) {\n      return;\n    }\n    this.#altText.data = data;\n  }\n\n  hasAltText() {\n    return !this.#altText?.isEmpty();\n  }\n\n  /**\n   * Render this editor in a div.\n   * @returns {HTMLDivElement | null}\n   */\n  render() {\n    this.div = document.createElement(\"div\");\n    this.div.setAttribute(\"data-editor-rotation\", (360 - this.rotation) % 360);\n    this.div.className = this.name;\n    this.div.setAttribute(\"id\", this.id);\n    this.div.tabIndex = this.#disabled ? -1 : 0;\n    if (!this._isVisible) {\n      this.div.classList.add(\"hidden\");\n    }\n\n    this.setInForeground();\n\n    const signal = this._uiManager._signal;\n    this.div.addEventListener(\"focusin\", this.#boundFocusin, { signal });\n    this.div.addEventListener(\"focusout\", this.#boundFocusout, { signal });\n\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    if (this.parentRotation % 180 !== 0) {\n      this.div.style.maxWidth = `${((100 * parentHeight) / parentWidth).toFixed(\n        2\n      )}%`;\n      this.div.style.maxHeight = `${(\n        (100 * parentWidth) /\n        parentHeight\n      ).toFixed(2)}%`;\n    }\n\n    const [tx, ty] = this.getInitialTranslation();\n    this.translate(tx, ty);\n\n    bindEvents(this, this.div, [\"pointerdown\"]);\n\n    return this.div;\n  }\n\n  /**\n   * Onpointerdown callback.\n   * @param {PointerEvent} event\n   */\n  pointerdown(event) {\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Avoid to focus this editor because of a non-left click.\n      event.preventDefault();\n      return;\n    }\n\n    this.#hasBeenClicked = true;\n\n    if (this._isDraggable) {\n      this.#setUpDragSession(event);\n      return;\n    }\n\n    this.#selectOnPointerEvent(event);\n  }\n\n  #selectOnPointerEvent(event) {\n    const { isMac } = FeatureTest.platform;\n    if (\n      (event.ctrlKey && !isMac) ||\n      event.shiftKey ||\n      (event.metaKey && isMac)\n    ) {\n      this.parent.toggleSelected(this);\n    } else {\n      this.parent.setSelected(this);\n    }\n  }\n\n  #setUpDragSession(event) {\n    const isSelected = this._uiManager.isSelected(this);\n    this._uiManager.setUpDragSession();\n\n    let pointerMoveOptions, pointerMoveCallback;\n    const signal = this._uiManager._signal;\n    if (isSelected) {\n      this.div.classList.add(\"moving\");\n      pointerMoveOptions = { passive: true, capture: true, signal };\n      this.#prevDragX = event.clientX;\n      this.#prevDragY = event.clientY;\n      pointerMoveCallback = e => {\n        const { clientX: x, clientY: y } = e;\n        const [tx, ty] = this.screenToPageTranslation(\n          x - this.#prevDragX,\n          y - this.#prevDragY\n        );\n        this.#prevDragX = x;\n        this.#prevDragY = y;\n        this._uiManager.dragSelectedEditors(tx, ty);\n      };\n      window.addEventListener(\n        \"pointermove\",\n        pointerMoveCallback,\n        pointerMoveOptions\n      );\n    }\n\n    const pointerUpCallback = () => {\n      window.removeEventListener(\"pointerup\", pointerUpCallback);\n      window.removeEventListener(\"blur\", pointerUpCallback);\n      if (isSelected) {\n        this.div.classList.remove(\"moving\");\n        window.removeEventListener(\n          \"pointermove\",\n          pointerMoveCallback,\n          pointerMoveOptions\n        );\n      }\n\n      this.#hasBeenClicked = false;\n      if (!this._uiManager.endDragSession()) {\n        this.#selectOnPointerEvent(event);\n      }\n    };\n    window.addEventListener(\"pointerup\", pointerUpCallback, { signal });\n    // If the user is using alt+tab during the dragging session, the pointerup\n    // event could be not fired, but a blur event is fired so we can use it in\n    // order to interrupt the dragging session.\n    window.addEventListener(\"blur\", pointerUpCallback, { signal });\n  }\n\n  moveInDOM() {\n    // Moving the editor in the DOM can be expensive, so we wait a bit before.\n    // It's important to not block the UI (for example when changing the font\n    // size in a FreeText).\n    if (this.#moveInDOMTimeout) {\n      clearTimeout(this.#moveInDOMTimeout);\n    }\n    this.#moveInDOMTimeout = setTimeout(() => {\n      this.#moveInDOMTimeout = null;\n      this.parent?.moveEditorInDOM(this);\n    }, 0);\n  }\n\n  _setParentAndPosition(parent, x, y) {\n    parent.changeParent(this);\n    this.x = x;\n    this.y = y;\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Convert the current rect into a page one.\n   * @param {number} tx - x-translation in screen coordinates.\n   * @param {number} ty - y-translation in screen coordinates.\n   * @param {number} [rotation] - the rotation of the page.\n   */\n  getRect(tx, ty, rotation = this.rotation) {\n    const scale = this.parentScale;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const [pageX, pageY] = this.pageTranslation;\n    const shiftX = tx / scale;\n    const shiftY = ty / scale;\n    const x = this.x * pageWidth;\n    const y = this.y * pageHeight;\n    const width = this.width * pageWidth;\n    const height = this.height * pageHeight;\n\n    switch (rotation) {\n      case 0:\n        return [\n          x + shiftX + pageX,\n          pageHeight - y - shiftY - height + pageY,\n          x + shiftX + width + pageX,\n          pageHeight - y - shiftY + pageY,\n        ];\n      case 90:\n        return [\n          x + shiftY + pageX,\n          pageHeight - y + shiftX + pageY,\n          x + shiftY + height + pageX,\n          pageHeight - y + shiftX + width + pageY,\n        ];\n      case 180:\n        return [\n          x - shiftX - width + pageX,\n          pageHeight - y + shiftY + pageY,\n          x - shiftX + pageX,\n          pageHeight - y + shiftY + height + pageY,\n        ];\n      case 270:\n        return [\n          x - shiftY - height + pageX,\n          pageHeight - y - shiftX - width + pageY,\n          x - shiftY + pageX,\n          pageHeight - y - shiftX + pageY,\n        ];\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n  }\n\n  getRectInCurrentCoords(rect, pageHeight) {\n    const [x1, y1, x2, y2] = rect;\n\n    const width = x2 - x1;\n    const height = y2 - y1;\n\n    switch (this.rotation) {\n      case 0:\n        return [x1, pageHeight - y2, width, height];\n      case 90:\n        return [x1, pageHeight - y1, height, width];\n      case 180:\n        return [x2, pageHeight - y1, width, height];\n      case 270:\n        return [x2, pageHeight - y2, height, width];\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n  }\n\n  /**\n   * Executed once this editor has been rendered.\n   */\n  onceAdded() {}\n\n  /**\n   * Check if the editor contains something.\n   * @returns {boolean}\n   */\n  isEmpty() {\n    return false;\n  }\n\n  /**\n   * Enable edit mode.\n   */\n  enableEditMode() {\n    this.#isInEditMode = true;\n  }\n\n  /**\n   * Disable edit mode.\n   */\n  disableEditMode() {\n    this.#isInEditMode = false;\n  }\n\n  /**\n   * Check if the editor is edited.\n   * @returns {boolean}\n   */\n  isInEditMode() {\n    return this.#isInEditMode;\n  }\n\n  /**\n   * If it returns true, then this editor handles the keyboard\n   * events itself.\n   * @returns {boolean}\n   */\n  shouldGetKeyboardEvents() {\n    return this.#isResizerEnabledForKeyboard;\n  }\n\n  /**\n   * Check if this editor needs to be rebuilt or not.\n   * @returns {boolean}\n   */\n  needsToBeRebuilt() {\n    return this.div && !this.isAttachedToDOM;\n  }\n\n  /**\n   * Rebuild the editor in case it has been removed on undo.\n   *\n   * To implement in subclasses.\n   */\n  rebuild() {\n    const signal = this._uiManager._signal;\n    this.div?.addEventListener(\"focusin\", this.#boundFocusin, { signal });\n    this.div?.addEventListener(\"focusout\", this.#boundFocusout, { signal });\n  }\n\n  /**\n   * Rotate the editor.\n   * @param {number} angle\n   */\n  rotate(_angle) {}\n\n  /**\n   * Serialize the editor.\n   * The result of the serialization will be used to construct a\n   * new annotation to add to the pdf document.\n   *\n   * To implement in subclasses.\n   * @param {boolean} [isForCopying]\n   * @param {Object | null} [context]\n   * @returns {Object | null}\n   */\n  serialize(isForCopying = false, context = null) {\n    unreachable(\"An editor must be serializable\");\n  }\n\n  /**\n   * Deserialize the editor.\n   * The result of the deserialization is a new editor.\n   *\n   * @param {Object} data\n   * @param {AnnotationEditorLayer} parent\n   * @param {AnnotationEditorUIManager} uiManager\n   * @returns {AnnotationEditor | null}\n   */\n  static deserialize(data, parent, uiManager) {\n    const editor = new this.prototype.constructor({\n      parent,\n      id: parent.getNextId(),\n      uiManager,\n    });\n    editor.rotation = data.rotation;\n    editor.#accessibilityData = data.accessibilityData;\n\n    const [pageWidth, pageHeight] = editor.pageDimensions;\n    const [x, y, width, height] = editor.getRectInCurrentCoords(\n      data.rect,\n      pageHeight\n    );\n    editor.x = x / pageWidth;\n    editor.y = y / pageHeight;\n    editor.width = width / pageWidth;\n    editor.height = height / pageHeight;\n\n    return editor;\n  }\n\n  /**\n   * Check if an existing annotation associated with this editor has been\n   * modified.\n   * @returns {boolean}\n   */\n  get hasBeenModified() {\n    return (\n      !!this.annotationElementId && (this.deleted || this.serialize() !== null)\n    );\n  }\n\n  /**\n   * Remove this editor.\n   * It's used on ctrl+backspace action.\n   */\n  remove() {\n    this.div.removeEventListener(\"focusin\", this.#boundFocusin);\n    this.div.removeEventListener(\"focusout\", this.#boundFocusout);\n\n    if (!this.isEmpty()) {\n      // The editor is removed but it can be back at some point thanks to\n      // undo/redo so we must commit it before.\n      this.commit();\n    }\n    if (this.parent) {\n      this.parent.remove(this);\n    } else {\n      this._uiManager.removeEditor(this);\n    }\n\n    if (this.#moveInDOMTimeout) {\n      clearTimeout(this.#moveInDOMTimeout);\n      this.#moveInDOMTimeout = null;\n    }\n    this.#stopResizing();\n    this.removeEditToolbar();\n    if (this.#telemetryTimeouts) {\n      for (const timeout of this.#telemetryTimeouts.values()) {\n        clearTimeout(timeout);\n      }\n      this.#telemetryTimeouts = null;\n    }\n    this.parent = null;\n  }\n\n  /**\n   * @returns {boolean} true if this editor can be resized.\n   */\n  get isResizable() {\n    return false;\n  }\n\n  /**\n   * Add the resizers to this editor.\n   */\n  makeResizable() {\n    if (this.isResizable) {\n      this.#createResizers();\n      this.#resizersDiv.classList.remove(\"hidden\");\n      bindEvents(this, this.div, [\"keydown\"]);\n    }\n  }\n\n  get toolbarPosition() {\n    return null;\n  }\n\n  /**\n   * onkeydown callback.\n   * @param {KeyboardEvent} event\n   */\n  keydown(event) {\n    if (\n      !this.isResizable ||\n      event.target !== this.div ||\n      event.key !== \"Enter\"\n    ) {\n      return;\n    }\n    this._uiManager.setSelected(this);\n    this.#savedDimensions = {\n      savedX: this.x,\n      savedY: this.y,\n      savedWidth: this.width,\n      savedHeight: this.height,\n    };\n    const children = this.#resizersDiv.children;\n    if (!this.#allResizerDivs) {\n      this.#allResizerDivs = Array.from(children);\n      const boundResizerKeydown = this.#resizerKeydown.bind(this);\n      const boundResizerBlur = this.#resizerBlur.bind(this);\n      const signal = this._uiManager._signal;\n      for (const div of this.#allResizerDivs) {\n        const name = div.getAttribute(\"data-resizer-name\");\n        div.setAttribute(\"role\", \"spinbutton\");\n        div.addEventListener(\"keydown\", boundResizerKeydown, { signal });\n        div.addEventListener(\"blur\", boundResizerBlur, { signal });\n        div.addEventListener(\"focus\", this.#resizerFocus.bind(this, name), {\n          signal,\n        });\n        AnnotationEditor._l10nPromise\n          .get(`pdfjs-editor-resizer-label-${name}`)\n          .then(msg => div.setAttribute(\"aria-label\", msg));\n      }\n    }\n\n    // We want to have the resizers in the visual order, so we move the first\n    // (top-left) to the right place.\n    const first = this.#allResizerDivs[0];\n    let firstPosition = 0;\n    for (const div of children) {\n      if (div === first) {\n        break;\n      }\n      firstPosition++;\n    }\n    const nextFirstPosition =\n      (((360 - this.rotation + this.parentRotation) % 360) / 90) *\n      (this.#allResizerDivs.length / 4);\n\n    if (nextFirstPosition !== firstPosition) {\n      // We need to reorder the resizers in the DOM in order to have the focus\n      // on the top-left one.\n      if (nextFirstPosition < firstPosition) {\n        for (let i = 0; i < firstPosition - nextFirstPosition; i++) {\n          this.#resizersDiv.append(this.#resizersDiv.firstChild);\n        }\n      } else if (nextFirstPosition > firstPosition) {\n        for (let i = 0; i < nextFirstPosition - firstPosition; i++) {\n          this.#resizersDiv.firstChild.before(this.#resizersDiv.lastChild);\n        }\n      }\n\n      let i = 0;\n      for (const child of children) {\n        const div = this.#allResizerDivs[i++];\n        const name = div.getAttribute(\"data-resizer-name\");\n        AnnotationEditor._l10nPromise\n          .get(`pdfjs-editor-resizer-label-${name}`)\n          .then(msg => child.setAttribute(\"aria-label\", msg));\n      }\n    }\n\n    this.#setResizerTabIndex(0);\n    this.#isResizerEnabledForKeyboard = true;\n    this.#resizersDiv.firstChild.focus({ focusVisible: true });\n    event.preventDefault();\n    event.stopImmediatePropagation();\n  }\n\n  #resizerKeydown(event) {\n    AnnotationEditor._resizerKeyboardManager.exec(this, event);\n  }\n\n  #resizerBlur(event) {\n    if (\n      this.#isResizerEnabledForKeyboard &&\n      event.relatedTarget?.parentNode !== this.#resizersDiv\n    ) {\n      this.#stopResizing();\n    }\n  }\n\n  #resizerFocus(name) {\n    this.#focusedResizerName = this.#isResizerEnabledForKeyboard ? name : \"\";\n  }\n\n  #setResizerTabIndex(value) {\n    if (!this.#allResizerDivs) {\n      return;\n    }\n    for (const div of this.#allResizerDivs) {\n      div.tabIndex = value;\n    }\n  }\n\n  _resizeWithKeyboard(x, y) {\n    if (!this.#isResizerEnabledForKeyboard) {\n      return;\n    }\n    this.#resizerPointermove(this.#focusedResizerName, {\n      movementX: x,\n      movementY: y,\n    });\n  }\n\n  #stopResizing() {\n    this.#isResizerEnabledForKeyboard = false;\n    this.#setResizerTabIndex(-1);\n    if (this.#savedDimensions) {\n      const { savedX, savedY, savedWidth, savedHeight } = this.#savedDimensions;\n      this.#addResizeToUndoStack(savedX, savedY, savedWidth, savedHeight);\n      this.#savedDimensions = null;\n    }\n  }\n\n  _stopResizingWithKeyboard() {\n    this.#stopResizing();\n    this.div.focus();\n  }\n\n  /**\n   * Select this editor.\n   */\n  select() {\n    this.makeResizable();\n    this.div?.classList.add(\"selectedEditor\");\n    if (!this.#editToolbar) {\n      this.addEditToolbar().then(() => {\n        if (this.div?.classList.contains(\"selectedEditor\")) {\n          // The editor can have been unselected while we were waiting for the\n          // edit toolbar to be created, hence we want to be sure that this\n          // editor is still selected.\n          this.#editToolbar?.show();\n        }\n      });\n      return;\n    }\n    this.#editToolbar?.show();\n  }\n\n  /**\n   * Unselect this editor.\n   */\n  unselect() {\n    this.#resizersDiv?.classList.add(\"hidden\");\n    this.div?.classList.remove(\"selectedEditor\");\n    if (this.div?.contains(document.activeElement)) {\n      // Don't use this.div.blur() because we don't know where the focus will\n      // go.\n      this._uiManager.currentLayer.div.focus({\n        preventScroll: true,\n      });\n    }\n    this.#editToolbar?.hide();\n  }\n\n  /**\n   * Update some parameters which have been changed through the UI.\n   * @param {number} type\n   * @param {*} value\n   */\n  updateParams(type, value) {}\n\n  /**\n   * When the user disables the editing mode some editors can change some of\n   * their properties.\n   */\n  disableEditing() {}\n\n  /**\n   * When the user enables the editing mode some editors can change some of\n   * their properties.\n   */\n  enableEditing() {}\n\n  /**\n   * The editor is about to be edited.\n   */\n  enterInEditMode() {}\n\n  /**\n   * @returns {HTMLElement | null} the element requiring an alt text.\n   */\n  getImageForAltText() {\n    return null;\n  }\n\n  /**\n   * Get the div which really contains the displayed content.\n   * @returns {HTMLDivElement | undefined}\n   */\n  get contentDiv() {\n    return this.div;\n  }\n\n  /**\n   * If true then the editor is currently edited.\n   * @type {boolean}\n   */\n  get isEditing() {\n    return this.#isEditing;\n  }\n\n  /**\n   * When set to true, it means that this editor is currently edited.\n   * @param {boolean} value\n   */\n  set isEditing(value) {\n    this.#isEditing = value;\n    if (!this.parent) {\n      return;\n    }\n    if (value) {\n      this.parent.setSelected(this);\n      this.parent.setActiveEditor(this);\n    } else {\n      this.parent.setActiveEditor(null);\n    }\n  }\n\n  /**\n   * Set the aspect ratio to use when resizing.\n   * @param {number} width\n   * @param {number} height\n   */\n  setAspectRatio(width, height) {\n    this.#keepAspectRatio = true;\n    const aspectRatio = width / height;\n    const { style } = this.div;\n    style.aspectRatio = aspectRatio;\n    style.height = \"auto\";\n  }\n\n  static get MIN_SIZE() {\n    return 16;\n  }\n\n  static canCreateNewEmptyEditor() {\n    return true;\n  }\n\n  /**\n   * Get the data to report to the telemetry when the editor is added.\n   * @returns {Object}\n   */\n  get telemetryInitialData() {\n    return { action: \"added\" };\n  }\n\n  /**\n   * The telemetry data to use when saving/printing.\n   * @returns {Object|null}\n   */\n  get telemetryFinalData() {\n    return null;\n  }\n\n  _reportTelemetry(data, mustWait = false) {\n    if (mustWait) {\n      this.#telemetryTimeouts ||= new Map();\n      const { action } = data;\n      let timeout = this.#telemetryTimeouts.get(action);\n      if (timeout) {\n        clearTimeout(timeout);\n      }\n      timeout = setTimeout(() => {\n        this._reportTelemetry(data);\n        this.#telemetryTimeouts.delete(action);\n        if (this.#telemetryTimeouts.size === 0) {\n          this.#telemetryTimeouts = null;\n        }\n      }, AnnotationEditor._telemetryTimeout);\n      this.#telemetryTimeouts.set(action, timeout);\n      return;\n    }\n    data.type ||= this.editorType;\n    this._uiManager._eventBus.dispatch(\"reporttelemetry\", {\n      source: this,\n      details: {\n        type: \"editing\",\n        data,\n      },\n    });\n  }\n\n  /**\n   * Show or hide this editor.\n   * @param {boolean|undefined} visible\n   */\n  show(visible = this._isVisible) {\n    this.div.classList.toggle(\"hidden\", !visible);\n    this._isVisible = visible;\n  }\n\n  enable() {\n    if (this.div) {\n      this.div.tabIndex = 0;\n    }\n    this.#disabled = false;\n  }\n\n  disable() {\n    if (this.div) {\n      this.div.tabIndex = -1;\n    }\n    this.#disabled = true;\n  }\n\n  /**\n   * Render an annotation in the annotation layer.\n   * @param {Object} annotation\n   * @returns {HTMLElement}\n   */\n  renderAnnotationElement(annotation) {\n    let content = annotation.container.querySelector(\".annotationContent\");\n    if (!content) {\n      content = document.createElement(\"div\");\n      content.classList.add(\"annotationContent\", this.editorType);\n      annotation.container.prepend(content);\n    } else if (content.nodeName === \"CANVAS\") {\n      const canvas = content;\n      content = document.createElement(\"div\");\n      content.classList.add(\"annotationContent\", this.editorType);\n      canvas.before(content);\n    }\n\n    return content;\n  }\n\n  resetAnnotationElement(annotation) {\n    const { firstChild } = annotation.container;\n    if (\n      firstChild.nodeName === \"DIV\" &&\n      firstChild.classList.contains(\"annotationContent\")\n    ) {\n      firstChild.remove();\n    }\n  }\n}\n\n// This class is used to fake an editor which has been deleted.\nclass FakeEditor extends AnnotationEditor {\n  constructor(params) {\n    super(params);\n    this.annotationElementId = params.annotationElementId;\n    this.deleted = true;\n  }\n\n  serialize() {\n    return {\n      id: this.annotationElementId,\n      deleted: true,\n      pageIndex: this.pageIndex,\n    };\n  }\n}\n\nexport { AnnotationEditor };\n","/* Copyright 2014 Opera Software ASA\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n *\n * Based on https://code.google.com/p/smhasher/wiki/MurmurHash3.\n * Hashes roughly 100 KB per millisecond on i7 3.4 GHz.\n */\n\nconst SEED = 0xc3d2e1f0;\n// Workaround for missing math precision in JS.\nconst MASK_HIGH = 0xffff0000;\nconst MASK_LOW = 0xffff;\n\nclass MurmurHash3_64 {\n  constructor(seed) {\n    this.h1 = seed ? seed & 0xffffffff : SEED;\n    this.h2 = seed ? seed & 0xffffffff : SEED;\n  }\n\n  update(input) {\n    let data, length;\n    if (typeof input === \"string\") {\n      data = new Uint8Array(input.length * 2);\n      length = 0;\n      for (let i = 0, ii = input.length; i < ii; i++) {\n        const code = input.charCodeAt(i);\n        if (code <= 0xff) {\n          data[length++] = code;\n        } else {\n          data[length++] = code >>> 8;\n          data[length++] = code & 0xff;\n        }\n      }\n    } else if (ArrayBuffer.isView(input)) {\n      data = input.slice();\n      length = data.byteLength;\n    } else {\n      throw new Error(\"Invalid data format, must be a string or TypedArray.\");\n    }\n\n    const blockCounts = length >> 2;\n    const tailLength = length - blockCounts * 4;\n    // We don't care about endianness here.\n    const dataUint32 = new Uint32Array(data.buffer, 0, blockCounts);\n    let k1 = 0,\n      k2 = 0;\n    let h1 = this.h1,\n      h2 = this.h2;\n    const C1 = 0xcc9e2d51,\n      C2 = 0x1b873593;\n    const C1_LOW = C1 & MASK_LOW,\n      C2_LOW = C2 & MASK_LOW;\n\n    for (let i = 0; i < blockCounts; i++) {\n      if (i & 1) {\n        k1 = dataUint32[i];\n        k1 = ((k1 * C1) & MASK_HIGH) | ((k1 * C1_LOW) & MASK_LOW);\n        k1 = (k1 << 15) | (k1 >>> 17);\n        k1 = ((k1 * C2) & MASK_HIGH) | ((k1 * C2_LOW) & MASK_LOW);\n        h1 ^= k1;\n        h1 = (h1 << 13) | (h1 >>> 19);\n        h1 = h1 * 5 + 0xe6546b64;\n      } else {\n        k2 = dataUint32[i];\n        k2 = ((k2 * C1) & MASK_HIGH) | ((k2 * C1_LOW) & MASK_LOW);\n        k2 = (k2 << 15) | (k2 >>> 17);\n        k2 = ((k2 * C2) & MASK_HIGH) | ((k2 * C2_LOW) & MASK_LOW);\n        h2 ^= k2;\n        h2 = (h2 << 13) | (h2 >>> 19);\n        h2 = h2 * 5 + 0xe6546b64;\n      }\n    }\n\n    k1 = 0;\n\n    switch (tailLength) {\n      case 3:\n        k1 ^= data[blockCounts * 4 + 2] << 16;\n      /* falls through */\n      case 2:\n        k1 ^= data[blockCounts * 4 + 1] << 8;\n      /* falls through */\n      case 1:\n        k1 ^= data[blockCounts * 4];\n        /* falls through */\n\n        k1 = ((k1 * C1) & MASK_HIGH) | ((k1 * C1_LOW) & MASK_LOW);\n        k1 = (k1 << 15) | (k1 >>> 17);\n        k1 = ((k1 * C2) & MASK_HIGH) | ((k1 * C2_LOW) & MASK_LOW);\n        if (blockCounts & 1) {\n          h1 ^= k1;\n        } else {\n          h2 ^= k1;\n        }\n    }\n\n    this.h1 = h1;\n    this.h2 = h2;\n  }\n\n  hexdigest() {\n    let h1 = this.h1,\n      h2 = this.h2;\n\n    h1 ^= h2 >>> 1;\n    h1 = ((h1 * 0xed558ccd) & MASK_HIGH) | ((h1 * 0x8ccd) & MASK_LOW);\n    h2 =\n      ((h2 * 0xff51afd7) & MASK_HIGH) |\n      (((((h2 << 16) | (h1 >>> 16)) * 0xafd7ed55) & MASK_HIGH) >>> 16);\n    h1 ^= h2 >>> 1;\n    h1 = ((h1 * 0x1a85ec53) & MASK_HIGH) | ((h1 * 0xec53) & MASK_LOW);\n    h2 =\n      ((h2 * 0xc4ceb9fe) & MASK_HIGH) |\n      (((((h2 << 16) | (h1 >>> 16)) * 0xb9fe1a85) & MASK_HIGH) >>> 16);\n    h1 ^= h2 >>> 1;\n\n    return (\n      (h1 >>> 0).toString(16).padStart(8, \"0\") +\n      (h2 >>> 0).toString(16).padStart(8, \"0\")\n    );\n  }\n}\n\nexport { MurmurHash3_64 };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { objectFromMap, shadow, unreachable } from \"../shared/util.js\";\nimport { AnnotationEditor } from \"./editor/editor.js\";\nimport { MurmurHash3_64 } from \"../shared/murmurhash3.js\";\n\nconst SerializableEmpty = Object.freeze({\n  map: null,\n  hash: \"\",\n  transfer: undefined,\n});\n\n/**\n * Key/value storage for annotation data in forms.\n */\nclass AnnotationStorage {\n  #modified = false;\n\n  #modifiedIds = null;\n\n  #storage = new Map();\n\n  constructor() {\n    // Callbacks to signal when the modification state is set or reset.\n    // This is used by the viewer to only bind on `beforeunload` if forms\n    // are actually edited to prevent doing so unconditionally since that\n    // can have undesirable effects.\n    this.onSetModified = null;\n    this.onResetModified = null;\n    this.onAnnotationEditor = null;\n  }\n\n  /**\n   * Get the value for a given key if it exists, or return the default value.\n   * @param {string} key\n   * @param {Object} defaultValue\n   * @returns {Object}\n   */\n  getValue(key, defaultValue) {\n    const value = this.#storage.get(key);\n    if (value === undefined) {\n      return defaultValue;\n    }\n\n    return Object.assign(defaultValue, value);\n  }\n\n  /**\n   * Get the value for a given key.\n   * @param {string} key\n   * @returns {Object}\n   */\n  getRawValue(key) {\n    return this.#storage.get(key);\n  }\n\n  /**\n   * Remove a value from the storage.\n   * @param {string} key\n   */\n  remove(key) {\n    this.#storage.delete(key);\n\n    if (this.#storage.size === 0) {\n      this.resetModified();\n    }\n\n    if (typeof this.onAnnotationEditor === \"function\") {\n      for (const value of this.#storage.values()) {\n        if (value instanceof AnnotationEditor) {\n          return;\n        }\n      }\n      this.onAnnotationEditor(null);\n    }\n  }\n\n  /**\n   * Set the value for a given key\n   * @param {string} key\n   * @param {Object} value\n   */\n  setValue(key, value) {\n    const obj = this.#storage.get(key);\n    let modified = false;\n    if (obj !== undefined) {\n      for (const [entry, val] of Object.entries(value)) {\n        if (obj[entry] !== val) {\n          modified = true;\n          obj[entry] = val;\n        }\n      }\n    } else {\n      modified = true;\n      this.#storage.set(key, value);\n    }\n    if (modified) {\n      this.#setModified();\n    }\n\n    if (\n      value instanceof AnnotationEditor &&\n      typeof this.onAnnotationEditor === \"function\"\n    ) {\n      this.onAnnotationEditor(value.constructor._type);\n    }\n  }\n\n  /**\n   * Check if the storage contains the given key.\n   * @param {string} key\n   * @returns {boolean}\n   */\n  has(key) {\n    return this.#storage.has(key);\n  }\n\n  /**\n   * @returns {Object | null}\n   */\n  getAll() {\n    return this.#storage.size > 0 ? objectFromMap(this.#storage) : null;\n  }\n\n  /**\n   * @param {Object} obj\n   */\n  setAll(obj) {\n    for (const [key, val] of Object.entries(obj)) {\n      this.setValue(key, val);\n    }\n  }\n\n  get size() {\n    return this.#storage.size;\n  }\n\n  #setModified() {\n    if (!this.#modified) {\n      this.#modified = true;\n      if (typeof this.onSetModified === \"function\") {\n        this.onSetModified();\n      }\n    }\n  }\n\n  resetModified() {\n    if (this.#modified) {\n      this.#modified = false;\n      if (typeof this.onResetModified === \"function\") {\n        this.onResetModified();\n      }\n    }\n  }\n\n  /**\n   * @returns {PrintAnnotationStorage}\n   */\n  get print() {\n    return new PrintAnnotationStorage(this);\n  }\n\n  /**\n   * PLEASE NOTE: Only intended for usage within the API itself.\n   * @ignore\n   */\n  get serializable() {\n    if (this.#storage.size === 0) {\n      return SerializableEmpty;\n    }\n    const map = new Map(),\n      hash = new MurmurHash3_64(),\n      transfer = [];\n    const context = Object.create(null);\n    let hasBitmap = false;\n\n    for (const [key, val] of this.#storage) {\n      const serialized =\n        val instanceof AnnotationEditor\n          ? val.serialize(/* isForCopying = */ false, context)\n          : val;\n      if (serialized) {\n        map.set(key, serialized);\n\n        hash.update(`${key}:${JSON.stringify(serialized)}`);\n        hasBitmap ||= !!serialized.bitmap;\n      }\n    }\n\n    if (hasBitmap) {\n      // We must transfer the bitmap data separately, since it can be changed\n      // during serialization with SVG images.\n      for (const value of map.values()) {\n        if (value.bitmap) {\n          transfer.push(value.bitmap);\n        }\n      }\n    }\n\n    return map.size > 0\n      ? { map, hash: hash.hexdigest(), transfer }\n      : SerializableEmpty;\n  }\n\n  get editorStats() {\n    let stats = null;\n    const typeToEditor = new Map();\n    for (const value of this.#storage.values()) {\n      if (!(value instanceof AnnotationEditor)) {\n        continue;\n      }\n      const editorStats = value.telemetryFinalData;\n      if (!editorStats) {\n        continue;\n      }\n      const { type } = editorStats;\n      if (!typeToEditor.has(type)) {\n        typeToEditor.set(type, Object.getPrototypeOf(value).constructor);\n      }\n      stats ||= Object.create(null);\n      const map = (stats[type] ||= new Map());\n      for (const [key, val] of Object.entries(editorStats)) {\n        if (key === \"type\") {\n          continue;\n        }\n        let counters = map.get(key);\n        if (!counters) {\n          counters = new Map();\n          map.set(key, counters);\n        }\n        const count = counters.get(val) ?? 0;\n        counters.set(val, count + 1);\n      }\n    }\n    for (const [type, editor] of typeToEditor) {\n      stats[type] = editor.computeTelemetryFinalData(stats[type]);\n    }\n    return stats;\n  }\n\n  resetModifiedIds() {\n    this.#modifiedIds = null;\n  }\n\n  /**\n   * @returns {{ids: Set<string>, hash: string}}\n   */\n  get modifiedIds() {\n    if (this.#modifiedIds) {\n      return this.#modifiedIds;\n    }\n    const ids = [];\n    for (const value of this.#storage.values()) {\n      if (\n        !(value instanceof AnnotationEditor) ||\n        !value.annotationElementId ||\n        !value.serialize()\n      ) {\n        continue;\n      }\n      ids.push(value.annotationElementId);\n    }\n    return (this.#modifiedIds = {\n      ids: new Set(ids),\n      hash: ids.join(\",\"),\n    });\n  }\n}\n\n/**\n * A special `AnnotationStorage` for use during printing, where the serializable\n * data is *frozen* upon initialization, to prevent scripting from modifying its\n * contents. (Necessary since printing is triggered synchronously in browsers.)\n */\nclass PrintAnnotationStorage extends AnnotationStorage {\n  #serializable;\n\n  constructor(parent) {\n    super();\n    const { map, hash, transfer } = parent.serializable;\n    // Create a *copy* of the data, since Objects are passed by reference in JS.\n    const clone = structuredClone(map, transfer ? { transfer } : null);\n\n    this.#serializable = { map: clone, hash, transfer };\n  }\n\n  /**\n   * @returns {PrintAnnotationStorage}\n   */\n  // eslint-disable-next-line getter-return\n  get print() {\n    unreachable(\"Should not call PrintAnnotationStorage.print\");\n  }\n\n  /**\n   * PLEASE NOTE: Only intended for usage within the API itself.\n   * @ignore\n   */\n  get serializable() {\n    return this.#serializable;\n  }\n\n  get modifiedIds() {\n    return shadow(this, \"modifiedIds\", {\n      ids: new Set(),\n      hash: \"\",\n    });\n  }\n}\n\nexport { AnnotationStorage, PrintAnnotationStorage, SerializableEmpty };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  assert,\n  bytesToString,\n  FontRenderOps,\n  isNodeJS,\n  shadow,\n  string32,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\n\nclass FontLoader {\n  #systemFonts = new Set();\n\n  constructor({\n    ownerDocument = globalThis.document,\n    styleElement = null, // For testing only.\n  }) {\n    this._document = ownerDocument;\n\n    this.nativeFontFaces = new Set();\n    this.styleElement =\n      typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")\n        ? styleElement\n        : null;\n\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n      this.loadingRequests = [];\n      this.loadTestFontId = 0;\n    }\n  }\n\n  addNativeFontFace(nativeFontFace) {\n    this.nativeFontFaces.add(nativeFontFace);\n    this._document.fonts.add(nativeFontFace);\n  }\n\n  removeNativeFontFace(nativeFontFace) {\n    this.nativeFontFaces.delete(nativeFontFace);\n    this._document.fonts.delete(nativeFontFace);\n  }\n\n  insertRule(rule) {\n    if (!this.styleElement) {\n      this.styleElement = this._document.createElement(\"style\");\n      this._document.documentElement\n        .getElementsByTagName(\"head\")[0]\n        .append(this.styleElement);\n    }\n    const styleSheet = this.styleElement.sheet;\n    styleSheet.insertRule(rule, styleSheet.cssRules.length);\n  }\n\n  clear() {\n    for (const nativeFontFace of this.nativeFontFaces) {\n      this._document.fonts.delete(nativeFontFace);\n    }\n    this.nativeFontFaces.clear();\n    this.#systemFonts.clear();\n\n    if (this.styleElement) {\n      // Note: ChildNode.remove doesn't throw if the parentNode is undefined.\n      this.styleElement.remove();\n      this.styleElement = null;\n    }\n  }\n\n  async loadSystemFont({ systemFontInfo: info, _inspectFont }) {\n    if (!info || this.#systemFonts.has(info.loadedName)) {\n      return;\n    }\n    assert(\n      !this.disableFontFace,\n      \"loadSystemFont shouldn't be called when `disableFontFace` is set.\"\n    );\n\n    if (this.isFontLoadingAPISupported) {\n      const { loadedName, src, style } = info;\n      const fontFace = new FontFace(loadedName, src, style);\n      this.addNativeFontFace(fontFace);\n      try {\n        await fontFace.load();\n        this.#systemFonts.add(loadedName);\n        _inspectFont?.(info);\n      } catch {\n        warn(\n          `Cannot load system font: ${info.baseFontName}, installing it could help to improve PDF rendering.`\n        );\n\n        this.removeNativeFontFace(fontFace);\n      }\n      return;\n    }\n\n    unreachable(\n      \"Not implemented: loadSystemFont without the Font Loading API.\"\n    );\n  }\n\n  async bind(font) {\n    // Add the font to the DOM only once; skip if the font is already loaded.\n    if (font.attached || (font.missingFile && !font.systemFontInfo)) {\n      return;\n    }\n    font.attached = true;\n\n    if (font.systemFontInfo) {\n      await this.loadSystemFont(font);\n      return;\n    }\n\n    if (this.isFontLoadingAPISupported) {\n      const nativeFontFace = font.createNativeFontFace();\n      if (nativeFontFace) {\n        this.addNativeFontFace(nativeFontFace);\n        try {\n          await nativeFontFace.loaded;\n        } catch (ex) {\n          warn(`Failed to load font '${nativeFontFace.family}': '${ex}'.`);\n\n          // When font loading failed, fall back to the built-in font renderer.\n          font.disableFontFace = true;\n          throw ex;\n        }\n      }\n      return; // The font was, asynchronously, loaded.\n    }\n\n    // !this.isFontLoadingAPISupported\n    const rule = font.createFontFaceRule();\n    if (rule) {\n      this.insertRule(rule);\n\n      if (this.isSyncFontLoadingSupported) {\n        return; // The font was, synchronously, loaded.\n      }\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n        throw new Error(\"Not implemented: async font loading\");\n      }\n      await new Promise(resolve => {\n        const request = this._queueLoadingCallback(resolve);\n        this._prepareFontLoadEvent(font, request);\n      });\n      // The font was, asynchronously, loaded.\n    }\n  }\n\n  get isFontLoadingAPISupported() {\n    const hasFonts = !!this._document?.fonts;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      return shadow(\n        this,\n        \"isFontLoadingAPISupported\",\n        hasFonts && !this.styleElement\n      );\n    }\n    return shadow(this, \"isFontLoadingAPISupported\", hasFonts);\n  }\n\n  get isSyncFontLoadingSupported() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      return shadow(this, \"isSyncFontLoadingSupported\", true);\n    }\n\n    let supported = false;\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"CHROME\")) {\n      if (isNodeJS) {\n        // Node.js - we can pretend that sync font loading is supported.\n        supported = true;\n      } else if (\n        typeof navigator !== \"undefined\" &&\n        typeof navigator?.userAgent === \"string\" &&\n        // User agent string sniffing is bad, but there is no reliable way to\n        // tell if the font is fully loaded and ready to be used with canvas.\n        /Mozilla\\/5.0.*?rv:\\d+.*? Gecko/.test(navigator.userAgent)\n      ) {\n        // Firefox, from version 14, supports synchronous font loading.\n        supported = true;\n      }\n    }\n    return shadow(this, \"isSyncFontLoadingSupported\", supported);\n  }\n\n  _queueLoadingCallback(callback) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _queueLoadingCallback\");\n    }\n\n    function completeRequest() {\n      assert(!request.done, \"completeRequest() cannot be called twice.\");\n      request.done = true;\n\n      // Sending all completed requests in order of how they were queued.\n      while (loadingRequests.length > 0 && loadingRequests[0].done) {\n        const otherRequest = loadingRequests.shift();\n        setTimeout(otherRequest.callback, 0);\n      }\n    }\n\n    const { loadingRequests } = this;\n    const request = {\n      done: false,\n      complete: completeRequest,\n      callback,\n    };\n    loadingRequests.push(request);\n    return request;\n  }\n\n  get _loadTestFont() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _loadTestFont\");\n    }\n\n    // This is a CFF font with 1 glyph for '.' that fills its entire width\n    // and height.\n    const testFont = atob(\n      \"T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQA\" +\n        \"FQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAA\" +\n        \"ALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgA\" +\n        \"AAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1\" +\n        \"AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD\" +\n        \"6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACM\" +\n        \"AooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4D\" +\n        \"IP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAA\" +\n        \"AAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUA\" +\n        \"AQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgAB\" +\n        \"AAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABY\" +\n        \"AAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAA\" +\n        \"AC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAA\" +\n        \"AAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQAC\" +\n        \"AQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3\" +\n        \"Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTj\" +\n        \"FQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==\"\n    );\n    return shadow(this, \"_loadTestFont\", testFont);\n  }\n\n  _prepareFontLoadEvent(font, request) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _prepareFontLoadEvent\");\n    }\n\n    /** Hack begin */\n    // There's currently no event when a font has finished downloading so the\n    // following code is a dirty hack to 'guess' when a font is ready.\n    // It's assumed fonts are loaded in order, so add a known test font after\n    // the desired fonts and then test for the loading of that test font.\n\n    function int32(data, offset) {\n      return (\n        (data.charCodeAt(offset) << 24) |\n        (data.charCodeAt(offset + 1) << 16) |\n        (data.charCodeAt(offset + 2) << 8) |\n        (data.charCodeAt(offset + 3) & 0xff)\n      );\n    }\n    function spliceString(s, offset, remove, insert) {\n      const chunk1 = s.substring(0, offset);\n      const chunk2 = s.substring(offset + remove);\n      return chunk1 + insert + chunk2;\n    }\n    let i, ii;\n\n    // The temporary canvas is used to determine if fonts are loaded.\n    const canvas = this._document.createElement(\"canvas\");\n    canvas.width = 1;\n    canvas.height = 1;\n    const ctx = canvas.getContext(\"2d\");\n\n    let called = 0;\n    function isFontReady(name, callback) {\n      // With setTimeout clamping this gives the font ~100ms to load.\n      if (++called > 30) {\n        warn(\"Load test font never loaded.\");\n        callback();\n        return;\n      }\n      ctx.font = \"30px \" + name;\n      ctx.fillText(\".\", 0, 20);\n      const imageData = ctx.getImageData(0, 0, 1, 1);\n      if (imageData.data[3] > 0) {\n        callback();\n        return;\n      }\n      setTimeout(isFontReady.bind(null, name, callback));\n    }\n\n    const loadTestFontId = `lt${Date.now()}${this.loadTestFontId++}`;\n    // Chromium seems to cache fonts based on a hash of the actual font data,\n    // so the font must be modified for each load test else it will appear to\n    // be loaded already.\n    // TODO: This could maybe be made faster by avoiding the btoa of the full\n    // font by splitting it in chunks before hand and padding the font id.\n    let data = this._loadTestFont;\n    const COMMENT_OFFSET = 976; // has to be on 4 byte boundary (for checksum)\n    data = spliceString(\n      data,\n      COMMENT_OFFSET,\n      loadTestFontId.length,\n      loadTestFontId\n    );\n    // CFF checksum is important for IE, adjusting it\n    const CFF_CHECKSUM_OFFSET = 16;\n    const XXXX_VALUE = 0x58585858; // the \"comment\" filled with 'X'\n    let checksum = int32(data, CFF_CHECKSUM_OFFSET);\n    for (i = 0, ii = loadTestFontId.length - 3; i < ii; i += 4) {\n      checksum = (checksum - XXXX_VALUE + int32(loadTestFontId, i)) | 0;\n    }\n    if (i < loadTestFontId.length) {\n      // align to 4 bytes boundary\n      checksum = (checksum - XXXX_VALUE + int32(loadTestFontId + \"XXX\", i)) | 0;\n    }\n    data = spliceString(data, CFF_CHECKSUM_OFFSET, 4, string32(checksum));\n\n    const url = `url(data:font/opentype;base64,${btoa(data)});`;\n    const rule = `@font-face {font-family:\"${loadTestFontId}\";src:${url}}`;\n    this.insertRule(rule);\n\n    const div = this._document.createElement(\"div\");\n    div.style.visibility = \"hidden\";\n    div.style.width = div.style.height = \"10px\";\n    div.style.position = \"absolute\";\n    div.style.top = div.style.left = \"0px\";\n\n    for (const name of [font.loadedName, loadTestFontId]) {\n      const span = this._document.createElement(\"span\");\n      span.textContent = \"Hi\";\n      span.style.fontFamily = name;\n      div.append(span);\n    }\n    this._document.body.append(div);\n\n    isFontReady(loadTestFontId, () => {\n      div.remove();\n      request.complete();\n    });\n    /** Hack end */\n  }\n}\n\nclass FontFaceObject {\n  constructor(translatedData, { disableFontFace = false, inspectFont = null }) {\n    this.compiledGlyphs = Object.create(null);\n    // importing translated data\n    for (const i in translatedData) {\n      this[i] = translatedData[i];\n    }\n    this.disableFontFace = disableFontFace === true;\n    this._inspectFont = inspectFont;\n  }\n\n  createNativeFontFace() {\n    if (!this.data || this.disableFontFace) {\n      return null;\n    }\n    let nativeFontFace;\n    if (!this.cssFontInfo) {\n      nativeFontFace = new FontFace(this.loadedName, this.data, {});\n    } else {\n      const css = {\n        weight: this.cssFontInfo.fontWeight,\n      };\n      if (this.cssFontInfo.italicAngle) {\n        css.style = `oblique ${this.cssFontInfo.italicAngle}deg`;\n      }\n      nativeFontFace = new FontFace(\n        this.cssFontInfo.fontFamily,\n        this.data,\n        css\n      );\n    }\n\n    this._inspectFont?.(this);\n    return nativeFontFace;\n  }\n\n  createFontFaceRule() {\n    if (!this.data || this.disableFontFace) {\n      return null;\n    }\n    const data = bytesToString(this.data);\n    // Add the @font-face rule to the document.\n    const url = `url(data:${this.mimetype};base64,${btoa(data)});`;\n    let rule;\n    if (!this.cssFontInfo) {\n      rule = `@font-face {font-family:\"${this.loadedName}\";src:${url}}`;\n    } else {\n      let css = `font-weight: ${this.cssFontInfo.fontWeight};`;\n      if (this.cssFontInfo.italicAngle) {\n        css += `font-style: oblique ${this.cssFontInfo.italicAngle}deg;`;\n      }\n      rule = `@font-face {font-family:\"${this.cssFontInfo.fontFamily}\";${css}src:${url}}`;\n    }\n\n    this._inspectFont?.(this, url);\n    return rule;\n  }\n\n  getPathGenerator(objs, character) {\n    if (this.compiledGlyphs[character] !== undefined) {\n      return this.compiledGlyphs[character];\n    }\n\n    let cmds;\n    try {\n      cmds = objs.get(this.loadedName + \"_path_\" + character);\n    } catch (ex) {\n      warn(`getPathGenerator - ignoring character: \"${ex}\".`);\n    }\n\n    if (!Array.isArray(cmds) || cmds.length === 0) {\n      return (this.compiledGlyphs[character] = function (c, size) {\n        // No-op function, to allow rendering to continue.\n      });\n    }\n\n    const commands = [];\n    for (let i = 0, ii = cmds.length; i < ii; ) {\n      switch (cmds[i++]) {\n        case FontRenderOps.BEZIER_CURVE_TO:\n          {\n            const [a, b, c, d, e, f] = cmds.slice(i, i + 6);\n            commands.push(ctx => ctx.bezierCurveTo(a, b, c, d, e, f));\n            i += 6;\n          }\n          break;\n        case FontRenderOps.MOVE_TO:\n          {\n            const [a, b] = cmds.slice(i, i + 2);\n            commands.push(ctx => ctx.moveTo(a, b));\n            i += 2;\n          }\n          break;\n        case FontRenderOps.LINE_TO:\n          {\n            const [a, b] = cmds.slice(i, i + 2);\n            commands.push(ctx => ctx.lineTo(a, b));\n            i += 2;\n          }\n          break;\n        case FontRenderOps.QUADRATIC_CURVE_TO:\n          {\n            const [a, b, c, d] = cmds.slice(i, i + 4);\n            commands.push(ctx => ctx.quadraticCurveTo(a, b, c, d));\n            i += 4;\n          }\n          break;\n        case FontRenderOps.RESTORE:\n          commands.push(ctx => ctx.restore());\n          break;\n        case FontRenderOps.SAVE:\n          commands.push(ctx => ctx.save());\n          break;\n        case FontRenderOps.SCALE:\n          // The scale command must be at the third position, after save and\n          // transform (for the font matrix) commands (see also\n          // font_renderer.js).\n          // The goal is to just scale the canvas and then run the commands loop\n          // without the need to pass the size parameter to each command.\n          assert(\n            commands.length === 2,\n            \"Scale command is only valid at the third position.\"\n          );\n          break;\n        case FontRenderOps.TRANSFORM:\n          {\n            const [a, b, c, d, e, f] = cmds.slice(i, i + 6);\n            commands.push(ctx => ctx.transform(a, b, c, d, e, f));\n            i += 6;\n          }\n          break;\n        case FontRenderOps.TRANSLATE:\n          {\n            const [a, b] = cmds.slice(i, i + 2);\n            commands.push(ctx => ctx.translate(a, b));\n            i += 2;\n          }\n          break;\n      }\n    }\n\n    return (this.compiledGlyphs[character] = function glyphDrawer(ctx, size) {\n      commands[0](ctx);\n      commands[1](ctx);\n      ctx.scale(size, -size);\n      for (let i = 2, ii = commands.length; i < ii; i++) {\n        commands[i](ctx);\n      }\n    });\n  }\n}\n\nexport { FontFaceObject, FontLoader };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BaseCanvasFactory,\n  BaseCMapReaderFactory,\n  BaseFilterFactory,\n  BaseStandardFontDataFactory,\n} from \"./base_factory.js\";\nimport { isNodeJS, warn } from \"../shared/util.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./node_utils.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nif (isNodeJS) {\n  // eslint-disable-next-line no-var\n  var packageCapability = Promise.withResolvers();\n  // eslint-disable-next-line no-var\n  var packageMap = null;\n\n  const loadPackages = async () => {\n    // Native packages.\n    const fs = await __non_webpack_import__(\"fs\"),\n      http = await __non_webpack_import__(\"http\"),\n      https = await __non_webpack_import__(\"https\"),\n      url = await __non_webpack_import__(\"url\");\n\n    // Optional, third-party, packages.\n    let canvas, path2d;\n    if (typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"SKIP_BABEL\")) {\n      try {\n        canvas = await __non_webpack_import__(\"canvas\");\n      } catch {}\n      try {\n        path2d = await __non_webpack_import__(\"path2d\");\n      } catch {}\n    }\n\n    return new Map(Object.entries({ fs, http, https, url, canvas, path2d }));\n  };\n\n  loadPackages().then(\n    map => {\n      packageMap = map;\n      packageCapability.resolve();\n\n      if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"SKIP_BABEL\")) {\n        return;\n      }\n      if (!globalThis.DOMMatrix) {\n        const DOMMatrix = map.get(\"canvas\")?.DOMMatrix;\n\n        if (DOMMatrix) {\n          globalThis.DOMMatrix = DOMMatrix;\n        } else {\n          warn(\"Cannot polyfill `DOMMatrix`, rendering may be broken.\");\n        }\n      }\n      if (!globalThis.Path2D) {\n        const CanvasRenderingContext2D =\n          map.get(\"canvas\")?.CanvasRenderingContext2D;\n        const applyPath2DToCanvasRenderingContext =\n          map.get(\"path2d\")?.applyPath2DToCanvasRenderingContext;\n        const Path2D = map.get(\"path2d\")?.Path2D;\n\n        if (\n          CanvasRenderingContext2D &&\n          applyPath2DToCanvasRenderingContext &&\n          Path2D\n        ) {\n          applyPath2DToCanvasRenderingContext(CanvasRenderingContext2D);\n          globalThis.Path2D = Path2D;\n        } else {\n          warn(\"Cannot polyfill `Path2D`, rendering may be broken.\");\n        }\n      }\n    },\n    reason => {\n      warn(`loadPackages: ${reason}`);\n\n      packageMap = new Map();\n      packageCapability.resolve();\n    }\n  );\n}\n\nclass NodePackages {\n  static get promise() {\n    return packageCapability.promise;\n  }\n\n  static get(name) {\n    return packageMap?.get(name);\n  }\n}\n\nconst fetchData = function (url) {\n  const fs = NodePackages.get(\"fs\");\n  return fs.promises.readFile(url).then(data => new Uint8Array(data));\n};\n\nclass NodeFilterFactory extends BaseFilterFactory {}\n\nclass NodeCanvasFactory extends BaseCanvasFactory {\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    const canvas = NodePackages.get(\"canvas\");\n    return canvas.createCanvas(width, height);\n  }\n}\n\nclass NodeCMapReaderFactory extends BaseCMapReaderFactory {\n  /**\n   * @ignore\n   */\n  _fetchData(url, compressionType) {\n    return fetchData(url).then(data => ({ cMapData: data, compressionType }));\n  }\n}\n\nclass NodeStandardFontDataFactory extends BaseStandardFontDataFactory {\n  /**\n   * @ignore\n   */\n  _fetchData(url) {\n    return fetchData(url);\n  }\n}\n\nexport {\n  NodeCanvasFactory,\n  NodeCMapReaderFactory,\n  NodeFilterFactory,\n  NodePackages,\n  NodeStandardFontDataFactory,\n};\n","/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FormatError, info, unreachable, Util } from \"../shared/util.js\";\nimport { getCurrentTransform } from \"./display_utils.js\";\n\nconst PathType = {\n  FILL: \"Fill\",\n  STROKE: \"Stroke\",\n  SHADING: \"Shading\",\n};\n\nfunction applyBoundingBox(ctx, bbox) {\n  if (!bbox) {\n    return;\n  }\n  const width = bbox[2] - bbox[0];\n  const height = bbox[3] - bbox[1];\n  const region = new Path2D();\n  region.rect(bbox[0], bbox[1], width, height);\n  ctx.clip(region);\n}\n\nclass BaseShadingPattern {\n  constructor() {\n    if (this.constructor === BaseShadingPattern) {\n      unreachable(\"Cannot initialize BaseShadingPattern.\");\n    }\n  }\n\n  getPattern() {\n    unreachable(\"Abstract method `getPattern` called.\");\n  }\n}\n\nclass RadialAxialShadingPattern extends BaseShadingPattern {\n  constructor(IR) {\n    super();\n    this._type = IR[1];\n    this._bbox = IR[2];\n    this._colorStops = IR[3];\n    this._p0 = IR[4];\n    this._p1 = IR[5];\n    this._r0 = IR[6];\n    this._r1 = IR[7];\n    this.matrix = null;\n  }\n\n  _createGradient(ctx) {\n    let grad;\n    if (this._type === \"axial\") {\n      grad = ctx.createLinearGradient(\n        this._p0[0],\n        this._p0[1],\n        this._p1[0],\n        this._p1[1]\n      );\n    } else if (this._type === \"radial\") {\n      grad = ctx.createRadialGradient(\n        this._p0[0],\n        this._p0[1],\n        this._r0,\n        this._p1[0],\n        this._p1[1],\n        this._r1\n      );\n    }\n\n    for (const colorStop of this._colorStops) {\n      grad.addColorStop(colorStop[0], colorStop[1]);\n    }\n    return grad;\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    let pattern;\n    if (pathType === PathType.STROKE || pathType === PathType.FILL) {\n      const ownerBBox = owner.current.getClippedPathBoundingBox(\n        pathType,\n        getCurrentTransform(ctx)\n      ) || [0, 0, 0, 0];\n      // Create a canvas that is only as big as the current path. This doesn't\n      // allow us to cache the pattern, but it generally creates much smaller\n      // canvases and saves memory use. See bug 1722807 for an example.\n      const width = Math.ceil(ownerBBox[2] - ownerBBox[0]) || 1;\n      const height = Math.ceil(ownerBBox[3] - ownerBBox[1]) || 1;\n\n      const tmpCanvas = owner.cachedCanvases.getCanvas(\n        \"pattern\",\n        width,\n        height,\n        true\n      );\n\n      const tmpCtx = tmpCanvas.context;\n      tmpCtx.clearRect(0, 0, tmpCtx.canvas.width, tmpCtx.canvas.height);\n      tmpCtx.beginPath();\n      tmpCtx.rect(0, 0, tmpCtx.canvas.width, tmpCtx.canvas.height);\n      // Non shading fill patterns are positioned relative to the base transform\n      // (usually the page's initial transform), but we may have created a\n      // smaller canvas based on the path, so we must account for the shift.\n      tmpCtx.translate(-ownerBBox[0], -ownerBBox[1]);\n      inverse = Util.transform(inverse, [\n        1,\n        0,\n        0,\n        1,\n        ownerBBox[0],\n        ownerBBox[1],\n      ]);\n\n      tmpCtx.transform(...owner.baseTransform);\n      if (this.matrix) {\n        tmpCtx.transform(...this.matrix);\n      }\n      applyBoundingBox(tmpCtx, this._bbox);\n\n      tmpCtx.fillStyle = this._createGradient(tmpCtx);\n      tmpCtx.fill();\n\n      pattern = ctx.createPattern(tmpCanvas.canvas, \"no-repeat\");\n      const domMatrix = new DOMMatrix(inverse);\n      pattern.setTransform(domMatrix);\n    } else {\n      // Shading fills are applied relative to the current matrix which is also\n      // how canvas gradients work, so there's no need to do anything special\n      // here.\n      applyBoundingBox(ctx, this._bbox);\n      pattern = this._createGradient(ctx);\n    }\n    return pattern;\n  }\n}\n\nfunction drawTriangle(data, context, p1, p2, p3, c1, c2, c3) {\n  // Very basic Gouraud-shaded triangle rasterization algorithm.\n  const coords = context.coords,\n    colors = context.colors;\n  const bytes = data.data,\n    rowSize = data.width * 4;\n  let tmp;\n  if (coords[p1 + 1] > coords[p2 + 1]) {\n    tmp = p1;\n    p1 = p2;\n    p2 = tmp;\n    tmp = c1;\n    c1 = c2;\n    c2 = tmp;\n  }\n  if (coords[p2 + 1] > coords[p3 + 1]) {\n    tmp = p2;\n    p2 = p3;\n    p3 = tmp;\n    tmp = c2;\n    c2 = c3;\n    c3 = tmp;\n  }\n  if (coords[p1 + 1] > coords[p2 + 1]) {\n    tmp = p1;\n    p1 = p2;\n    p2 = tmp;\n    tmp = c1;\n    c1 = c2;\n    c2 = tmp;\n  }\n  const x1 = (coords[p1] + context.offsetX) * context.scaleX;\n  const y1 = (coords[p1 + 1] + context.offsetY) * context.scaleY;\n  const x2 = (coords[p2] + context.offsetX) * context.scaleX;\n  const y2 = (coords[p2 + 1] + context.offsetY) * context.scaleY;\n  const x3 = (coords[p3] + context.offsetX) * context.scaleX;\n  const y3 = (coords[p3 + 1] + context.offsetY) * context.scaleY;\n  if (y1 >= y3) {\n    return;\n  }\n  const c1r = colors[c1],\n    c1g = colors[c1 + 1],\n    c1b = colors[c1 + 2];\n  const c2r = colors[c2],\n    c2g = colors[c2 + 1],\n    c2b = colors[c2 + 2];\n  const c3r = colors[c3],\n    c3g = colors[c3 + 1],\n    c3b = colors[c3 + 2];\n\n  const minY = Math.round(y1),\n    maxY = Math.round(y3);\n  let xa, car, cag, cab;\n  let xb, cbr, cbg, cbb;\n  for (let y = minY; y <= maxY; y++) {\n    if (y < y2) {\n      const k = y < y1 ? 0 : (y1 - y) / (y1 - y2);\n      xa = x1 - (x1 - x2) * k;\n      car = c1r - (c1r - c2r) * k;\n      cag = c1g - (c1g - c2g) * k;\n      cab = c1b - (c1b - c2b) * k;\n    } else {\n      let k;\n      if (y > y3) {\n        k = 1;\n      } else if (y2 === y3) {\n        k = 0;\n      } else {\n        k = (y2 - y) / (y2 - y3);\n      }\n      xa = x2 - (x2 - x3) * k;\n      car = c2r - (c2r - c3r) * k;\n      cag = c2g - (c2g - c3g) * k;\n      cab = c2b - (c2b - c3b) * k;\n    }\n\n    let k;\n    if (y < y1) {\n      k = 0;\n    } else if (y > y3) {\n      k = 1;\n    } else {\n      k = (y1 - y) / (y1 - y3);\n    }\n    xb = x1 - (x1 - x3) * k;\n    cbr = c1r - (c1r - c3r) * k;\n    cbg = c1g - (c1g - c3g) * k;\n    cbb = c1b - (c1b - c3b) * k;\n    const x1_ = Math.round(Math.min(xa, xb));\n    const x2_ = Math.round(Math.max(xa, xb));\n    let j = rowSize * y + x1_ * 4;\n    for (let x = x1_; x <= x2_; x++) {\n      k = (xa - x) / (xa - xb);\n      if (k < 0) {\n        k = 0;\n      } else if (k > 1) {\n        k = 1;\n      }\n      bytes[j++] = (car - (car - cbr) * k) | 0;\n      bytes[j++] = (cag - (cag - cbg) * k) | 0;\n      bytes[j++] = (cab - (cab - cbb) * k) | 0;\n      bytes[j++] = 255;\n    }\n  }\n}\n\nfunction drawFigure(data, figure, context) {\n  const ps = figure.coords;\n  const cs = figure.colors;\n  let i, ii;\n  switch (figure.type) {\n    case \"lattice\":\n      const verticesPerRow = figure.verticesPerRow;\n      const rows = Math.floor(ps.length / verticesPerRow) - 1;\n      const cols = verticesPerRow - 1;\n      for (i = 0; i < rows; i++) {\n        let q = i * verticesPerRow;\n        for (let j = 0; j < cols; j++, q++) {\n          drawTriangle(\n            data,\n            context,\n            ps[q],\n            ps[q + 1],\n            ps[q + verticesPerRow],\n            cs[q],\n            cs[q + 1],\n            cs[q + verticesPerRow]\n          );\n          drawTriangle(\n            data,\n            context,\n            ps[q + verticesPerRow + 1],\n            ps[q + 1],\n            ps[q + verticesPerRow],\n            cs[q + verticesPerRow + 1],\n            cs[q + 1],\n            cs[q + verticesPerRow]\n          );\n        }\n      }\n      break;\n    case \"triangles\":\n      for (i = 0, ii = ps.length; i < ii; i += 3) {\n        drawTriangle(\n          data,\n          context,\n          ps[i],\n          ps[i + 1],\n          ps[i + 2],\n          cs[i],\n          cs[i + 1],\n          cs[i + 2]\n        );\n      }\n      break;\n    default:\n      throw new Error(\"illegal figure\");\n  }\n}\n\nclass MeshShadingPattern extends BaseShadingPattern {\n  constructor(IR) {\n    super();\n    this._coords = IR[2];\n    this._colors = IR[3];\n    this._figures = IR[4];\n    this._bounds = IR[5];\n    this._bbox = IR[7];\n    this._background = IR[8];\n    this.matrix = null;\n  }\n\n  _createMeshCanvas(combinedScale, backgroundColor, cachedCanvases) {\n    // we will increase scale on some weird factor to let antialiasing take\n    // care of \"rough\" edges\n    const EXPECTED_SCALE = 1.1;\n    // MAX_PATTERN_SIZE is used to avoid OOM situation.\n    const MAX_PATTERN_SIZE = 3000; // 10in @ 300dpi shall be enough\n    // We need to keep transparent border around our pattern for fill():\n    // createPattern with 'no-repeat' will bleed edges across entire area.\n    const BORDER_SIZE = 2;\n\n    const offsetX = Math.floor(this._bounds[0]);\n    const offsetY = Math.floor(this._bounds[1]);\n    const boundsWidth = Math.ceil(this._bounds[2]) - offsetX;\n    const boundsHeight = Math.ceil(this._bounds[3]) - offsetY;\n\n    const width = Math.min(\n      Math.ceil(Math.abs(boundsWidth * combinedScale[0] * EXPECTED_SCALE)),\n      MAX_PATTERN_SIZE\n    );\n    const height = Math.min(\n      Math.ceil(Math.abs(boundsHeight * combinedScale[1] * EXPECTED_SCALE)),\n      MAX_PATTERN_SIZE\n    );\n    const scaleX = boundsWidth / width;\n    const scaleY = boundsHeight / height;\n\n    const context = {\n      coords: this._coords,\n      colors: this._colors,\n      offsetX: -offsetX,\n      offsetY: -offsetY,\n      scaleX: 1 / scaleX,\n      scaleY: 1 / scaleY,\n    };\n\n    const paddedWidth = width + BORDER_SIZE * 2;\n    const paddedHeight = height + BORDER_SIZE * 2;\n\n    const tmpCanvas = cachedCanvases.getCanvas(\n      \"mesh\",\n      paddedWidth,\n      paddedHeight,\n      false\n    );\n    const tmpCtx = tmpCanvas.context;\n\n    const data = tmpCtx.createImageData(width, height);\n    if (backgroundColor) {\n      const bytes = data.data;\n      for (let i = 0, ii = bytes.length; i < ii; i += 4) {\n        bytes[i] = backgroundColor[0];\n        bytes[i + 1] = backgroundColor[1];\n        bytes[i + 2] = backgroundColor[2];\n        bytes[i + 3] = 255;\n      }\n    }\n    for (const figure of this._figures) {\n      drawFigure(data, figure, context);\n    }\n    tmpCtx.putImageData(data, BORDER_SIZE, BORDER_SIZE);\n    const canvas = tmpCanvas.canvas;\n\n    return {\n      canvas,\n      offsetX: offsetX - BORDER_SIZE * scaleX,\n      offsetY: offsetY - BORDER_SIZE * scaleY,\n      scaleX,\n      scaleY,\n    };\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    applyBoundingBox(ctx, this._bbox);\n    let scale;\n    if (pathType === PathType.SHADING) {\n      scale = Util.singularValueDecompose2dScale(getCurrentTransform(ctx));\n    } else {\n      // Obtain scale from matrix and current transformation matrix.\n      scale = Util.singularValueDecompose2dScale(owner.baseTransform);\n      if (this.matrix) {\n        const matrixScale = Util.singularValueDecompose2dScale(this.matrix);\n        scale = [scale[0] * matrixScale[0], scale[1] * matrixScale[1]];\n      }\n    }\n\n    // Rasterizing on the main thread since sending/queue large canvases\n    // might cause OOM.\n    const temporaryPatternCanvas = this._createMeshCanvas(\n      scale,\n      pathType === PathType.SHADING ? null : this._background,\n      owner.cachedCanvases\n    );\n\n    if (pathType !== PathType.SHADING) {\n      ctx.setTransform(...owner.baseTransform);\n      if (this.matrix) {\n        ctx.transform(...this.matrix);\n      }\n    }\n\n    ctx.translate(\n      temporaryPatternCanvas.offsetX,\n      temporaryPatternCanvas.offsetY\n    );\n    ctx.scale(temporaryPatternCanvas.scaleX, temporaryPatternCanvas.scaleY);\n\n    return ctx.createPattern(temporaryPatternCanvas.canvas, \"no-repeat\");\n  }\n}\n\nclass DummyShadingPattern extends BaseShadingPattern {\n  getPattern() {\n    return \"hotpink\";\n  }\n}\n\nfunction getShadingPattern(IR) {\n  switch (IR[0]) {\n    case \"RadialAxial\":\n      return new RadialAxialShadingPattern(IR);\n    case \"Mesh\":\n      return new MeshShadingPattern(IR);\n    case \"Dummy\":\n      return new DummyShadingPattern();\n  }\n  throw new Error(`Unknown IR type: ${IR[0]}`);\n}\n\nconst PaintType = {\n  COLORED: 1,\n  UNCOLORED: 2,\n};\n\nclass TilingPattern {\n  // 10in @ 300dpi shall be enough.\n  static MAX_PATTERN_SIZE = 3000;\n\n  constructor(IR, color, ctx, canvasGraphicsFactory, baseTransform) {\n    this.operatorList = IR[2];\n    this.matrix = IR[3];\n    this.bbox = IR[4];\n    this.xstep = IR[5];\n    this.ystep = IR[6];\n    this.paintType = IR[7];\n    this.tilingType = IR[8];\n    this.color = color;\n    this.ctx = ctx;\n    this.canvasGraphicsFactory = canvasGraphicsFactory;\n    this.baseTransform = baseTransform;\n  }\n\n  createPatternCanvas(owner) {\n    const operatorList = this.operatorList;\n    const bbox = this.bbox;\n    const xstep = this.xstep;\n    const ystep = this.ystep;\n    const paintType = this.paintType;\n    const tilingType = this.tilingType;\n    const color = this.color;\n    const canvasGraphicsFactory = this.canvasGraphicsFactory;\n\n    info(\"TilingType: \" + tilingType);\n\n    // A tiling pattern as defined by PDF spec 8.7.2 is a cell whose size is\n    // described by bbox, and may repeat regularly by shifting the cell by\n    // xstep and ystep.\n    // Because the HTML5 canvas API does not support pattern repetition with\n    // gaps in between, we use the xstep/ystep instead of the bbox's size.\n    //\n    // This has the following consequences (similarly for ystep):\n    //\n    // - If xstep is the same as bbox, then there is no observable difference.\n    //\n    // - If xstep is larger than bbox, then the pattern canvas is partially\n    //   empty: the area bounded by bbox is painted, the outside area is void.\n    //\n    // - If xstep is smaller than bbox, then the pixels between xstep and the\n    //   bbox boundary will be missing. This is INCORRECT behavior.\n    //   \"Figures on adjacent tiles should not overlap\" (PDF spec 8.7.3.1),\n    //   but overlapping cells without common pixels are still valid.\n    //   TODO: Fix the implementation, to allow this scenario to be painted\n    //   correctly.\n\n    const x0 = bbox[0],\n      y0 = bbox[1],\n      x1 = bbox[2],\n      y1 = bbox[3];\n\n    // Obtain scale from matrix and current transformation matrix.\n    const matrixScale = Util.singularValueDecompose2dScale(this.matrix);\n    const curMatrixScale = Util.singularValueDecompose2dScale(\n      this.baseTransform\n    );\n    const combinedScale = [\n      matrixScale[0] * curMatrixScale[0],\n      matrixScale[1] * curMatrixScale[1],\n    ];\n\n    // Use width and height values that are as close as possible to the end\n    // result when the pattern is used. Too low value makes the pattern look\n    // blurry. Too large value makes it look too crispy.\n    const dimx = this.getSizeAndScale(\n      xstep,\n      this.ctx.canvas.width,\n      combinedScale[0]\n    );\n    const dimy = this.getSizeAndScale(\n      ystep,\n      this.ctx.canvas.height,\n      combinedScale[1]\n    );\n\n    const tmpCanvas = owner.cachedCanvases.getCanvas(\n      \"pattern\",\n      dimx.size,\n      dimy.size,\n      true\n    );\n    const tmpCtx = tmpCanvas.context;\n    const graphics = canvasGraphicsFactory.createCanvasGraphics(tmpCtx);\n    graphics.groupLevel = owner.groupLevel;\n\n    this.setFillAndStrokeStyleToContext(graphics, paintType, color);\n\n    let adjustedX0 = x0;\n    let adjustedY0 = y0;\n    let adjustedX1 = x1;\n    let adjustedY1 = y1;\n    // Some bounding boxes have negative x0/y0 coordinates which will cause the\n    // some of the drawing to be off of the canvas. To avoid this shift the\n    // bounding box over.\n    if (x0 < 0) {\n      adjustedX0 = 0;\n      adjustedX1 += Math.abs(x0);\n    }\n    if (y0 < 0) {\n      adjustedY0 = 0;\n      adjustedY1 += Math.abs(y0);\n    }\n    tmpCtx.translate(-(dimx.scale * adjustedX0), -(dimy.scale * adjustedY0));\n    graphics.transform(dimx.scale, 0, 0, dimy.scale, 0, 0);\n\n    // To match CanvasGraphics beginDrawing we must save the context here or\n    // else we end up with unbalanced save/restores.\n    tmpCtx.save();\n\n    this.clipBbox(graphics, adjustedX0, adjustedY0, adjustedX1, adjustedY1);\n\n    graphics.baseTransform = getCurrentTransform(graphics.ctx);\n\n    graphics.executeOperatorList(operatorList);\n\n    graphics.endDrawing();\n\n    return {\n      canvas: tmpCanvas.canvas,\n      scaleX: dimx.scale,\n      scaleY: dimy.scale,\n      offsetX: adjustedX0,\n      offsetY: adjustedY0,\n    };\n  }\n\n  getSizeAndScale(step, realOutputSize, scale) {\n    // xstep / ystep may be negative -- normalize.\n    step = Math.abs(step);\n    // MAX_PATTERN_SIZE is used to avoid OOM situation.\n    // Use the destination canvas's size if it is bigger than the hard-coded\n    // limit of MAX_PATTERN_SIZE to avoid clipping patterns that cover the\n    // whole canvas.\n    const maxSize = Math.max(TilingPattern.MAX_PATTERN_SIZE, realOutputSize);\n    let size = Math.ceil(step * scale);\n    if (size >= maxSize) {\n      size = maxSize;\n    } else {\n      scale = size / step;\n    }\n    return { scale, size };\n  }\n\n  clipBbox(graphics, x0, y0, x1, y1) {\n    const bboxWidth = x1 - x0;\n    const bboxHeight = y1 - y0;\n    graphics.ctx.rect(x0, y0, bboxWidth, bboxHeight);\n    graphics.current.updateRectMinMax(getCurrentTransform(graphics.ctx), [\n      x0,\n      y0,\n      x1,\n      y1,\n    ]);\n    graphics.clip();\n    graphics.endPath();\n  }\n\n  setFillAndStrokeStyleToContext(graphics, paintType, color) {\n    const context = graphics.ctx,\n      current = graphics.current;\n    switch (paintType) {\n      case PaintType.COLORED:\n        const ctx = this.ctx;\n        context.fillStyle = ctx.fillStyle;\n        context.strokeStyle = ctx.strokeStyle;\n        current.fillColor = ctx.fillStyle;\n        current.strokeColor = ctx.strokeStyle;\n        break;\n      case PaintType.UNCOLORED:\n        const cssColor = Util.makeHexColor(color[0], color[1], color[2]);\n        context.fillStyle = cssColor;\n        context.strokeStyle = cssColor;\n        // Set color needed by image masks (fixes issues 3226 and 8741).\n        current.fillColor = cssColor;\n        current.strokeColor = cssColor;\n        break;\n      default:\n        throw new FormatError(`Unsupported paint type: ${paintType}`);\n    }\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    // PDF spec 8.7.2 NOTE 1: pattern's matrix is relative to initial matrix.\n    let matrix = inverse;\n    if (pathType !== PathType.SHADING) {\n      matrix = Util.transform(matrix, owner.baseTransform);\n      if (this.matrix) {\n        matrix = Util.transform(matrix, this.matrix);\n      }\n    }\n\n    const temporaryPatternCanvas = this.createPatternCanvas(owner);\n\n    let domMatrix = new DOMMatrix(matrix);\n    // Rescale and so that the ctx.createPattern call generates a pattern with\n    // the desired size.\n    domMatrix = domMatrix.translate(\n      temporaryPatternCanvas.offsetX,\n      temporaryPatternCanvas.offsetY\n    );\n    domMatrix = domMatrix.scale(\n      1 / temporaryPatternCanvas.scaleX,\n      1 / temporaryPatternCanvas.scaleY\n    );\n\n    const pattern = ctx.createPattern(temporaryPatternCanvas.canvas, \"repeat\");\n    pattern.setTransform(domMatrix);\n\n    return pattern;\n  }\n}\n\nexport { getShadingPattern, PathType, TilingPattern };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FeatureTest, ImageKind } from \"./util.js\";\n\nfunction convertToRGBA(params) {\n  switch (params.kind) {\n    case ImageKind.GRAYSCALE_1BPP:\n      return convertBlackAndWhiteToRGBA(params);\n    case ImageKind.RGB_24BPP:\n      return convertRGBToRGBA(params);\n  }\n\n  return null;\n}\n\nfunction convertBlackAndWhiteToRGBA({\n  src,\n  srcPos = 0,\n  dest,\n  width,\n  height,\n  nonBlackColor = 0xffffffff,\n  inverseDecode = false,\n}) {\n  const black = FeatureTest.isLittleEndian ? 0xff000000 : 0x000000ff;\n  const [zeroMapping, oneMapping] = inverseDecode\n    ? [nonBlackColor, black]\n    : [black, nonBlackColor];\n  const widthInSource = width >> 3;\n  const widthRemainder = width & 7;\n  const srcLength = src.length;\n  dest = new Uint32Array(dest.buffer);\n  let destPos = 0;\n\n  for (let i = 0; i < height; i++) {\n    for (const max = srcPos + widthInSource; srcPos < max; srcPos++) {\n      const elem = srcPos < srcLength ? src[srcPos] : 255;\n      dest[destPos++] = elem & 0b10000000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1000000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b100000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b10000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b100 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b10 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1 ? oneMapping : zeroMapping;\n    }\n    if (widthRemainder === 0) {\n      continue;\n    }\n    const elem = srcPos < srcLength ? src[srcPos++] : 255;\n    for (let j = 0; j < widthRemainder; j++) {\n      dest[destPos++] = elem & (1 << (7 - j)) ? oneMapping : zeroMapping;\n    }\n  }\n  return { srcPos, destPos };\n}\n\nfunction convertRGBToRGBA({\n  src,\n  srcPos = 0,\n  dest,\n  destPos = 0,\n  width,\n  height,\n}) {\n  let i = 0;\n  const len32 = src.length >> 2;\n  const src32 = new Uint32Array(src.buffer, srcPos, len32);\n\n  if (FeatureTest.isLittleEndian) {\n    // It's a way faster to do the shuffle manually instead of working\n    // component by component with some Uint8 arrays.\n    for (; i < len32 - 2; i += 3, destPos += 4) {\n      const s1 = src32[i]; // R2B1G1R1\n      const s2 = src32[i + 1]; // G3R3B2G2\n      const s3 = src32[i + 2]; // B4G4R4B3\n\n      dest[destPos] = s1 | 0xff000000;\n      dest[destPos + 1] = (s1 >>> 24) | (s2 << 8) | 0xff000000;\n      dest[destPos + 2] = (s2 >>> 16) | (s3 << 16) | 0xff000000;\n      dest[destPos + 3] = (s3 >>> 8) | 0xff000000;\n    }\n\n    for (let j = i * 4, jj = src.length; j < jj; j += 3) {\n      dest[destPos++] =\n        src[j] | (src[j + 1] << 8) | (src[j + 2] << 16) | 0xff000000;\n    }\n  } else {\n    for (; i < len32 - 2; i += 3, destPos += 4) {\n      const s1 = src32[i]; // R1G1B1R2\n      const s2 = src32[i + 1]; // G2B2R3G3\n      const s3 = src32[i + 2]; // B3R4G4B4\n\n      dest[destPos] = s1 | 0xff;\n      dest[destPos + 1] = (s1 << 24) | (s2 >>> 8) | 0xff;\n      dest[destPos + 2] = (s2 << 16) | (s3 >>> 16) | 0xff;\n      dest[destPos + 3] = (s3 << 8) | 0xff;\n    }\n\n    for (let j = i * 4, jj = src.length; j < jj; j += 3) {\n      dest[destPos++] =\n        (src[j] << 24) | (src[j + 1] << 16) | (src[j + 2] << 8) | 0xff;\n    }\n  }\n\n  return { srcPos, destPos };\n}\n\nfunction grayToRGBA(src, dest) {\n  if (FeatureTest.isLittleEndian) {\n    for (let i = 0, ii = src.length; i < ii; i++) {\n      dest[i] = (src[i] * 0x10101) | 0xff000000;\n    }\n  } else {\n    for (let i = 0, ii = src.length; i < ii; i++) {\n      dest[i] = (src[i] * 0x1010100) | 0x000000ff;\n    }\n  }\n}\n\nexport { convertBlackAndWhiteToRGBA, convertToRGBA, grayToRGBA };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FeatureTest,\n  FONT_IDENTITY_MATRIX,\n  IDENTITY_MATRIX,\n  ImageKind,\n  info,\n  isNodeJS,\n  OPS,\n  shadow,\n  TextRenderingMode,\n  unreachable,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  getCurrentTransform,\n  getCurrentTransformInverse,\n  PixelsPerInch,\n} from \"./display_utils.js\";\nimport {\n  getShadingPattern,\n  PathType,\n  TilingPattern,\n} from \"./pattern_helper.js\";\nimport { convertBlackAndWhiteToRGBA } from \"../shared/image_utils.js\";\n\n// <canvas> contexts store most of the state we need natively.\n// However, PDF needs a bit more state, which we store here.\n// Minimal font size that would be used during canvas fillText operations.\nconst MIN_FONT_SIZE = 16;\n// Maximum font size that would be used during canvas fillText operations.\nconst MAX_FONT_SIZE = 100;\n\n// Defines the time the `executeOperatorList`-method is going to be executing\n// before it stops and schedules a continue of execution.\nconst EXECUTION_TIME = 15; // ms\n// Defines the number of steps before checking the execution time.\nconst EXECUTION_STEPS = 10;\n\n// To disable Type3 compilation, set the value to `-1`.\nconst MAX_SIZE_TO_COMPILE = 1000;\n\nconst FULL_CHUNK_HEIGHT = 16;\n\n/**\n * Overrides certain methods on a 2d ctx so that when they are called they\n * will also call the same method on the destCtx. The methods that are\n * overridden are all the transformation state modifiers, path creation, and\n * save/restore. We only forward these specific methods because they are the\n * only state modifiers that we cannot copy over when we switch contexts.\n *\n * To remove mirroring call `ctx._removeMirroring()`.\n *\n * @param {Object} ctx - The 2d canvas context that will duplicate its calls on\n *   the destCtx.\n * @param {Object} destCtx - The 2d canvas context that will receive the\n *   forwarded calls.\n */\nfunction mirrorContextOperations(ctx, destCtx) {\n  if (ctx._removeMirroring) {\n    throw new Error(\"Context is already forwarding operations.\");\n  }\n  ctx.__originalSave = ctx.save;\n  ctx.__originalRestore = ctx.restore;\n  ctx.__originalRotate = ctx.rotate;\n  ctx.__originalScale = ctx.scale;\n  ctx.__originalTranslate = ctx.translate;\n  ctx.__originalTransform = ctx.transform;\n  ctx.__originalSetTransform = ctx.setTransform;\n  ctx.__originalResetTransform = ctx.resetTransform;\n  ctx.__originalClip = ctx.clip;\n  ctx.__originalMoveTo = ctx.moveTo;\n  ctx.__originalLineTo = ctx.lineTo;\n  ctx.__originalBezierCurveTo = ctx.bezierCurveTo;\n  ctx.__originalRect = ctx.rect;\n  ctx.__originalClosePath = ctx.closePath;\n  ctx.__originalBeginPath = ctx.beginPath;\n\n  ctx._removeMirroring = () => {\n    ctx.save = ctx.__originalSave;\n    ctx.restore = ctx.__originalRestore;\n    ctx.rotate = ctx.__originalRotate;\n    ctx.scale = ctx.__originalScale;\n    ctx.translate = ctx.__originalTranslate;\n    ctx.transform = ctx.__originalTransform;\n    ctx.setTransform = ctx.__originalSetTransform;\n    ctx.resetTransform = ctx.__originalResetTransform;\n\n    ctx.clip = ctx.__originalClip;\n    ctx.moveTo = ctx.__originalMoveTo;\n    ctx.lineTo = ctx.__originalLineTo;\n    ctx.bezierCurveTo = ctx.__originalBezierCurveTo;\n    ctx.rect = ctx.__originalRect;\n    ctx.closePath = ctx.__originalClosePath;\n    ctx.beginPath = ctx.__originalBeginPath;\n    delete ctx._removeMirroring;\n  };\n\n  ctx.save = function ctxSave() {\n    destCtx.save();\n    this.__originalSave();\n  };\n\n  ctx.restore = function ctxRestore() {\n    destCtx.restore();\n    this.__originalRestore();\n  };\n\n  ctx.translate = function ctxTranslate(x, y) {\n    destCtx.translate(x, y);\n    this.__originalTranslate(x, y);\n  };\n\n  ctx.scale = function ctxScale(x, y) {\n    destCtx.scale(x, y);\n    this.__originalScale(x, y);\n  };\n\n  ctx.transform = function ctxTransform(a, b, c, d, e, f) {\n    destCtx.transform(a, b, c, d, e, f);\n    this.__originalTransform(a, b, c, d, e, f);\n  };\n\n  ctx.setTransform = function ctxSetTransform(a, b, c, d, e, f) {\n    destCtx.setTransform(a, b, c, d, e, f);\n    this.__originalSetTransform(a, b, c, d, e, f);\n  };\n\n  ctx.resetTransform = function ctxResetTransform() {\n    destCtx.resetTransform();\n    this.__originalResetTransform();\n  };\n\n  ctx.rotate = function ctxRotate(angle) {\n    destCtx.rotate(angle);\n    this.__originalRotate(angle);\n  };\n\n  ctx.clip = function ctxRotate(rule) {\n    destCtx.clip(rule);\n    this.__originalClip(rule);\n  };\n\n  ctx.moveTo = function (x, y) {\n    destCtx.moveTo(x, y);\n    this.__originalMoveTo(x, y);\n  };\n\n  ctx.lineTo = function (x, y) {\n    destCtx.lineTo(x, y);\n    this.__originalLineTo(x, y);\n  };\n\n  ctx.bezierCurveTo = function (cp1x, cp1y, cp2x, cp2y, x, y) {\n    destCtx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n    this.__originalBezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n  };\n\n  ctx.rect = function (x, y, width, height) {\n    destCtx.rect(x, y, width, height);\n    this.__originalRect(x, y, width, height);\n  };\n\n  ctx.closePath = function () {\n    destCtx.closePath();\n    this.__originalClosePath();\n  };\n\n  ctx.beginPath = function () {\n    destCtx.beginPath();\n    this.__originalBeginPath();\n  };\n}\n\nclass CachedCanvases {\n  constructor(canvasFactory) {\n    this.canvasFactory = canvasFactory;\n    this.cache = Object.create(null);\n  }\n\n  getCanvas(id, width, height) {\n    let canvasEntry;\n    if (this.cache[id] !== undefined) {\n      canvasEntry = this.cache[id];\n      this.canvasFactory.reset(canvasEntry, width, height);\n    } else {\n      canvasEntry = this.canvasFactory.create(width, height);\n      this.cache[id] = canvasEntry;\n    }\n    return canvasEntry;\n  }\n\n  delete(id) {\n    delete this.cache[id];\n  }\n\n  clear() {\n    for (const id in this.cache) {\n      const canvasEntry = this.cache[id];\n      this.canvasFactory.destroy(canvasEntry);\n      delete this.cache[id];\n    }\n  }\n}\n\nfunction drawImageAtIntegerCoords(\n  ctx,\n  srcImg,\n  srcX,\n  srcY,\n  srcW,\n  srcH,\n  destX,\n  destY,\n  destW,\n  destH\n) {\n  const [a, b, c, d, tx, ty] = getCurrentTransform(ctx);\n  if (b === 0 && c === 0) {\n    // top-left corner is at (X, Y) and\n    // bottom-right one is at (X + width, Y + height).\n\n    // If leftX is 4.321 then it's rounded to 4.\n    // If width is 10.432 then it's rounded to 11 because\n    // rightX = leftX + width = 14.753 which is rounded to 15\n    // so after rounding the total width is 11 (15 - 4).\n    // It's why we can't just floor/ceil uniformly, it just depends\n    // on the values we've.\n\n    const tlX = destX * a + tx;\n    const rTlX = Math.round(tlX);\n    const tlY = destY * d + ty;\n    const rTlY = Math.round(tlY);\n    const brX = (destX + destW) * a + tx;\n\n    // Some pdf contains images with 1x1 images so in case of 0-width after\n    // scaling we must fallback on 1 to be sure there is something.\n    const rWidth = Math.abs(Math.round(brX) - rTlX) || 1;\n    const brY = (destY + destH) * d + ty;\n    const rHeight = Math.abs(Math.round(brY) - rTlY) || 1;\n\n    // We must apply a transformation in order to apply it on the image itself.\n    // For example if a == 1 && d == -1, it means that the image itself is\n    // mirrored w.r.t. the x-axis.\n    ctx.setTransform(Math.sign(a), 0, 0, Math.sign(d), rTlX, rTlY);\n    ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, 0, 0, rWidth, rHeight);\n    ctx.setTransform(a, b, c, d, tx, ty);\n\n    return [rWidth, rHeight];\n  }\n\n  if (a === 0 && d === 0) {\n    // This path is taken in issue9462.pdf (page 3).\n    const tlX = destY * c + tx;\n    const rTlX = Math.round(tlX);\n    const tlY = destX * b + ty;\n    const rTlY = Math.round(tlY);\n    const brX = (destY + destH) * c + tx;\n    const rWidth = Math.abs(Math.round(brX) - rTlX) || 1;\n    const brY = (destX + destW) * b + ty;\n    const rHeight = Math.abs(Math.round(brY) - rTlY) || 1;\n\n    ctx.setTransform(0, Math.sign(b), Math.sign(c), 0, rTlX, rTlY);\n    ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, 0, 0, rHeight, rWidth);\n    ctx.setTransform(a, b, c, d, tx, ty);\n\n    return [rHeight, rWidth];\n  }\n\n  // Not a scale matrix so let the render handle the case without rounding.\n  ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, destX, destY, destW, destH);\n\n  const scaleX = Math.hypot(a, b);\n  const scaleY = Math.hypot(c, d);\n  return [scaleX * destW, scaleY * destH];\n}\n\nfunction compileType3Glyph(imgData) {\n  const { width, height } = imgData;\n  if (width > MAX_SIZE_TO_COMPILE || height > MAX_SIZE_TO_COMPILE) {\n    return null;\n  }\n\n  const POINT_TO_PROCESS_LIMIT = 1000;\n  const POINT_TYPES = new Uint8Array([\n    0, 2, 4, 0, 1, 0, 5, 4, 8, 10, 0, 8, 0, 2, 1, 0,\n  ]);\n\n  const width1 = width + 1;\n  let points = new Uint8Array(width1 * (height + 1));\n  let i, j, j0;\n\n  // decodes bit-packed mask data\n  const lineSize = (width + 7) & ~7;\n  let data = new Uint8Array(lineSize * height),\n    pos = 0;\n  for (const elem of imgData.data) {\n    let mask = 128;\n    while (mask > 0) {\n      data[pos++] = elem & mask ? 0 : 255;\n      mask >>= 1;\n    }\n  }\n\n  // finding interesting points: every point is located between mask pixels,\n  // so there will be points of the (width + 1)x(height + 1) grid. Every point\n  // will have flags assigned based on neighboring mask pixels:\n  //   4 | 8\n  //   --P--\n  //   2 | 1\n  // We are interested only in points with the flags:\n  //   - outside corners: 1, 2, 4, 8;\n  //   - inside corners: 7, 11, 13, 14;\n  //   - and, intersections: 5, 10.\n  let count = 0;\n  pos = 0;\n  if (data[pos] !== 0) {\n    points[0] = 1;\n    ++count;\n  }\n  for (j = 1; j < width; j++) {\n    if (data[pos] !== data[pos + 1]) {\n      points[j] = data[pos] ? 2 : 1;\n      ++count;\n    }\n    pos++;\n  }\n  if (data[pos] !== 0) {\n    points[j] = 2;\n    ++count;\n  }\n  for (i = 1; i < height; i++) {\n    pos = i * lineSize;\n    j0 = i * width1;\n    if (data[pos - lineSize] !== data[pos]) {\n      points[j0] = data[pos] ? 1 : 8;\n      ++count;\n    }\n    // 'sum' is the position of the current pixel configuration in the 'TYPES'\n    // array (in order 8-1-2-4, so we can use '>>2' to shift the column).\n    let sum = (data[pos] ? 4 : 0) + (data[pos - lineSize] ? 8 : 0);\n    for (j = 1; j < width; j++) {\n      sum =\n        (sum >> 2) +\n        (data[pos + 1] ? 4 : 0) +\n        (data[pos - lineSize + 1] ? 8 : 0);\n      if (POINT_TYPES[sum]) {\n        points[j0 + j] = POINT_TYPES[sum];\n        ++count;\n      }\n      pos++;\n    }\n    if (data[pos - lineSize] !== data[pos]) {\n      points[j0 + j] = data[pos] ? 2 : 4;\n      ++count;\n    }\n\n    if (count > POINT_TO_PROCESS_LIMIT) {\n      return null;\n    }\n  }\n\n  pos = lineSize * (height - 1);\n  j0 = i * width1;\n  if (data[pos] !== 0) {\n    points[j0] = 8;\n    ++count;\n  }\n  for (j = 1; j < width; j++) {\n    if (data[pos] !== data[pos + 1]) {\n      points[j0 + j] = data[pos] ? 4 : 8;\n      ++count;\n    }\n    pos++;\n  }\n  if (data[pos] !== 0) {\n    points[j0 + j] = 4;\n    ++count;\n  }\n  if (count > POINT_TO_PROCESS_LIMIT) {\n    return null;\n  }\n\n  // building outlines\n  const steps = new Int32Array([0, width1, -1, 0, -width1, 0, 0, 0, 1]);\n  const path = new Path2D();\n\n  for (i = 0; count && i <= height; i++) {\n    let p = i * width1;\n    const end = p + width;\n    while (p < end && !points[p]) {\n      p++;\n    }\n    if (p === end) {\n      continue;\n    }\n    path.moveTo(p % width1, i);\n\n    const p0 = p;\n    let type = points[p];\n    do {\n      const step = steps[type];\n      do {\n        p += step;\n      } while (!points[p]);\n\n      const pp = points[p];\n      if (pp !== 5 && pp !== 10) {\n        // set new direction\n        type = pp;\n        // delete mark\n        points[p] = 0;\n      } else {\n        // type is 5 or 10, ie, a crossing\n        // set new direction\n        type = pp & ((0x33 * type) >> 4);\n        // set new type for \"future hit\"\n        points[p] &= (type >> 2) | (type << 2);\n      }\n      path.lineTo(p % width1, (p / width1) | 0);\n\n      if (!points[p]) {\n        --count;\n      }\n    } while (p0 !== p);\n    --i;\n  }\n\n  // Immediately release the, potentially large, `Uint8Array`s after parsing.\n  data = null;\n  points = null;\n\n  const drawOutline = function (c) {\n    c.save();\n    // the path shall be painted in [0..1]x[0..1] space\n    c.scale(1 / width, -1 / height);\n    c.translate(0, -height);\n    c.fill(path);\n    c.beginPath();\n    c.restore();\n  };\n\n  return drawOutline;\n}\n\nclass CanvasExtraState {\n  constructor(width, height) {\n    // Are soft masks and alpha values shapes or opacities?\n    this.alphaIsShape = false;\n    this.fontSize = 0;\n    this.fontSizeScale = 1;\n    this.textMatrix = IDENTITY_MATRIX;\n    this.textMatrixScale = 1;\n    this.fontMatrix = FONT_IDENTITY_MATRIX;\n    this.leading = 0;\n    // Current point (in user coordinates)\n    this.x = 0;\n    this.y = 0;\n    // Start of text line (in text coordinates)\n    this.lineX = 0;\n    this.lineY = 0;\n    // Character and word spacing\n    this.charSpacing = 0;\n    this.wordSpacing = 0;\n    this.textHScale = 1;\n    this.textRenderingMode = TextRenderingMode.FILL;\n    this.textRise = 0;\n    // Default fore and background colors\n    this.fillColor = \"#000000\";\n    this.strokeColor = \"#000000\";\n    this.patternFill = false;\n    // Note: fill alpha applies to all non-stroking operations\n    this.fillAlpha = 1;\n    this.strokeAlpha = 1;\n    this.lineWidth = 1;\n    this.activeSMask = null;\n    this.transferMaps = \"none\";\n\n    this.startNewPathAndClipBox([0, 0, width, height]);\n  }\n\n  clone() {\n    const clone = Object.create(this);\n    clone.clipBox = this.clipBox.slice();\n    return clone;\n  }\n\n  setCurrentPoint(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  updatePathMinMax(transform, x, y) {\n    [x, y] = Util.applyTransform([x, y], transform);\n    this.minX = Math.min(this.minX, x);\n    this.minY = Math.min(this.minY, y);\n    this.maxX = Math.max(this.maxX, x);\n    this.maxY = Math.max(this.maxY, y);\n  }\n\n  updateRectMinMax(transform, rect) {\n    const p1 = Util.applyTransform(rect, transform);\n    const p2 = Util.applyTransform(rect.slice(2), transform);\n    const p3 = Util.applyTransform([rect[0], rect[3]], transform);\n    const p4 = Util.applyTransform([rect[2], rect[1]], transform);\n\n    this.minX = Math.min(this.minX, p1[0], p2[0], p3[0], p4[0]);\n    this.minY = Math.min(this.minY, p1[1], p2[1], p3[1], p4[1]);\n    this.maxX = Math.max(this.maxX, p1[0], p2[0], p3[0], p4[0]);\n    this.maxY = Math.max(this.maxY, p1[1], p2[1], p3[1], p4[1]);\n  }\n\n  updateScalingPathMinMax(transform, minMax) {\n    Util.scaleMinMax(transform, minMax);\n    this.minX = Math.min(this.minX, minMax[0]);\n    this.minY = Math.min(this.minY, minMax[1]);\n    this.maxX = Math.max(this.maxX, minMax[2]);\n    this.maxY = Math.max(this.maxY, minMax[3]);\n  }\n\n  updateCurvePathMinMax(transform, x0, y0, x1, y1, x2, y2, x3, y3, minMax) {\n    const box = Util.bezierBoundingBox(x0, y0, x1, y1, x2, y2, x3, y3, minMax);\n    if (minMax) {\n      return;\n    }\n    this.updateRectMinMax(transform, box);\n  }\n\n  getPathBoundingBox(pathType = PathType.FILL, transform = null) {\n    const box = [this.minX, this.minY, this.maxX, this.maxY];\n    if (pathType === PathType.STROKE) {\n      if (!transform) {\n        unreachable(\"Stroke bounding box must include transform.\");\n      }\n      // Stroked paths can be outside of the path bounding box by 1/2 the line\n      // width.\n      const scale = Util.singularValueDecompose2dScale(transform);\n      const xStrokePad = (scale[0] * this.lineWidth) / 2;\n      const yStrokePad = (scale[1] * this.lineWidth) / 2;\n      box[0] -= xStrokePad;\n      box[1] -= yStrokePad;\n      box[2] += xStrokePad;\n      box[3] += yStrokePad;\n    }\n    return box;\n  }\n\n  updateClipFromPath() {\n    const intersect = Util.intersect(this.clipBox, this.getPathBoundingBox());\n    this.startNewPathAndClipBox(intersect || [0, 0, 0, 0]);\n  }\n\n  isEmptyClip() {\n    return this.minX === Infinity;\n  }\n\n  startNewPathAndClipBox(box) {\n    this.clipBox = box;\n    this.minX = Infinity;\n    this.minY = Infinity;\n    this.maxX = 0;\n    this.maxY = 0;\n  }\n\n  getClippedPathBoundingBox(pathType = PathType.FILL, transform = null) {\n    return Util.intersect(\n      this.clipBox,\n      this.getPathBoundingBox(pathType, transform)\n    );\n  }\n}\n\nfunction putBinaryImageData(ctx, imgData) {\n  if (typeof ImageData !== \"undefined\" && imgData instanceof ImageData) {\n    ctx.putImageData(imgData, 0, 0);\n    return;\n  }\n\n  // Put the image data to the canvas in chunks, rather than putting the\n  // whole image at once.  This saves JS memory, because the ImageData object\n  // is smaller. It also possibly saves C++ memory within the implementation\n  // of putImageData(). (E.g. in Firefox we make two short-lived copies of\n  // the data passed to putImageData()). |n| shouldn't be too small, however,\n  // because too many putImageData() calls will slow things down.\n  //\n  // Note: as written, if the last chunk is partial, the putImageData() call\n  // will (conceptually) put pixels past the bounds of the canvas.  But\n  // that's ok; any such pixels are ignored.\n\n  const height = imgData.height,\n    width = imgData.width;\n  const partialChunkHeight = height % FULL_CHUNK_HEIGHT;\n  const fullChunks = (height - partialChunkHeight) / FULL_CHUNK_HEIGHT;\n  const totalChunks = partialChunkHeight === 0 ? fullChunks : fullChunks + 1;\n\n  const chunkImgData = ctx.createImageData(width, FULL_CHUNK_HEIGHT);\n  let srcPos = 0,\n    destPos;\n  const src = imgData.data;\n  const dest = chunkImgData.data;\n  let i, j, thisChunkHeight, elemsInThisChunk;\n\n  // There are multiple forms in which the pixel data can be passed, and\n  // imgData.kind tells us which one this is.\n  if (imgData.kind === ImageKind.GRAYSCALE_1BPP) {\n    // Grayscale, 1 bit per pixel (i.e. black-and-white).\n    const srcLength = src.byteLength;\n    const dest32 = new Uint32Array(dest.buffer, 0, dest.byteLength >> 2);\n    const dest32DataLength = dest32.length;\n    const fullSrcDiff = (width + 7) >> 3;\n    const white = 0xffffffff;\n    const black = FeatureTest.isLittleEndian ? 0xff000000 : 0x000000ff;\n\n    for (i = 0; i < totalChunks; i++) {\n      thisChunkHeight = i < fullChunks ? FULL_CHUNK_HEIGHT : partialChunkHeight;\n      destPos = 0;\n      for (j = 0; j < thisChunkHeight; j++) {\n        const srcDiff = srcLength - srcPos;\n        let k = 0;\n        const kEnd = srcDiff > fullSrcDiff ? width : srcDiff * 8 - 7;\n        const kEndUnrolled = kEnd & ~7;\n        let mask = 0;\n        let srcByte = 0;\n        for (; k < kEndUnrolled; k += 8) {\n          srcByte = src[srcPos++];\n          dest32[destPos++] = srcByte & 128 ? white : black;\n          dest32[destPos++] = srcByte & 64 ? white : black;\n          dest32[destPos++] = srcByte & 32 ? white : black;\n          dest32[destPos++] = srcByte & 16 ? white : black;\n          dest32[destPos++] = srcByte & 8 ? white : black;\n          dest32[destPos++] = srcByte & 4 ? white : black;\n          dest32[destPos++] = srcByte & 2 ? white : black;\n          dest32[destPos++] = srcByte & 1 ? white : black;\n        }\n        for (; k < kEnd; k++) {\n          if (mask === 0) {\n            srcByte = src[srcPos++];\n            mask = 128;\n          }\n\n          dest32[destPos++] = srcByte & mask ? white : black;\n          mask >>= 1;\n        }\n      }\n      // We ran out of input. Make all remaining pixels transparent.\n      while (destPos < dest32DataLength) {\n        dest32[destPos++] = 0;\n      }\n\n      ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n    }\n  } else if (imgData.kind === ImageKind.RGBA_32BPP) {\n    // RGBA, 32-bits per pixel.\n    j = 0;\n    elemsInThisChunk = width * FULL_CHUNK_HEIGHT * 4;\n    for (i = 0; i < fullChunks; i++) {\n      dest.set(src.subarray(srcPos, srcPos + elemsInThisChunk));\n      srcPos += elemsInThisChunk;\n\n      ctx.putImageData(chunkImgData, 0, j);\n      j += FULL_CHUNK_HEIGHT;\n    }\n    if (i < totalChunks) {\n      elemsInThisChunk = width * partialChunkHeight * 4;\n      dest.set(src.subarray(srcPos, srcPos + elemsInThisChunk));\n\n      ctx.putImageData(chunkImgData, 0, j);\n    }\n  } else if (imgData.kind === ImageKind.RGB_24BPP) {\n    // RGB, 24-bits per pixel.\n    thisChunkHeight = FULL_CHUNK_HEIGHT;\n    elemsInThisChunk = width * thisChunkHeight;\n    for (i = 0; i < totalChunks; i++) {\n      if (i >= fullChunks) {\n        thisChunkHeight = partialChunkHeight;\n        elemsInThisChunk = width * thisChunkHeight;\n      }\n\n      destPos = 0;\n      for (j = elemsInThisChunk; j--; ) {\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = 255;\n      }\n\n      ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n    }\n  } else {\n    throw new Error(`bad image kind: ${imgData.kind}`);\n  }\n}\n\nfunction putBinaryImageMask(ctx, imgData) {\n  if (imgData.bitmap) {\n    // The bitmap has been created in the worker.\n    ctx.drawImage(imgData.bitmap, 0, 0);\n    return;\n  }\n\n  // Slow path: OffscreenCanvas isn't available in the worker.\n  const height = imgData.height,\n    width = imgData.width;\n  const partialChunkHeight = height % FULL_CHUNK_HEIGHT;\n  const fullChunks = (height - partialChunkHeight) / FULL_CHUNK_HEIGHT;\n  const totalChunks = partialChunkHeight === 0 ? fullChunks : fullChunks + 1;\n\n  const chunkImgData = ctx.createImageData(width, FULL_CHUNK_HEIGHT);\n  let srcPos = 0;\n  const src = imgData.data;\n  const dest = chunkImgData.data;\n\n  for (let i = 0; i < totalChunks; i++) {\n    const thisChunkHeight =\n      i < fullChunks ? FULL_CHUNK_HEIGHT : partialChunkHeight;\n\n    // Expand the mask so it can be used by the canvas.  Any required\n    // inversion has already been handled.\n\n    ({ srcPos } = convertBlackAndWhiteToRGBA({\n      src,\n      srcPos,\n      dest,\n      width,\n      height: thisChunkHeight,\n      nonBlackColor: 0,\n    }));\n\n    ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n  }\n}\n\nfunction copyCtxState(sourceCtx, destCtx) {\n  const properties = [\n    \"strokeStyle\",\n    \"fillStyle\",\n    \"fillRule\",\n    \"globalAlpha\",\n    \"lineWidth\",\n    \"lineCap\",\n    \"lineJoin\",\n    \"miterLimit\",\n    \"globalCompositeOperation\",\n    \"font\",\n    \"filter\",\n  ];\n  for (const property of properties) {\n    if (sourceCtx[property] !== undefined) {\n      destCtx[property] = sourceCtx[property];\n    }\n  }\n  if (sourceCtx.setLineDash !== undefined) {\n    destCtx.setLineDash(sourceCtx.getLineDash());\n    destCtx.lineDashOffset = sourceCtx.lineDashOffset;\n  }\n}\n\nfunction resetCtxToDefault(ctx) {\n  ctx.strokeStyle = ctx.fillStyle = \"#000000\";\n  ctx.fillRule = \"nonzero\";\n  ctx.globalAlpha = 1;\n  ctx.lineWidth = 1;\n  ctx.lineCap = \"butt\";\n  ctx.lineJoin = \"miter\";\n  ctx.miterLimit = 10;\n  ctx.globalCompositeOperation = \"source-over\";\n  ctx.font = \"10px sans-serif\";\n  if (ctx.setLineDash !== undefined) {\n    ctx.setLineDash([]);\n    ctx.lineDashOffset = 0;\n  }\n  if (\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n    !isNodeJS\n  ) {\n    const { filter } = ctx;\n    if (filter !== \"none\" && filter !== \"\") {\n      ctx.filter = \"none\";\n    }\n  }\n}\n\nfunction getImageSmoothingEnabled(transform, interpolate) {\n  // In section 8.9.5.3 of the PDF spec, it's mentioned that the interpolate\n  // flag should be used when the image is upscaled.\n  // In Firefox, smoothing is always used when downscaling images (bug 1360415).\n\n  if (interpolate) {\n    return true;\n  }\n\n  const scale = Util.singularValueDecompose2dScale(transform);\n  // Round to a 32bit float so that `<=` check below will pass for numbers that\n  // are very close, but not exactly the same 64bit floats.\n  scale[0] = Math.fround(scale[0]);\n  scale[1] = Math.fround(scale[1]);\n  const actualScale = Math.fround(\n    (globalThis.devicePixelRatio || 1) * PixelsPerInch.PDF_TO_CSS_UNITS\n  );\n  return scale[0] <= actualScale && scale[1] <= actualScale;\n}\n\nconst LINE_CAP_STYLES = [\"butt\", \"round\", \"square\"];\nconst LINE_JOIN_STYLES = [\"miter\", \"round\", \"bevel\"];\nconst NORMAL_CLIP = {};\nconst EO_CLIP = {};\n\nclass CanvasGraphics {\n  constructor(\n    canvasCtx,\n    commonObjs,\n    objs,\n    canvasFactory,\n    filterFactory,\n    { optionalContentConfig, markedContentStack = null },\n    annotationCanvasMap,\n    pageColors\n  ) {\n    this.ctx = canvasCtx;\n    this.current = new CanvasExtraState(\n      this.ctx.canvas.width,\n      this.ctx.canvas.height\n    );\n    this.stateStack = [];\n    this.pendingClip = null;\n    this.pendingEOFill = false;\n    this.res = null;\n    this.xobjs = null;\n    this.commonObjs = commonObjs;\n    this.objs = objs;\n    this.canvasFactory = canvasFactory;\n    this.filterFactory = filterFactory;\n    this.groupStack = [];\n    this.processingType3 = null;\n    // Patterns are painted relative to the initial page/form transform, see\n    // PDF spec 8.7.2 NOTE 1.\n    this.baseTransform = null;\n    this.baseTransformStack = [];\n    this.groupLevel = 0;\n    this.smaskStack = [];\n    this.smaskCounter = 0;\n    this.tempSMask = null;\n    this.suspendedCtx = null;\n    this.contentVisible = true;\n    this.markedContentStack = markedContentStack || [];\n    this.optionalContentConfig = optionalContentConfig;\n    this.cachedCanvases = new CachedCanvases(this.canvasFactory);\n    this.cachedPatterns = new Map();\n    this.annotationCanvasMap = annotationCanvasMap;\n    this.viewportScale = 1;\n    this.outputScaleX = 1;\n    this.outputScaleY = 1;\n    this.pageColors = pageColors;\n\n    this._cachedScaleForStroking = [-1, 0];\n    this._cachedGetSinglePixelWidth = null;\n    this._cachedBitmapsMap = new Map();\n  }\n\n  getObject(data, fallback = null) {\n    if (typeof data === \"string\") {\n      return data.startsWith(\"g_\")\n        ? this.commonObjs.get(data)\n        : this.objs.get(data);\n    }\n    return fallback;\n  }\n\n  beginDrawing({\n    transform,\n    viewport,\n    transparency = false,\n    background = null,\n  }) {\n    // For pdfs that use blend modes we have to clear the canvas else certain\n    // blend modes can look wrong since we'd be blending with a white\n    // backdrop. The problem with a transparent backdrop though is we then\n    // don't get sub pixel anti aliasing on text, creating temporary\n    // transparent canvas when we have blend modes.\n    const width = this.ctx.canvas.width;\n    const height = this.ctx.canvas.height;\n\n    const savedFillStyle = this.ctx.fillStyle;\n    this.ctx.fillStyle = background || \"#ffffff\";\n    this.ctx.fillRect(0, 0, width, height);\n    this.ctx.fillStyle = savedFillStyle;\n\n    if (transparency) {\n      const transparentCanvas = this.cachedCanvases.getCanvas(\n        \"transparent\",\n        width,\n        height\n      );\n      this.compositeCtx = this.ctx;\n      this.transparentCanvas = transparentCanvas.canvas;\n      this.ctx = transparentCanvas.context;\n      this.ctx.save();\n      // The transform can be applied before rendering, transferring it to\n      // the new canvas.\n      this.ctx.transform(...getCurrentTransform(this.compositeCtx));\n    }\n\n    this.ctx.save();\n    resetCtxToDefault(this.ctx);\n    if (transform) {\n      this.ctx.transform(...transform);\n      this.outputScaleX = transform[0];\n      this.outputScaleY = transform[0];\n    }\n    this.ctx.transform(...viewport.transform);\n    this.viewportScale = viewport.scale;\n\n    this.baseTransform = getCurrentTransform(this.ctx);\n  }\n\n  executeOperatorList(\n    operatorList,\n    executionStartIdx,\n    continueCallback,\n    stepper\n  ) {\n    const argsArray = operatorList.argsArray;\n    const fnArray = operatorList.fnArray;\n    let i = executionStartIdx || 0;\n    const argsArrayLen = argsArray.length;\n\n    // Sometimes the OperatorList to execute is empty.\n    if (argsArrayLen === i) {\n      return i;\n    }\n\n    const chunkOperations =\n      argsArrayLen - i > EXECUTION_STEPS &&\n      typeof continueCallback === \"function\";\n    const endTime = chunkOperations ? Date.now() + EXECUTION_TIME : 0;\n    let steps = 0;\n\n    const commonObjs = this.commonObjs;\n    const objs = this.objs;\n    let fnId;\n\n    while (true) {\n      if (stepper !== undefined && i === stepper.nextBreakPoint) {\n        stepper.breakIt(i, continueCallback);\n        return i;\n      }\n\n      fnId = fnArray[i];\n\n      if (fnId !== OPS.dependency) {\n        // eslint-disable-next-line prefer-spread\n        this[fnId].apply(this, argsArray[i]);\n      } else {\n        for (const depObjId of argsArray[i]) {\n          const objsPool = depObjId.startsWith(\"g_\") ? commonObjs : objs;\n\n          // If the promise isn't resolved yet, add the continueCallback\n          // to the promise and bail out.\n          if (!objsPool.has(depObjId)) {\n            objsPool.get(depObjId, continueCallback);\n            return i;\n          }\n        }\n      }\n\n      i++;\n\n      // If the entire operatorList was executed, stop as were done.\n      if (i === argsArrayLen) {\n        return i;\n      }\n\n      // If the execution took longer then a certain amount of time and\n      // `continueCallback` is specified, interrupt the execution.\n      if (chunkOperations && ++steps > EXECUTION_STEPS) {\n        if (Date.now() > endTime) {\n          continueCallback();\n          return i;\n        }\n        steps = 0;\n      }\n\n      // If the operatorList isn't executed completely yet OR the execution\n      // time was short enough, do another execution round.\n    }\n  }\n\n  #restoreInitialState() {\n    // Finishing all opened operations such as SMask group painting.\n    while (this.stateStack.length || this.inSMaskMode) {\n      this.restore();\n    }\n\n    this.current.activeSMask = null;\n    this.ctx.restore();\n\n    if (this.transparentCanvas) {\n      this.ctx = this.compositeCtx;\n      this.ctx.save();\n      this.ctx.setTransform(1, 0, 0, 1, 0, 0); // Avoid apply transform twice\n      this.ctx.drawImage(this.transparentCanvas, 0, 0);\n      this.ctx.restore();\n      this.transparentCanvas = null;\n    }\n  }\n\n  endDrawing() {\n    this.#restoreInitialState();\n\n    this.cachedCanvases.clear();\n    this.cachedPatterns.clear();\n\n    for (const cache of this._cachedBitmapsMap.values()) {\n      for (const canvas of cache.values()) {\n        if (\n          typeof HTMLCanvasElement !== \"undefined\" &&\n          canvas instanceof HTMLCanvasElement\n        ) {\n          canvas.width = canvas.height = 0;\n        }\n      }\n      cache.clear();\n    }\n    this._cachedBitmapsMap.clear();\n    this.#drawFilter();\n  }\n\n  #drawFilter() {\n    if (this.pageColors) {\n      const hcmFilterId = this.filterFactory.addHCMFilter(\n        this.pageColors.foreground,\n        this.pageColors.background\n      );\n      if (hcmFilterId !== \"none\") {\n        const savedFilter = this.ctx.filter;\n        this.ctx.filter = hcmFilterId;\n        this.ctx.drawImage(this.ctx.canvas, 0, 0);\n        this.ctx.filter = savedFilter;\n      }\n    }\n  }\n\n  _scaleImage(img, inverseTransform) {\n    // Vertical or horizontal scaling shall not be more than 2 to not lose the\n    // pixels during drawImage operation, painting on the temporary canvas(es)\n    // that are twice smaller in size.\n    const width = img.width;\n    const height = img.height;\n    let widthScale = Math.max(\n      Math.hypot(inverseTransform[0], inverseTransform[1]),\n      1\n    );\n    let heightScale = Math.max(\n      Math.hypot(inverseTransform[2], inverseTransform[3]),\n      1\n    );\n\n    let paintWidth = width,\n      paintHeight = height;\n    let tmpCanvasId = \"prescale1\";\n    let tmpCanvas, tmpCtx;\n    while (\n      (widthScale > 2 && paintWidth > 1) ||\n      (heightScale > 2 && paintHeight > 1)\n    ) {\n      let newWidth = paintWidth,\n        newHeight = paintHeight;\n      if (widthScale > 2 && paintWidth > 1) {\n        // See bug 1820511 (Windows specific bug).\n        // TODO: once the above bug is fixed we could revert to:\n        // newWidth = Math.ceil(paintWidth / 2);\n        newWidth =\n          paintWidth >= 16384\n            ? Math.floor(paintWidth / 2) - 1 || 1\n            : Math.ceil(paintWidth / 2);\n        widthScale /= paintWidth / newWidth;\n      }\n      if (heightScale > 2 && paintHeight > 1) {\n        // TODO: see the comment above.\n        newHeight =\n          paintHeight >= 16384\n            ? Math.floor(paintHeight / 2) - 1 || 1\n            : Math.ceil(paintHeight) / 2;\n        heightScale /= paintHeight / newHeight;\n      }\n      tmpCanvas = this.cachedCanvases.getCanvas(\n        tmpCanvasId,\n        newWidth,\n        newHeight\n      );\n      tmpCtx = tmpCanvas.context;\n      tmpCtx.clearRect(0, 0, newWidth, newHeight);\n      tmpCtx.drawImage(\n        img,\n        0,\n        0,\n        paintWidth,\n        paintHeight,\n        0,\n        0,\n        newWidth,\n        newHeight\n      );\n      img = tmpCanvas.canvas;\n      paintWidth = newWidth;\n      paintHeight = newHeight;\n      tmpCanvasId = tmpCanvasId === \"prescale1\" ? \"prescale2\" : \"prescale1\";\n    }\n    return {\n      img,\n      paintWidth,\n      paintHeight,\n    };\n  }\n\n  _createMaskCanvas(img) {\n    const ctx = this.ctx;\n    const { width, height } = img;\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n    const currentTransform = getCurrentTransform(ctx);\n\n    let cache, cacheKey, scaled, maskCanvas;\n    if ((img.bitmap || img.data) && img.count > 1) {\n      const mainKey = img.bitmap || img.data.buffer;\n      // We're reusing the same image several times, so we can cache it.\n      // In case we've a pattern fill we just keep the scaled version of\n      // the image.\n      // Only the scaling part matters, the translation part is just used\n      // to compute offsets (but not when filling patterns see #15573).\n      // TODO: handle the case of a pattern fill if it's possible.\n      cacheKey = JSON.stringify(\n        isPatternFill\n          ? currentTransform\n          : [currentTransform.slice(0, 4), fillColor]\n      );\n\n      cache = this._cachedBitmapsMap.get(mainKey);\n      if (!cache) {\n        cache = new Map();\n        this._cachedBitmapsMap.set(mainKey, cache);\n      }\n      const cachedImage = cache.get(cacheKey);\n      if (cachedImage && !isPatternFill) {\n        const offsetX = Math.round(\n          Math.min(currentTransform[0], currentTransform[2]) +\n            currentTransform[4]\n        );\n        const offsetY = Math.round(\n          Math.min(currentTransform[1], currentTransform[3]) +\n            currentTransform[5]\n        );\n        return {\n          canvas: cachedImage,\n          offsetX,\n          offsetY,\n        };\n      }\n      scaled = cachedImage;\n    }\n\n    if (!scaled) {\n      maskCanvas = this.cachedCanvases.getCanvas(\"maskCanvas\", width, height);\n      putBinaryImageMask(maskCanvas.context, img);\n    }\n\n    // Create the mask canvas at the size it will be drawn at and also set\n    // its transform to match the current transform so if there are any\n    // patterns applied they will be applied relative to the correct\n    // transform.\n\n    let maskToCanvas = Util.transform(currentTransform, [\n      1 / width,\n      0,\n      0,\n      -1 / height,\n      0,\n      0,\n    ]);\n    maskToCanvas = Util.transform(maskToCanvas, [1, 0, 0, 1, 0, -height]);\n    const [minX, minY, maxX, maxY] = Util.getAxialAlignedBoundingBox(\n      [0, 0, width, height],\n      maskToCanvas\n    );\n    const drawnWidth = Math.round(maxX - minX) || 1;\n    const drawnHeight = Math.round(maxY - minY) || 1;\n    const fillCanvas = this.cachedCanvases.getCanvas(\n      \"fillCanvas\",\n      drawnWidth,\n      drawnHeight\n    );\n    const fillCtx = fillCanvas.context;\n\n    // The offset will be the top-left cordinate mask.\n    // If objToCanvas is [a,b,c,d,e,f] then:\n    //   - offsetX = min(a, c) + e\n    //   - offsetY = min(b, d) + f\n    const offsetX = minX;\n    const offsetY = minY;\n    fillCtx.translate(-offsetX, -offsetY);\n    fillCtx.transform(...maskToCanvas);\n\n    if (!scaled) {\n      // Pre-scale if needed to improve image smoothing.\n      scaled = this._scaleImage(\n        maskCanvas.canvas,\n        getCurrentTransformInverse(fillCtx)\n      );\n      scaled = scaled.img;\n      if (cache && isPatternFill) {\n        cache.set(cacheKey, scaled);\n      }\n    }\n\n    fillCtx.imageSmoothingEnabled = getImageSmoothingEnabled(\n      getCurrentTransform(fillCtx),\n      img.interpolate\n    );\n\n    drawImageAtIntegerCoords(\n      fillCtx,\n      scaled,\n      0,\n      0,\n      scaled.width,\n      scaled.height,\n      0,\n      0,\n      width,\n      height\n    );\n    fillCtx.globalCompositeOperation = \"source-in\";\n\n    const inverse = Util.transform(getCurrentTransformInverse(fillCtx), [\n      1,\n      0,\n      0,\n      1,\n      -offsetX,\n      -offsetY,\n    ]);\n    fillCtx.fillStyle = isPatternFill\n      ? fillColor.getPattern(ctx, this, inverse, PathType.FILL)\n      : fillColor;\n\n    fillCtx.fillRect(0, 0, width, height);\n\n    if (cache && !isPatternFill) {\n      // The fill canvas is put in the cache associated to the mask image\n      // so we must remove from the cached canvas: it mustn't be used again.\n      this.cachedCanvases.delete(\"fillCanvas\");\n      cache.set(cacheKey, fillCanvas.canvas);\n    }\n\n    // Round the offsets to avoid drawing fractional pixels.\n    return {\n      canvas: fillCanvas.canvas,\n      offsetX: Math.round(offsetX),\n      offsetY: Math.round(offsetY),\n    };\n  }\n\n  // Graphics state\n  setLineWidth(width) {\n    if (width !== this.current.lineWidth) {\n      this._cachedScaleForStroking[0] = -1;\n    }\n    this.current.lineWidth = width;\n    this.ctx.lineWidth = width;\n  }\n\n  setLineCap(style) {\n    this.ctx.lineCap = LINE_CAP_STYLES[style];\n  }\n\n  setLineJoin(style) {\n    this.ctx.lineJoin = LINE_JOIN_STYLES[style];\n  }\n\n  setMiterLimit(limit) {\n    this.ctx.miterLimit = limit;\n  }\n\n  setDash(dashArray, dashPhase) {\n    const ctx = this.ctx;\n    if (ctx.setLineDash !== undefined) {\n      ctx.setLineDash(dashArray);\n      ctx.lineDashOffset = dashPhase;\n    }\n  }\n\n  setRenderingIntent(intent) {\n    // This operation is ignored since we haven't found a use case for it yet.\n  }\n\n  setFlatness(flatness) {\n    // This operation is ignored since we haven't found a use case for it yet.\n  }\n\n  setGState(states) {\n    for (const [key, value] of states) {\n      switch (key) {\n        case \"LW\":\n          this.setLineWidth(value);\n          break;\n        case \"LC\":\n          this.setLineCap(value);\n          break;\n        case \"LJ\":\n          this.setLineJoin(value);\n          break;\n        case \"ML\":\n          this.setMiterLimit(value);\n          break;\n        case \"D\":\n          this.setDash(value[0], value[1]);\n          break;\n        case \"RI\":\n          this.setRenderingIntent(value);\n          break;\n        case \"FL\":\n          this.setFlatness(value);\n          break;\n        case \"Font\":\n          this.setFont(value[0], value[1]);\n          break;\n        case \"CA\":\n          this.current.strokeAlpha = value;\n          break;\n        case \"ca\":\n          this.current.fillAlpha = value;\n          this.ctx.globalAlpha = value;\n          break;\n        case \"BM\":\n          this.ctx.globalCompositeOperation = value;\n          break;\n        case \"SMask\":\n          this.current.activeSMask = value ? this.tempSMask : null;\n          this.tempSMask = null;\n          this.checkSMaskState();\n          break;\n        case \"TR\":\n          this.ctx.filter = this.current.transferMaps =\n            this.filterFactory.addFilter(value);\n          break;\n      }\n    }\n  }\n\n  get inSMaskMode() {\n    return !!this.suspendedCtx;\n  }\n\n  checkSMaskState() {\n    const inSMaskMode = this.inSMaskMode;\n    if (this.current.activeSMask && !inSMaskMode) {\n      this.beginSMaskMode();\n    } else if (!this.current.activeSMask && inSMaskMode) {\n      this.endSMaskMode();\n    }\n    // Else, the state is okay and nothing needs to be done.\n  }\n\n  /**\n   * Soft mask mode takes the current main drawing canvas and replaces it with\n   * a temporary canvas. Any drawing operations that happen on the temporary\n   * canvas need to be composed with the main canvas that was suspended (see\n   * `compose()`). The temporary canvas also duplicates many of its operations\n   * on the suspended canvas to keep them in sync, so that when the soft mask\n   * mode ends any clipping paths or transformations will still be active and in\n   * the right order on the canvas' graphics state stack.\n   */\n  beginSMaskMode() {\n    if (this.inSMaskMode) {\n      throw new Error(\"beginSMaskMode called while already in smask mode\");\n    }\n    const drawnWidth = this.ctx.canvas.width;\n    const drawnHeight = this.ctx.canvas.height;\n    const cacheId = \"smaskGroupAt\" + this.groupLevel;\n    const scratchCanvas = this.cachedCanvases.getCanvas(\n      cacheId,\n      drawnWidth,\n      drawnHeight\n    );\n    this.suspendedCtx = this.ctx;\n    this.ctx = scratchCanvas.context;\n    const ctx = this.ctx;\n    ctx.setTransform(...getCurrentTransform(this.suspendedCtx));\n    copyCtxState(this.suspendedCtx, ctx);\n    mirrorContextOperations(ctx, this.suspendedCtx);\n\n    this.setGState([\n      [\"BM\", \"source-over\"],\n      [\"ca\", 1],\n      [\"CA\", 1],\n    ]);\n  }\n\n  endSMaskMode() {\n    if (!this.inSMaskMode) {\n      throw new Error(\"endSMaskMode called while not in smask mode\");\n    }\n    // The soft mask is done, now restore the suspended canvas as the main\n    // drawing canvas.\n    this.ctx._removeMirroring();\n    copyCtxState(this.ctx, this.suspendedCtx);\n    this.ctx = this.suspendedCtx;\n\n    this.suspendedCtx = null;\n  }\n\n  compose(dirtyBox) {\n    if (!this.current.activeSMask) {\n      return;\n    }\n\n    if (!dirtyBox) {\n      dirtyBox = [0, 0, this.ctx.canvas.width, this.ctx.canvas.height];\n    } else {\n      dirtyBox[0] = Math.floor(dirtyBox[0]);\n      dirtyBox[1] = Math.floor(dirtyBox[1]);\n      dirtyBox[2] = Math.ceil(dirtyBox[2]);\n      dirtyBox[3] = Math.ceil(dirtyBox[3]);\n    }\n    const smask = this.current.activeSMask;\n    const suspendedCtx = this.suspendedCtx;\n\n    this.composeSMask(suspendedCtx, smask, this.ctx, dirtyBox);\n    // Whatever was drawn has been moved to the suspended canvas, now clear it\n    // out of the current canvas.\n    this.ctx.save();\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0);\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    this.ctx.restore();\n  }\n\n  composeSMask(ctx, smask, layerCtx, layerBox) {\n    const layerOffsetX = layerBox[0];\n    const layerOffsetY = layerBox[1];\n    const layerWidth = layerBox[2] - layerOffsetX;\n    const layerHeight = layerBox[3] - layerOffsetY;\n    if (layerWidth === 0 || layerHeight === 0) {\n      return;\n    }\n    this.genericComposeSMask(\n      smask.context,\n      layerCtx,\n      layerWidth,\n      layerHeight,\n      smask.subtype,\n      smask.backdrop,\n      smask.transferMap,\n      layerOffsetX,\n      layerOffsetY,\n      smask.offsetX,\n      smask.offsetY\n    );\n    ctx.save();\n    ctx.globalAlpha = 1;\n    ctx.globalCompositeOperation = \"source-over\";\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.drawImage(layerCtx.canvas, 0, 0);\n    ctx.restore();\n  }\n\n  genericComposeSMask(\n    maskCtx,\n    layerCtx,\n    width,\n    height,\n    subtype,\n    backdrop,\n    transferMap,\n    layerOffsetX,\n    layerOffsetY,\n    maskOffsetX,\n    maskOffsetY\n  ) {\n    let maskCanvas = maskCtx.canvas;\n    let maskX = layerOffsetX - maskOffsetX;\n    let maskY = layerOffsetY - maskOffsetY;\n\n    if (backdrop) {\n      if (\n        maskX < 0 ||\n        maskY < 0 ||\n        maskX + width > maskCanvas.width ||\n        maskY + height > maskCanvas.height\n      ) {\n        const canvas = this.cachedCanvases.getCanvas(\n          \"maskExtension\",\n          width,\n          height\n        );\n        const ctx = canvas.context;\n        ctx.drawImage(maskCanvas, -maskX, -maskY);\n        if (backdrop.some(c => c !== 0)) {\n          ctx.globalCompositeOperation = \"destination-atop\";\n          ctx.fillStyle = Util.makeHexColor(...backdrop);\n          ctx.fillRect(0, 0, width, height);\n          ctx.globalCompositeOperation = \"source-over\";\n        }\n\n        maskCanvas = canvas.canvas;\n        maskX = maskY = 0;\n      } else if (backdrop.some(c => c !== 0)) {\n        maskCtx.save();\n        maskCtx.globalAlpha = 1;\n        maskCtx.setTransform(1, 0, 0, 1, 0, 0);\n        const clip = new Path2D();\n        clip.rect(maskX, maskY, width, height);\n        maskCtx.clip(clip);\n        maskCtx.globalCompositeOperation = \"destination-atop\";\n        maskCtx.fillStyle = Util.makeHexColor(...backdrop);\n        maskCtx.fillRect(maskX, maskY, width, height);\n        maskCtx.restore();\n      }\n    }\n\n    layerCtx.save();\n    layerCtx.globalAlpha = 1;\n    layerCtx.setTransform(1, 0, 0, 1, 0, 0);\n\n    if (subtype === \"Alpha\" && transferMap) {\n      layerCtx.filter = this.filterFactory.addAlphaFilter(transferMap);\n    } else if (subtype === \"Luminosity\") {\n      layerCtx.filter = this.filterFactory.addLuminosityFilter(transferMap);\n    }\n\n    const clip = new Path2D();\n    clip.rect(layerOffsetX, layerOffsetY, width, height);\n    layerCtx.clip(clip);\n    layerCtx.globalCompositeOperation = \"destination-in\";\n    layerCtx.drawImage(\n      maskCanvas,\n      maskX,\n      maskY,\n      width,\n      height,\n      layerOffsetX,\n      layerOffsetY,\n      width,\n      height\n    );\n    layerCtx.restore();\n  }\n\n  save() {\n    if (this.inSMaskMode) {\n      // SMask mode may be turned on/off causing us to lose graphics state.\n      // Copy the temporary canvas state to the main(suspended) canvas to keep\n      // it in sync.\n      copyCtxState(this.ctx, this.suspendedCtx);\n      // Don't bother calling save on the temporary canvas since state is not\n      // saved there.\n      this.suspendedCtx.save();\n    } else {\n      this.ctx.save();\n    }\n    const old = this.current;\n    this.stateStack.push(old);\n    this.current = old.clone();\n  }\n\n  restore() {\n    if (this.stateStack.length === 0 && this.inSMaskMode) {\n      this.endSMaskMode();\n    }\n    if (this.stateStack.length !== 0) {\n      this.current = this.stateStack.pop();\n      if (this.inSMaskMode) {\n        // Graphics state is stored on the main(suspended) canvas. Restore its\n        // state then copy it over to the temporary canvas.\n        this.suspendedCtx.restore();\n        copyCtxState(this.suspendedCtx, this.ctx);\n      } else {\n        this.ctx.restore();\n      }\n      this.checkSMaskState();\n\n      // Ensure that the clipping path is reset (fixes issue6413.pdf).\n      this.pendingClip = null;\n\n      this._cachedScaleForStroking[0] = -1;\n      this._cachedGetSinglePixelWidth = null;\n    }\n  }\n\n  transform(a, b, c, d, e, f) {\n    this.ctx.transform(a, b, c, d, e, f);\n\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n  }\n\n  // Path\n  constructPath(ops, args, minMax) {\n    const ctx = this.ctx;\n    const current = this.current;\n    let x = current.x,\n      y = current.y;\n    let startX, startY;\n    const currentTransform = getCurrentTransform(ctx);\n\n    // Most of the time the current transform is a scaling matrix\n    // so we don't need to transform points before computing min/max:\n    // we can compute min/max first and then smartly \"apply\" the\n    // transform (see Util.scaleMinMax).\n    // For rectangle, moveTo and lineTo, min/max are computed in the\n    // worker (see evaluator.js).\n    const isScalingMatrix =\n      (currentTransform[0] === 0 && currentTransform[3] === 0) ||\n      (currentTransform[1] === 0 && currentTransform[2] === 0);\n    const minMaxForBezier = isScalingMatrix ? minMax.slice(0) : null;\n\n    for (let i = 0, j = 0, ii = ops.length; i < ii; i++) {\n      switch (ops[i] | 0) {\n        case OPS.rectangle:\n          x = args[j++];\n          y = args[j++];\n          const width = args[j++];\n          const height = args[j++];\n\n          const xw = x + width;\n          const yh = y + height;\n          ctx.moveTo(x, y);\n          if (width === 0 || height === 0) {\n            ctx.lineTo(xw, yh);\n          } else {\n            ctx.lineTo(xw, y);\n            ctx.lineTo(xw, yh);\n            ctx.lineTo(x, yh);\n          }\n          if (!isScalingMatrix) {\n            current.updateRectMinMax(currentTransform, [x, y, xw, yh]);\n          }\n          ctx.closePath();\n          break;\n        case OPS.moveTo:\n          x = args[j++];\n          y = args[j++];\n          ctx.moveTo(x, y);\n          if (!isScalingMatrix) {\n            current.updatePathMinMax(currentTransform, x, y);\n          }\n          break;\n        case OPS.lineTo:\n          x = args[j++];\n          y = args[j++];\n          ctx.lineTo(x, y);\n          if (!isScalingMatrix) {\n            current.updatePathMinMax(currentTransform, x, y);\n          }\n          break;\n        case OPS.curveTo:\n          startX = x;\n          startY = y;\n          x = args[j + 4];\n          y = args[j + 5];\n          ctx.bezierCurveTo(\n            args[j],\n            args[j + 1],\n            args[j + 2],\n            args[j + 3],\n            x,\n            y\n          );\n          current.updateCurvePathMinMax(\n            currentTransform,\n            startX,\n            startY,\n            args[j],\n            args[j + 1],\n            args[j + 2],\n            args[j + 3],\n            x,\n            y,\n            minMaxForBezier\n          );\n          j += 6;\n          break;\n        case OPS.curveTo2:\n          startX = x;\n          startY = y;\n          ctx.bezierCurveTo(\n            x,\n            y,\n            args[j],\n            args[j + 1],\n            args[j + 2],\n            args[j + 3]\n          );\n          current.updateCurvePathMinMax(\n            currentTransform,\n            startX,\n            startY,\n            x,\n            y,\n            args[j],\n            args[j + 1],\n            args[j + 2],\n            args[j + 3],\n            minMaxForBezier\n          );\n          x = args[j + 2];\n          y = args[j + 3];\n          j += 4;\n          break;\n        case OPS.curveTo3:\n          startX = x;\n          startY = y;\n          x = args[j + 2];\n          y = args[j + 3];\n          ctx.bezierCurveTo(args[j], args[j + 1], x, y, x, y);\n          current.updateCurvePathMinMax(\n            currentTransform,\n            startX,\n            startY,\n            args[j],\n            args[j + 1],\n            x,\n            y,\n            x,\n            y,\n            minMaxForBezier\n          );\n          j += 4;\n          break;\n        case OPS.closePath:\n          ctx.closePath();\n          break;\n      }\n    }\n\n    if (isScalingMatrix) {\n      current.updateScalingPathMinMax(currentTransform, minMaxForBezier);\n    }\n\n    current.setCurrentPoint(x, y);\n  }\n\n  closePath() {\n    this.ctx.closePath();\n  }\n\n  stroke(consumePath = true) {\n    const ctx = this.ctx;\n    const strokeColor = this.current.strokeColor;\n    // For stroke we want to temporarily change the global alpha to the\n    // stroking alpha.\n    ctx.globalAlpha = this.current.strokeAlpha;\n    if (this.contentVisible) {\n      if (typeof strokeColor === \"object\" && strokeColor?.getPattern) {\n        ctx.save();\n        ctx.strokeStyle = strokeColor.getPattern(\n          ctx,\n          this,\n          getCurrentTransformInverse(ctx),\n          PathType.STROKE\n        );\n        this.rescaleAndStroke(/* saveRestore */ false);\n        ctx.restore();\n      } else {\n        this.rescaleAndStroke(/* saveRestore */ true);\n      }\n    }\n    if (consumePath) {\n      this.consumePath(this.current.getClippedPathBoundingBox());\n    }\n    // Restore the global alpha to the fill alpha\n    ctx.globalAlpha = this.current.fillAlpha;\n  }\n\n  closeStroke() {\n    this.closePath();\n    this.stroke();\n  }\n\n  fill(consumePath = true) {\n    const ctx = this.ctx;\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n    let needRestore = false;\n\n    if (isPatternFill) {\n      ctx.save();\n      ctx.fillStyle = fillColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.FILL\n      );\n      needRestore = true;\n    }\n\n    const intersect = this.current.getClippedPathBoundingBox();\n    if (this.contentVisible && intersect !== null) {\n      if (this.pendingEOFill) {\n        ctx.fill(\"evenodd\");\n        this.pendingEOFill = false;\n      } else {\n        ctx.fill();\n      }\n    }\n\n    if (needRestore) {\n      ctx.restore();\n    }\n    if (consumePath) {\n      this.consumePath(intersect);\n    }\n  }\n\n  eoFill() {\n    this.pendingEOFill = true;\n    this.fill();\n  }\n\n  fillStroke() {\n    this.fill(false);\n    this.stroke(false);\n\n    this.consumePath();\n  }\n\n  eoFillStroke() {\n    this.pendingEOFill = true;\n    this.fillStroke();\n  }\n\n  closeFillStroke() {\n    this.closePath();\n    this.fillStroke();\n  }\n\n  closeEOFillStroke() {\n    this.pendingEOFill = true;\n    this.closePath();\n    this.fillStroke();\n  }\n\n  endPath() {\n    this.consumePath();\n  }\n\n  // Clipping\n  clip() {\n    this.pendingClip = NORMAL_CLIP;\n  }\n\n  eoClip() {\n    this.pendingClip = EO_CLIP;\n  }\n\n  // Text\n  beginText() {\n    this.current.textMatrix = IDENTITY_MATRIX;\n    this.current.textMatrixScale = 1;\n    this.current.x = this.current.lineX = 0;\n    this.current.y = this.current.lineY = 0;\n  }\n\n  endText() {\n    const paths = this.pendingTextPaths;\n    const ctx = this.ctx;\n    if (paths === undefined) {\n      ctx.beginPath();\n      return;\n    }\n\n    ctx.save();\n    ctx.beginPath();\n    for (const path of paths) {\n      ctx.setTransform(...path.transform);\n      ctx.translate(path.x, path.y);\n      path.addToPath(ctx, path.fontSize);\n    }\n    ctx.restore();\n    ctx.clip();\n    ctx.beginPath();\n    delete this.pendingTextPaths;\n  }\n\n  setCharSpacing(spacing) {\n    this.current.charSpacing = spacing;\n  }\n\n  setWordSpacing(spacing) {\n    this.current.wordSpacing = spacing;\n  }\n\n  setHScale(scale) {\n    this.current.textHScale = scale / 100;\n  }\n\n  setLeading(leading) {\n    this.current.leading = -leading;\n  }\n\n  setFont(fontRefName, size) {\n    const fontObj = this.commonObjs.get(fontRefName);\n    const current = this.current;\n\n    if (!fontObj) {\n      throw new Error(`Can't find font for ${fontRefName}`);\n    }\n    current.fontMatrix = fontObj.fontMatrix || FONT_IDENTITY_MATRIX;\n\n    // A valid matrix needs all main diagonal elements to be non-zero\n    // This also ensures we bypass FF bugzilla bug #719844.\n    if (current.fontMatrix[0] === 0 || current.fontMatrix[3] === 0) {\n      warn(\"Invalid font matrix for font \" + fontRefName);\n    }\n\n    // The spec for Tf (setFont) says that 'size' specifies the font 'scale',\n    // and in some docs this can be negative (inverted x-y axes).\n    if (size < 0) {\n      size = -size;\n      current.fontDirection = -1;\n    } else {\n      current.fontDirection = 1;\n    }\n\n    this.current.font = fontObj;\n    this.current.fontSize = size;\n\n    if (fontObj.isType3Font) {\n      return; // we don't need ctx.font for Type3 fonts\n    }\n\n    const name = fontObj.loadedName || \"sans-serif\";\n    const typeface =\n      fontObj.systemFontInfo?.css || `\"${name}\", ${fontObj.fallbackName}`;\n\n    let bold = \"normal\";\n    if (fontObj.black) {\n      bold = \"900\";\n    } else if (fontObj.bold) {\n      bold = \"bold\";\n    }\n    const italic = fontObj.italic ? \"italic\" : \"normal\";\n\n    // Some font backends cannot handle fonts below certain size.\n    // Keeping the font at minimal size and using the fontSizeScale to change\n    // the current transformation matrix before the fillText/strokeText.\n    // See https://bugzilla.mozilla.org/show_bug.cgi?id=726227\n    let browserFontSize = size;\n    if (size < MIN_FONT_SIZE) {\n      browserFontSize = MIN_FONT_SIZE;\n    } else if (size > MAX_FONT_SIZE) {\n      browserFontSize = MAX_FONT_SIZE;\n    }\n    this.current.fontSizeScale = size / browserFontSize;\n\n    this.ctx.font = `${italic} ${bold} ${browserFontSize}px ${typeface}`;\n  }\n\n  setTextRenderingMode(mode) {\n    this.current.textRenderingMode = mode;\n  }\n\n  setTextRise(rise) {\n    this.current.textRise = rise;\n  }\n\n  moveText(x, y) {\n    this.current.x = this.current.lineX += x;\n    this.current.y = this.current.lineY += y;\n  }\n\n  setLeadingMoveText(x, y) {\n    this.setLeading(-y);\n    this.moveText(x, y);\n  }\n\n  setTextMatrix(a, b, c, d, e, f) {\n    this.current.textMatrix = [a, b, c, d, e, f];\n    this.current.textMatrixScale = Math.hypot(a, b);\n\n    this.current.x = this.current.lineX = 0;\n    this.current.y = this.current.lineY = 0;\n  }\n\n  nextLine() {\n    this.moveText(0, this.current.leading);\n  }\n\n  paintChar(character, x, y, patternTransform) {\n    const ctx = this.ctx;\n    const current = this.current;\n    const font = current.font;\n    const textRenderingMode = current.textRenderingMode;\n    const fontSize = current.fontSize / current.fontSizeScale;\n    const fillStrokeMode =\n      textRenderingMode & TextRenderingMode.FILL_STROKE_MASK;\n    const isAddToPathSet = !!(\n      textRenderingMode & TextRenderingMode.ADD_TO_PATH_FLAG\n    );\n    const patternFill = current.patternFill && !font.missingFile;\n\n    let addToPath;\n    if (font.disableFontFace || isAddToPathSet || patternFill) {\n      addToPath = font.getPathGenerator(this.commonObjs, character);\n    }\n\n    if (font.disableFontFace || patternFill) {\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.beginPath();\n      addToPath(ctx, fontSize);\n      if (patternTransform) {\n        ctx.setTransform(...patternTransform);\n      }\n      if (\n        fillStrokeMode === TextRenderingMode.FILL ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        ctx.fill();\n      }\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        ctx.stroke();\n      }\n      ctx.restore();\n    } else {\n      if (\n        fillStrokeMode === TextRenderingMode.FILL ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        ctx.fillText(character, x, y);\n      }\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        ctx.strokeText(character, x, y);\n      }\n    }\n\n    if (isAddToPathSet) {\n      const paths = (this.pendingTextPaths ||= []);\n      paths.push({\n        transform: getCurrentTransform(ctx),\n        x,\n        y,\n        fontSize,\n        addToPath,\n      });\n    }\n  }\n\n  get isFontSubpixelAAEnabled() {\n    // Checks if anti-aliasing is enabled when scaled text is painted.\n    // On Windows GDI scaled fonts looks bad.\n    const { context: ctx } = this.cachedCanvases.getCanvas(\n      \"isFontSubpixelAAEnabled\",\n      10,\n      10\n    );\n    ctx.scale(1.5, 1);\n    ctx.fillText(\"I\", 0, 10);\n    const data = ctx.getImageData(0, 0, 10, 10).data;\n    let enabled = false;\n    for (let i = 3; i < data.length; i += 4) {\n      if (data[i] > 0 && data[i] < 255) {\n        enabled = true;\n        break;\n      }\n    }\n    return shadow(this, \"isFontSubpixelAAEnabled\", enabled);\n  }\n\n  showText(glyphs) {\n    const current = this.current;\n    const font = current.font;\n    if (font.isType3Font) {\n      return this.showType3Text(glyphs);\n    }\n\n    const fontSize = current.fontSize;\n    if (fontSize === 0) {\n      return undefined;\n    }\n\n    const ctx = this.ctx;\n    const fontSizeScale = current.fontSizeScale;\n    const charSpacing = current.charSpacing;\n    const wordSpacing = current.wordSpacing;\n    const fontDirection = current.fontDirection;\n    const textHScale = current.textHScale * fontDirection;\n    const glyphsLength = glyphs.length;\n    const vertical = font.vertical;\n    const spacingDir = vertical ? 1 : -1;\n    const defaultVMetrics = font.defaultVMetrics;\n    const widthAdvanceScale = fontSize * current.fontMatrix[0];\n\n    const simpleFillText =\n      current.textRenderingMode === TextRenderingMode.FILL &&\n      !font.disableFontFace &&\n      !current.patternFill;\n\n    ctx.save();\n    ctx.transform(...current.textMatrix);\n    ctx.translate(current.x, current.y + current.textRise);\n\n    if (fontDirection > 0) {\n      ctx.scale(textHScale, -1);\n    } else {\n      ctx.scale(textHScale, 1);\n    }\n\n    let patternTransform;\n    if (current.patternFill) {\n      ctx.save();\n      const pattern = current.fillColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.FILL\n      );\n      patternTransform = getCurrentTransform(ctx);\n      ctx.restore();\n      ctx.fillStyle = pattern;\n    }\n\n    let lineWidth = current.lineWidth;\n    const scale = current.textMatrixScale;\n    if (scale === 0 || lineWidth === 0) {\n      const fillStrokeMode =\n        current.textRenderingMode & TextRenderingMode.FILL_STROKE_MASK;\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        lineWidth = this.getSinglePixelWidth();\n      }\n    } else {\n      lineWidth /= scale;\n    }\n\n    if (fontSizeScale !== 1.0) {\n      ctx.scale(fontSizeScale, fontSizeScale);\n      lineWidth /= fontSizeScale;\n    }\n\n    ctx.lineWidth = lineWidth;\n\n    if (font.isInvalidPDFjsFont) {\n      const chars = [];\n      let width = 0;\n      for (const glyph of glyphs) {\n        chars.push(glyph.unicode);\n        width += glyph.width;\n      }\n      ctx.fillText(chars.join(\"\"), 0, 0);\n      current.x += width * widthAdvanceScale * textHScale;\n      ctx.restore();\n      this.compose();\n\n      return undefined;\n    }\n\n    let x = 0,\n      i;\n    for (i = 0; i < glyphsLength; ++i) {\n      const glyph = glyphs[i];\n      if (typeof glyph === \"number\") {\n        x += (spacingDir * glyph * fontSize) / 1000;\n        continue;\n      }\n\n      let restoreNeeded = false;\n      const spacing = (glyph.isSpace ? wordSpacing : 0) + charSpacing;\n      const character = glyph.fontChar;\n      const accent = glyph.accent;\n      let scaledX, scaledY;\n      let width = glyph.width;\n      if (vertical) {\n        const vmetric = glyph.vmetric || defaultVMetrics;\n        const vx =\n          -(glyph.vmetric ? vmetric[1] : width * 0.5) * widthAdvanceScale;\n        const vy = vmetric[2] * widthAdvanceScale;\n\n        width = vmetric ? -vmetric[0] : width;\n        scaledX = vx / fontSizeScale;\n        scaledY = (x + vy) / fontSizeScale;\n      } else {\n        scaledX = x / fontSizeScale;\n        scaledY = 0;\n      }\n\n      if (font.remeasure && width > 0) {\n        // Some standard fonts may not have the exact width: rescale per\n        // character if measured width is greater than expected glyph width\n        // and subpixel-aa is enabled, otherwise just center the glyph.\n        const measuredWidth =\n          ((ctx.measureText(character).width * 1000) / fontSize) *\n          fontSizeScale;\n        if (width < measuredWidth && this.isFontSubpixelAAEnabled) {\n          const characterScaleX = width / measuredWidth;\n          restoreNeeded = true;\n          ctx.save();\n          ctx.scale(characterScaleX, 1);\n          scaledX /= characterScaleX;\n        } else if (width !== measuredWidth) {\n          scaledX +=\n            (((width - measuredWidth) / 2000) * fontSize) / fontSizeScale;\n        }\n      }\n\n      // Only attempt to draw the glyph if it is actually in the embedded font\n      // file or if there isn't a font file so the fallback font is shown.\n      if (this.contentVisible && (glyph.isInFont || font.missingFile)) {\n        if (simpleFillText && !accent) {\n          // common case\n          ctx.fillText(character, scaledX, scaledY);\n        } else {\n          this.paintChar(character, scaledX, scaledY, patternTransform);\n          if (accent) {\n            const scaledAccentX =\n              scaledX + (fontSize * accent.offset.x) / fontSizeScale;\n            const scaledAccentY =\n              scaledY - (fontSize * accent.offset.y) / fontSizeScale;\n            this.paintChar(\n              accent.fontChar,\n              scaledAccentX,\n              scaledAccentY,\n              patternTransform\n            );\n          }\n        }\n      }\n\n      const charWidth = vertical\n        ? width * widthAdvanceScale - spacing * fontDirection\n        : width * widthAdvanceScale + spacing * fontDirection;\n      x += charWidth;\n\n      if (restoreNeeded) {\n        ctx.restore();\n      }\n    }\n    if (vertical) {\n      current.y -= x;\n    } else {\n      current.x += x * textHScale;\n    }\n    ctx.restore();\n    this.compose();\n\n    return undefined;\n  }\n\n  showType3Text(glyphs) {\n    // Type3 fonts - each glyph is a \"mini-PDF\"\n    const ctx = this.ctx;\n    const current = this.current;\n    const font = current.font;\n    const fontSize = current.fontSize;\n    const fontDirection = current.fontDirection;\n    const spacingDir = font.vertical ? 1 : -1;\n    const charSpacing = current.charSpacing;\n    const wordSpacing = current.wordSpacing;\n    const textHScale = current.textHScale * fontDirection;\n    const fontMatrix = current.fontMatrix || FONT_IDENTITY_MATRIX;\n    const glyphsLength = glyphs.length;\n    const isTextInvisible =\n      current.textRenderingMode === TextRenderingMode.INVISIBLE;\n    let i, glyph, width, spacingLength;\n\n    if (isTextInvisible || fontSize === 0) {\n      return;\n    }\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n\n    ctx.save();\n    ctx.transform(...current.textMatrix);\n    ctx.translate(current.x, current.y);\n\n    ctx.scale(textHScale, fontDirection);\n\n    for (i = 0; i < glyphsLength; ++i) {\n      glyph = glyphs[i];\n      if (typeof glyph === \"number\") {\n        spacingLength = (spacingDir * glyph * fontSize) / 1000;\n        this.ctx.translate(spacingLength, 0);\n        current.x += spacingLength * textHScale;\n        continue;\n      }\n\n      const spacing = (glyph.isSpace ? wordSpacing : 0) + charSpacing;\n      const operatorList = font.charProcOperatorList[glyph.operatorListId];\n      if (!operatorList) {\n        warn(`Type3 character \"${glyph.operatorListId}\" is not available.`);\n        continue;\n      }\n      if (this.contentVisible) {\n        this.processingType3 = glyph;\n        this.save();\n        ctx.scale(fontSize, fontSize);\n        ctx.transform(...fontMatrix);\n        this.executeOperatorList(operatorList);\n        this.restore();\n      }\n\n      const transformed = Util.applyTransform([glyph.width, 0], fontMatrix);\n      width = transformed[0] * fontSize + spacing;\n\n      ctx.translate(width, 0);\n      current.x += width * textHScale;\n    }\n    ctx.restore();\n    this.processingType3 = null;\n  }\n\n  // Type3 fonts\n  setCharWidth(xWidth, yWidth) {\n    // We can safely ignore this since the width should be the same\n    // as the width in the Widths array.\n  }\n\n  setCharWidthAndBounds(xWidth, yWidth, llx, lly, urx, ury) {\n    this.ctx.rect(llx, lly, urx - llx, ury - lly);\n    this.ctx.clip();\n    this.endPath();\n  }\n\n  // Color\n  getColorN_Pattern(IR) {\n    let pattern;\n    if (IR[0] === \"TilingPattern\") {\n      const color = IR[1];\n      const baseTransform = this.baseTransform || getCurrentTransform(this.ctx);\n      const canvasGraphicsFactory = {\n        createCanvasGraphics: ctx =>\n          new CanvasGraphics(\n            ctx,\n            this.commonObjs,\n            this.objs,\n            this.canvasFactory,\n            this.filterFactory,\n            {\n              optionalContentConfig: this.optionalContentConfig,\n              markedContentStack: this.markedContentStack,\n            }\n          ),\n      };\n      pattern = new TilingPattern(\n        IR,\n        color,\n        this.ctx,\n        canvasGraphicsFactory,\n        baseTransform\n      );\n    } else {\n      pattern = this._getPattern(IR[1], IR[2]);\n    }\n    return pattern;\n  }\n\n  setStrokeColorN() {\n    this.current.strokeColor = this.getColorN_Pattern(arguments);\n  }\n\n  setFillColorN() {\n    this.current.fillColor = this.getColorN_Pattern(arguments);\n    this.current.patternFill = true;\n  }\n\n  setStrokeRGBColor(r, g, b) {\n    this.ctx.strokeStyle = this.current.strokeColor = Util.makeHexColor(\n      r,\n      g,\n      b\n    );\n  }\n\n  setStrokeTransparent() {\n    this.ctx.strokeStyle = this.current.strokeColor = \"transparent\";\n  }\n\n  setFillRGBColor(r, g, b) {\n    this.ctx.fillStyle = this.current.fillColor = Util.makeHexColor(r, g, b);\n    this.current.patternFill = false;\n  }\n\n  setFillTransparent() {\n    this.ctx.fillStyle = this.current.fillColor = \"transparent\";\n    this.current.patternFill = false;\n  }\n\n  _getPattern(objId, matrix = null) {\n    let pattern;\n    if (this.cachedPatterns.has(objId)) {\n      pattern = this.cachedPatterns.get(objId);\n    } else {\n      pattern = getShadingPattern(this.getObject(objId));\n      this.cachedPatterns.set(objId, pattern);\n    }\n    if (matrix) {\n      pattern.matrix = matrix;\n    }\n    return pattern;\n  }\n\n  shadingFill(objId) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n\n    this.save();\n    const pattern = this._getPattern(objId);\n    ctx.fillStyle = pattern.getPattern(\n      ctx,\n      this,\n      getCurrentTransformInverse(ctx),\n      PathType.SHADING\n    );\n\n    const inv = getCurrentTransformInverse(ctx);\n    if (inv) {\n      const { width, height } = ctx.canvas;\n      const [x0, y0, x1, y1] = Util.getAxialAlignedBoundingBox(\n        [0, 0, width, height],\n        inv\n      );\n\n      this.ctx.fillRect(x0, y0, x1 - x0, y1 - y0);\n    } else {\n      // HACK to draw the gradient onto an infinite rectangle.\n      // PDF gradients are drawn across the entire image while\n      // Canvas only allows gradients to be drawn in a rectangle\n      // The following bug should allow us to remove this.\n      // https://bugzilla.mozilla.org/show_bug.cgi?id=664884\n\n      this.ctx.fillRect(-1e10, -1e10, 2e10, 2e10);\n    }\n\n    this.compose(this.current.getClippedPathBoundingBox());\n    this.restore();\n  }\n\n  // Images\n  beginInlineImage() {\n    unreachable(\"Should not call beginInlineImage\");\n  }\n\n  beginImageData() {\n    unreachable(\"Should not call beginImageData\");\n  }\n\n  paintFormXObjectBegin(matrix, bbox) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.save();\n    this.baseTransformStack.push(this.baseTransform);\n\n    if (matrix) {\n      this.transform(...matrix);\n    }\n    this.baseTransform = getCurrentTransform(this.ctx);\n\n    if (bbox) {\n      const width = bbox[2] - bbox[0];\n      const height = bbox[3] - bbox[1];\n      this.ctx.rect(bbox[0], bbox[1], width, height);\n      this.current.updateRectMinMax(getCurrentTransform(this.ctx), bbox);\n      this.clip();\n      this.endPath();\n    }\n  }\n\n  paintFormXObjectEnd() {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.restore();\n    this.baseTransform = this.baseTransformStack.pop();\n  }\n\n  beginGroup(group) {\n    if (!this.contentVisible) {\n      return;\n    }\n\n    this.save();\n    // If there's an active soft mask we don't want it enabled for the group, so\n    // clear it out. The mask and suspended canvas will be restored in endGroup.\n    if (this.inSMaskMode) {\n      this.endSMaskMode();\n      this.current.activeSMask = null;\n    }\n\n    const currentCtx = this.ctx;\n    // TODO non-isolated groups - according to Rik at adobe non-isolated\n    // group results aren't usually that different and they even have tools\n    // that ignore this setting. Notes from Rik on implementing:\n    // - When you encounter an transparency group, create a new canvas with\n    // the dimensions of the bbox\n    // - copy the content from the previous canvas to the new canvas\n    // - draw as usual\n    // - remove the backdrop alpha:\n    // alphaNew = 1 - (1 - alpha)/(1 - alphaBackdrop) with 'alpha' the alpha\n    // value of your transparency group and 'alphaBackdrop' the alpha of the\n    // backdrop\n    // - remove background color:\n    // colorNew = color - alphaNew *colorBackdrop /(1 - alphaNew)\n    if (!group.isolated) {\n      info(\"TODO: Support non-isolated groups.\");\n    }\n\n    // TODO knockout - supposedly possible with the clever use of compositing\n    // modes.\n    if (group.knockout) {\n      warn(\"Knockout groups not supported.\");\n    }\n\n    const currentTransform = getCurrentTransform(currentCtx);\n    if (group.matrix) {\n      currentCtx.transform(...group.matrix);\n    }\n    if (!group.bbox) {\n      throw new Error(\"Bounding box is required.\");\n    }\n\n    // Based on the current transform figure out how big the bounding box\n    // will actually be.\n    let bounds = Util.getAxialAlignedBoundingBox(\n      group.bbox,\n      getCurrentTransform(currentCtx)\n    );\n    // Clip the bounding box to the current canvas.\n    const canvasBounds = [\n      0,\n      0,\n      currentCtx.canvas.width,\n      currentCtx.canvas.height,\n    ];\n    bounds = Util.intersect(bounds, canvasBounds) || [0, 0, 0, 0];\n    // Use ceil in case we're between sizes so we don't create canvas that is\n    // too small and make the canvas at least 1x1 pixels.\n    const offsetX = Math.floor(bounds[0]);\n    const offsetY = Math.floor(bounds[1]);\n    const drawnWidth = Math.max(Math.ceil(bounds[2]) - offsetX, 1);\n    const drawnHeight = Math.max(Math.ceil(bounds[3]) - offsetY, 1);\n\n    this.current.startNewPathAndClipBox([0, 0, drawnWidth, drawnHeight]);\n\n    let cacheId = \"groupAt\" + this.groupLevel;\n    if (group.smask) {\n      // Using two cache entries is case if masks are used one after another.\n      cacheId += \"_smask_\" + (this.smaskCounter++ % 2);\n    }\n    const scratchCanvas = this.cachedCanvases.getCanvas(\n      cacheId,\n      drawnWidth,\n      drawnHeight\n    );\n    const groupCtx = scratchCanvas.context;\n\n    // Since we created a new canvas that is just the size of the bounding box\n    // we have to translate the group ctx.\n    groupCtx.translate(-offsetX, -offsetY);\n    groupCtx.transform(...currentTransform);\n\n    if (group.smask) {\n      // Saving state and cached mask to be used in setGState.\n      this.smaskStack.push({\n        canvas: scratchCanvas.canvas,\n        context: groupCtx,\n        offsetX,\n        offsetY,\n        subtype: group.smask.subtype,\n        backdrop: group.smask.backdrop,\n        transferMap: group.smask.transferMap || null,\n        startTransformInverse: null, // used during suspend operation\n      });\n    } else {\n      // Setup the current ctx so when the group is popped we draw it at the\n      // right location.\n      currentCtx.setTransform(1, 0, 0, 1, 0, 0);\n      currentCtx.translate(offsetX, offsetY);\n      currentCtx.save();\n    }\n    // The transparency group inherits all off the current graphics state\n    // except the blend mode, soft mask, and alpha constants.\n    copyCtxState(currentCtx, groupCtx);\n    this.ctx = groupCtx;\n    this.setGState([\n      [\"BM\", \"source-over\"],\n      [\"ca\", 1],\n      [\"CA\", 1],\n    ]);\n    this.groupStack.push(currentCtx);\n    this.groupLevel++;\n  }\n\n  endGroup(group) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.groupLevel--;\n    const groupCtx = this.ctx;\n    const ctx = this.groupStack.pop();\n    this.ctx = ctx;\n    // Turn off image smoothing to avoid sub pixel interpolation which can\n    // look kind of blurry for some pdfs.\n    this.ctx.imageSmoothingEnabled = false;\n\n    if (group.smask) {\n      this.tempSMask = this.smaskStack.pop();\n      this.restore();\n    } else {\n      this.ctx.restore();\n      const currentMtx = getCurrentTransform(this.ctx);\n      this.restore();\n      this.ctx.save();\n      this.ctx.setTransform(...currentMtx);\n      const dirtyBox = Util.getAxialAlignedBoundingBox(\n        [0, 0, groupCtx.canvas.width, groupCtx.canvas.height],\n        currentMtx\n      );\n      this.ctx.drawImage(groupCtx.canvas, 0, 0);\n      this.ctx.restore();\n      this.compose(dirtyBox);\n    }\n  }\n\n  beginAnnotation(id, rect, transform, matrix, hasOwnCanvas) {\n    // The annotations are drawn just after the page content.\n    // The page content drawing can potentially have set a transform,\n    // a clipping path, whatever...\n    // So in order to have something clean, we restore the initial state.\n    this.#restoreInitialState();\n    resetCtxToDefault(this.ctx);\n\n    this.ctx.save();\n    this.save();\n\n    if (this.baseTransform) {\n      this.ctx.setTransform(...this.baseTransform);\n    }\n\n    if (rect) {\n      const width = rect[2] - rect[0];\n      const height = rect[3] - rect[1];\n\n      if (hasOwnCanvas && this.annotationCanvasMap) {\n        transform = transform.slice();\n        transform[4] -= rect[0];\n        transform[5] -= rect[1];\n\n        rect = rect.slice();\n        rect[0] = rect[1] = 0;\n        rect[2] = width;\n        rect[3] = height;\n\n        const [scaleX, scaleY] = Util.singularValueDecompose2dScale(\n          getCurrentTransform(this.ctx)\n        );\n        const { viewportScale } = this;\n        const canvasWidth = Math.ceil(\n          width * this.outputScaleX * viewportScale\n        );\n        const canvasHeight = Math.ceil(\n          height * this.outputScaleY * viewportScale\n        );\n\n        this.annotationCanvas = this.canvasFactory.create(\n          canvasWidth,\n          canvasHeight\n        );\n        const { canvas, context } = this.annotationCanvas;\n        this.annotationCanvasMap.set(id, canvas);\n        this.annotationCanvas.savedCtx = this.ctx;\n        this.ctx = context;\n        this.ctx.save();\n        this.ctx.setTransform(scaleX, 0, 0, -scaleY, 0, height * scaleY);\n\n        resetCtxToDefault(this.ctx);\n      } else {\n        resetCtxToDefault(this.ctx);\n\n        this.ctx.rect(rect[0], rect[1], width, height);\n        this.ctx.clip();\n        this.endPath();\n      }\n    }\n\n    this.current = new CanvasExtraState(\n      this.ctx.canvas.width,\n      this.ctx.canvas.height\n    );\n\n    this.transform(...transform);\n    this.transform(...matrix);\n  }\n\n  endAnnotation() {\n    if (this.annotationCanvas) {\n      this.ctx.restore();\n      this.#drawFilter();\n\n      this.ctx = this.annotationCanvas.savedCtx;\n      delete this.annotationCanvas.savedCtx;\n      delete this.annotationCanvas;\n    }\n  }\n\n  paintImageMaskXObject(img) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const count = img.count;\n    img = this.getObject(img.data, img);\n    img.count = count;\n\n    const ctx = this.ctx;\n    const glyph = this.processingType3;\n\n    if (glyph) {\n      if (glyph.compiled === undefined) {\n        glyph.compiled = compileType3Glyph(img);\n      }\n\n      if (glyph.compiled) {\n        glyph.compiled(ctx);\n        return;\n      }\n    }\n    const mask = this._createMaskCanvas(img);\n    const maskCanvas = mask.canvas;\n\n    ctx.save();\n    // The mask is drawn with the transform applied. Reset the current\n    // transform to draw to the identity.\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.drawImage(maskCanvas, mask.offsetX, mask.offsetY);\n    ctx.restore();\n    this.compose();\n  }\n\n  paintImageMaskXObjectRepeat(\n    img,\n    scaleX,\n    skewX = 0,\n    skewY = 0,\n    scaleY,\n    positions\n  ) {\n    if (!this.contentVisible) {\n      return;\n    }\n\n    img = this.getObject(img.data, img);\n\n    const ctx = this.ctx;\n    ctx.save();\n    const currentTransform = getCurrentTransform(ctx);\n    ctx.transform(scaleX, skewX, skewY, scaleY, 0, 0);\n    const mask = this._createMaskCanvas(img);\n\n    ctx.setTransform(\n      1,\n      0,\n      0,\n      1,\n      mask.offsetX - currentTransform[4],\n      mask.offsetY - currentTransform[5]\n    );\n    for (let i = 0, ii = positions.length; i < ii; i += 2) {\n      const trans = Util.transform(currentTransform, [\n        scaleX,\n        skewX,\n        skewY,\n        scaleY,\n        positions[i],\n        positions[i + 1],\n      ]);\n\n      const [x, y] = Util.applyTransform([0, 0], trans);\n      ctx.drawImage(mask.canvas, x, y);\n    }\n    ctx.restore();\n    this.compose();\n  }\n\n  paintImageMaskXObjectGroup(images) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n\n    for (const image of images) {\n      const { data, width, height, transform } = image;\n\n      const maskCanvas = this.cachedCanvases.getCanvas(\n        \"maskCanvas\",\n        width,\n        height\n      );\n      const maskCtx = maskCanvas.context;\n      maskCtx.save();\n\n      const img = this.getObject(data, image);\n      putBinaryImageMask(maskCtx, img);\n\n      maskCtx.globalCompositeOperation = \"source-in\";\n\n      maskCtx.fillStyle = isPatternFill\n        ? fillColor.getPattern(\n            maskCtx,\n            this,\n            getCurrentTransformInverse(ctx),\n            PathType.FILL\n          )\n        : fillColor;\n      maskCtx.fillRect(0, 0, width, height);\n\n      maskCtx.restore();\n\n      ctx.save();\n      ctx.transform(...transform);\n      ctx.scale(1, -1);\n      drawImageAtIntegerCoords(\n        ctx,\n        maskCanvas.canvas,\n        0,\n        0,\n        width,\n        height,\n        0,\n        -1,\n        1,\n        1\n      );\n      ctx.restore();\n    }\n    this.compose();\n  }\n\n  paintImageXObject(objId) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const imgData = this.getObject(objId);\n    if (!imgData) {\n      warn(\"Dependent image isn't ready yet\");\n      return;\n    }\n\n    this.paintInlineImageXObject(imgData);\n  }\n\n  paintImageXObjectRepeat(objId, scaleX, scaleY, positions) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const imgData = this.getObject(objId);\n    if (!imgData) {\n      warn(\"Dependent image isn't ready yet\");\n      return;\n    }\n\n    const width = imgData.width;\n    const height = imgData.height;\n    const map = [];\n    for (let i = 0, ii = positions.length; i < ii; i += 2) {\n      map.push({\n        transform: [scaleX, 0, 0, scaleY, positions[i], positions[i + 1]],\n        x: 0,\n        y: 0,\n        w: width,\n        h: height,\n      });\n    }\n    this.paintInlineImageXObjectGroup(imgData, map);\n  }\n\n  applyTransferMapsToCanvas(ctx) {\n    if (this.current.transferMaps !== \"none\") {\n      ctx.filter = this.current.transferMaps;\n      ctx.drawImage(ctx.canvas, 0, 0);\n      ctx.filter = \"none\";\n    }\n    return ctx.canvas;\n  }\n\n  applyTransferMapsToBitmap(imgData) {\n    if (this.current.transferMaps === \"none\") {\n      return imgData.bitmap;\n    }\n    const { bitmap, width, height } = imgData;\n    const tmpCanvas = this.cachedCanvases.getCanvas(\n      \"inlineImage\",\n      width,\n      height\n    );\n    const tmpCtx = tmpCanvas.context;\n    tmpCtx.filter = this.current.transferMaps;\n    tmpCtx.drawImage(bitmap, 0, 0);\n    tmpCtx.filter = \"none\";\n\n    return tmpCanvas.canvas;\n  }\n\n  paintInlineImageXObject(imgData) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const width = imgData.width;\n    const height = imgData.height;\n    const ctx = this.ctx;\n\n    this.save();\n\n    if (\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      !isNodeJS\n    ) {\n      // The filter, if any, will be applied in applyTransferMapsToBitmap.\n      // It must be applied to the image before rescaling else some artifacts\n      // could appear.\n      // The final restore will reset it to its value.\n      const { filter } = ctx;\n      if (filter !== \"none\" && filter !== \"\") {\n        ctx.filter = \"none\";\n      }\n    }\n\n    // scale the image to the unit square\n    ctx.scale(1 / width, -1 / height);\n\n    let imgToPaint;\n    if (imgData.bitmap) {\n      imgToPaint = this.applyTransferMapsToBitmap(imgData);\n    } else if (\n      (typeof HTMLElement === \"function\" && imgData instanceof HTMLElement) ||\n      !imgData.data\n    ) {\n      // typeof check is needed due to node.js support, see issue #8489\n      imgToPaint = imgData;\n    } else {\n      const tmpCanvas = this.cachedCanvases.getCanvas(\n        \"inlineImage\",\n        width,\n        height\n      );\n      const tmpCtx = tmpCanvas.context;\n      putBinaryImageData(tmpCtx, imgData);\n      imgToPaint = this.applyTransferMapsToCanvas(tmpCtx);\n    }\n\n    const scaled = this._scaleImage(\n      imgToPaint,\n      getCurrentTransformInverse(ctx)\n    );\n    ctx.imageSmoothingEnabled = getImageSmoothingEnabled(\n      getCurrentTransform(ctx),\n      imgData.interpolate\n    );\n\n    drawImageAtIntegerCoords(\n      ctx,\n      scaled.img,\n      0,\n      0,\n      scaled.paintWidth,\n      scaled.paintHeight,\n      0,\n      -height,\n      width,\n      height\n    );\n    this.compose();\n    this.restore();\n  }\n\n  paintInlineImageXObjectGroup(imgData, map) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n    let imgToPaint;\n    if (imgData.bitmap) {\n      imgToPaint = imgData.bitmap;\n    } else {\n      const w = imgData.width;\n      const h = imgData.height;\n\n      const tmpCanvas = this.cachedCanvases.getCanvas(\"inlineImage\", w, h);\n      const tmpCtx = tmpCanvas.context;\n      putBinaryImageData(tmpCtx, imgData);\n      imgToPaint = this.applyTransferMapsToCanvas(tmpCtx);\n    }\n\n    for (const entry of map) {\n      ctx.save();\n      ctx.transform(...entry.transform);\n      ctx.scale(1, -1);\n      drawImageAtIntegerCoords(\n        ctx,\n        imgToPaint,\n        entry.x,\n        entry.y,\n        entry.w,\n        entry.h,\n        0,\n        -1,\n        1,\n        1\n      );\n      ctx.restore();\n    }\n    this.compose();\n  }\n\n  paintSolidColorImageMask() {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.ctx.fillRect(0, 0, 1, 1);\n    this.compose();\n  }\n\n  // Marked content\n\n  markPoint(tag) {\n    // TODO Marked content.\n  }\n\n  markPointProps(tag, properties) {\n    // TODO Marked content.\n  }\n\n  beginMarkedContent(tag) {\n    this.markedContentStack.push({\n      visible: true,\n    });\n  }\n\n  beginMarkedContentProps(tag, properties) {\n    if (tag === \"OC\") {\n      this.markedContentStack.push({\n        visible: this.optionalContentConfig.isVisible(properties),\n      });\n    } else {\n      this.markedContentStack.push({\n        visible: true,\n      });\n    }\n    this.contentVisible = this.isContentVisible();\n  }\n\n  endMarkedContent() {\n    this.markedContentStack.pop();\n    this.contentVisible = this.isContentVisible();\n  }\n\n  // Compatibility\n\n  beginCompat() {\n    // TODO ignore undefined operators (should we do that anyway?)\n  }\n\n  endCompat() {\n    // TODO stop ignoring undefined operators\n  }\n\n  // Helper functions\n\n  consumePath(clipBox) {\n    const isEmpty = this.current.isEmptyClip();\n    if (this.pendingClip) {\n      this.current.updateClipFromPath();\n    }\n    if (!this.pendingClip) {\n      this.compose(clipBox);\n    }\n    const ctx = this.ctx;\n    if (this.pendingClip) {\n      if (!isEmpty) {\n        if (this.pendingClip === EO_CLIP) {\n          ctx.clip(\"evenodd\");\n        } else {\n          ctx.clip();\n        }\n      }\n      this.pendingClip = null;\n    }\n    this.current.startNewPathAndClipBox(this.current.clipBox);\n    ctx.beginPath();\n  }\n\n  getSinglePixelWidth() {\n    if (!this._cachedGetSinglePixelWidth) {\n      const m = getCurrentTransform(this.ctx);\n      if (m[1] === 0 && m[2] === 0) {\n        // Fast path\n        this._cachedGetSinglePixelWidth =\n          1 / Math.min(Math.abs(m[0]), Math.abs(m[3]));\n      } else {\n        const absDet = Math.abs(m[0] * m[3] - m[2] * m[1]);\n        const normX = Math.hypot(m[0], m[2]);\n        const normY = Math.hypot(m[1], m[3]);\n        this._cachedGetSinglePixelWidth = Math.max(normX, normY) / absDet;\n      }\n    }\n    return this._cachedGetSinglePixelWidth;\n  }\n\n  getScaleForStroking() {\n    // A pixel has thicknessX = thicknessY = 1;\n    // A transformed pixel is a parallelogram and the thicknesses\n    // corresponds to the heights.\n    // The goal of this function is to rescale before setting the\n    // lineWidth in order to have both thicknesses greater or equal\n    // to 1 after transform.\n    if (this._cachedScaleForStroking[0] === -1) {\n      const { lineWidth } = this.current;\n      const { a, b, c, d } = this.ctx.getTransform();\n      let scaleX, scaleY;\n\n      if (b === 0 && c === 0) {\n        // Fast path\n        const normX = Math.abs(a);\n        const normY = Math.abs(d);\n        if (normX === normY) {\n          if (lineWidth === 0) {\n            scaleX = scaleY = 1 / normX;\n          } else {\n            const scaledLineWidth = normX * lineWidth;\n            scaleX = scaleY = scaledLineWidth < 1 ? 1 / scaledLineWidth : 1;\n          }\n        } else if (lineWidth === 0) {\n          scaleX = 1 / normX;\n          scaleY = 1 / normY;\n        } else {\n          const scaledXLineWidth = normX * lineWidth;\n          const scaledYLineWidth = normY * lineWidth;\n          scaleX = scaledXLineWidth < 1 ? 1 / scaledXLineWidth : 1;\n          scaleY = scaledYLineWidth < 1 ? 1 / scaledYLineWidth : 1;\n        }\n      } else {\n        // A pixel (base (x, y)) is transformed by M into a parallelogram:\n        //  - its area is |det(M)|;\n        //  - heightY (orthogonal to Mx) has a length: |det(M)| / norm(Mx);\n        //  - heightX (orthogonal to My) has a length: |det(M)| / norm(My).\n        // heightX and heightY are the thicknesses of the transformed pixel\n        // and they must be both greater or equal to 1.\n        const absDet = Math.abs(a * d - b * c);\n        const normX = Math.hypot(a, b);\n        const normY = Math.hypot(c, d);\n        if (lineWidth === 0) {\n          scaleX = normY / absDet;\n          scaleY = normX / absDet;\n        } else {\n          const baseArea = lineWidth * absDet;\n          scaleX = normY > baseArea ? normY / baseArea : 1;\n          scaleY = normX > baseArea ? normX / baseArea : 1;\n        }\n      }\n      this._cachedScaleForStroking[0] = scaleX;\n      this._cachedScaleForStroking[1] = scaleY;\n    }\n    return this._cachedScaleForStroking;\n  }\n\n  // Rescale before stroking in order to have a final lineWidth\n  // with both thicknesses greater or equal to 1.\n  rescaleAndStroke(saveRestore) {\n    const { ctx } = this;\n    const { lineWidth } = this.current;\n    const [scaleX, scaleY] = this.getScaleForStroking();\n\n    ctx.lineWidth = lineWidth || 1;\n\n    if (scaleX === 1 && scaleY === 1) {\n      ctx.stroke();\n      return;\n    }\n\n    const dashes = ctx.getLineDash();\n    if (saveRestore) {\n      ctx.save();\n    }\n\n    ctx.scale(scaleX, scaleY);\n\n    // How the dashed line is rendered depends on the current transform...\n    // so we added a rescale to handle too thin lines and consequently\n    // the way the line is dashed will be modified.\n    // If scaleX === scaleY, the dashed lines will be rendered correctly\n    // else we'll have some bugs (but only with too thin lines).\n    // Here we take the max... why not taking the min... or something else.\n    // Anyway, as said it's buggy when scaleX !== scaleY.\n    if (dashes.length > 0) {\n      const scale = Math.max(scaleX, scaleY);\n      ctx.setLineDash(dashes.map(x => x / scale));\n      ctx.lineDashOffset /= scale;\n    }\n\n    ctx.stroke();\n\n    if (saveRestore) {\n      ctx.restore();\n    }\n  }\n\n  isContentVisible() {\n    for (let i = this.markedContentStack.length - 1; i >= 0; i--) {\n      if (!this.markedContentStack[i].visible) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n\nfor (const op in OPS) {\n  if (CanvasGraphics.prototype[op] !== undefined) {\n    CanvasGraphics.prototype[OPS[op]] = CanvasGraphics.prototype[op];\n  }\n}\n\nexport { CanvasGraphics };\n","/* Copyright 2018 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass GlobalWorkerOptions {\n  static #port = null;\n\n  static #src = \"\";\n\n  /**\n   * @type {Worker | null}\n   */\n  static get workerPort() {\n    return this.#port;\n  }\n\n  /**\n   * @param {Worker | null} workerPort - Defines global port for worker process.\n   *   Overrides the `workerSrc` option.\n   */\n  static set workerPort(val) {\n    if (\n      !(typeof Worker !== \"undefined\" && val instanceof Worker) &&\n      val !== null\n    ) {\n      throw new Error(\"Invalid `workerPort` type.\");\n    }\n    this.#port = val;\n  }\n\n  /**\n   * @type {string}\n   */\n  static get workerSrc() {\n    return this.#src;\n  }\n\n  /**\n   * @param {string} workerSrc - A string containing the path and filename of\n   *   the worker file.\n   *\n   *   NOTE: The `workerSrc` option should always be set, in order to prevent\n   *         any issues when using the PDF.js library.\n   */\n  static set workerSrc(val) {\n    if (typeof val !== \"string\") {\n      throw new Error(\"Invalid `workerSrc` type.\");\n    }\n    this.#src = val;\n  }\n}\n\nexport { GlobalWorkerOptions };\n","/* Copyright 2018 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AbortException,\n  assert,\n  MissingPDFException,\n  PasswordException,\n  UnexpectedResponseException,\n  UnknownErrorException,\n  unreachable,\n} from \"./util.js\";\n\nconst CallbackKind = {\n  UNKNOWN: 0,\n  DATA: 1,\n  ERROR: 2,\n};\n\nconst StreamKind = {\n  UNKNOWN: 0,\n  CANCEL: 1,\n  CANCEL_COMPLETE: 2,\n  CLOSE: 3,\n  ENQUEUE: 4,\n  ERROR: 5,\n  PULL: 6,\n  PULL_COMPLETE: 7,\n  START_COMPLETE: 8,\n};\n\nfunction wrapReason(reason) {\n  if (\n    !(\n      reason instanceof Error ||\n      (typeof reason === \"object\" && reason !== null)\n    )\n  ) {\n    unreachable(\n      'wrapReason: Expected \"reason\" to be a (possibly cloned) Error.'\n    );\n  }\n  switch (reason.name) {\n    case \"AbortException\":\n      return new AbortException(reason.message);\n    case \"MissingPDFException\":\n      return new MissingPDFException(reason.message);\n    case \"PasswordException\":\n      return new PasswordException(reason.message, reason.code);\n    case \"UnexpectedResponseException\":\n      return new UnexpectedResponseException(reason.message, reason.status);\n    case \"UnknownErrorException\":\n      return new UnknownErrorException(reason.message, reason.details);\n    default:\n      return new UnknownErrorException(reason.message, reason.toString());\n  }\n}\n\nclass MessageHandler {\n  constructor(sourceName, targetName, comObj) {\n    this.sourceName = sourceName;\n    this.targetName = targetName;\n    this.comObj = comObj;\n    this.callbackId = 1;\n    this.streamId = 1;\n    this.streamSinks = Object.create(null);\n    this.streamControllers = Object.create(null);\n    this.callbackCapabilities = Object.create(null);\n    this.actionHandler = Object.create(null);\n\n    this._onComObjOnMessage = event => {\n      const data = event.data;\n      if (data.targetName !== this.sourceName) {\n        return;\n      }\n      if (data.stream) {\n        this.#processStreamMessage(data);\n        return;\n      }\n      if (data.callback) {\n        const callbackId = data.callbackId;\n        const capability = this.callbackCapabilities[callbackId];\n        if (!capability) {\n          throw new Error(`Cannot resolve callback ${callbackId}`);\n        }\n        delete this.callbackCapabilities[callbackId];\n\n        if (data.callback === CallbackKind.DATA) {\n          capability.resolve(data.data);\n        } else if (data.callback === CallbackKind.ERROR) {\n          capability.reject(wrapReason(data.reason));\n        } else {\n          throw new Error(\"Unexpected callback case\");\n        }\n        return;\n      }\n      const action = this.actionHandler[data.action];\n      if (!action) {\n        throw new Error(`Unknown action from worker: ${data.action}`);\n      }\n      if (data.callbackId) {\n        const cbSourceName = this.sourceName;\n        const cbTargetName = data.sourceName;\n\n        new Promise(function (resolve) {\n          resolve(action(data.data));\n        }).then(\n          function (result) {\n            comObj.postMessage({\n              sourceName: cbSourceName,\n              targetName: cbTargetName,\n              callback: CallbackKind.DATA,\n              callbackId: data.callbackId,\n              data: result,\n            });\n          },\n          function (reason) {\n            comObj.postMessage({\n              sourceName: cbSourceName,\n              targetName: cbTargetName,\n              callback: CallbackKind.ERROR,\n              callbackId: data.callbackId,\n              reason: wrapReason(reason),\n            });\n          }\n        );\n        return;\n      }\n      if (data.streamId) {\n        this.#createStreamSink(data);\n        return;\n      }\n      action(data.data);\n    };\n    comObj.addEventListener(\"message\", this._onComObjOnMessage);\n  }\n\n  on(actionName, handler) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        typeof handler === \"function\",\n        'MessageHandler.on: Expected \"handler\" to be a function.'\n      );\n    }\n    const ah = this.actionHandler;\n    if (ah[actionName]) {\n      throw new Error(`There is already an actionName called \"${actionName}\"`);\n    }\n    ah[actionName] = handler;\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   */\n  send(actionName, data, transfers) {\n    this.comObj.postMessage(\n      {\n        sourceName: this.sourceName,\n        targetName: this.targetName,\n        action: actionName,\n        data,\n      },\n      transfers\n    );\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * Expects that the other side will callback with the response.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   * @returns {Promise} Promise to be resolved with response data.\n   */\n  sendWithPromise(actionName, data, transfers) {\n    const callbackId = this.callbackId++;\n    const capability = Promise.withResolvers();\n    this.callbackCapabilities[callbackId] = capability;\n    try {\n      this.comObj.postMessage(\n        {\n          sourceName: this.sourceName,\n          targetName: this.targetName,\n          action: actionName,\n          callbackId,\n          data,\n        },\n        transfers\n      );\n    } catch (ex) {\n      capability.reject(ex);\n    }\n    return capability.promise;\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * Expect that the other side will callback to signal 'start_complete'.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Object} queueingStrategy - Strategy to signal backpressure based on\n   *                 internal queue.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   * @returns {ReadableStream} ReadableStream to read data in chunks.\n   */\n  sendWithStream(actionName, data, queueingStrategy, transfers) {\n    const streamId = this.streamId++,\n      sourceName = this.sourceName,\n      targetName = this.targetName,\n      comObj = this.comObj;\n\n    return new ReadableStream(\n      {\n        start: controller => {\n          const startCapability = Promise.withResolvers();\n          this.streamControllers[streamId] = {\n            controller,\n            startCall: startCapability,\n            pullCall: null,\n            cancelCall: null,\n            isClosed: false,\n          };\n          comObj.postMessage(\n            {\n              sourceName,\n              targetName,\n              action: actionName,\n              streamId,\n              data,\n              desiredSize: controller.desiredSize,\n            },\n            transfers\n          );\n          // Return Promise for Async process, to signal success/failure.\n          return startCapability.promise;\n        },\n\n        pull: controller => {\n          const pullCapability = Promise.withResolvers();\n          this.streamControllers[streamId].pullCall = pullCapability;\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.PULL,\n            streamId,\n            desiredSize: controller.desiredSize,\n          });\n          // Returning Promise will not call \"pull\"\n          // again until current pull is resolved.\n          return pullCapability.promise;\n        },\n\n        cancel: reason => {\n          assert(reason instanceof Error, \"cancel must have a valid reason\");\n          const cancelCapability = Promise.withResolvers();\n          this.streamControllers[streamId].cancelCall = cancelCapability;\n          this.streamControllers[streamId].isClosed = true;\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.CANCEL,\n            streamId,\n            reason: wrapReason(reason),\n          });\n          // Return Promise to signal success or failure.\n          return cancelCapability.promise;\n        },\n      },\n      queueingStrategy\n    );\n  }\n\n  #createStreamSink(data) {\n    const streamId = data.streamId,\n      sourceName = this.sourceName,\n      targetName = data.sourceName,\n      comObj = this.comObj;\n    const self = this,\n      action = this.actionHandler[data.action];\n\n    const streamSink = {\n      enqueue(chunk, size = 1, transfers) {\n        if (this.isCancelled) {\n          return;\n        }\n        const lastDesiredSize = this.desiredSize;\n        this.desiredSize -= size;\n        // Enqueue decreases the desiredSize property of sink,\n        // so when it changes from positive to negative,\n        // set ready as unresolved promise.\n        if (lastDesiredSize > 0 && this.desiredSize <= 0) {\n          this.sinkCapability = Promise.withResolvers();\n          this.ready = this.sinkCapability.promise;\n        }\n        comObj.postMessage(\n          {\n            sourceName,\n            targetName,\n            stream: StreamKind.ENQUEUE,\n            streamId,\n            chunk,\n          },\n          transfers\n        );\n      },\n\n      close() {\n        if (this.isCancelled) {\n          return;\n        }\n        this.isCancelled = true;\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.CLOSE,\n          streamId,\n        });\n        delete self.streamSinks[streamId];\n      },\n\n      error(reason) {\n        assert(reason instanceof Error, \"error must have a valid reason\");\n        if (this.isCancelled) {\n          return;\n        }\n        this.isCancelled = true;\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.ERROR,\n          streamId,\n          reason: wrapReason(reason),\n        });\n      },\n\n      sinkCapability: Promise.withResolvers(),\n      onPull: null,\n      onCancel: null,\n      isCancelled: false,\n      desiredSize: data.desiredSize,\n      ready: null,\n    };\n\n    streamSink.sinkCapability.resolve();\n    streamSink.ready = streamSink.sinkCapability.promise;\n    this.streamSinks[streamId] = streamSink;\n\n    new Promise(function (resolve) {\n      resolve(action(data.data, streamSink));\n    }).then(\n      function () {\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.START_COMPLETE,\n          streamId,\n          success: true,\n        });\n      },\n      function (reason) {\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.START_COMPLETE,\n          streamId,\n          reason: wrapReason(reason),\n        });\n      }\n    );\n  }\n\n  #processStreamMessage(data) {\n    const streamId = data.streamId,\n      sourceName = this.sourceName,\n      targetName = data.sourceName,\n      comObj = this.comObj;\n    const streamController = this.streamControllers[streamId],\n      streamSink = this.streamSinks[streamId];\n\n    switch (data.stream) {\n      case StreamKind.START_COMPLETE:\n        if (data.success) {\n          streamController.startCall.resolve();\n        } else {\n          streamController.startCall.reject(wrapReason(data.reason));\n        }\n        break;\n      case StreamKind.PULL_COMPLETE:\n        if (data.success) {\n          streamController.pullCall.resolve();\n        } else {\n          streamController.pullCall.reject(wrapReason(data.reason));\n        }\n        break;\n      case StreamKind.PULL:\n        // Ignore any pull after close is called.\n        if (!streamSink) {\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.PULL_COMPLETE,\n            streamId,\n            success: true,\n          });\n          break;\n        }\n        // Pull increases the desiredSize property of sink, so when it changes\n        // from negative to positive, set ready property as resolved promise.\n        if (streamSink.desiredSize <= 0 && data.desiredSize > 0) {\n          streamSink.sinkCapability.resolve();\n        }\n        // Reset desiredSize property of sink on every pull.\n        streamSink.desiredSize = data.desiredSize;\n\n        new Promise(function (resolve) {\n          resolve(streamSink.onPull?.());\n        }).then(\n          function () {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.PULL_COMPLETE,\n              streamId,\n              success: true,\n            });\n          },\n          function (reason) {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.PULL_COMPLETE,\n              streamId,\n              reason: wrapReason(reason),\n            });\n          }\n        );\n        break;\n      case StreamKind.ENQUEUE:\n        assert(streamController, \"enqueue should have stream controller\");\n        if (streamController.isClosed) {\n          break;\n        }\n        streamController.controller.enqueue(data.chunk);\n        break;\n      case StreamKind.CLOSE:\n        assert(streamController, \"close should have stream controller\");\n        if (streamController.isClosed) {\n          break;\n        }\n        streamController.isClosed = true;\n        streamController.controller.close();\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.ERROR:\n        assert(streamController, \"error should have stream controller\");\n        streamController.controller.error(wrapReason(data.reason));\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.CANCEL_COMPLETE:\n        if (data.success) {\n          streamController.cancelCall.resolve();\n        } else {\n          streamController.cancelCall.reject(wrapReason(data.reason));\n        }\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.CANCEL:\n        if (!streamSink) {\n          break;\n        }\n\n        new Promise(function (resolve) {\n          resolve(streamSink.onCancel?.(wrapReason(data.reason)));\n        }).then(\n          function () {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.CANCEL_COMPLETE,\n              streamId,\n              success: true,\n            });\n          },\n          function (reason) {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.CANCEL_COMPLETE,\n              streamId,\n              reason: wrapReason(reason),\n            });\n          }\n        );\n        streamSink.sinkCapability.reject(wrapReason(data.reason));\n        streamSink.isCancelled = true;\n        delete this.streamSinks[streamId];\n        break;\n      default:\n        throw new Error(\"Unexpected stream case\");\n    }\n  }\n\n  async #deleteStreamController(streamController, streamId) {\n    // Delete the `streamController` only when the start, pull, and cancel\n    // capabilities have settled, to prevent `TypeError`s.\n    await Promise.allSettled([\n      streamController.startCall?.promise,\n      streamController.pullCall?.promise,\n      streamController.cancelCall?.promise,\n    ]);\n    delete this.streamControllers[streamId];\n  }\n\n  destroy() {\n    this.comObj.removeEventListener(\"message\", this._onComObjOnMessage);\n  }\n}\n\nexport { MessageHandler };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { objectFromMap } from \"../shared/util.js\";\n\nclass Metadata {\n  #metadataMap;\n\n  #data;\n\n  constructor({ parsedData, rawData }) {\n    this.#metadataMap = parsedData;\n    this.#data = rawData;\n  }\n\n  getRaw() {\n    return this.#data;\n  }\n\n  get(name) {\n    return this.#metadataMap.get(name) ?? null;\n  }\n\n  getAll() {\n    return objectFromMap(this.#metadataMap);\n  }\n\n  has(name) {\n    return this.#metadataMap.has(name);\n  }\n}\n\nexport { Metadata };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  info,\n  objectFromMap,\n  RenderingIntentFlag,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\nimport { MurmurHash3_64 } from \"../shared/murmurhash3.js\";\n\nconst INTERNAL = Symbol(\"INTERNAL\");\n\nclass OptionalContentGroup {\n  #isDisplay = false;\n\n  #isPrint = false;\n\n  #userSet = false;\n\n  #visible = true;\n\n  constructor(renderingIntent, { name, intent, usage }) {\n    this.#isDisplay = !!(renderingIntent & RenderingIntentFlag.DISPLAY);\n    this.#isPrint = !!(renderingIntent & RenderingIntentFlag.PRINT);\n\n    this.name = name;\n    this.intent = intent;\n    this.usage = usage;\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get visible() {\n    if (this.#userSet) {\n      return this.#visible;\n    }\n    if (!this.#visible) {\n      return false;\n    }\n    const { print, view } = this.usage;\n\n    if (this.#isDisplay) {\n      return view?.viewState !== \"OFF\";\n    } else if (this.#isPrint) {\n      return print?.printState !== \"OFF\";\n    }\n    return true;\n  }\n\n  /**\n   * @ignore\n   */\n  _setVisible(internal, visible, userSet = false) {\n    if (internal !== INTERNAL) {\n      unreachable(\"Internal method `_setVisible` called.\");\n    }\n    this.#userSet = userSet;\n    this.#visible = visible;\n  }\n}\n\nclass OptionalContentConfig {\n  #cachedGetHash = null;\n\n  #groups = new Map();\n\n  #initialHash = null;\n\n  #order = null;\n\n  constructor(data, renderingIntent = RenderingIntentFlag.DISPLAY) {\n    this.renderingIntent = renderingIntent;\n\n    this.name = null;\n    this.creator = null;\n\n    if (data === null) {\n      return;\n    }\n    this.name = data.name;\n    this.creator = data.creator;\n    this.#order = data.order;\n    for (const group of data.groups) {\n      this.#groups.set(\n        group.id,\n        new OptionalContentGroup(renderingIntent, group)\n      );\n    }\n\n    if (data.baseState === \"OFF\") {\n      for (const group of this.#groups.values()) {\n        group._setVisible(INTERNAL, false);\n      }\n    }\n\n    for (const on of data.on) {\n      this.#groups.get(on)._setVisible(INTERNAL, true);\n    }\n\n    for (const off of data.off) {\n      this.#groups.get(off)._setVisible(INTERNAL, false);\n    }\n\n    // The following code must always run *last* in the constructor.\n    this.#initialHash = this.getHash();\n  }\n\n  #evaluateVisibilityExpression(array) {\n    const length = array.length;\n    if (length < 2) {\n      return true;\n    }\n    const operator = array[0];\n    for (let i = 1; i < length; i++) {\n      const element = array[i];\n      let state;\n      if (Array.isArray(element)) {\n        state = this.#evaluateVisibilityExpression(element);\n      } else if (this.#groups.has(element)) {\n        state = this.#groups.get(element).visible;\n      } else {\n        warn(`Optional content group not found: ${element}`);\n        return true;\n      }\n      switch (operator) {\n        case \"And\":\n          if (!state) {\n            return false;\n          }\n          break;\n        case \"Or\":\n          if (state) {\n            return true;\n          }\n          break;\n        case \"Not\":\n          return !state;\n        default:\n          return true;\n      }\n    }\n    return operator === \"And\";\n  }\n\n  isVisible(group) {\n    if (this.#groups.size === 0) {\n      return true;\n    }\n    if (!group) {\n      info(\"Optional content group not defined.\");\n      return true;\n    }\n    if (group.type === \"OCG\") {\n      if (!this.#groups.has(group.id)) {\n        warn(`Optional content group not found: ${group.id}`);\n        return true;\n      }\n      return this.#groups.get(group.id).visible;\n    } else if (group.type === \"OCMD\") {\n      // Per the spec, the expression should be preferred if available.\n      if (group.expression) {\n        return this.#evaluateVisibilityExpression(group.expression);\n      }\n      if (!group.policy || group.policy === \"AnyOn\") {\n        // Default\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (this.#groups.get(id).visible) {\n            return true;\n          }\n        }\n        return false;\n      } else if (group.policy === \"AllOn\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (!this.#groups.get(id).visible) {\n            return false;\n          }\n        }\n        return true;\n      } else if (group.policy === \"AnyOff\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (!this.#groups.get(id).visible) {\n            return true;\n          }\n        }\n        return false;\n      } else if (group.policy === \"AllOff\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (this.#groups.get(id).visible) {\n            return false;\n          }\n        }\n        return true;\n      }\n      warn(`Unknown optional content policy ${group.policy}.`);\n      return true;\n    }\n    warn(`Unknown group type ${group.type}.`);\n    return true;\n  }\n\n  setVisibility(id, visible = true) {\n    const group = this.#groups.get(id);\n    if (!group) {\n      warn(`Optional content group not found: ${id}`);\n      return;\n    }\n    group._setVisible(INTERNAL, !!visible, /* userSet = */ true);\n\n    this.#cachedGetHash = null;\n  }\n\n  setOCGState({ state, preserveRB }) {\n    let operator;\n\n    for (const elem of state) {\n      switch (elem) {\n        case \"ON\":\n        case \"OFF\":\n        case \"Toggle\":\n          operator = elem;\n          continue;\n      }\n\n      const group = this.#groups.get(elem);\n      if (!group) {\n        continue;\n      }\n      switch (operator) {\n        case \"ON\":\n          group._setVisible(INTERNAL, true);\n          break;\n        case \"OFF\":\n          group._setVisible(INTERNAL, false);\n          break;\n        case \"Toggle\":\n          group._setVisible(INTERNAL, !group.visible);\n          break;\n      }\n    }\n\n    this.#cachedGetHash = null;\n  }\n\n  get hasInitialVisibility() {\n    return this.#initialHash === null || this.getHash() === this.#initialHash;\n  }\n\n  getOrder() {\n    if (!this.#groups.size) {\n      return null;\n    }\n    if (this.#order) {\n      return this.#order.slice();\n    }\n    return [...this.#groups.keys()];\n  }\n\n  getGroups() {\n    return this.#groups.size > 0 ? objectFromMap(this.#groups) : null;\n  }\n\n  getGroup(id) {\n    return this.#groups.get(id) || null;\n  }\n\n  getHash() {\n    if (this.#cachedGetHash !== null) {\n      return this.#cachedGetHash;\n    }\n    const hash = new MurmurHash3_64();\n\n    for (const [id, group] of this.#groups) {\n      hash.update(`${id}:${group.visible}`);\n    }\n    return (this.#cachedGetHash = hash.hexdigest());\n  }\n}\n\nexport { OptionalContentConfig };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"../interfaces\").IPDFStream} IPDFStream */\n/** @typedef {import(\"../interfaces\").IPDFStreamReader} IPDFStreamReader */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../interfaces\").IPDFStreamRangeReader} IPDFStreamRangeReader */\n\nimport { assert } from \"../shared/util.js\";\nimport { isPdfFile } from \"./display_utils.js\";\n\n/** @implements {IPDFStream} */\nclass PDFDataTransportStream {\n  constructor(\n    pdfDataRangeTransport,\n    { disableRange = false, disableStream = false }\n  ) {\n    assert(\n      pdfDataRangeTransport,\n      'PDFDataTransportStream - missing required \"pdfDataRangeTransport\" argument.'\n    );\n    const { length, initialData, progressiveDone, contentDispositionFilename } =\n      pdfDataRangeTransport;\n\n    this._queuedChunks = [];\n    this._progressiveDone = progressiveDone;\n    this._contentDispositionFilename = contentDispositionFilename;\n\n    if (initialData?.length > 0) {\n      // Prevent any possible issues by only transferring a Uint8Array that\n      // completely \"utilizes\" its underlying ArrayBuffer.\n      const buffer =\n        initialData instanceof Uint8Array &&\n        initialData.byteLength === initialData.buffer.byteLength\n          ? initialData.buffer\n          : new Uint8Array(initialData).buffer;\n      this._queuedChunks.push(buffer);\n    }\n\n    this._pdfDataRangeTransport = pdfDataRangeTransport;\n    this._isStreamingSupported = !disableStream;\n    this._isRangeSupported = !disableRange;\n    this._contentLength = length;\n\n    this._fullRequestReader = null;\n    this._rangeReaders = [];\n\n    pdfDataRangeTransport.addRangeListener((begin, chunk) => {\n      this._onReceiveData({ begin, chunk });\n    });\n\n    pdfDataRangeTransport.addProgressListener((loaded, total) => {\n      this._onProgress({ loaded, total });\n    });\n\n    pdfDataRangeTransport.addProgressiveReadListener(chunk => {\n      this._onReceiveData({ chunk });\n    });\n\n    pdfDataRangeTransport.addProgressiveDoneListener(() => {\n      this._onProgressiveDone();\n    });\n\n    pdfDataRangeTransport.transportReady();\n  }\n\n  _onReceiveData({ begin, chunk }) {\n    // Prevent any possible issues by only transferring a Uint8Array that\n    // completely \"utilizes\" its underlying ArrayBuffer.\n    const buffer =\n      chunk instanceof Uint8Array &&\n      chunk.byteLength === chunk.buffer.byteLength\n        ? chunk.buffer\n        : new Uint8Array(chunk).buffer;\n\n    if (begin === undefined) {\n      if (this._fullRequestReader) {\n        this._fullRequestReader._enqueue(buffer);\n      } else {\n        this._queuedChunks.push(buffer);\n      }\n    } else {\n      const found = this._rangeReaders.some(function (rangeReader) {\n        if (rangeReader._begin !== begin) {\n          return false;\n        }\n        rangeReader._enqueue(buffer);\n        return true;\n      });\n      assert(\n        found,\n        \"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.\"\n      );\n    }\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  _onProgress(evt) {\n    if (evt.total === undefined) {\n      // Reporting to first range reader, if it exists.\n      this._rangeReaders[0]?.onProgress?.({ loaded: evt.loaded });\n    } else {\n      this._fullRequestReader?.onProgress?.({\n        loaded: evt.loaded,\n        total: evt.total,\n      });\n    }\n  }\n\n  _onProgressiveDone() {\n    this._fullRequestReader?.progressiveDone();\n    this._progressiveDone = true;\n  }\n\n  _removeRangeReader(reader) {\n    const i = this._rangeReaders.indexOf(reader);\n    if (i >= 0) {\n      this._rangeReaders.splice(i, 1);\n    }\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFDataTransportStream.getFullReader can only be called once.\"\n    );\n    const queuedChunks = this._queuedChunks;\n    this._queuedChunks = null;\n    return new PDFDataTransportStreamReader(\n      this,\n      queuedChunks,\n      this._progressiveDone,\n      this._contentDispositionFilename\n    );\n  }\n\n  getRangeReader(begin, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const reader = new PDFDataTransportStreamRangeReader(this, begin, end);\n    this._pdfDataRangeTransport.requestDataRange(begin, end);\n    this._rangeReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n    this._pdfDataRangeTransport.abort();\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFDataTransportStreamReader {\n  constructor(\n    stream,\n    queuedChunks,\n    progressiveDone = false,\n    contentDispositionFilename = null\n  ) {\n    this._stream = stream;\n    this._done = progressiveDone || false;\n    this._filename = isPdfFile(contentDispositionFilename)\n      ? contentDispositionFilename\n      : null;\n    this._queuedChunks = queuedChunks || [];\n    this._loaded = 0;\n    for (const chunk of this._queuedChunks) {\n      this._loaded += chunk.byteLength;\n    }\n    this._requests = [];\n    this._headersReady = Promise.resolve();\n    stream._fullRequestReader = this;\n\n    this.onProgress = null;\n  }\n\n  _enqueue(chunk) {\n    if (this._done) {\n      return; // Ignore new data.\n    }\n    if (this._requests.length > 0) {\n      const requestCapability = this._requests.shift();\n      requestCapability.resolve({ value: chunk, done: false });\n    } else {\n      this._queuedChunks.push(chunk);\n    }\n    this._loaded += chunk.byteLength;\n  }\n\n  get headersReady() {\n    return this._headersReady;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get isRangeSupported() {\n    return this._stream._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._stream._isStreamingSupported;\n  }\n\n  get contentLength() {\n    return this._stream._contentLength;\n  }\n\n  async read() {\n    if (this._queuedChunks.length > 0) {\n      const chunk = this._queuedChunks.shift();\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n  }\n\n  progressiveDone() {\n    if (this._done) {\n      return;\n    }\n    this._done = true;\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFDataTransportStreamRangeReader {\n  constructor(stream, begin, end) {\n    this._stream = stream;\n    this._begin = begin;\n    this._end = end;\n    this._queuedChunk = null;\n    this._requests = [];\n    this._done = false;\n\n    this.onProgress = null;\n  }\n\n  _enqueue(chunk) {\n    if (this._done) {\n      return; // ignore new data\n    }\n    if (this._requests.length === 0) {\n      this._queuedChunk = chunk;\n    } else {\n      const requestsCapability = this._requests.shift();\n      requestsCapability.resolve({ value: chunk, done: false });\n      for (const requestCapability of this._requests) {\n        requestCapability.resolve({ value: undefined, done: true });\n      }\n      this._requests.length = 0;\n    }\n    this._done = true;\n    this._stream._removeRangeReader(this);\n  }\n\n  get isStreamingSupported() {\n    return false;\n  }\n\n  async read() {\n    if (this._queuedChunk) {\n      const chunk = this._queuedChunk;\n      this._queuedChunk = null;\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    this._stream._removeRangeReader(this);\n  }\n}\n\nexport { PDFDataTransportStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  assert,\n  MissingPDFException,\n  UnexpectedResponseException,\n} from \"../shared/util.js\";\nimport { getFilenameFromContentDispositionHeader } from \"./content_disposition.js\";\nimport { isPdfFile } from \"./display_utils.js\";\n\nfunction validateRangeRequestCapabilities({\n  getResponseHeader,\n  isHttp,\n  rangeChunkSize,\n  disableRange,\n}) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      Number.isInteger(rangeChunkSize) && rangeChunkSize > 0,\n      \"rangeChunkSize must be an integer larger than zero.\"\n    );\n  }\n  const returnValues = {\n    allowRangeRequests: false,\n    suggestedLength: undefined,\n  };\n\n  const length = parseInt(getResponseHeader(\"Content-Length\"), 10);\n  if (!Number.isInteger(length)) {\n    return returnValues;\n  }\n\n  returnValues.suggestedLength = length;\n\n  if (length <= 2 * rangeChunkSize) {\n    // The file size is smaller than the size of two chunks, so it does not\n    // make any sense to abort the request and retry with a range request.\n    return returnValues;\n  }\n\n  if (disableRange || !isHttp) {\n    return returnValues;\n  }\n  if (getResponseHeader(\"Accept-Ranges\") !== \"bytes\") {\n    return returnValues;\n  }\n\n  const contentEncoding = getResponseHeader(\"Content-Encoding\") || \"identity\";\n  if (contentEncoding !== \"identity\") {\n    return returnValues;\n  }\n\n  returnValues.allowRangeRequests = true;\n  return returnValues;\n}\n\nfunction extractFilenameFromHeader(getResponseHeader) {\n  const contentDisposition = getResponseHeader(\"Content-Disposition\");\n  if (contentDisposition) {\n    let filename = getFilenameFromContentDispositionHeader(contentDisposition);\n    if (filename.includes(\"%\")) {\n      try {\n        filename = decodeURIComponent(filename);\n      } catch {}\n    }\n    if (isPdfFile(filename)) {\n      return filename;\n    }\n  }\n  return null;\n}\n\nfunction createResponseStatusError(status, url) {\n  if (status === 404 || (status === 0 && url.startsWith(\"file:\"))) {\n    return new MissingPDFException('Missing PDF \"' + url + '\".');\n  }\n  return new UnexpectedResponseException(\n    `Unexpected server response (${status}) while retrieving PDF \"${url}\".`,\n    status\n  );\n}\n\nfunction validateResponseStatus(status) {\n  return status === 200 || status === 206;\n}\n\nexport {\n  createResponseStatusError,\n  extractFilenameFromHeader,\n  validateRangeRequestCapabilities,\n  validateResponseStatus,\n};\n","/* Copyright 2017 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringToBytes } from \"../shared/util.js\";\n\n// This getFilenameFromContentDispositionHeader function is adapted from\n// https://github.com/Rob--W/open-in-browser/blob/7e2e35a38b8b4e981b11da7b2f01df0149049e92/extension/content-disposition.js\n// with the following changes:\n// - Modified to conform to PDF.js's coding style.\n// - Move return to the end of the function to prevent Babel from dropping the\n//   function declarations.\n\n/**\n * Extract file name from the Content-Disposition HTTP response header.\n *\n * @param {string} contentDisposition\n * @returns {string} Filename, if found in the Content-Disposition header.\n */\nfunction getFilenameFromContentDispositionHeader(contentDisposition) {\n  let needsEncodingFixup = true;\n\n  // filename*=ext-value (\"ext-value\" from RFC 5987, referenced by RFC 6266).\n  let tmp = toParamRegExp(\"filename\\\\*\", \"i\").exec(contentDisposition);\n  if (tmp) {\n    tmp = tmp[1];\n    let filename = rfc2616unquote(tmp);\n    filename = unescape(filename);\n    filename = rfc5987decode(filename);\n    filename = rfc2047decode(filename);\n    return fixupEncoding(filename);\n  }\n\n  // Continuations (RFC 2231 section 3, referenced by RFC 5987 section 3.1).\n  // filename*n*=part\n  // filename*n=part\n  tmp = rfc2231getparam(contentDisposition);\n  if (tmp) {\n    // RFC 2047, section\n    const filename = rfc2047decode(tmp);\n    return fixupEncoding(filename);\n  }\n\n  // filename=value (RFC 5987, section 4.1).\n  tmp = toParamRegExp(\"filename\", \"i\").exec(contentDisposition);\n  if (tmp) {\n    tmp = tmp[1];\n    let filename = rfc2616unquote(tmp);\n    filename = rfc2047decode(filename);\n    return fixupEncoding(filename);\n  }\n\n  // After this line there are only function declarations. We cannot put\n  // \"return\" here for readability because babel would then drop the function\n  // declarations...\n  function toParamRegExp(attributePattern, flags) {\n    return new RegExp(\n      \"(?:^|;)\\\\s*\" +\n        attributePattern +\n        \"\\\\s*=\\\\s*\" +\n        // Captures: value = token | quoted-string\n        // (RFC 2616, section 3.6 and referenced by RFC 6266 4.1)\n        \"(\" +\n        '[^\";\\\\s][^;\\\\s]*' +\n        \"|\" +\n        '\"(?:[^\"\\\\\\\\]|\\\\\\\\\"?)+\"?' +\n        \")\",\n      flags\n    );\n  }\n  function textdecode(encoding, value) {\n    if (encoding) {\n      if (!/^[\\x00-\\xFF]+$/.test(value)) {\n        return value;\n      }\n      try {\n        const decoder = new TextDecoder(encoding, { fatal: true });\n        const buffer = stringToBytes(value);\n        value = decoder.decode(buffer);\n        needsEncodingFixup = false;\n      } catch {\n        // TextDecoder constructor threw - unrecognized encoding.\n      }\n    }\n    return value;\n  }\n  function fixupEncoding(value) {\n    if (needsEncodingFixup && /[\\x80-\\xff]/.test(value)) {\n      // Maybe multi-byte UTF-8.\n      value = textdecode(\"utf-8\", value);\n      if (needsEncodingFixup) {\n        // Try iso-8859-1 encoding.\n        value = textdecode(\"iso-8859-1\", value);\n      }\n    }\n    return value;\n  }\n  function rfc2231getparam(contentDispositionStr) {\n    const matches = [];\n    let match;\n    // Iterate over all filename*n= and filename*n*= with n being an integer\n    // of at least zero. Any non-zero number must not start with '0'.\n    const iter = toParamRegExp(\"filename\\\\*((?!0\\\\d)\\\\d+)(\\\\*?)\", \"ig\");\n    while ((match = iter.exec(contentDispositionStr)) !== null) {\n      let [, n, quot, part] = match; // eslint-disable-line prefer-const\n      n = parseInt(n, 10);\n      if (n in matches) {\n        // Ignore anything after the invalid second filename*0.\n        if (n === 0) {\n          break;\n        }\n        continue;\n      }\n      matches[n] = [quot, part];\n    }\n    const parts = [];\n    for (let n = 0; n < matches.length; ++n) {\n      if (!(n in matches)) {\n        // Numbers must be consecutive. Truncate when there is a hole.\n        break;\n      }\n      let [quot, part] = matches[n]; // eslint-disable-line prefer-const\n      part = rfc2616unquote(part);\n      if (quot) {\n        part = unescape(part);\n        if (n === 0) {\n          part = rfc5987decode(part);\n        }\n      }\n      parts.push(part);\n    }\n    return parts.join(\"\");\n  }\n  function rfc2616unquote(value) {\n    if (value.startsWith('\"')) {\n      const parts = value.slice(1).split('\\\\\"');\n      // Find the first unescaped \" and terminate there.\n      for (let i = 0; i < parts.length; ++i) {\n        const quotindex = parts[i].indexOf('\"');\n        if (quotindex !== -1) {\n          parts[i] = parts[i].slice(0, quotindex);\n          parts.length = i + 1; // Truncates and stop the iteration.\n        }\n        parts[i] = parts[i].replaceAll(/\\\\(.)/g, \"$1\");\n      }\n      value = parts.join('\"');\n    }\n    return value;\n  }\n  function rfc5987decode(extvalue) {\n    // Decodes \"ext-value\" from RFC 5987.\n    const encodingend = extvalue.indexOf(\"'\");\n    if (encodingend === -1) {\n      // Some servers send \"filename*=\" without encoding 'language' prefix,\n      // e.g. in https://github.com/Rob--W/open-in-browser/issues/26\n      // Let's accept the value like Firefox (57) (Chrome 62 rejects it).\n      return extvalue;\n    }\n    const encoding = extvalue.slice(0, encodingend);\n    const langvalue = extvalue.slice(encodingend + 1);\n    // Ignore language (RFC 5987 section 3.2.1, and RFC 6266 section 4.1 ).\n    const value = langvalue.replace(/^[^']*'/, \"\");\n    return textdecode(encoding, value);\n  }\n  function rfc2047decode(value) {\n    // RFC 2047-decode the result. Firefox tried to drop support for it, but\n    // backed out because some servers use it - https://bugzil.la/875615\n    // Firefox's condition for decoding is here: https://searchfox.org/mozilla-central/rev/4a590a5a15e35d88a3b23dd6ac3c471cf85b04a8/netwerk/mime/nsMIMEHeaderParamImpl.cpp#742-748\n\n    // We are more strict and only recognize RFC 2047-encoding if the value\n    // starts with \"=?\", since then it is likely that the full value is\n    // RFC 2047-encoded.\n\n    // Firefox also decodes words even where RFC 2047 section 5 states:\n    // \"An 'encoded-word' MUST NOT appear within a 'quoted-string'.\"\n    if (!value.startsWith(\"=?\") || /[\\x00-\\x19\\x80-\\xff]/.test(value)) {\n      return value;\n    }\n    // RFC 2047, section 2.4\n    // encoded-word = \"=?\" charset \"?\" encoding \"?\" encoded-text \"?=\"\n    // charset = token (but let's restrict to characters that denote a\n    //       possibly valid encoding).\n    // encoding = q or b\n    // encoded-text = any printable ASCII character other than ? or space.\n    //        ... but Firefox permits ? and space.\n    return value.replaceAll(\n      /=\\?([\\w-]*)\\?([QqBb])\\?((?:[^?]|\\?(?!=))*)\\?=/g,\n      function (matches, charset, encoding, text) {\n        if (encoding === \"q\" || encoding === \"Q\") {\n          // RFC 2047 section 4.2.\n          text = text.replaceAll(\"_\", \" \");\n          text = text.replaceAll(/=([0-9a-fA-F]{2})/g, function (match, hex) {\n            return String.fromCharCode(parseInt(hex, 16));\n          });\n          return textdecode(charset, text);\n        } // else encoding is b or B - base64 (RFC 2047 section 4.1)\n        try {\n          text = atob(text);\n        } catch {}\n        return textdecode(charset, text);\n      }\n    );\n  }\n\n  return \"\";\n}\n\nexport { getFilenameFromContentDispositionHeader };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AbortException, assert, warn } from \"../shared/util.js\";\nimport {\n  createResponseStatusError,\n  extractFilenameFromHeader,\n  validateRangeRequestCapabilities,\n  validateResponseStatus,\n} from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./fetch_stream.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nfunction createFetchOptions(headers, withCredentials, abortController) {\n  return {\n    method: \"GET\",\n    headers,\n    signal: abortController.signal,\n    mode: \"cors\",\n    credentials: withCredentials ? \"include\" : \"same-origin\",\n    redirect: \"follow\",\n  };\n}\n\nfunction createHeaders(httpHeaders) {\n  const headers = new Headers();\n  for (const property in httpHeaders) {\n    const value = httpHeaders[property];\n    if (value === undefined) {\n      continue;\n    }\n    headers.append(property, value);\n  }\n  return headers;\n}\n\nfunction getArrayBuffer(val) {\n  if (val instanceof Uint8Array) {\n    return val.buffer;\n  }\n  if (val instanceof ArrayBuffer) {\n    return val;\n  }\n  warn(`getArrayBuffer - unexpected data format: ${val}`);\n  return new Uint8Array(val).buffer;\n}\n\n/** @implements {IPDFStream} */\nclass PDFFetchStream {\n  constructor(source) {\n    this.source = source;\n    this.isHttp = /^https?:/i.test(source.url);\n    this.httpHeaders = (this.isHttp && source.httpHeaders) || {};\n\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFFetchStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFFetchStreamReader(this);\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(begin, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const reader = new PDFFetchStreamRangeReader(this, begin, end);\n    this._rangeRequestReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFFetchStreamReader {\n  constructor(stream) {\n    this._stream = stream;\n    this._reader = null;\n    this._loaded = 0;\n    this._filename = null;\n    const source = stream.source;\n    this._withCredentials = source.withCredentials || false;\n    this._contentLength = source.length;\n    this._headersCapability = Promise.withResolvers();\n    this._disableRange = source.disableRange || false;\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._abortController = new AbortController();\n    this._isStreamingSupported = !source.disableStream;\n    this._isRangeSupported = !source.disableRange;\n\n    this._headers = createHeaders(this._stream.httpHeaders);\n\n    const url = source.url;\n    fetch(\n      url,\n      createFetchOptions(\n        this._headers,\n        this._withCredentials,\n        this._abortController\n      )\n    )\n      .then(response => {\n        if (!validateResponseStatus(response.status)) {\n          throw createResponseStatusError(response.status, url);\n        }\n        this._reader = response.body.getReader();\n        this._headersCapability.resolve();\n\n        const getResponseHeader = name => response.headers.get(name);\n\n        const { allowRangeRequests, suggestedLength } =\n          validateRangeRequestCapabilities({\n            getResponseHeader,\n            isHttp: this._stream.isHttp,\n            rangeChunkSize: this._rangeChunkSize,\n            disableRange: this._disableRange,\n          });\n\n        this._isRangeSupported = allowRangeRequests;\n        // Setting right content length.\n        this._contentLength = suggestedLength || this._contentLength;\n\n        this._filename = extractFilenameFromHeader(getResponseHeader);\n\n        // We need to stop reading when range is supported and streaming is\n        // disabled.\n        if (!this._isStreamingSupported && this._isRangeSupported) {\n          this.cancel(new AbortException(\"Streaming is disabled.\"));\n        }\n      })\n      .catch(this._headersCapability.reject);\n\n    this.onProgress = null;\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._headersCapability.promise;\n    const { value, done } = await this._reader.read();\n    if (done) {\n      return { value, done };\n    }\n    this._loaded += value.byteLength;\n    this.onProgress?.({\n      loaded: this._loaded,\n      total: this._contentLength,\n    });\n\n    return { value: getArrayBuffer(value), done: false };\n  }\n\n  cancel(reason) {\n    this._reader?.cancel(reason);\n    this._abortController.abort();\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFFetchStreamRangeReader {\n  constructor(stream, begin, end) {\n    this._stream = stream;\n    this._reader = null;\n    this._loaded = 0;\n    const source = stream.source;\n    this._withCredentials = source.withCredentials || false;\n    this._readCapability = Promise.withResolvers();\n    this._isStreamingSupported = !source.disableStream;\n\n    this._abortController = new AbortController();\n    this._headers = createHeaders(this._stream.httpHeaders);\n    this._headers.append(\"Range\", `bytes=${begin}-${end - 1}`);\n\n    const url = source.url;\n    fetch(\n      url,\n      createFetchOptions(\n        this._headers,\n        this._withCredentials,\n        this._abortController\n      )\n    )\n      .then(response => {\n        if (!validateResponseStatus(response.status)) {\n          throw createResponseStatusError(response.status, url);\n        }\n        this._readCapability.resolve();\n        this._reader = response.body.getReader();\n      })\n      .catch(this._readCapability.reject);\n\n    this.onProgress = null;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    const { value, done } = await this._reader.read();\n    if (done) {\n      return { value, done };\n    }\n    this._loaded += value.byteLength;\n    this.onProgress?.({ loaded: this._loaded });\n\n    return { value: getArrayBuffer(value), done: false };\n  }\n\n  cancel(reason) {\n    this._reader?.cancel(reason);\n    this._abortController.abort();\n  }\n}\n\nexport { PDFFetchStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert, stringToBytes } from \"../shared/util.js\";\nimport {\n  createResponseStatusError,\n  extractFilenameFromHeader,\n  validateRangeRequestCapabilities,\n} from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./network.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nconst OK_RESPONSE = 200;\nconst PARTIAL_CONTENT_RESPONSE = 206;\n\nfunction getArrayBuffer(xhr) {\n  const data = xhr.response;\n  if (typeof data !== \"string\") {\n    return data;\n  }\n  return stringToBytes(data).buffer;\n}\n\nclass NetworkManager {\n  constructor(url, args = {}) {\n    this.url = url;\n    this.isHttp = /^https?:/i.test(url);\n    this.httpHeaders = (this.isHttp && args.httpHeaders) || Object.create(null);\n    this.withCredentials = args.withCredentials || false;\n\n    this.currXhrId = 0;\n    this.pendingRequests = Object.create(null);\n  }\n\n  requestRange(begin, end, listeners) {\n    const args = {\n      begin,\n      end,\n    };\n    for (const prop in listeners) {\n      args[prop] = listeners[prop];\n    }\n    return this.request(args);\n  }\n\n  requestFull(listeners) {\n    return this.request(listeners);\n  }\n\n  request(args) {\n    const xhr = new XMLHttpRequest();\n    const xhrId = this.currXhrId++;\n    const pendingRequest = (this.pendingRequests[xhrId] = { xhr });\n\n    xhr.open(\"GET\", this.url);\n    xhr.withCredentials = this.withCredentials;\n    for (const property in this.httpHeaders) {\n      const value = this.httpHeaders[property];\n      if (value === undefined) {\n        continue;\n      }\n      xhr.setRequestHeader(property, value);\n    }\n    if (this.isHttp && \"begin\" in args && \"end\" in args) {\n      xhr.setRequestHeader(\"Range\", `bytes=${args.begin}-${args.end - 1}`);\n      pendingRequest.expectedStatus = PARTIAL_CONTENT_RESPONSE;\n    } else {\n      pendingRequest.expectedStatus = OK_RESPONSE;\n    }\n    xhr.responseType = \"arraybuffer\";\n\n    if (args.onError) {\n      xhr.onerror = function (evt) {\n        args.onError(xhr.status);\n      };\n    }\n    xhr.onreadystatechange = this.onStateChange.bind(this, xhrId);\n    xhr.onprogress = this.onProgress.bind(this, xhrId);\n\n    pendingRequest.onHeadersReceived = args.onHeadersReceived;\n    pendingRequest.onDone = args.onDone;\n    pendingRequest.onError = args.onError;\n    pendingRequest.onProgress = args.onProgress;\n\n    xhr.send(null);\n\n    return xhrId;\n  }\n\n  onProgress(xhrId, evt) {\n    const pendingRequest = this.pendingRequests[xhrId];\n    if (!pendingRequest) {\n      return; // Maybe abortRequest was called...\n    }\n    pendingRequest.onProgress?.(evt);\n  }\n\n  onStateChange(xhrId, evt) {\n    const pendingRequest = this.pendingRequests[xhrId];\n    if (!pendingRequest) {\n      return; // Maybe abortRequest was called...\n    }\n\n    const xhr = pendingRequest.xhr;\n    if (xhr.readyState >= 2 && pendingRequest.onHeadersReceived) {\n      pendingRequest.onHeadersReceived();\n      delete pendingRequest.onHeadersReceived;\n    }\n\n    if (xhr.readyState !== 4) {\n      return;\n    }\n\n    if (!(xhrId in this.pendingRequests)) {\n      // The XHR request might have been aborted in onHeadersReceived()\n      // callback, in which case we should abort request.\n      return;\n    }\n\n    delete this.pendingRequests[xhrId];\n\n    // Success status == 0 can be on ftp, file and other protocols.\n    if (xhr.status === 0 && this.isHttp) {\n      pendingRequest.onError?.(xhr.status);\n      return;\n    }\n    const xhrStatus = xhr.status || OK_RESPONSE;\n\n    // From http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.35.2:\n    // \"A server MAY ignore the Range header\". This means it's possible to\n    // get a 200 rather than a 206 response from a range request.\n    const ok_response_on_range_request =\n      xhrStatus === OK_RESPONSE &&\n      pendingRequest.expectedStatus === PARTIAL_CONTENT_RESPONSE;\n\n    if (\n      !ok_response_on_range_request &&\n      xhrStatus !== pendingRequest.expectedStatus\n    ) {\n      pendingRequest.onError?.(xhr.status);\n      return;\n    }\n\n    const chunk = getArrayBuffer(xhr);\n    if (xhrStatus === PARTIAL_CONTENT_RESPONSE) {\n      const rangeHeader = xhr.getResponseHeader(\"Content-Range\");\n      const matches = /bytes (\\d+)-(\\d+)\\/(\\d+)/.exec(rangeHeader);\n      pendingRequest.onDone({\n        begin: parseInt(matches[1], 10),\n        chunk,\n      });\n    } else if (chunk) {\n      pendingRequest.onDone({\n        begin: 0,\n        chunk,\n      });\n    } else {\n      pendingRequest.onError?.(xhr.status);\n    }\n  }\n\n  getRequestXhr(xhrId) {\n    return this.pendingRequests[xhrId].xhr;\n  }\n\n  isPendingRequest(xhrId) {\n    return xhrId in this.pendingRequests;\n  }\n\n  abortRequest(xhrId) {\n    const xhr = this.pendingRequests[xhrId].xhr;\n    delete this.pendingRequests[xhrId];\n    xhr.abort();\n  }\n}\n\n/** @implements {IPDFStream} */\nclass PDFNetworkStream {\n  constructor(source) {\n    this._source = source;\n    this._manager = new NetworkManager(source.url, {\n      httpHeaders: source.httpHeaders,\n      withCredentials: source.withCredentials,\n    });\n    this._rangeChunkSize = source.rangeChunkSize;\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  _onRangeRequestReaderClosed(reader) {\n    const i = this._rangeRequestReaders.indexOf(reader);\n    if (i >= 0) {\n      this._rangeRequestReaders.splice(i, 1);\n    }\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFNetworkStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFNetworkStreamFullRequestReader(\n      this._manager,\n      this._source\n    );\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(begin, end) {\n    const reader = new PDFNetworkStreamRangeRequestReader(\n      this._manager,\n      begin,\n      end\n    );\n    reader.onClosed = this._onRangeRequestReaderClosed.bind(this);\n    this._rangeRequestReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFNetworkStreamFullRequestReader {\n  constructor(manager, source) {\n    this._manager = manager;\n\n    const args = {\n      onHeadersReceived: this._onHeadersReceived.bind(this),\n      onDone: this._onDone.bind(this),\n      onError: this._onError.bind(this),\n      onProgress: this._onProgress.bind(this),\n    };\n    this._url = source.url;\n    this._fullRequestId = manager.requestFull(args);\n    this._headersReceivedCapability = Promise.withResolvers();\n    this._disableRange = source.disableRange || false;\n    this._contentLength = source.length; // Optional\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._isStreamingSupported = false;\n    this._isRangeSupported = false;\n\n    this._cachedChunks = [];\n    this._requests = [];\n    this._done = false;\n    this._storedError = undefined;\n    this._filename = null;\n\n    this.onProgress = null;\n  }\n\n  _onHeadersReceived() {\n    const fullRequestXhrId = this._fullRequestId;\n    const fullRequestXhr = this._manager.getRequestXhr(fullRequestXhrId);\n\n    const getResponseHeader = name => fullRequestXhr.getResponseHeader(name);\n\n    const { allowRangeRequests, suggestedLength } =\n      validateRangeRequestCapabilities({\n        getResponseHeader,\n        isHttp: this._manager.isHttp,\n        rangeChunkSize: this._rangeChunkSize,\n        disableRange: this._disableRange,\n      });\n\n    if (allowRangeRequests) {\n      this._isRangeSupported = true;\n    }\n    // Setting right content length.\n    this._contentLength = suggestedLength || this._contentLength;\n\n    this._filename = extractFilenameFromHeader(getResponseHeader);\n\n    if (this._isRangeSupported) {\n      // NOTE: by cancelling the full request, and then issuing range\n      // requests, there will be an issue for sites where you can only\n      // request the pdf once. However, if this is the case, then the\n      // server should not be returning that it can support range requests.\n      this._manager.abortRequest(fullRequestXhrId);\n    }\n\n    this._headersReceivedCapability.resolve();\n  }\n\n  _onDone(data) {\n    if (data) {\n      if (this._requests.length > 0) {\n        const requestCapability = this._requests.shift();\n        requestCapability.resolve({ value: data.chunk, done: false });\n      } else {\n        this._cachedChunks.push(data.chunk);\n      }\n    }\n    this._done = true;\n    if (this._cachedChunks.length > 0) {\n      return;\n    }\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n  }\n\n  _onError(status) {\n    this._storedError = createResponseStatusError(status, this._url);\n    this._headersReceivedCapability.reject(this._storedError);\n    for (const requestCapability of this._requests) {\n      requestCapability.reject(this._storedError);\n    }\n    this._requests.length = 0;\n    this._cachedChunks.length = 0;\n  }\n\n  _onProgress(evt) {\n    this.onProgress?.({\n      loaded: evt.loaded,\n      total: evt.lengthComputable ? evt.total : this._contentLength,\n    });\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get headersReady() {\n    return this._headersReceivedCapability.promise;\n  }\n\n  async read() {\n    if (this._storedError) {\n      throw this._storedError;\n    }\n    if (this._cachedChunks.length > 0) {\n      const chunk = this._cachedChunks.shift();\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    this._headersReceivedCapability.reject(reason);\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    if (this._manager.isPendingRequest(this._fullRequestId)) {\n      this._manager.abortRequest(this._fullRequestId);\n    }\n    this._fullRequestReader = null;\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFNetworkStreamRangeRequestReader {\n  constructor(manager, begin, end) {\n    this._manager = manager;\n\n    const args = {\n      onDone: this._onDone.bind(this),\n      onError: this._onError.bind(this),\n      onProgress: this._onProgress.bind(this),\n    };\n    this._url = manager.url;\n    this._requestId = manager.requestRange(begin, end, args);\n    this._requests = [];\n    this._queuedChunk = null;\n    this._done = false;\n    this._storedError = undefined;\n\n    this.onProgress = null;\n    this.onClosed = null;\n  }\n\n  _close() {\n    this.onClosed?.(this);\n  }\n\n  _onDone(data) {\n    const chunk = data.chunk;\n    if (this._requests.length > 0) {\n      const requestCapability = this._requests.shift();\n      requestCapability.resolve({ value: chunk, done: false });\n    } else {\n      this._queuedChunk = chunk;\n    }\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    this._close();\n  }\n\n  _onError(status) {\n    this._storedError = createResponseStatusError(status, this._url);\n    for (const requestCapability of this._requests) {\n      requestCapability.reject(this._storedError);\n    }\n    this._requests.length = 0;\n    this._queuedChunk = null;\n  }\n\n  _onProgress(evt) {\n    if (!this.isStreamingSupported) {\n      this.onProgress?.({ loaded: evt.loaded });\n    }\n  }\n\n  get isStreamingSupported() {\n    return false;\n  }\n\n  async read() {\n    if (this._storedError) {\n      throw this._storedError;\n    }\n    if (this._queuedChunk !== null) {\n      const chunk = this._queuedChunk;\n      this._queuedChunk = null;\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    if (this._manager.isPendingRequest(this._requestId)) {\n      this._manager.abortRequest(this._requestId);\n    }\n    this._close();\n  }\n}\n\nexport { PDFNetworkStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AbortException, assert, MissingPDFException } from \"../shared/util.js\";\nimport {\n  extractFilenameFromHeader,\n  validateRangeRequestCapabilities,\n} from \"./network_utils.js\";\nimport { NodePackages } from \"./node_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./node_stream.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nconst fileUriRegex = /^file:\\/\\/\\/[a-zA-Z]:\\//;\n\nfunction parseUrl(sourceUrl) {\n  const url = NodePackages.get(\"url\");\n  const parsedUrl = url.parse(sourceUrl);\n  if (parsedUrl.protocol === \"file:\" || parsedUrl.host) {\n    return parsedUrl;\n  }\n  // Prepending 'file:///' to Windows absolute path.\n  if (/^[a-z]:[/\\\\]/i.test(sourceUrl)) {\n    return url.parse(`file:///${sourceUrl}`);\n  }\n  // Changes protocol to 'file:' if url refers to filesystem.\n  if (!parsedUrl.host) {\n    parsedUrl.protocol = \"file:\";\n  }\n  return parsedUrl;\n}\n\nclass PDFNodeStream {\n  constructor(source) {\n    this.source = source;\n    this.url = parseUrl(source.url);\n    this.isHttp =\n      this.url.protocol === \"http:\" || this.url.protocol === \"https:\";\n    // Check if url refers to filesystem.\n    this.isFsUrl = this.url.protocol === \"file:\";\n    this.httpHeaders = (this.isHttp && source.httpHeaders) || {};\n\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFNodeStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = this.isFsUrl\n      ? new PDFNodeStreamFsFullReader(this)\n      : new PDFNodeStreamFullReader(this);\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(start, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const rangeReader = this.isFsUrl\n      ? new PDFNodeStreamFsRangeReader(this, start, end)\n      : new PDFNodeStreamRangeReader(this, start, end);\n    this._rangeRequestReaders.push(rangeReader);\n    return rangeReader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\nclass BaseFullReader {\n  constructor(stream) {\n    this._url = stream.url;\n    this._done = false;\n    this._storedError = null;\n    this.onProgress = null;\n    const source = stream.source;\n    this._contentLength = source.length; // optional\n    this._loaded = 0;\n    this._filename = null;\n\n    this._disableRange = source.disableRange || false;\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._isStreamingSupported = !source.disableStream;\n    this._isRangeSupported = !source.disableRange;\n\n    this._readableStream = null;\n    this._readCapability = Promise.withResolvers();\n    this._headersCapability = Promise.withResolvers();\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    if (this._storedError) {\n      throw this._storedError;\n    }\n\n    const chunk = this._readableStream.read();\n    if (chunk === null) {\n      this._readCapability = Promise.withResolvers();\n      return this.read();\n    }\n    this._loaded += chunk.length;\n    this.onProgress?.({\n      loaded: this._loaded,\n      total: this._contentLength,\n    });\n\n    // Ensure that `read()` method returns ArrayBuffer.\n    const buffer = new Uint8Array(chunk).buffer;\n    return { value: buffer, done: false };\n  }\n\n  cancel(reason) {\n    // Call `this._error()` method when cancel is called\n    // before _readableStream is set.\n    if (!this._readableStream) {\n      this._error(reason);\n      return;\n    }\n    this._readableStream.destroy(reason);\n  }\n\n  _error(reason) {\n    this._storedError = reason;\n    this._readCapability.resolve();\n  }\n\n  _setReadableStream(readableStream) {\n    this._readableStream = readableStream;\n    readableStream.on(\"readable\", () => {\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"end\", () => {\n      // Destroy readable to minimize resource usage.\n      readableStream.destroy();\n      this._done = true;\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"error\", reason => {\n      this._error(reason);\n    });\n\n    // We need to stop reading when range is supported and streaming is\n    // disabled.\n    if (!this._isStreamingSupported && this._isRangeSupported) {\n      this._error(new AbortException(\"streaming is disabled\"));\n    }\n\n    // Destroy ReadableStream if already in errored state.\n    if (this._storedError) {\n      this._readableStream.destroy(this._storedError);\n    }\n  }\n}\n\nclass BaseRangeReader {\n  constructor(stream) {\n    this._url = stream.url;\n    this._done = false;\n    this._storedError = null;\n    this.onProgress = null;\n    this._loaded = 0;\n    this._readableStream = null;\n    this._readCapability = Promise.withResolvers();\n    const source = stream.source;\n    this._isStreamingSupported = !source.disableStream;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    if (this._storedError) {\n      throw this._storedError;\n    }\n\n    const chunk = this._readableStream.read();\n    if (chunk === null) {\n      this._readCapability = Promise.withResolvers();\n      return this.read();\n    }\n    this._loaded += chunk.length;\n    this.onProgress?.({ loaded: this._loaded });\n\n    // Ensure that `read()` method returns ArrayBuffer.\n    const buffer = new Uint8Array(chunk).buffer;\n    return { value: buffer, done: false };\n  }\n\n  cancel(reason) {\n    // Call `this._error()` method when cancel is called\n    // before _readableStream is set.\n    if (!this._readableStream) {\n      this._error(reason);\n      return;\n    }\n    this._readableStream.destroy(reason);\n  }\n\n  _error(reason) {\n    this._storedError = reason;\n    this._readCapability.resolve();\n  }\n\n  _setReadableStream(readableStream) {\n    this._readableStream = readableStream;\n    readableStream.on(\"readable\", () => {\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"end\", () => {\n      // Destroy readableStream to minimize resource usage.\n      readableStream.destroy();\n      this._done = true;\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"error\", reason => {\n      this._error(reason);\n    });\n\n    // Destroy readableStream if already in errored state.\n    if (this._storedError) {\n      this._readableStream.destroy(this._storedError);\n    }\n  }\n}\n\nfunction createRequestOptions(parsedUrl, headers) {\n  return {\n    protocol: parsedUrl.protocol,\n    auth: parsedUrl.auth,\n    host: parsedUrl.hostname,\n    port: parsedUrl.port,\n    path: parsedUrl.path,\n    method: \"GET\",\n    headers,\n  };\n}\n\nclass PDFNodeStreamFullReader extends BaseFullReader {\n  constructor(stream) {\n    super(stream);\n\n    const handleResponse = response => {\n      if (response.statusCode === 404) {\n        const error = new MissingPDFException(`Missing PDF \"${this._url}\".`);\n        this._storedError = error;\n        this._headersCapability.reject(error);\n        return;\n      }\n      this._headersCapability.resolve();\n      this._setReadableStream(response);\n\n      // Make sure that headers name are in lower case, as mentioned\n      // here: https://nodejs.org/api/http.html#http_message_headers.\n      const getResponseHeader = name =>\n        this._readableStream.headers[name.toLowerCase()];\n\n      const { allowRangeRequests, suggestedLength } =\n        validateRangeRequestCapabilities({\n          getResponseHeader,\n          isHttp: stream.isHttp,\n          rangeChunkSize: this._rangeChunkSize,\n          disableRange: this._disableRange,\n        });\n\n      this._isRangeSupported = allowRangeRequests;\n      // Setting right content length.\n      this._contentLength = suggestedLength || this._contentLength;\n\n      this._filename = extractFilenameFromHeader(getResponseHeader);\n    };\n\n    this._request = null;\n    if (this._url.protocol === \"http:\") {\n      const http = NodePackages.get(\"http\");\n      this._request = http.request(\n        createRequestOptions(this._url, stream.httpHeaders),\n        handleResponse\n      );\n    } else {\n      const https = NodePackages.get(\"https\");\n      this._request = https.request(\n        createRequestOptions(this._url, stream.httpHeaders),\n        handleResponse\n      );\n    }\n\n    this._request.on(\"error\", reason => {\n      this._storedError = reason;\n      this._headersCapability.reject(reason);\n    });\n    // Note: `request.end(data)` is used to write `data` to request body\n    // and notify end of request. But one should always call `request.end()`\n    // even if there is no data to write -- (to notify the end of request).\n    this._request.end();\n  }\n}\n\nclass PDFNodeStreamRangeReader extends BaseRangeReader {\n  constructor(stream, start, end) {\n    super(stream);\n\n    this._httpHeaders = {};\n    for (const property in stream.httpHeaders) {\n      const value = stream.httpHeaders[property];\n      if (value === undefined) {\n        continue;\n      }\n      this._httpHeaders[property] = value;\n    }\n    this._httpHeaders.Range = `bytes=${start}-${end - 1}`;\n\n    const handleResponse = response => {\n      if (response.statusCode === 404) {\n        const error = new MissingPDFException(`Missing PDF \"${this._url}\".`);\n        this._storedError = error;\n        return;\n      }\n      this._setReadableStream(response);\n    };\n\n    this._request = null;\n    if (this._url.protocol === \"http:\") {\n      const http = NodePackages.get(\"http\");\n      this._request = http.request(\n        createRequestOptions(this._url, this._httpHeaders),\n        handleResponse\n      );\n    } else {\n      const https = NodePackages.get(\"https\");\n      this._request = https.request(\n        createRequestOptions(this._url, this._httpHeaders),\n        handleResponse\n      );\n    }\n\n    this._request.on(\"error\", reason => {\n      this._storedError = reason;\n    });\n    this._request.end();\n  }\n}\n\nclass PDFNodeStreamFsFullReader extends BaseFullReader {\n  constructor(stream) {\n    super(stream);\n\n    let path = decodeURIComponent(this._url.path);\n\n    // Remove the extra slash to get right path from url like `file:///C:/`\n    if (fileUriRegex.test(this._url.href)) {\n      path = path.replace(/^\\//, \"\");\n    }\n\n    const fs = NodePackages.get(\"fs\");\n    fs.promises.lstat(path).then(\n      stat => {\n        // Setting right content length.\n        this._contentLength = stat.size;\n\n        this._setReadableStream(fs.createReadStream(path));\n        this._headersCapability.resolve();\n      },\n      error => {\n        if (error.code === \"ENOENT\") {\n          error = new MissingPDFException(`Missing PDF \"${path}\".`);\n        }\n        this._storedError = error;\n        this._headersCapability.reject(error);\n      }\n    );\n  }\n}\n\nclass PDFNodeStreamFsRangeReader extends BaseRangeReader {\n  constructor(stream, start, end) {\n    super(stream);\n\n    let path = decodeURIComponent(this._url.path);\n\n    // Remove the extra slash to get right path from url like `file:///C:/`\n    if (fileUriRegex.test(this._url.href)) {\n      path = path.replace(/^\\//, \"\");\n    }\n\n    const fs = NodePackages.get(\"fs\");\n    this._setReadableStream(fs.createReadStream(path, { start, end: end - 1 }));\n  }\n}\n\nexport { PDFNodeStream };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"./api\").TextContent} TextContent */\n\nimport { AbortException, Util, warn } from \"../shared/util.js\";\nimport { setLayerDimensions } from \"./display_utils.js\";\n\n/**\n * @typedef {Object} TextLayerParameters\n * @property {ReadableStream | TextContent} textContentSource - Text content to\n *   render, i.e. the value returned by the page's `streamTextContent` or\n *   `getTextContent` method.\n * @property {HTMLElement} container - The DOM node that will contain the text\n *   runs.\n * @property {PageViewport} viewport - The target viewport to properly layout\n *   the text runs.\n */\n\n/**\n * @typedef {Object} TextLayerUpdateParameters\n * @property {PageViewport} viewport - The target viewport to properly layout\n *   the text runs.\n * @property {function} [onBefore] - Callback invoked before the textLayer is\n *   updated in the DOM.\n */\n\nconst MAX_TEXT_DIVS_TO_RENDER = 100000;\nconst DEFAULT_FONT_SIZE = 30;\nconst DEFAULT_FONT_ASCENT = 0.8;\n\nclass TextLayer {\n  #capability = Promise.withResolvers();\n\n  #container = null;\n\n  #disableProcessItems = false;\n\n  #fontInspectorEnabled = !!globalThis.FontInspector?.enabled;\n\n  #lang = null;\n\n  #layoutTextParams = null;\n\n  #pageHeight = 0;\n\n  #pageWidth = 0;\n\n  #reader = null;\n\n  #rootContainer = null;\n\n  #rotation = 0;\n\n  #scale = 0;\n\n  #styleCache = Object.create(null);\n\n  #textContentItemsStr = [];\n\n  #textContentSource = null;\n\n  #textDivs = [];\n\n  #textDivProperties = new WeakMap();\n\n  #transform = null;\n\n  static #ascentCache = new Map();\n\n  static #canvasContexts = new Map();\n\n  static #minFontSize = null;\n\n  static #pendingTextLayers = new Set();\n\n  /**\n   * @param {TextLayerParameters} options\n   */\n  constructor({ textContentSource, container, viewport }) {\n    if (textContentSource instanceof ReadableStream) {\n      this.#textContentSource = textContentSource;\n    } else if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n      typeof textContentSource === \"object\"\n    ) {\n      this.#textContentSource = new ReadableStream({\n        start(controller) {\n          controller.enqueue(textContentSource);\n          controller.close();\n        },\n      });\n    } else {\n      throw new Error('No \"textContentSource\" parameter specified.');\n    }\n    this.#container = this.#rootContainer = container;\n\n    this.#scale = viewport.scale * (globalThis.devicePixelRatio || 1);\n    this.#rotation = viewport.rotation;\n    this.#layoutTextParams = {\n      prevFontSize: null,\n      prevFontFamily: null,\n      div: null,\n      properties: null,\n      ctx: null,\n    };\n    const { pageWidth, pageHeight, pageX, pageY } = viewport.rawDims;\n    this.#transform = [1, 0, 0, -1, -pageX, pageY + pageHeight];\n    this.#pageWidth = pageWidth;\n    this.#pageHeight = pageHeight;\n\n    TextLayer.#ensureMinFontSizeComputed();\n\n    setLayerDimensions(container, viewport);\n\n    // Always clean-up the temporary canvas once rendering is no longer pending.\n    this.#capability.promise\n      .catch(() => {\n        // Avoid \"Uncaught promise\" messages in the console.\n      })\n      .then(() => {\n        TextLayer.#pendingTextLayers.delete(this);\n        this.#layoutTextParams = null;\n        this.#styleCache = null;\n      });\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"pageWidth\", {\n        get() {\n          return this.#pageWidth;\n        },\n      });\n      Object.defineProperty(this, \"pageHeight\", {\n        get() {\n          return this.#pageHeight;\n        },\n      });\n    }\n  }\n\n  /**\n   * Render the textLayer.\n   * @returns {Promise}\n   */\n  render() {\n    const pump = () => {\n      this.#reader.read().then(({ value, done }) => {\n        if (done) {\n          this.#capability.resolve();\n          return;\n        }\n        this.#lang ??= value.lang;\n        Object.assign(this.#styleCache, value.styles);\n        this.#processItems(value.items);\n        pump();\n      }, this.#capability.reject);\n    };\n    this.#reader = this.#textContentSource.getReader();\n    TextLayer.#pendingTextLayers.add(this);\n    pump();\n\n    return this.#capability.promise;\n  }\n\n  /**\n   * Update a previously rendered textLayer, if necessary.\n   * @param {TextLayerUpdateParameters} options\n   * @returns {undefined}\n   */\n  update({ viewport, onBefore = null }) {\n    const scale = viewport.scale * (globalThis.devicePixelRatio || 1);\n    const rotation = viewport.rotation;\n\n    if (rotation !== this.#rotation) {\n      onBefore?.();\n      this.#rotation = rotation;\n      setLayerDimensions(this.#rootContainer, { rotation });\n    }\n\n    if (scale !== this.#scale) {\n      onBefore?.();\n      this.#scale = scale;\n      const params = {\n        prevFontSize: null,\n        prevFontFamily: null,\n        div: null,\n        properties: null,\n        ctx: TextLayer.#getCtx(this.#lang),\n      };\n      for (const div of this.#textDivs) {\n        params.properties = this.#textDivProperties.get(div);\n        params.div = div;\n        this.#layout(params);\n      }\n    }\n  }\n\n  /**\n   * Cancel rendering of the textLayer.\n   * @returns {undefined}\n   */\n  cancel() {\n    const abortEx = new AbortException(\"TextLayer task cancelled.\");\n\n    this.#reader?.cancel(abortEx).catch(() => {\n      // Avoid \"Uncaught promise\" messages in the console.\n    });\n    this.#reader = null;\n\n    this.#capability.reject(abortEx);\n  }\n\n  /**\n   * @type {Array<HTMLElement>} HTML elements that correspond to the text items\n   *   of the textContent input.\n   *   This is output and will initially be set to an empty array.\n   */\n  get textDivs() {\n    return this.#textDivs;\n  }\n\n  /**\n   * @type {Array<string>} Strings that correspond to the `str` property of\n   *   the text items of the textContent input.\n   *   This is output and will initially be set to an empty array\n   */\n  get textContentItemsStr() {\n    return this.#textContentItemsStr;\n  }\n\n  #processItems(items) {\n    if (this.#disableProcessItems) {\n      return;\n    }\n    this.#layoutTextParams.ctx ??= TextLayer.#getCtx(this.#lang);\n\n    const textDivs = this.#textDivs,\n      textContentItemsStr = this.#textContentItemsStr;\n\n    for (const item of items) {\n      // No point in rendering many divs as it would make the browser\n      // unusable even after the divs are rendered.\n      if (textDivs.length > MAX_TEXT_DIVS_TO_RENDER) {\n        warn(\"Ignoring additional textDivs for performance reasons.\");\n\n        this.#disableProcessItems = true; // Avoid multiple warnings for one page.\n        return;\n      }\n\n      if (item.str === undefined) {\n        if (\n          item.type === \"beginMarkedContentProps\" ||\n          item.type === \"beginMarkedContent\"\n        ) {\n          const parent = this.#container;\n          this.#container = document.createElement(\"span\");\n          this.#container.classList.add(\"markedContent\");\n          if (item.id !== null) {\n            this.#container.setAttribute(\"id\", `${item.id}`);\n          }\n          parent.append(this.#container);\n        } else if (item.type === \"endMarkedContent\") {\n          this.#container = this.#container.parentNode;\n        }\n        continue;\n      }\n      textContentItemsStr.push(item.str);\n      this.#appendText(item);\n    }\n  }\n\n  #appendText(geom) {\n    // Initialize all used properties to keep the caches monomorphic.\n    const textDiv = document.createElement(\"span\");\n    const textDivProperties = {\n      angle: 0,\n      canvasWidth: 0,\n      hasText: geom.str !== \"\",\n      hasEOL: geom.hasEOL,\n      fontSize: 0,\n    };\n    this.#textDivs.push(textDiv);\n\n    const tx = Util.transform(this.#transform, geom.transform);\n    let angle = Math.atan2(tx[1], tx[0]);\n    const style = this.#styleCache[geom.fontName];\n    if (style.vertical) {\n      angle += Math.PI / 2;\n    }\n\n    const fontFamily =\n      (this.#fontInspectorEnabled && style.fontSubstitution) ||\n      style.fontFamily;\n    const fontHeight = Math.hypot(tx[2], tx[3]);\n    const fontAscent =\n      fontHeight * TextLayer.#getAscent(fontFamily, this.#lang);\n\n    let left, top;\n    if (angle === 0) {\n      left = tx[4];\n      top = tx[5] - fontAscent;\n    } else {\n      left = tx[4] + fontAscent * Math.sin(angle);\n      top = tx[5] - fontAscent * Math.cos(angle);\n    }\n\n    const scaleFactorStr = \"calc(var(--scale-factor)*\";\n    const divStyle = textDiv.style;\n    // Setting the style properties individually, rather than all at once,\n    // should be OK since the `textDiv` isn't appended to the document yet.\n    if (this.#container === this.#rootContainer) {\n      divStyle.left = `${((100 * left) / this.#pageWidth).toFixed(2)}%`;\n      divStyle.top = `${((100 * top) / this.#pageHeight).toFixed(2)}%`;\n    } else {\n      // We're in a marked content span, hence we can't use percents.\n      divStyle.left = `${scaleFactorStr}${left.toFixed(2)}px)`;\n      divStyle.top = `${scaleFactorStr}${top.toFixed(2)}px)`;\n    }\n    // We multiply the font size by #minFontSize, and then #layout will\n    // scale the element by 1/#minFontSize. This allows us to effectively\n    // ignore the minimum font size enforced by the browser, so that the text\n    // layer <span>s can always match the size of the text in the canvas.\n    divStyle.fontSize = `${scaleFactorStr}${(TextLayer.#minFontSize * fontHeight).toFixed(2)}px)`;\n    divStyle.fontFamily = fontFamily;\n\n    textDivProperties.fontSize = fontHeight;\n\n    // Keeps screen readers from pausing on every new text span.\n    textDiv.setAttribute(\"role\", \"presentation\");\n\n    textDiv.textContent = geom.str;\n    // geom.dir may be 'ttb' for vertical texts.\n    textDiv.dir = geom.dir;\n\n    // `fontName` is only used by the FontInspector, and we only use `dataset`\n    // here to make the font name available in the debugger.\n    if (this.#fontInspectorEnabled) {\n      textDiv.dataset.fontName =\n        style.fontSubstitutionLoadedName || geom.fontName;\n    }\n    if (angle !== 0) {\n      textDivProperties.angle = angle * (180 / Math.PI);\n    }\n    // We don't bother scaling single-char text divs, because it has very\n    // little effect on text highlighting. This makes scrolling on docs with\n    // lots of such divs a lot faster.\n    let shouldScaleText = false;\n    if (geom.str.length > 1) {\n      shouldScaleText = true;\n    } else if (geom.str !== \" \" && geom.transform[0] !== geom.transform[3]) {\n      const absScaleX = Math.abs(geom.transform[0]),\n        absScaleY = Math.abs(geom.transform[3]);\n      // When the horizontal/vertical scaling differs significantly, also scale\n      // even single-char text to improve highlighting (fixes issue11713.pdf).\n      if (\n        absScaleX !== absScaleY &&\n        Math.max(absScaleX, absScaleY) / Math.min(absScaleX, absScaleY) > 1.5\n      ) {\n        shouldScaleText = true;\n      }\n    }\n    if (shouldScaleText) {\n      textDivProperties.canvasWidth = style.vertical ? geom.height : geom.width;\n    }\n    this.#textDivProperties.set(textDiv, textDivProperties);\n\n    // Finally, layout and append the text to the DOM.\n    this.#layoutTextParams.div = textDiv;\n    this.#layoutTextParams.properties = textDivProperties;\n    this.#layout(this.#layoutTextParams);\n\n    if (textDivProperties.hasText) {\n      this.#container.append(textDiv);\n    }\n    if (textDivProperties.hasEOL) {\n      const br = document.createElement(\"br\");\n      br.setAttribute(\"role\", \"presentation\");\n      this.#container.append(br);\n    }\n  }\n\n  #layout(params) {\n    const { div, properties, ctx, prevFontSize, prevFontFamily } = params;\n    const { style } = div;\n\n    let transform = \"\";\n    if (TextLayer.#minFontSize > 1) {\n      transform = `scale(${1 / TextLayer.#minFontSize})`;\n    }\n\n    if (properties.canvasWidth !== 0 && properties.hasText) {\n      const { fontFamily } = style;\n      const { canvasWidth, fontSize } = properties;\n\n      if (prevFontSize !== fontSize || prevFontFamily !== fontFamily) {\n        ctx.font = `${fontSize * this.#scale}px ${fontFamily}`;\n        params.prevFontSize = fontSize;\n        params.prevFontFamily = fontFamily;\n      }\n\n      // Only measure the width for multi-char text divs, see `appendText`.\n      const { width } = ctx.measureText(div.textContent);\n\n      if (width > 0) {\n        transform = `scaleX(${(canvasWidth * this.#scale) / width}) ${transform}`;\n      }\n    }\n    if (properties.angle !== 0) {\n      transform = `rotate(${properties.angle}deg) ${transform}`;\n    }\n    if (transform.length > 0) {\n      style.transform = transform;\n    }\n  }\n\n  /**\n   * Clean-up global textLayer data.\n   * @returns {undefined}\n   */\n  static cleanup() {\n    if (this.#pendingTextLayers.size > 0) {\n      return;\n    }\n    this.#ascentCache.clear();\n\n    for (const { canvas } of this.#canvasContexts.values()) {\n      canvas.remove();\n    }\n    this.#canvasContexts.clear();\n  }\n\n  static #getCtx(lang = null) {\n    let canvasContext = this.#canvasContexts.get((lang ||= \"\"));\n    if (!canvasContext) {\n      // We don't use an OffscreenCanvas here because we use serif/sans serif\n      // fonts with it and they depends on the locale.\n      // In Firefox, the <html> element get a lang attribute that depends on\n      // what Fluent returns for the locale and the OffscreenCanvas uses\n      // the OS locale.\n      // Those two locales can be different and consequently the used fonts will\n      // be different (see bug 1869001).\n      // Ideally, we should use in the text layer the fonts we've in the pdf (or\n      // their replacements when they aren't embedded) and then we can use an\n      // OffscreenCanvas.\n      const canvas = document.createElement(\"canvas\");\n      canvas.className = \"hiddenCanvasElement\";\n      canvas.lang = lang;\n      document.body.append(canvas);\n      canvasContext = canvas.getContext(\"2d\", {\n        alpha: false,\n        willReadFrequently: true,\n      });\n      this.#canvasContexts.set(lang, canvasContext);\n    }\n    return canvasContext;\n  }\n\n  /**\n   * Compute the minimum font size enforced by the browser.\n   */\n  static #ensureMinFontSizeComputed() {\n    if (this.#minFontSize !== null) {\n      return;\n    }\n    const div = document.createElement(\"div\");\n    div.style.opacity = 0;\n    div.style.lineHeight = 1;\n    div.style.fontSize = \"1px\";\n    div.style.position = \"absolute\";\n    div.textContent = \"X\";\n    document.body.append(div);\n    // In `display:block` elements contain a single line of text,\n    // the height matches the line height (which, when set to 1,\n    // matches the actual font size).\n    this.#minFontSize = div.getBoundingClientRect().height;\n    div.remove();\n  }\n\n  static #getAscent(fontFamily, lang) {\n    const cachedAscent = this.#ascentCache.get(fontFamily);\n    if (cachedAscent) {\n      return cachedAscent;\n    }\n    const ctx = this.#getCtx(lang);\n\n    const savedFont = ctx.font;\n    ctx.canvas.width = ctx.canvas.height = DEFAULT_FONT_SIZE;\n    ctx.font = `${DEFAULT_FONT_SIZE}px ${fontFamily}`;\n    const metrics = ctx.measureText(\"\");\n\n    // Both properties aren't available by default in Firefox.\n    let ascent = metrics.fontBoundingBoxAscent;\n    let descent = Math.abs(metrics.fontBoundingBoxDescent);\n    if (ascent) {\n      const ratio = ascent / (ascent + descent);\n      this.#ascentCache.set(fontFamily, ratio);\n\n      ctx.canvas.width = ctx.canvas.height = 0;\n      ctx.font = savedFont;\n      return ratio;\n    }\n\n    // Try basic heuristic to guess ascent/descent.\n    // Draw a g with baseline at 0,0 and then get the line\n    // number where a pixel has non-null red component (starting\n    // from bottom).\n    ctx.strokeStyle = \"red\";\n    ctx.clearRect(0, 0, DEFAULT_FONT_SIZE, DEFAULT_FONT_SIZE);\n    ctx.strokeText(\"g\", 0, 0);\n    let pixels = ctx.getImageData(\n      0,\n      0,\n      DEFAULT_FONT_SIZE,\n      DEFAULT_FONT_SIZE\n    ).data;\n    descent = 0;\n    for (let i = pixels.length - 1 - 3; i >= 0; i -= 4) {\n      if (pixels[i] > 0) {\n        descent = Math.ceil(i / 4 / DEFAULT_FONT_SIZE);\n        break;\n      }\n    }\n\n    // Draw an A with baseline at 0,DEFAULT_FONT_SIZE and then get the line\n    // number where a pixel has non-null red component (starting\n    // from top).\n    ctx.clearRect(0, 0, DEFAULT_FONT_SIZE, DEFAULT_FONT_SIZE);\n    ctx.strokeText(\"A\", 0, DEFAULT_FONT_SIZE);\n    pixels = ctx.getImageData(0, 0, DEFAULT_FONT_SIZE, DEFAULT_FONT_SIZE).data;\n    ascent = 0;\n    for (let i = 0, ii = pixels.length; i < ii; i += 4) {\n      if (pixels[i] > 0) {\n        ascent = DEFAULT_FONT_SIZE - Math.floor(i / 4 / DEFAULT_FONT_SIZE);\n        break;\n      }\n    }\n\n    ctx.canvas.width = ctx.canvas.height = 0;\n    ctx.font = savedFont;\n\n    const ratio = ascent ? ascent / (ascent + descent) : DEFAULT_FONT_ASCENT;\n    this.#ascentCache.set(fontFamily, ratio);\n    return ratio;\n  }\n}\n\nexport { TextLayer };\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./api\").TextContent} TextContent */\n\nclass XfaText {\n  /**\n   * Walk an XFA tree and create an array of text nodes that is compatible\n   * with a regular PDFs TextContent. Currently, only TextItem.str is supported,\n   * all other fields and styles haven't been implemented.\n   *\n   * @param {Object} xfa - An XFA fake DOM object.\n   *\n   * @returns {TextContent}\n   */\n  static textContent(xfa) {\n    const items = [];\n    const output = {\n      items,\n      styles: Object.create(null),\n    };\n    function walk(node) {\n      if (!node) {\n        return;\n      }\n      let str = null;\n      const name = node.name;\n      if (name === \"#text\") {\n        str = node.value;\n      } else if (!XfaText.shouldBuildText(name)) {\n        return;\n      } else if (node?.attributes?.textContent) {\n        str = node.attributes.textContent;\n      } else if (node.value) {\n        str = node.value;\n      }\n      if (str !== null) {\n        items.push({\n          str,\n        });\n      }\n      if (!node.children) {\n        return;\n      }\n      for (const child of node.children) {\n        walk(child);\n      }\n    }\n    walk(xfa);\n    return output;\n  }\n\n  /**\n   * @param {string} name - DOM node name. (lower case)\n   *\n   * @returns {boolean} true if the DOM node should have a corresponding text\n   * node.\n   */\n  static shouldBuildText(name) {\n    return !(\n      name === \"textarea\" ||\n      name === \"input\" ||\n      name === \"option\" ||\n      name === \"select\"\n    );\n  }\n}\n\nexport { XfaText };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @module pdfjsLib\n */\n\nimport {\n  AbortException,\n  AnnotationMode,\n  assert,\n  getVerbosityLevel,\n  info,\n  InvalidPDFException,\n  isNodeJS,\n  MAX_IMAGE_SIZE_TO_CACHE,\n  MissingPDFException,\n  PasswordException,\n  RenderingIntentFlag,\n  setVerbosityLevel,\n  shadow,\n  stringToBytes,\n  UnexpectedResponseException,\n  UnknownErrorException,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  AnnotationStorage,\n  PrintAnnotationStorage,\n  SerializableEmpty,\n} from \"./annotation_storage.js\";\nimport {\n  DOMCanvasFactory,\n  DOMCMapReaderFactory,\n  DOMFilterFactory,\n  DOMStandardFontDataFactory,\n  isDataScheme,\n  isValidFetchUrl,\n  PageViewport,\n  RenderingCancelledException,\n  StatTimer,\n} from \"./display_utils.js\";\nimport { FontFaceObject, FontLoader } from \"./font_loader.js\";\nimport {\n  NodeCanvasFactory,\n  NodeCMapReaderFactory,\n  NodeFilterFactory,\n  NodePackages,\n  NodeStandardFontDataFactory,\n} from \"display-node_utils\";\nimport { CanvasGraphics } from \"./canvas.js\";\nimport { GlobalWorkerOptions } from \"./worker_options.js\";\nimport { MessageHandler } from \"../shared/message_handler.js\";\nimport { Metadata } from \"./metadata.js\";\nimport { OptionalContentConfig } from \"./optional_content_config.js\";\nimport { PDFDataTransportStream } from \"./transport_stream.js\";\nimport { PDFFetchStream } from \"display-fetch_stream\";\nimport { PDFNetworkStream } from \"display-network\";\nimport { PDFNodeStream } from \"display-node_stream\";\nimport { TextLayer } from \"./text_layer.js\";\nimport { XfaText } from \"./xfa_text.js\";\n\nconst DEFAULT_RANGE_CHUNK_SIZE = 65536; // 2^16 = 65536\nconst RENDERING_CANCELLED_TIMEOUT = 100; // ms\nconst DELAYED_CLEANUP_TIMEOUT = 5000; // ms\n\nconst DefaultCanvasFactory =\n  typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n    ? NodeCanvasFactory\n    : DOMCanvasFactory;\nconst DefaultCMapReaderFactory =\n  typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n    ? NodeCMapReaderFactory\n    : DOMCMapReaderFactory;\nconst DefaultFilterFactory =\n  typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n    ? NodeFilterFactory\n    : DOMFilterFactory;\nconst DefaultStandardFontDataFactory =\n  typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n    ? NodeStandardFontDataFactory\n    : DOMStandardFontDataFactory;\n\n/**\n * @typedef { Int8Array | Uint8Array | Uint8ClampedArray |\n *            Int16Array | Uint16Array |\n *            Int32Array | Uint32Array | Float32Array |\n *            Float64Array\n * } TypedArray\n */\n\n/**\n * @typedef {Object} RefProxy\n * @property {number} num\n * @property {number} gen\n */\n\n/**\n * Document initialization / loading parameters object.\n *\n * @typedef {Object} DocumentInitParameters\n * @property {string | URL} [url] - The URL of the PDF.\n * @property {TypedArray | ArrayBuffer | Array<number> | string} [data] -\n *   Binary PDF data.\n *   Use TypedArrays (Uint8Array) to improve the memory usage. If PDF data is\n *   BASE64-encoded, use `atob()` to convert it to a binary string first.\n *\n *   NOTE: If TypedArrays are used they will generally be transferred to the\n *   worker-thread. This will help reduce main-thread memory usage, however\n *   it will take ownership of the TypedArrays.\n * @property {Object} [httpHeaders] - Basic authentication headers.\n * @property {boolean} [withCredentials] - Indicates whether or not\n *   cross-site Access-Control requests should be made using credentials such\n *   as cookies or authorization headers. The default is `false`.\n * @property {string} [password] - For decrypting password-protected PDFs.\n * @property {number} [length] - The PDF file length. It's used for progress\n *   reports and range requests operations.\n * @property {PDFDataRangeTransport} [range] - Allows for using a custom range\n *   transport implementation.\n * @property {number} [rangeChunkSize] - Specify maximum number of bytes fetched\n *   per range request. The default value is {@link DEFAULT_RANGE_CHUNK_SIZE}.\n * @property {PDFWorker} [worker] - The worker that will be used for loading and\n *   parsing the PDF data.\n * @property {number} [verbosity] - Controls the logging level; the constants\n *   from {@link VerbosityLevel} should be used.\n * @property {string} [docBaseUrl] - The base URL of the document, used when\n *   attempting to recover valid absolute URLs for annotations, and outline\n *   items, that (incorrectly) only specify relative URLs.\n * @property {string} [cMapUrl] - The URL where the predefined Adobe CMaps are\n *   located. Include the trailing slash.\n * @property {boolean} [cMapPacked] - Specifies if the Adobe CMaps are binary\n *   packed or not. The default value is `true`.\n * @property {Object} [CMapReaderFactory] - The factory that will be used when\n *   reading built-in CMap files. Providing a custom factory is useful for\n *   environments without Fetch API or `XMLHttpRequest` support, such as\n *   Node.js. The default value is {DOMCMapReaderFactory}.\n * @property {boolean} [useSystemFonts] - When `true`, fonts that aren't\n *   embedded in the PDF document will fallback to a system font.\n *   The default value is `true` in web environments and `false` in Node.js;\n *   unless `disableFontFace === true` in which case this defaults to `false`\n *   regardless of the environment (to prevent completely broken fonts).\n * @property {string} [standardFontDataUrl] - The URL where the standard font\n *   files are located. Include the trailing slash.\n * @property {Object} [StandardFontDataFactory] - The factory that will be used\n *   when reading the standard font files. Providing a custom factory is useful\n *   for environments without Fetch API or `XMLHttpRequest` support, such as\n *   Node.js. The default value is {DOMStandardFontDataFactory}.\n * @property {boolean} [useWorkerFetch] - Enable using the Fetch API in the\n *   worker-thread when reading CMap and standard font files. When `true`,\n *   the `CMapReaderFactory` and `StandardFontDataFactory` options are ignored.\n *   The default value is `true` in web environments and `false` in Node.js.\n * @property {boolean} [stopAtErrors] - Reject certain promises, e.g.\n *   `getOperatorList`, `getTextContent`, and `RenderTask`, when the associated\n *   PDF data cannot be successfully parsed, instead of attempting to recover\n *   whatever possible of the data. The default value is `false`.\n * @property {number} [maxImageSize] - The maximum allowed image size in total\n *   pixels, i.e. width * height. Images above this value will not be rendered.\n *   Use -1 for no limit, which is also the default value.\n * @property {boolean} [isEvalSupported] - Determines if we can evaluate strings\n *   as JavaScript. Primarily used to improve performance of PDF functions.\n *   The default value is `true`.\n * @property {boolean} [isOffscreenCanvasSupported] - Determines if we can use\n *   `OffscreenCanvas` in the worker. Primarily used to improve performance of\n *   image conversion/rendering.\n *   The default value is `true` in web environments and `false` in Node.js.\n * @property {number} [canvasMaxAreaInBytes] - The integer value is used to\n *   know when an image must be resized (uses `OffscreenCanvas` in the worker).\n *   If it's -1 then a possibly slow algorithm is used to guess the max value.\n * @property {boolean} [disableFontFace] - By default fonts are converted to\n *   OpenType fonts and loaded via the Font Loading API or `@font-face` rules.\n *   If disabled, fonts will be rendered using a built-in font renderer that\n *   constructs the glyphs with primitive path commands.\n *   The default value is `false` in web environments and `true` in Node.js.\n * @property {boolean} [fontExtraProperties] - Include additional properties,\n *   which are unused during rendering of PDF documents, when exporting the\n *   parsed font data from the worker-thread. This may be useful for debugging\n *   purposes (and backwards compatibility), but note that it will lead to\n *   increased memory usage. The default value is `false`.\n * @property {boolean} [enableXfa] - Render Xfa forms if any.\n *   The default value is `false`.\n * @property {HTMLDocument} [ownerDocument] - Specify an explicit document\n *   context to create elements with and to load resources, such as fonts,\n *   into. Defaults to the current document.\n * @property {boolean} [disableRange] - Disable range request loading of PDF\n *   files. When enabled, and if the server supports partial content requests,\n *   then the PDF will be fetched in chunks. The default value is `false`.\n * @property {boolean} [disableStream] - Disable streaming of PDF file data.\n *   By default PDF.js attempts to load PDF files in chunks. The default value\n *   is `false`.\n * @property {boolean} [disableAutoFetch] - Disable pre-fetching of PDF file\n *   data. When range requests are enabled PDF.js will automatically keep\n *   fetching more data even if it isn't needed to display the current page.\n *   The default value is `false`.\n *\n *   NOTE: It is also necessary to disable streaming, see above, in order for\n *   disabling of pre-fetching to work correctly.\n * @property {boolean} [pdfBug] - Enables special hooks for debugging PDF.js\n *   (see `web/debugger.js`). The default value is `false`.\n * @property {Object} [canvasFactory] - The factory instance that will be used\n *   when creating canvases. The default value is {new DOMCanvasFactory()}.\n * @property {Object} [filterFactory] - A factory instance that will be used\n *   to create SVG filters when rendering some images on the main canvas.\n * @property {boolean} [enableHWA] - Enables hardware acceleration for\n *   rendering. The default value is `false`.\n */\n\n/**\n * This is the main entry point for loading a PDF and interacting with it.\n *\n * NOTE: If a URL is used to fetch the PDF data a standard Fetch API call (or\n * XHR as fallback) is used, which means it must follow same origin rules,\n * e.g. no cross-domain requests without CORS.\n *\n * @param {string | URL | TypedArray | ArrayBuffer | DocumentInitParameters}\n *   src - Can be a URL where a PDF file is located, a typed array (Uint8Array)\n *         already populated with data, or a parameter object.\n * @returns {PDFDocumentLoadingTask}\n */\nfunction getDocument(src = {}) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n    if (typeof src === \"string\" || src instanceof URL) {\n      src = { url: src };\n    } else if (src instanceof ArrayBuffer || ArrayBuffer.isView(src)) {\n      src = { data: src };\n    }\n  }\n  const task = new PDFDocumentLoadingTask();\n  const { docId } = task;\n\n  const url = src.url ? getUrlProp(src.url) : null;\n  const data = src.data ? getDataProp(src.data) : null;\n  const httpHeaders = src.httpHeaders || null;\n  const withCredentials = src.withCredentials === true;\n  const password = src.password ?? null;\n  const rangeTransport =\n    src.range instanceof PDFDataRangeTransport ? src.range : null;\n  const rangeChunkSize =\n    Number.isInteger(src.rangeChunkSize) && src.rangeChunkSize > 0\n      ? src.rangeChunkSize\n      : DEFAULT_RANGE_CHUNK_SIZE;\n  let worker = src.worker instanceof PDFWorker ? src.worker : null;\n  const verbosity = src.verbosity;\n  // Ignore \"data:\"-URLs, since they can't be used to recover valid absolute\n  // URLs anyway. We want to avoid sending them to the worker-thread, since\n  // they contain the *entire* PDF document and can thus be arbitrarily long.\n  const docBaseUrl =\n    typeof src.docBaseUrl === \"string\" && !isDataScheme(src.docBaseUrl)\n      ? src.docBaseUrl\n      : null;\n  const cMapUrl = typeof src.cMapUrl === \"string\" ? src.cMapUrl : null;\n  const cMapPacked = src.cMapPacked !== false;\n  const CMapReaderFactory = src.CMapReaderFactory || DefaultCMapReaderFactory;\n  const standardFontDataUrl =\n    typeof src.standardFontDataUrl === \"string\"\n      ? src.standardFontDataUrl\n      : null;\n  const StandardFontDataFactory =\n    src.StandardFontDataFactory || DefaultStandardFontDataFactory;\n  const ignoreErrors = src.stopAtErrors !== true;\n  const maxImageSize =\n    Number.isInteger(src.maxImageSize) && src.maxImageSize > -1\n      ? src.maxImageSize\n      : -1;\n  const isEvalSupported = src.isEvalSupported !== false;\n  const isOffscreenCanvasSupported =\n    typeof src.isOffscreenCanvasSupported === \"boolean\"\n      ? src.isOffscreenCanvasSupported\n      : !isNodeJS;\n  const canvasMaxAreaInBytes = Number.isInteger(src.canvasMaxAreaInBytes)\n    ? src.canvasMaxAreaInBytes\n    : -1;\n  const disableFontFace =\n    typeof src.disableFontFace === \"boolean\" ? src.disableFontFace : isNodeJS;\n  const fontExtraProperties = src.fontExtraProperties === true;\n  const enableXfa = src.enableXfa === true;\n  const ownerDocument = src.ownerDocument || globalThis.document;\n  const disableRange = src.disableRange === true;\n  const disableStream = src.disableStream === true;\n  const disableAutoFetch = src.disableAutoFetch === true;\n  const pdfBug = src.pdfBug === true;\n  const enableHWA = src.enableHWA === true;\n\n  // Parameters whose default values depend on other parameters.\n  const length = rangeTransport ? rangeTransport.length : (src.length ?? NaN);\n  const useSystemFonts =\n    typeof src.useSystemFonts === \"boolean\"\n      ? src.useSystemFonts\n      : !isNodeJS && !disableFontFace;\n  const useWorkerFetch =\n    typeof src.useWorkerFetch === \"boolean\"\n      ? src.useWorkerFetch\n      : (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        (CMapReaderFactory === DOMCMapReaderFactory &&\n          StandardFontDataFactory === DOMStandardFontDataFactory &&\n          cMapUrl &&\n          standardFontDataUrl &&\n          isValidFetchUrl(cMapUrl, document.baseURI) &&\n          isValidFetchUrl(standardFontDataUrl, document.baseURI));\n  const canvasFactory =\n    src.canvasFactory || new DefaultCanvasFactory({ ownerDocument, enableHWA });\n  const filterFactory =\n    src.filterFactory || new DefaultFilterFactory({ docId, ownerDocument });\n\n  // Parameters only intended for development/testing purposes.\n  const styleElement =\n    typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")\n      ? src.styleElement\n      : null;\n\n  // Set the main-thread verbosity level.\n  setVerbosityLevel(verbosity);\n\n  // Ensure that the various factories can be initialized, when necessary,\n  // since the user may provide *custom* ones.\n  const transportFactory = {\n    canvasFactory,\n    filterFactory,\n  };\n  if (!useWorkerFetch) {\n    transportFactory.cMapReaderFactory = new CMapReaderFactory({\n      baseUrl: cMapUrl,\n      isCompressed: cMapPacked,\n    });\n    transportFactory.standardFontDataFactory = new StandardFontDataFactory({\n      baseUrl: standardFontDataUrl,\n    });\n  }\n\n  if (!worker) {\n    const workerParams = {\n      verbosity,\n      port: GlobalWorkerOptions.workerPort,\n    };\n    // Worker was not provided -- creating and owning our own. If message port\n    // is specified in global worker options, using it.\n    worker = workerParams.port\n      ? PDFWorker.fromPort(workerParams)\n      : new PDFWorker(workerParams);\n    task._worker = worker;\n  }\n\n  const docParams = {\n    docId,\n    apiVersion:\n      typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"TESTING\")\n        ? PDFJSDev.eval(\"BUNDLE_VERSION\")\n        : null,\n    data,\n    password,\n    disableAutoFetch,\n    rangeChunkSize,\n    length,\n    docBaseUrl,\n    enableXfa,\n    evaluatorOptions: {\n      maxImageSize,\n      disableFontFace,\n      ignoreErrors,\n      isEvalSupported,\n      isOffscreenCanvasSupported,\n      canvasMaxAreaInBytes,\n      fontExtraProperties,\n      useSystemFonts,\n      cMapUrl: useWorkerFetch ? cMapUrl : null,\n      standardFontDataUrl: useWorkerFetch ? standardFontDataUrl : null,\n    },\n  };\n  const transportParams = {\n    disableFontFace,\n    fontExtraProperties,\n    ownerDocument,\n    pdfBug,\n    styleElement,\n    loadingParams: {\n      disableAutoFetch,\n      enableXfa,\n    },\n  };\n\n  worker.promise\n    .then(function () {\n      if (task.destroyed) {\n        throw new Error(\"Loading aborted\");\n      }\n      if (worker.destroyed) {\n        throw new Error(\"Worker was destroyed\");\n      }\n\n      const workerIdPromise = worker.messageHandler.sendWithPromise(\n        \"GetDocRequest\",\n        docParams,\n        data ? [data.buffer] : null\n      );\n\n      let networkStream;\n      if (rangeTransport) {\n        networkStream = new PDFDataTransportStream(rangeTransport, {\n          disableRange,\n          disableStream,\n        });\n      } else if (!data) {\n        if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n          throw new Error(\"Not implemented: createPDFNetworkStream\");\n        }\n        if (!url) {\n          throw new Error(\"getDocument - no `url` parameter provided.\");\n        }\n        const createPDFNetworkStream = params => {\n          if (\n            typeof PDFJSDev !== \"undefined\" &&\n            PDFJSDev.test(\"GENERIC\") &&\n            isNodeJS\n          ) {\n            const isFetchSupported = function () {\n              return (\n                typeof fetch !== \"undefined\" &&\n                typeof Response !== \"undefined\" &&\n                \"body\" in Response.prototype\n              );\n            };\n            return isFetchSupported() && isValidFetchUrl(params.url)\n              ? new PDFFetchStream(params)\n              : new PDFNodeStream(params);\n          }\n          return isValidFetchUrl(params.url)\n            ? new PDFFetchStream(params)\n            : new PDFNetworkStream(params);\n        };\n\n        networkStream = createPDFNetworkStream({\n          url,\n          length,\n          httpHeaders,\n          withCredentials,\n          rangeChunkSize,\n          disableRange,\n          disableStream,\n        });\n      }\n\n      return workerIdPromise.then(workerId => {\n        if (task.destroyed) {\n          throw new Error(\"Loading aborted\");\n        }\n        if (worker.destroyed) {\n          throw new Error(\"Worker was destroyed\");\n        }\n\n        const messageHandler = new MessageHandler(docId, workerId, worker.port);\n        const transport = new WorkerTransport(\n          messageHandler,\n          task,\n          networkStream,\n          transportParams,\n          transportFactory\n        );\n        task._transport = transport;\n        messageHandler.send(\"Ready\", null);\n      });\n    })\n    .catch(task._capability.reject);\n\n  return task;\n}\n\nfunction getUrlProp(val) {\n  if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n    return null; // The 'url' is unused with `PDFDataRangeTransport`.\n  }\n  if (val instanceof URL) {\n    return val.href;\n  }\n  try {\n    // The full path is required in the 'url' field.\n    return new URL(val, window.location).href;\n  } catch {\n    if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"GENERIC\") &&\n      isNodeJS &&\n      typeof val === \"string\"\n    ) {\n      return val; // Use the url as-is in Node.js environments.\n    }\n  }\n  throw new Error(\n    \"Invalid PDF url data: \" +\n      \"either string or URL-object is expected in the url property.\"\n  );\n}\n\nfunction getDataProp(val) {\n  // Converting string or array-like data to Uint8Array.\n  if (\n    typeof PDFJSDev !== \"undefined\" &&\n    PDFJSDev.test(\"GENERIC\") &&\n    isNodeJS &&\n    typeof Buffer !== \"undefined\" && // eslint-disable-line no-undef\n    val instanceof Buffer // eslint-disable-line no-undef\n  ) {\n    throw new Error(\n      \"Please provide binary data as `Uint8Array`, rather than `Buffer`.\"\n    );\n  }\n  if (val instanceof Uint8Array && val.byteLength === val.buffer.byteLength) {\n    // Use the data as-is when it's already a Uint8Array that completely\n    // \"utilizes\" its underlying ArrayBuffer, to prevent any possible\n    // issues when transferring it to the worker-thread.\n    return val;\n  }\n  if (typeof val === \"string\") {\n    return stringToBytes(val);\n  }\n  if (\n    val instanceof ArrayBuffer ||\n    ArrayBuffer.isView(val) ||\n    (typeof val === \"object\" && !isNaN(val?.length))\n  ) {\n    return new Uint8Array(val);\n  }\n  throw new Error(\n    \"Invalid PDF binary data: either TypedArray, \" +\n      \"string, or array-like object is expected in the data property.\"\n  );\n}\n\nfunction isRefProxy(ref) {\n  return (\n    typeof ref === \"object\" &&\n    Number.isInteger(ref?.num) &&\n    ref.num >= 0 &&\n    Number.isInteger(ref?.gen) &&\n    ref.gen >= 0\n  );\n}\n\n/**\n * @typedef {Object} OnProgressParameters\n * @property {number} loaded - Currently loaded number of bytes.\n * @property {number} total - Total number of bytes in the PDF file.\n */\n\n/**\n * The loading task controls the operations required to load a PDF document\n * (such as network requests) and provides a way to listen for completion,\n * after which individual pages can be rendered.\n */\nclass PDFDocumentLoadingTask {\n  static #docId = 0;\n\n  constructor() {\n    this._capability = Promise.withResolvers();\n    this._transport = null;\n    this._worker = null;\n\n    /**\n     * Unique identifier for the document loading task.\n     * @type {string}\n     */\n    this.docId = `d${PDFDocumentLoadingTask.#docId++}`;\n\n    /**\n     * Whether the loading task is destroyed or not.\n     * @type {boolean}\n     */\n    this.destroyed = false;\n\n    /**\n     * Callback to request a password if a wrong or no password was provided.\n     * The callback receives two parameters: a function that should be called\n     * with the new password, and a reason (see {@link PasswordResponses}).\n     * @type {function}\n     */\n    this.onPassword = null;\n\n    /**\n     * Callback to be able to monitor the loading progress of the PDF file\n     * (necessary to implement e.g. a loading bar).\n     * The callback receives an {@link OnProgressParameters} argument.\n     * @type {function}\n     */\n    this.onProgress = null;\n  }\n\n  /**\n   * Promise for document loading task completion.\n   * @type {Promise<PDFDocumentProxy>}\n   */\n  get promise() {\n    return this._capability.promise;\n  }\n\n  /**\n   * Abort all network requests and destroy the worker.\n   * @returns {Promise<void>} A promise that is resolved when destruction is\n   *   completed.\n   */\n  async destroy() {\n    this.destroyed = true;\n    try {\n      if (this._worker?.port) {\n        this._worker._pendingDestroy = true;\n      }\n      await this._transport?.destroy();\n    } catch (ex) {\n      if (this._worker?.port) {\n        delete this._worker._pendingDestroy;\n      }\n      throw ex;\n    }\n\n    this._transport = null;\n    if (this._worker) {\n      this._worker.destroy();\n      this._worker = null;\n    }\n  }\n}\n\n/**\n * Abstract class to support range requests file loading.\n *\n * NOTE: The TypedArrays passed to the constructor and relevant methods below\n * will generally be transferred to the worker-thread. This will help reduce\n * main-thread memory usage, however it will take ownership of the TypedArrays.\n */\nclass PDFDataRangeTransport {\n  /**\n   * @param {number} length\n   * @param {Uint8Array|null} initialData\n   * @param {boolean} [progressiveDone]\n   * @param {string} [contentDispositionFilename]\n   */\n  constructor(\n    length,\n    initialData,\n    progressiveDone = false,\n    contentDispositionFilename = null\n  ) {\n    this.length = length;\n    this.initialData = initialData;\n    this.progressiveDone = progressiveDone;\n    this.contentDispositionFilename = contentDispositionFilename;\n\n    this._rangeListeners = [];\n    this._progressListeners = [];\n    this._progressiveReadListeners = [];\n    this._progressiveDoneListeners = [];\n    this._readyCapability = Promise.withResolvers();\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addRangeListener(listener) {\n    this._rangeListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressListener(listener) {\n    this._progressListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressiveReadListener(listener) {\n    this._progressiveReadListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressiveDoneListener(listener) {\n    this._progressiveDoneListeners.push(listener);\n  }\n\n  /**\n   * @param {number} begin\n   * @param {Uint8Array|null} chunk\n   */\n  onDataRange(begin, chunk) {\n    for (const listener of this._rangeListeners) {\n      listener(begin, chunk);\n    }\n  }\n\n  /**\n   * @param {number} loaded\n   * @param {number|undefined} total\n   */\n  onDataProgress(loaded, total) {\n    this._readyCapability.promise.then(() => {\n      for (const listener of this._progressListeners) {\n        listener(loaded, total);\n      }\n    });\n  }\n\n  /**\n   * @param {Uint8Array|null} chunk\n   */\n  onDataProgressiveRead(chunk) {\n    this._readyCapability.promise.then(() => {\n      for (const listener of this._progressiveReadListeners) {\n        listener(chunk);\n      }\n    });\n  }\n\n  onDataProgressiveDone() {\n    this._readyCapability.promise.then(() => {\n      for (const listener of this._progressiveDoneListeners) {\n        listener();\n      }\n    });\n  }\n\n  transportReady() {\n    this._readyCapability.resolve();\n  }\n\n  /**\n   * @param {number} begin\n   * @param {number} end\n   */\n  requestDataRange(begin, end) {\n    unreachable(\"Abstract method PDFDataRangeTransport.requestDataRange\");\n  }\n\n  abort() {}\n}\n\n/**\n * Proxy to a `PDFDocument` in the worker thread.\n */\nclass PDFDocumentProxy {\n  constructor(pdfInfo, transport) {\n    this._pdfInfo = pdfInfo;\n    this._transport = transport;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getNetworkStreamName\", {\n        value: () => this._transport.getNetworkStreamName(),\n      });\n      Object.defineProperty(this, \"getXFADatasets\", {\n        value: () => this._transport.getXFADatasets(),\n      });\n      Object.defineProperty(this, \"getXRefPrevValue\", {\n        value: () => this._transport.getXRefPrevValue(),\n      });\n      Object.defineProperty(this, \"getStartXRefPos\", {\n        value: () => this._transport.getStartXRefPos(),\n      });\n      Object.defineProperty(this, \"getAnnotArray\", {\n        value: pageIndex => this._transport.getAnnotArray(pageIndex),\n      });\n    }\n  }\n\n  /**\n   * @type {AnnotationStorage} Storage for annotation data in forms.\n   */\n  get annotationStorage() {\n    return this._transport.annotationStorage;\n  }\n\n  /**\n   * @type {Object} The filter factory instance.\n   */\n  get filterFactory() {\n    return this._transport.filterFactory;\n  }\n\n  /**\n   * @type {number} Total number of pages in the PDF file.\n   */\n  get numPages() {\n    return this._pdfInfo.numPages;\n  }\n\n  /**\n   * @type {Array<string, string|null>} A (not guaranteed to be) unique ID to\n   *   identify the PDF document.\n   *   NOTE: The first element will always be defined for all PDF documents,\n   *   whereas the second element is only defined for *modified* PDF documents.\n   */\n  get fingerprints() {\n    return this._pdfInfo.fingerprints;\n  }\n\n  /**\n   * @type {boolean} True if only XFA form.\n   */\n  get isPureXfa() {\n    return shadow(this, \"isPureXfa\", !!this._transport._htmlForXfa);\n  }\n\n  /**\n   * NOTE: This is (mostly) intended to support printing of XFA forms.\n   *\n   * @type {Object | null} An object representing a HTML tree structure\n   *   to render the XFA, or `null` when no XFA form exists.\n   */\n  get allXfaHtml() {\n    return this._transport._htmlForXfa;\n  }\n\n  /**\n   * @param {number} pageNumber - The page number to get. The first page is 1.\n   * @returns {Promise<PDFPageProxy>} A promise that is resolved with\n   *   a {@link PDFPageProxy} object.\n   */\n  getPage(pageNumber) {\n    return this._transport.getPage(pageNumber);\n  }\n\n  /**\n   * @param {RefProxy} ref - The page reference.\n   * @returns {Promise<number>} A promise that is resolved with the page index,\n   *   starting from zero, that is associated with the reference.\n   */\n  getPageIndex(ref) {\n    return this._transport.getPageIndex(ref);\n  }\n\n  /**\n   * @returns {Promise<Object<string, Array<any>>>} A promise that is resolved\n   *   with a mapping from named destinations to references.\n   *\n   * This can be slow for large documents. Use `getDestination` instead.\n   */\n  getDestinations() {\n    return this._transport.getDestinations();\n  }\n\n  /**\n   * @param {string} id - The named destination to get.\n   * @returns {Promise<Array<any> | null>} A promise that is resolved with all\n   *   information of the given named destination, or `null` when the named\n   *   destination is not present in the PDF file.\n   */\n  getDestination(id) {\n    return this._transport.getDestination(id);\n  }\n\n  /**\n   * @returns {Promise<Array<string> | null>} A promise that is resolved with\n   *   an {Array} containing the page labels that correspond to the page\n   *   indexes, or `null` when no page labels are present in the PDF file.\n   */\n  getPageLabels() {\n    return this._transport.getPageLabels();\n  }\n\n  /**\n   * @returns {Promise<string>} A promise that is resolved with a {string}\n   *   containing the page layout name.\n   */\n  getPageLayout() {\n    return this._transport.getPageLayout();\n  }\n\n  /**\n   * @returns {Promise<string>} A promise that is resolved with a {string}\n   *   containing the page mode name.\n   */\n  getPageMode() {\n    return this._transport.getPageMode();\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with an\n   *   {Object} containing the viewer preferences, or `null` when no viewer\n   *   preferences are present in the PDF file.\n   */\n  getViewerPreferences() {\n    return this._transport.getViewerPreferences();\n  }\n\n  /**\n   * @returns {Promise<any | null>} A promise that is resolved with an {Array}\n   *   containing the destination, or `null` when no open action is present\n   *   in the PDF.\n   */\n  getOpenAction() {\n    return this._transport.getOpenAction();\n  }\n\n  /**\n   * @returns {Promise<any>} A promise that is resolved with a lookup table\n   *   for mapping named attachments to their content.\n   */\n  getAttachments() {\n    return this._transport.getAttachments();\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with\n   *   an {Object} with the JavaScript actions:\n   *     - from the name tree.\n   *     - from A or AA entries in the catalog dictionary.\n   *   , or `null` if no JavaScript exists.\n   */\n  getJSActions() {\n    return this._transport.getDocJSActions();\n  }\n\n  /**\n   * @typedef {Object} OutlineNode\n   * @property {string} title\n   * @property {boolean} bold\n   * @property {boolean} italic\n   * @property {Uint8ClampedArray} color - The color in RGB format to use for\n   *   display purposes.\n   * @property {string | Array<any> | null} dest\n   * @property {string | null} url\n   * @property {string | undefined} unsafeUrl\n   * @property {boolean | undefined} newWindow\n   * @property {number | undefined} count\n   * @property {Array<OutlineNode>} items\n   */\n\n  /**\n   * @returns {Promise<Array<OutlineNode>>} A promise that is resolved with an\n   *   {Array} that is a tree outline (if it has one) of the PDF file.\n   */\n  getOutline() {\n    return this._transport.getOutline();\n  }\n\n  /**\n   * @typedef {Object} GetOptionalContentConfigParameters\n   * @property {string} [intent] - Determines the optional content groups that\n   *   are visible by default; valid values are:\n   *    - 'display' (viewable groups).\n   *    - 'print' (printable groups).\n   *    - 'any' (all groups).\n   *   The default value is 'display'.\n   */\n\n  /**\n   * @param {GetOptionalContentConfigParameters} [params] - Optional content\n   *   config parameters.\n   * @returns {Promise<OptionalContentConfig>} A promise that is resolved with\n   *   an {@link OptionalContentConfig} that contains all the optional content\n   *   groups (assuming that the document has any).\n   */\n  getOptionalContentConfig({ intent = \"display\" } = {}) {\n    const { renderingIntent } = this._transport.getRenderingIntent(intent);\n\n    return this._transport.getOptionalContentConfig(renderingIntent);\n  }\n\n  /**\n   * @returns {Promise<Array<number> | null>} A promise that is resolved with\n   *   an {Array} that contains the permission flags for the PDF document, or\n   *   `null` when no permissions are present in the PDF file.\n   */\n  getPermissions() {\n    return this._transport.getPermissions();\n  }\n\n  /**\n   * @returns {Promise<{ info: Object, metadata: Metadata }>} A promise that is\n   *   resolved with an {Object} that has `info` and `metadata` properties.\n   *   `info` is an {Object} filled with anything available in the information\n   *   dictionary and similarly `metadata` is a {Metadata} object with\n   *   information from the metadata section of the PDF.\n   */\n  getMetadata() {\n    return this._transport.getMetadata();\n  }\n\n  /**\n   * @typedef {Object} MarkInfo\n   * Properties correspond to Table 321 of the PDF 32000-1:2008 spec.\n   * @property {boolean} Marked\n   * @property {boolean} UserProperties\n   * @property {boolean} Suspects\n   */\n\n  /**\n   * @returns {Promise<MarkInfo | null>} A promise that is resolved with\n   *   a {MarkInfo} object that contains the MarkInfo flags for the PDF\n   *   document, or `null` when no MarkInfo values are present in the PDF file.\n   */\n  getMarkInfo() {\n    return this._transport.getMarkInfo();\n  }\n\n  /**\n   * @returns {Promise<Uint8Array>} A promise that is resolved with a\n   *   {Uint8Array} containing the raw data of the PDF document.\n   */\n  getData() {\n    return this._transport.getData();\n  }\n\n  /**\n   * @returns {Promise<Uint8Array>} A promise that is resolved with a\n   *   {Uint8Array} containing the full data of the saved document.\n   */\n  saveDocument() {\n    return this._transport.saveDocument();\n  }\n\n  /**\n   * @returns {Promise<{ length: number }>} A promise that is resolved when the\n   *   document's data is loaded. It is resolved with an {Object} that contains\n   *   the `length` property that indicates size of the PDF data in bytes.\n   */\n  getDownloadInfo() {\n    return this._transport.downloadInfoCapability.promise;\n  }\n\n  /**\n   * Cleans up resources allocated by the document on both the main and worker\n   * threads.\n   *\n   * NOTE: Do not, under any circumstances, call this method when rendering is\n   * currently ongoing since that may lead to rendering errors.\n   *\n   * @param {boolean} [keepLoadedFonts] - Let fonts remain attached to the DOM.\n   *   NOTE: This will increase persistent memory usage, hence don't use this\n   *   option unless absolutely necessary. The default value is `false`.\n   * @returns {Promise} A promise that is resolved when clean-up has finished.\n   */\n  cleanup(keepLoadedFonts = false) {\n    return this._transport.startCleanup(keepLoadedFonts || this.isPureXfa);\n  }\n\n  /**\n   * Destroys the current document instance and terminates the worker.\n   */\n  destroy() {\n    return this.loadingTask.destroy();\n  }\n\n  /**\n   * @param {RefProxy} ref - The page reference.\n   * @returns {number | null} The page number, if it's cached.\n   */\n  cachedPageNumber(ref) {\n    return this._transport.cachedPageNumber(ref);\n  }\n\n  /**\n   * @type {DocumentInitParameters} A subset of the current\n   *   {DocumentInitParameters}, which are needed in the viewer.\n   */\n  get loadingParams() {\n    return this._transport.loadingParams;\n  }\n\n  /**\n   * @type {PDFDocumentLoadingTask} The loadingTask for the current document.\n   */\n  get loadingTask() {\n    return this._transport.loadingTask;\n  }\n\n  /**\n   * @returns {Promise<Object<string, Array<Object>> | null>} A promise that is\n   *   resolved with an {Object} containing /AcroForm field data for the JS\n   *   sandbox, or `null` when no field data is present in the PDF file.\n   */\n  getFieldObjects() {\n    return this._transport.getFieldObjects();\n  }\n\n  /**\n   * @returns {Promise<boolean>} A promise that is resolved with `true`\n   *   if some /AcroForm fields have JavaScript actions.\n   */\n  hasJSActions() {\n    return this._transport.hasJSActions();\n  }\n\n  /**\n   * @returns {Promise<Array<string> | null>} A promise that is resolved with an\n   *   {Array<string>} containing IDs of annotations that have a calculation\n   *   action, or `null` when no such annotations are present in the PDF file.\n   */\n  getCalculationOrderIds() {\n    return this._transport.getCalculationOrderIds();\n  }\n}\n\n/**\n * Page getViewport parameters.\n *\n * @typedef {Object} GetViewportParameters\n * @property {number} scale - The desired scale of the viewport.\n * @property {number} [rotation] - The desired rotation, in degrees, of\n *   the viewport. If omitted it defaults to the page rotation.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset.\n *   The default value is `0`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset.\n *   The default value is `0`.\n * @property {boolean} [dontFlip] - If true, the y-axis will not be\n *   flipped. The default value is `false`.\n */\n\n/**\n * Page getTextContent parameters.\n *\n * @typedef {Object} getTextContentParameters\n * @property {boolean} [includeMarkedContent] - When true include marked\n *   content items in the items array of TextContent. The default is `false`.\n * @property {boolean} [disableNormalization] - When true the text is *not*\n *   normalized in the worker-thread. The default is `false`.\n */\n\n/**\n * Page text content.\n *\n * @typedef {Object} TextContent\n * @property {Array<TextItem | TextMarkedContent>} items - Array of\n *   {@link TextItem} and {@link TextMarkedContent} objects. TextMarkedContent\n *   items are included when includeMarkedContent is true.\n * @property {Object<string, TextStyle>} styles - {@link TextStyle} objects,\n *   indexed by font name.\n * @property {string | null} lang - The document /Lang attribute.\n */\n\n/**\n * Page text content part.\n *\n * @typedef {Object} TextItem\n * @property {string} str - Text content.\n * @property {string} dir - Text direction: 'ttb', 'ltr' or 'rtl'.\n * @property {Array<any>} transform - Transformation matrix.\n * @property {number} width - Width in device space.\n * @property {number} height - Height in device space.\n * @property {string} fontName - Font name used by PDF.js for converted font.\n * @property {boolean} hasEOL - Indicating if the text content is followed by a\n *   line-break.\n */\n\n/**\n * Page text marked content part.\n *\n * @typedef {Object} TextMarkedContent\n * @property {string} type - Either 'beginMarkedContent',\n *   'beginMarkedContentProps', or 'endMarkedContent'.\n * @property {string} id - The marked content identifier. Only used for type\n *   'beginMarkedContentProps'.\n */\n\n/**\n * Text style.\n *\n * @typedef {Object} TextStyle\n * @property {number} ascent - Font ascent.\n * @property {number} descent - Font descent.\n * @property {boolean} vertical - Whether or not the text is in vertical mode.\n * @property {string} fontFamily - The possible font family.\n */\n\n/**\n * Page annotation parameters.\n *\n * @typedef {Object} GetAnnotationsParameters\n * @property {string} [intent] - Determines the annotations that are fetched,\n *   can be 'display' (viewable annotations), 'print' (printable annotations),\n *   or 'any' (all annotations). The default value is 'display'.\n */\n\n/**\n * Page render parameters.\n *\n * @typedef {Object} RenderParameters\n * @property {CanvasRenderingContext2D} canvasContext - A 2D context of a DOM\n *   Canvas object.\n * @property {PageViewport} viewport - Rendering viewport obtained by calling\n *   the `PDFPageProxy.getViewport` method.\n * @property {string} [intent] - Rendering intent, can be 'display', 'print',\n *   or 'any'. The default value is 'display'.\n * @property {number} [annotationMode] Controls which annotations are rendered\n *   onto the canvas, for annotations with appearance-data; the values from\n *   {@link AnnotationMode} should be used. The following values are supported:\n *    - `AnnotationMode.DISABLE`, which disables all annotations.\n *    - `AnnotationMode.ENABLE`, which includes all possible annotations (thus\n *      it also depends on the `intent`-option, see above).\n *    - `AnnotationMode.ENABLE_FORMS`, which excludes annotations that contain\n *      interactive form elements (those will be rendered in the display layer).\n *    - `AnnotationMode.ENABLE_STORAGE`, which includes all possible annotations\n *      (as above) but where interactive form elements are updated with data\n *      from the {@link AnnotationStorage}-instance; useful e.g. for printing.\n *   The default value is `AnnotationMode.ENABLE`.\n * @property {Array<any>} [transform] - Additional transform, applied just\n *   before viewport transform.\n * @property {CanvasGradient | CanvasPattern | string} [background] - Background\n *   to use for the canvas.\n *   Any valid `canvas.fillStyle` can be used: a `DOMString` parsed as CSS\n *   <color> value, a `CanvasGradient` object (a linear or radial gradient) or\n *   a `CanvasPattern` object (a repetitive image). The default value is\n *   'rgb(255,255,255)'.\n *\n *   NOTE: This option may be partially, or completely, ignored when the\n *   `pageColors`-option is used.\n * @property {Object} [pageColors] - Overwrites background and foreground colors\n *   with user defined ones in order to improve readability in high contrast\n *   mode.\n * @property {Promise<OptionalContentConfig>} [optionalContentConfigPromise] -\n *   A promise that should resolve with an {@link OptionalContentConfig}\n *   created from `PDFDocumentProxy.getOptionalContentConfig`. If `null`,\n *   the configuration will be fetched automatically with the default visibility\n *   states set.\n * @property {Map<string, HTMLCanvasElement>} [annotationCanvasMap] - Map some\n *   annotation ids with canvases used to render them.\n * @property {PrintAnnotationStorage} [printAnnotationStorage]\n * @property {boolean} [isEditing] - Render the page in editing mode.\n */\n\n/**\n * Page getOperatorList parameters.\n *\n * @typedef {Object} GetOperatorListParameters\n * @property {string} [intent] - Rendering intent, can be 'display', 'print',\n *   or 'any'. The default value is 'display'.\n * @property {number} [annotationMode] Controls which annotations are included\n *   in the operatorList, for annotations with appearance-data; the values from\n *   {@link AnnotationMode} should be used. The following values are supported:\n *    - `AnnotationMode.DISABLE`, which disables all annotations.\n *    - `AnnotationMode.ENABLE`, which includes all possible annotations (thus\n *      it also depends on the `intent`-option, see above).\n *    - `AnnotationMode.ENABLE_FORMS`, which excludes annotations that contain\n *      interactive form elements (those will be rendered in the display layer).\n *    - `AnnotationMode.ENABLE_STORAGE`, which includes all possible annotations\n *      (as above) but where interactive form elements are updated with data\n *      from the {@link AnnotationStorage}-instance; useful e.g. for printing.\n *   The default value is `AnnotationMode.ENABLE`.\n * @property {PrintAnnotationStorage} [printAnnotationStorage]\n * @property {boolean} [isEditing] - Render the page in editing mode.\n */\n\n/**\n * Structure tree node. The root node will have a role \"Root\".\n *\n * @typedef {Object} StructTreeNode\n * @property {Array<StructTreeNode | StructTreeContent>} children - Array of\n *   {@link StructTreeNode} and {@link StructTreeContent} objects.\n * @property {string} role - element's role, already mapped if a role map exists\n * in the PDF.\n */\n\n/**\n * Structure tree content.\n *\n * @typedef {Object} StructTreeContent\n * @property {string} type - either \"content\" for page and stream structure\n *   elements or \"object\" for object references.\n * @property {string} id - unique id that will map to the text layer.\n */\n\n/**\n * PDF page operator list.\n *\n * @typedef {Object} PDFOperatorList\n * @property {Array<number>} fnArray - Array containing the operator functions.\n * @property {Array<any>} argsArray - Array containing the arguments of the\n *   functions.\n */\n\n/**\n * Proxy to a `PDFPage` in the worker thread.\n */\nclass PDFPageProxy {\n  #delayedCleanupTimeout = null;\n\n  #pendingCleanup = false;\n\n  constructor(pageIndex, pageInfo, transport, pdfBug = false) {\n    this._pageIndex = pageIndex;\n    this._pageInfo = pageInfo;\n    this._transport = transport;\n    this._stats = pdfBug ? new StatTimer() : null;\n    this._pdfBug = pdfBug;\n    /** @type {PDFObjects} */\n    this.commonObjs = transport.commonObjs;\n    this.objs = new PDFObjects();\n\n    this._maybeCleanupAfterRender = false;\n    this._intentStates = new Map();\n    this.destroyed = false;\n  }\n\n  /**\n   * @type {number} Page number of the page. First page is 1.\n   */\n  get pageNumber() {\n    return this._pageIndex + 1;\n  }\n\n  /**\n   * @type {number} The number of degrees the page is rotated clockwise.\n   */\n  get rotate() {\n    return this._pageInfo.rotate;\n  }\n\n  /**\n   * @type {RefProxy | null} The reference that points to this page.\n   */\n  get ref() {\n    return this._pageInfo.ref;\n  }\n\n  /**\n   * @type {number} The default size of units in 1/72nds of an inch.\n   */\n  get userUnit() {\n    return this._pageInfo.userUnit;\n  }\n\n  /**\n   * @type {Array<number>} An array of the visible portion of the PDF page in\n   *   user space units [x1, y1, x2, y2].\n   */\n  get view() {\n    return this._pageInfo.view;\n  }\n\n  /**\n   * @param {GetViewportParameters} params - Viewport parameters.\n   * @returns {PageViewport} Contains 'width' and 'height' properties\n   *   along with transforms required for rendering.\n   */\n  getViewport({\n    scale,\n    rotation = this.rotate,\n    offsetX = 0,\n    offsetY = 0,\n    dontFlip = false,\n  } = {}) {\n    return new PageViewport({\n      viewBox: this.view,\n      scale,\n      rotation,\n      offsetX,\n      offsetY,\n      dontFlip,\n    });\n  }\n\n  /**\n   * @param {GetAnnotationsParameters} [params] - Annotation parameters.\n   * @returns {Promise<Array<any>>} A promise that is resolved with an\n   *   {Array} of the annotation objects.\n   */\n  getAnnotations({ intent = \"display\" } = {}) {\n    const { renderingIntent } = this._transport.getRenderingIntent(intent);\n\n    return this._transport.getAnnotations(this._pageIndex, renderingIntent);\n  }\n\n  /**\n   * @returns {Promise<Object>} A promise that is resolved with an\n   *   {Object} with JS actions.\n   */\n  getJSActions() {\n    return this._transport.getPageJSActions(this._pageIndex);\n  }\n\n  /**\n   * @type {Object} The filter factory instance.\n   */\n  get filterFactory() {\n    return this._transport.filterFactory;\n  }\n\n  /**\n   * @type {boolean} True if only XFA form.\n   */\n  get isPureXfa() {\n    return shadow(this, \"isPureXfa\", !!this._transport._htmlForXfa);\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with\n   *   an {Object} with a fake DOM object (a tree structure where elements\n   *   are {Object} with a name, attributes (class, style, ...), value and\n   *   children, very similar to a HTML DOM tree), or `null` if no XFA exists.\n   */\n  async getXfa() {\n    return this._transport._htmlForXfa?.children[this._pageIndex] || null;\n  }\n\n  /**\n   * Begins the process of rendering a page to the desired context.\n   *\n   * @param {RenderParameters} params - Page render parameters.\n   * @returns {RenderTask} An object that contains a promise that is\n   *   resolved when the page finishes rendering.\n   */\n  render({\n    canvasContext,\n    viewport,\n    intent = \"display\",\n    annotationMode = AnnotationMode.ENABLE,\n    transform = null,\n    background = null,\n    optionalContentConfigPromise = null,\n    annotationCanvasMap = null,\n    pageColors = null,\n    printAnnotationStorage = null,\n    isEditing = false,\n  }) {\n    this._stats?.time(\"Overall\");\n\n    const intentArgs = this._transport.getRenderingIntent(\n      intent,\n      annotationMode,\n      printAnnotationStorage,\n      isEditing\n    );\n    const { renderingIntent, cacheKey } = intentArgs;\n    // If there was a pending destroy, cancel it so no cleanup happens during\n    // this call to render...\n    this.#pendingCleanup = false;\n    // ... and ensure that a delayed cleanup is always aborted.\n    this.#abortDelayedCleanup();\n\n    optionalContentConfigPromise ||=\n      this._transport.getOptionalContentConfig(renderingIntent);\n\n    let intentState = this._intentStates.get(cacheKey);\n    if (!intentState) {\n      intentState = Object.create(null);\n      this._intentStates.set(cacheKey, intentState);\n    }\n\n    // Ensure that a pending `streamReader` cancel timeout is always aborted.\n    if (intentState.streamReaderCancelTimeout) {\n      clearTimeout(intentState.streamReaderCancelTimeout);\n      intentState.streamReaderCancelTimeout = null;\n    }\n\n    const intentPrint = !!(renderingIntent & RenderingIntentFlag.PRINT);\n\n    // If there's no displayReadyCapability yet, then the operatorList\n    // was never requested before. Make the request and create the promise.\n    if (!intentState.displayReadyCapability) {\n      intentState.displayReadyCapability = Promise.withResolvers();\n      intentState.operatorList = {\n        fnArray: [],\n        argsArray: [],\n        lastChunk: false,\n        separateAnnots: null,\n      };\n\n      this._stats?.time(\"Page Request\");\n      this._pumpOperatorList(intentArgs);\n    }\n\n    const complete = error => {\n      intentState.renderTasks.delete(internalRenderTask);\n\n      // Attempt to reduce memory usage during *printing*, by always running\n      // cleanup immediately once rendering has finished.\n      if (this._maybeCleanupAfterRender || intentPrint) {\n        this.#pendingCleanup = true;\n      }\n      this.#tryCleanup(/* delayed = */ !intentPrint);\n\n      if (error) {\n        internalRenderTask.capability.reject(error);\n\n        this._abortOperatorList({\n          intentState,\n          reason: error instanceof Error ? error : new Error(error),\n        });\n      } else {\n        internalRenderTask.capability.resolve();\n      }\n\n      if (this._stats) {\n        this._stats.timeEnd(\"Rendering\");\n        this._stats.timeEnd(\"Overall\");\n\n        if (globalThis.Stats?.enabled) {\n          globalThis.Stats.add(this.pageNumber, this._stats);\n        }\n      }\n    };\n\n    const internalRenderTask = new InternalRenderTask({\n      callback: complete,\n      // Only include the required properties, and *not* the entire object.\n      params: {\n        canvasContext,\n        viewport,\n        transform,\n        background,\n      },\n      objs: this.objs,\n      commonObjs: this.commonObjs,\n      annotationCanvasMap,\n      operatorList: intentState.operatorList,\n      pageIndex: this._pageIndex,\n      canvasFactory: this._transport.canvasFactory,\n      filterFactory: this._transport.filterFactory,\n      useRequestAnimationFrame: !intentPrint,\n      pdfBug: this._pdfBug,\n      pageColors,\n    });\n\n    (intentState.renderTasks ||= new Set()).add(internalRenderTask);\n    const renderTask = internalRenderTask.task;\n\n    Promise.all([\n      intentState.displayReadyCapability.promise,\n      optionalContentConfigPromise,\n    ])\n      .then(([transparency, optionalContentConfig]) => {\n        if (this.destroyed) {\n          complete();\n          return;\n        }\n        this._stats?.time(\"Rendering\");\n\n        if (!(optionalContentConfig.renderingIntent & renderingIntent)) {\n          throw new Error(\n            \"Must use the same `intent`-argument when calling the `PDFPageProxy.render` \" +\n              \"and `PDFDocumentProxy.getOptionalContentConfig` methods.\"\n          );\n        }\n        internalRenderTask.initializeGraphics({\n          transparency,\n          optionalContentConfig,\n        });\n        internalRenderTask.operatorListChanged();\n      })\n      .catch(complete);\n\n    return renderTask;\n  }\n\n  /**\n   * @param {GetOperatorListParameters} params - Page getOperatorList\n   *   parameters.\n   * @returns {Promise<PDFOperatorList>} A promise resolved with an\n   *   {@link PDFOperatorList} object that represents the page's operator list.\n   */\n  getOperatorList({\n    intent = \"display\",\n    annotationMode = AnnotationMode.ENABLE,\n    printAnnotationStorage = null,\n    isEditing = false,\n  } = {}) {\n    if (typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"GENERIC\")) {\n      throw new Error(\"Not implemented: getOperatorList\");\n    }\n    function operatorListChanged() {\n      if (intentState.operatorList.lastChunk) {\n        intentState.opListReadCapability.resolve(intentState.operatorList);\n\n        intentState.renderTasks.delete(opListTask);\n      }\n    }\n\n    const intentArgs = this._transport.getRenderingIntent(\n      intent,\n      annotationMode,\n      printAnnotationStorage,\n      isEditing,\n      /* isOpList = */ true\n    );\n    let intentState = this._intentStates.get(intentArgs.cacheKey);\n    if (!intentState) {\n      intentState = Object.create(null);\n      this._intentStates.set(intentArgs.cacheKey, intentState);\n    }\n    let opListTask;\n\n    if (!intentState.opListReadCapability) {\n      opListTask = Object.create(null);\n      opListTask.operatorListChanged = operatorListChanged;\n      intentState.opListReadCapability = Promise.withResolvers();\n      (intentState.renderTasks ||= new Set()).add(opListTask);\n      intentState.operatorList = {\n        fnArray: [],\n        argsArray: [],\n        lastChunk: false,\n        separateAnnots: null,\n      };\n\n      this._stats?.time(\"Page Request\");\n      this._pumpOperatorList(intentArgs);\n    }\n    return intentState.opListReadCapability.promise;\n  }\n\n  /**\n   * NOTE: All occurrences of whitespace will be replaced by\n   * standard spaces (0x20).\n   *\n   * @param {getTextContentParameters} params - getTextContent parameters.\n   * @returns {ReadableStream} Stream for reading text content chunks.\n   */\n  streamTextContent({\n    includeMarkedContent = false,\n    disableNormalization = false,\n  } = {}) {\n    const TEXT_CONTENT_CHUNK_SIZE = 100;\n\n    return this._transport.messageHandler.sendWithStream(\n      \"GetTextContent\",\n      {\n        pageIndex: this._pageIndex,\n        includeMarkedContent: includeMarkedContent === true,\n        disableNormalization: disableNormalization === true,\n      },\n      {\n        highWaterMark: TEXT_CONTENT_CHUNK_SIZE,\n        size(textContent) {\n          return textContent.items.length;\n        },\n      }\n    );\n  }\n\n  /**\n   * NOTE: All occurrences of whitespace will be replaced by\n   * standard spaces (0x20).\n   *\n   * @param {getTextContentParameters} params - getTextContent parameters.\n   * @returns {Promise<TextContent>} A promise that is resolved with a\n   *   {@link TextContent} object that represents the page's text content.\n   */\n  getTextContent(params = {}) {\n    if (this._transport._htmlForXfa) {\n      // TODO: We need to revisit this once the XFA foreground patch lands and\n      // only do this for non-foreground XFA.\n      return this.getXfa().then(xfa => XfaText.textContent(xfa));\n    }\n    const readableStream = this.streamTextContent(params);\n\n    return new Promise(function (resolve, reject) {\n      function pump() {\n        reader.read().then(function ({ value, done }) {\n          if (done) {\n            resolve(textContent);\n            return;\n          }\n          textContent.lang ??= value.lang;\n          Object.assign(textContent.styles, value.styles);\n          textContent.items.push(...value.items);\n          pump();\n        }, reject);\n      }\n\n      const reader = readableStream.getReader();\n      const textContent = {\n        items: [],\n        styles: Object.create(null),\n        lang: null,\n      };\n      pump();\n    });\n  }\n\n  /**\n   * @returns {Promise<StructTreeNode>} A promise that is resolved with a\n   *   {@link StructTreeNode} object that represents the page's structure tree,\n   *   or `null` when no structure tree is present for the current page.\n   */\n  getStructTree() {\n    return this._transport.getStructTree(this._pageIndex);\n  }\n\n  /**\n   * Destroys the page object.\n   * @private\n   */\n  _destroy() {\n    this.destroyed = true;\n\n    const waitOn = [];\n    for (const intentState of this._intentStates.values()) {\n      this._abortOperatorList({\n        intentState,\n        reason: new Error(\"Page was destroyed.\"),\n        force: true,\n      });\n\n      if (intentState.opListReadCapability) {\n        // Avoid errors below, since the renderTasks are just stubs.\n        continue;\n      }\n      for (const internalRenderTask of intentState.renderTasks) {\n        waitOn.push(internalRenderTask.completed);\n        internalRenderTask.cancel();\n      }\n    }\n    this.objs.clear();\n    this.#pendingCleanup = false;\n    this.#abortDelayedCleanup();\n\n    return Promise.all(waitOn);\n  }\n\n  /**\n   * Cleans up resources allocated by the page.\n   *\n   * @param {boolean} [resetStats] - Reset page stats, if enabled.\n   *   The default value is `false`.\n   * @returns {boolean} Indicates if clean-up was successfully run.\n   */\n  cleanup(resetStats = false) {\n    this.#pendingCleanup = true;\n    const success = this.#tryCleanup(/* delayed = */ false);\n\n    if (resetStats && success) {\n      this._stats &&= new StatTimer();\n    }\n    return success;\n  }\n\n  /**\n   * Attempts to clean up if rendering is in a state where that's possible.\n   * @param {boolean} [delayed] - Delay the cleanup, to e.g. improve zooming\n   *   performance in documents with large images.\n   *   The default value is `false`.\n   * @returns {boolean} Indicates if clean-up was successfully run.\n   */\n  #tryCleanup(delayed = false) {\n    this.#abortDelayedCleanup();\n\n    if (!this.#pendingCleanup || this.destroyed) {\n      return false;\n    }\n    if (delayed) {\n      this.#delayedCleanupTimeout = setTimeout(() => {\n        this.#delayedCleanupTimeout = null;\n        this.#tryCleanup(/* delayed = */ false);\n      }, DELAYED_CLEANUP_TIMEOUT);\n\n      return false;\n    }\n    for (const { renderTasks, operatorList } of this._intentStates.values()) {\n      if (renderTasks.size > 0 || !operatorList.lastChunk) {\n        return false;\n      }\n    }\n    this._intentStates.clear();\n    this.objs.clear();\n    this.#pendingCleanup = false;\n    return true;\n  }\n\n  #abortDelayedCleanup() {\n    if (this.#delayedCleanupTimeout) {\n      clearTimeout(this.#delayedCleanupTimeout);\n      this.#delayedCleanupTimeout = null;\n    }\n  }\n\n  /**\n   * @private\n   */\n  _startRenderPage(transparency, cacheKey) {\n    const intentState = this._intentStates.get(cacheKey);\n    if (!intentState) {\n      return; // Rendering was cancelled.\n    }\n    this._stats?.timeEnd(\"Page Request\");\n\n    // TODO Refactor RenderPageRequest to separate rendering\n    // and operator list logic\n    intentState.displayReadyCapability?.resolve(transparency);\n  }\n\n  /**\n   * @private\n   */\n  _renderPageChunk(operatorListChunk, intentState) {\n    // Add the new chunk to the current operator list.\n    for (let i = 0, ii = operatorListChunk.length; i < ii; i++) {\n      intentState.operatorList.fnArray.push(operatorListChunk.fnArray[i]);\n      intentState.operatorList.argsArray.push(operatorListChunk.argsArray[i]);\n    }\n    intentState.operatorList.lastChunk = operatorListChunk.lastChunk;\n    intentState.operatorList.separateAnnots = operatorListChunk.separateAnnots;\n\n    // Notify all the rendering tasks there are more operators to be consumed.\n    for (const internalRenderTask of intentState.renderTasks) {\n      internalRenderTask.operatorListChanged();\n    }\n\n    if (operatorListChunk.lastChunk) {\n      this.#tryCleanup(/* delayed = */ true);\n    }\n  }\n\n  /**\n   * @private\n   */\n  _pumpOperatorList({\n    renderingIntent,\n    cacheKey,\n    annotationStorageSerializable,\n    modifiedIds,\n  }) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        Number.isInteger(renderingIntent) && renderingIntent > 0,\n        '_pumpOperatorList: Expected valid \"renderingIntent\" argument.'\n      );\n    }\n    const { map, transfer } = annotationStorageSerializable;\n\n    const readableStream = this._transport.messageHandler.sendWithStream(\n      \"GetOperatorList\",\n      {\n        pageIndex: this._pageIndex,\n        intent: renderingIntent,\n        cacheKey,\n        annotationStorage: map,\n        modifiedIds,\n      },\n      transfer\n    );\n    const reader = readableStream.getReader();\n\n    const intentState = this._intentStates.get(cacheKey);\n    intentState.streamReader = reader;\n\n    const pump = () => {\n      reader.read().then(\n        ({ value, done }) => {\n          if (done) {\n            intentState.streamReader = null;\n            return;\n          }\n          if (this._transport.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          this._renderPageChunk(value, intentState);\n          pump();\n        },\n        reason => {\n          intentState.streamReader = null;\n\n          if (this._transport.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          if (intentState.operatorList) {\n            // Mark operator list as complete.\n            intentState.operatorList.lastChunk = true;\n\n            for (const internalRenderTask of intentState.renderTasks) {\n              internalRenderTask.operatorListChanged();\n            }\n            this.#tryCleanup(/* delayed = */ true);\n          }\n\n          if (intentState.displayReadyCapability) {\n            intentState.displayReadyCapability.reject(reason);\n          } else if (intentState.opListReadCapability) {\n            intentState.opListReadCapability.reject(reason);\n          } else {\n            throw reason;\n          }\n        }\n      );\n    };\n    pump();\n  }\n\n  /**\n   * @private\n   */\n  _abortOperatorList({ intentState, reason, force = false }) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        reason instanceof Error,\n        '_abortOperatorList: Expected valid \"reason\" argument.'\n      );\n    }\n\n    if (!intentState.streamReader) {\n      return;\n    }\n    // Ensure that a pending `streamReader` cancel timeout is always aborted.\n    if (intentState.streamReaderCancelTimeout) {\n      clearTimeout(intentState.streamReaderCancelTimeout);\n      intentState.streamReaderCancelTimeout = null;\n    }\n\n    if (!force) {\n      // Ensure that an Error occurring in *only* one `InternalRenderTask`, e.g.\n      // multiple render() calls on the same canvas, won't break all rendering.\n      if (intentState.renderTasks.size > 0) {\n        return;\n      }\n      // Don't immediately abort parsing on the worker-thread when rendering is\n      // cancelled, since that will unnecessarily delay re-rendering when (for\n      // partially parsed pages) e.g. zooming/rotation occurs in the viewer.\n      if (reason instanceof RenderingCancelledException) {\n        let delay = RENDERING_CANCELLED_TIMEOUT;\n        if (reason.extraDelay > 0 && reason.extraDelay < /* ms = */ 1000) {\n          // Above, we prevent the total delay from becoming arbitrarily large.\n          delay += reason.extraDelay;\n        }\n\n        intentState.streamReaderCancelTimeout = setTimeout(() => {\n          intentState.streamReaderCancelTimeout = null;\n          this._abortOperatorList({ intentState, reason, force: true });\n        }, delay);\n        return;\n      }\n    }\n    intentState.streamReader\n      .cancel(new AbortException(reason.message))\n      .catch(() => {\n        // Avoid \"Uncaught promise\" messages in the console.\n      });\n    intentState.streamReader = null;\n\n    if (this._transport.destroyed) {\n      return; // Ignore any pending requests if the worker was terminated.\n    }\n    // Remove the current `intentState`, since a cancelled `getOperatorList`\n    // call on the worker-thread cannot be re-started...\n    for (const [curCacheKey, curIntentState] of this._intentStates) {\n      if (curIntentState === intentState) {\n        this._intentStates.delete(curCacheKey);\n        break;\n      }\n    }\n    // ... and force clean-up to ensure that any old state is always removed.\n    this.cleanup();\n  }\n\n  /**\n   * @type {StatTimer | null} Returns page stats, if enabled; returns `null`\n   *   otherwise.\n   */\n  get stats() {\n    return this._stats;\n  }\n}\n\nclass LoopbackPort {\n  #listeners = new Set();\n\n  #deferred = Promise.resolve();\n\n  postMessage(obj, transfer) {\n    const event = {\n      data: structuredClone(obj, transfer ? { transfer } : null),\n    };\n\n    this.#deferred.then(() => {\n      for (const listener of this.#listeners) {\n        listener.call(this, event);\n      }\n    });\n  }\n\n  addEventListener(name, listener) {\n    this.#listeners.add(listener);\n  }\n\n  removeEventListener(name, listener) {\n    this.#listeners.delete(listener);\n  }\n\n  terminate() {\n    this.#listeners.clear();\n  }\n}\n\n/**\n * @typedef {Object} PDFWorkerParameters\n * @property {string} [name] - The name of the worker.\n * @property {Worker} [port] - The `workerPort` object.\n * @property {number} [verbosity] - Controls the logging level;\n *   the constants from {@link VerbosityLevel} should be used.\n */\n\nconst PDFWorkerUtil = {\n  isWorkerDisabled: false,\n  fakeWorkerId: 0,\n};\nif (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n  if (isNodeJS) {\n    // Workers aren't supported in Node.js, force-disabling them there.\n    PDFWorkerUtil.isWorkerDisabled = true;\n\n    GlobalWorkerOptions.workerSrc ||= PDFJSDev.test(\"LIB\")\n      ? \"../pdf.worker.js\"\n      : \"./pdf.worker.mjs\";\n  }\n\n  // Check if URLs have the same origin. For non-HTTP based URLs, returns false.\n  PDFWorkerUtil.isSameOrigin = function (baseUrl, otherUrl) {\n    let base;\n    try {\n      base = new URL(baseUrl);\n      if (!base.origin || base.origin === \"null\") {\n        return false; // non-HTTP url\n      }\n    } catch {\n      return false;\n    }\n\n    const other = new URL(otherUrl, base);\n    return base.origin === other.origin;\n  };\n\n  PDFWorkerUtil.createCDNWrapper = function (url) {\n    // We will rely on blob URL's property to specify origin.\n    // We want this function to fail in case if createObjectURL or Blob do not\n    // exist or fail for some reason -- our Worker creation will fail anyway.\n    const wrapper = `await import(\"${url}\");`;\n    return URL.createObjectURL(\n      new Blob([wrapper], { type: \"text/javascript\" })\n    );\n  };\n}\n\n/**\n * PDF.js web worker abstraction that controls the instantiation of PDF\n * documents. Message handlers are used to pass information from the main\n * thread to the worker thread and vice versa. If the creation of a web\n * worker is not possible, a \"fake\" worker will be used instead.\n *\n * @param {PDFWorkerParameters} params - The worker initialization parameters.\n */\nclass PDFWorker {\n  static #workerPorts;\n\n  constructor({\n    name = null,\n    port = null,\n    verbosity = getVerbosityLevel(),\n  } = {}) {\n    this.name = name;\n    this.destroyed = false;\n    this.verbosity = verbosity;\n\n    this._readyCapability = Promise.withResolvers();\n    this._port = null;\n    this._webWorker = null;\n    this._messageHandler = null;\n\n    if (\n      (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) &&\n      port\n    ) {\n      if (PDFWorker.#workerPorts?.has(port)) {\n        throw new Error(\"Cannot use more than one PDFWorker per port.\");\n      }\n      (PDFWorker.#workerPorts ||= new WeakMap()).set(port, this);\n      this._initializeFromPort(port);\n      return;\n    }\n    this._initialize();\n  }\n\n  /**\n   * Promise for worker initialization completion.\n   * @type {Promise<void>}\n   */\n  get promise() {\n    if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"GENERIC\") &&\n      isNodeJS\n    ) {\n      // Ensure that all Node.js packages/polyfills have loaded.\n      return Promise.all([NodePackages.promise, this._readyCapability.promise]);\n    }\n    return this._readyCapability.promise;\n  }\n\n  #resolve() {\n    this._readyCapability.resolve();\n    // Send global setting, e.g. verbosity level.\n    this._messageHandler.send(\"configure\", {\n      verbosity: this.verbosity,\n    });\n  }\n\n  /**\n   * The current `workerPort`, when it exists.\n   * @type {Worker}\n   */\n  get port() {\n    return this._port;\n  }\n\n  /**\n   * The current MessageHandler-instance.\n   * @type {MessageHandler}\n   */\n  get messageHandler() {\n    return this._messageHandler;\n  }\n\n  _initializeFromPort(port) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _initializeFromPort\");\n    }\n    this._port = port;\n    this._messageHandler = new MessageHandler(\"main\", \"worker\", port);\n    this._messageHandler.on(\"ready\", function () {\n      // Ignoring \"ready\" event -- MessageHandler should already be initialized\n      // and ready to accept messages.\n    });\n    this.#resolve();\n  }\n\n  _initialize() {\n    // If worker support isn't disabled explicit and the browser has worker\n    // support, create a new web worker and test if it/the browser fulfills\n    // all requirements to run parts of pdf.js in a web worker.\n    // Right now, the requirement is, that an Uint8Array is still an\n    // Uint8Array as it arrives on the worker.\n    if (\n      PDFWorkerUtil.isWorkerDisabled ||\n      PDFWorker.#mainThreadWorkerMessageHandler\n    ) {\n      this._setupFakeWorker();\n      return;\n    }\n    let { workerSrc } = PDFWorker;\n\n    try {\n      // Wraps workerSrc path into blob URL, if the former does not belong\n      // to the same origin.\n      if (\n        typeof PDFJSDev !== \"undefined\" &&\n        PDFJSDev.test(\"GENERIC\") &&\n        !PDFWorkerUtil.isSameOrigin(window.location.href, workerSrc)\n      ) {\n        workerSrc = PDFWorkerUtil.createCDNWrapper(\n          new URL(workerSrc, window.location).href\n        );\n      }\n\n      const worker = new Worker(workerSrc, { type: \"module\" });\n      const messageHandler = new MessageHandler(\"main\", \"worker\", worker);\n      const terminateEarly = () => {\n        ac.abort();\n        messageHandler.destroy();\n        worker.terminate();\n        if (this.destroyed) {\n          this._readyCapability.reject(new Error(\"Worker was destroyed\"));\n        } else {\n          // Fall back to fake worker if the termination is caused by an\n          // error (e.g. NetworkError / SecurityError).\n          this._setupFakeWorker();\n        }\n      };\n\n      const ac = new AbortController();\n      worker.addEventListener(\n        \"error\",\n        () => {\n          if (!this._webWorker) {\n            // Worker failed to initialize due to an error. Clean up and fall\n            // back to the fake worker.\n            terminateEarly();\n          }\n        },\n        { signal: ac.signal }\n      );\n\n      messageHandler.on(\"test\", data => {\n        ac.abort();\n        if (this.destroyed || !data) {\n          terminateEarly();\n          return;\n        }\n        this._messageHandler = messageHandler;\n        this._port = worker;\n        this._webWorker = worker;\n\n        this.#resolve();\n      });\n\n      messageHandler.on(\"ready\", data => {\n        ac.abort();\n        if (this.destroyed) {\n          terminateEarly();\n          return;\n        }\n        try {\n          sendTest();\n        } catch {\n          // We need fallback to a faked worker.\n          this._setupFakeWorker();\n        }\n      });\n\n      const sendTest = () => {\n        const testObj = new Uint8Array();\n        // Ensure that we can use `postMessage` transfers.\n        messageHandler.send(\"test\", testObj, [testObj.buffer]);\n      };\n\n      // It might take time for the worker to initialize. We will try to send\n      // the \"test\" message immediately, and once the \"ready\" message arrives.\n      // The worker shall process only the first received \"test\" message.\n      sendTest();\n      return;\n    } catch {\n      info(\"The worker has been disabled.\");\n    }\n    // Either workers are not supported or have thrown an exception.\n    // Thus, we fallback to a faked worker.\n    this._setupFakeWorker();\n  }\n\n  _setupFakeWorker() {\n    if (!PDFWorkerUtil.isWorkerDisabled) {\n      warn(\"Setting up fake worker.\");\n      PDFWorkerUtil.isWorkerDisabled = true;\n    }\n\n    PDFWorker._setupFakeWorkerGlobal\n      .then(WorkerMessageHandler => {\n        if (this.destroyed) {\n          this._readyCapability.reject(new Error(\"Worker was destroyed\"));\n          return;\n        }\n        const port = new LoopbackPort();\n        this._port = port;\n\n        // All fake workers use the same port, making id unique.\n        const id = `fake${PDFWorkerUtil.fakeWorkerId++}`;\n\n        // If the main thread is our worker, setup the handling for the\n        // messages -- the main thread sends to it self.\n        const workerHandler = new MessageHandler(id + \"_worker\", id, port);\n        WorkerMessageHandler.setup(workerHandler, port);\n\n        this._messageHandler = new MessageHandler(id, id + \"_worker\", port);\n        this.#resolve();\n      })\n      .catch(reason => {\n        this._readyCapability.reject(\n          new Error(`Setting up fake worker failed: \"${reason.message}\".`)\n        );\n      });\n  }\n\n  /**\n   * Destroys the worker instance.\n   */\n  destroy() {\n    this.destroyed = true;\n    if (this._webWorker) {\n      // We need to terminate only web worker created resource.\n      this._webWorker.terminate();\n      this._webWorker = null;\n    }\n    PDFWorker.#workerPorts?.delete(this._port);\n    this._port = null;\n    if (this._messageHandler) {\n      this._messageHandler.destroy();\n      this._messageHandler = null;\n    }\n  }\n\n  /**\n   * @param {PDFWorkerParameters} params - The worker initialization parameters.\n   */\n  static fromPort(params) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: fromPort\");\n    }\n    if (!params?.port) {\n      throw new Error(\"PDFWorker.fromPort - invalid method signature.\");\n    }\n    const cachedPort = this.#workerPorts?.get(params.port);\n    if (cachedPort) {\n      if (cachedPort._pendingDestroy) {\n        throw new Error(\n          \"PDFWorker.fromPort - the worker is being destroyed.\\n\" +\n            \"Please remember to await `PDFDocumentLoadingTask.destroy()`-calls.\"\n        );\n      }\n      return cachedPort;\n    }\n    return new PDFWorker(params);\n  }\n\n  /**\n   * The current `workerSrc`, when it exists.\n   * @type {string}\n   */\n  static get workerSrc() {\n    if (GlobalWorkerOptions.workerSrc) {\n      return GlobalWorkerOptions.workerSrc;\n    }\n    throw new Error('No \"GlobalWorkerOptions.workerSrc\" specified.');\n  }\n\n  static get #mainThreadWorkerMessageHandler() {\n    try {\n      return globalThis.pdfjsWorker?.WorkerMessageHandler || null;\n    } catch {\n      return null;\n    }\n  }\n\n  // Loads worker code into the main-thread.\n  static get _setupFakeWorkerGlobal() {\n    const loader = async () => {\n      if (this.#mainThreadWorkerMessageHandler) {\n        // The worker was already loaded using e.g. a `<script>` tag.\n        return this.#mainThreadWorkerMessageHandler;\n      }\n      const worker =\n        typeof PDFJSDev === \"undefined\"\n          ? await import(\"pdfjs/pdf.worker.js\")\n          : await __non_webpack_import__(this.workerSrc);\n      return worker.WorkerMessageHandler;\n    };\n\n    return shadow(this, \"_setupFakeWorkerGlobal\", loader());\n  }\n}\n\n/**\n * For internal use only.\n * @ignore\n */\nclass WorkerTransport {\n  #methodPromises = new Map();\n\n  #pageCache = new Map();\n\n  #pagePromises = new Map();\n\n  #pageRefCache = new Map();\n\n  #passwordCapability = null;\n\n  constructor(messageHandler, loadingTask, networkStream, params, factory) {\n    this.messageHandler = messageHandler;\n    this.loadingTask = loadingTask;\n    this.commonObjs = new PDFObjects();\n    this.fontLoader = new FontLoader({\n      ownerDocument: params.ownerDocument,\n      styleElement: params.styleElement,\n    });\n    this.loadingParams = params.loadingParams;\n    this._params = params;\n\n    this.canvasFactory = factory.canvasFactory;\n    this.filterFactory = factory.filterFactory;\n    this.cMapReaderFactory = factory.cMapReaderFactory;\n    this.standardFontDataFactory = factory.standardFontDataFactory;\n\n    this.destroyed = false;\n    this.destroyCapability = null;\n\n    this._networkStream = networkStream;\n    this._fullReader = null;\n    this._lastProgress = null;\n    this.downloadInfoCapability = Promise.withResolvers();\n\n    this.setupMessageHandler();\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getNetworkStreamName\", {\n        value: () => networkStream?.constructor?.name || null,\n      });\n      Object.defineProperty(this, \"getXFADatasets\", {\n        value: () =>\n          this.messageHandler.sendWithPromise(\"GetXFADatasets\", null),\n      });\n      Object.defineProperty(this, \"getXRefPrevValue\", {\n        value: () =>\n          this.messageHandler.sendWithPromise(\"GetXRefPrevValue\", null),\n      });\n      Object.defineProperty(this, \"getStartXRefPos\", {\n        value: () =>\n          this.messageHandler.sendWithPromise(\"GetStartXRefPos\", null),\n      });\n      Object.defineProperty(this, \"getAnnotArray\", {\n        value: pageIndex =>\n          this.messageHandler.sendWithPromise(\"GetAnnotArray\", { pageIndex }),\n      });\n    }\n  }\n\n  #cacheSimpleMethod(name, data = null) {\n    const cachedPromise = this.#methodPromises.get(name);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler.sendWithPromise(name, data);\n\n    this.#methodPromises.set(name, promise);\n    return promise;\n  }\n\n  get annotationStorage() {\n    return shadow(this, \"annotationStorage\", new AnnotationStorage());\n  }\n\n  getRenderingIntent(\n    intent,\n    annotationMode = AnnotationMode.ENABLE,\n    printAnnotationStorage = null,\n    isEditing = false,\n    isOpList = false\n  ) {\n    let renderingIntent = RenderingIntentFlag.DISPLAY; // Default value.\n    let annotationStorageSerializable = SerializableEmpty;\n\n    switch (intent) {\n      case \"any\":\n        renderingIntent = RenderingIntentFlag.ANY;\n        break;\n      case \"display\":\n        break;\n      case \"print\":\n        renderingIntent = RenderingIntentFlag.PRINT;\n        break;\n      default:\n        warn(`getRenderingIntent - invalid intent: ${intent}`);\n    }\n\n    const annotationStorage =\n      renderingIntent & RenderingIntentFlag.PRINT &&\n      printAnnotationStorage instanceof PrintAnnotationStorage\n        ? printAnnotationStorage\n        : this.annotationStorage;\n\n    switch (annotationMode) {\n      case AnnotationMode.DISABLE:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_DISABLE;\n        break;\n      case AnnotationMode.ENABLE:\n        break;\n      case AnnotationMode.ENABLE_FORMS:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_FORMS;\n        break;\n      case AnnotationMode.ENABLE_STORAGE:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_STORAGE;\n\n        annotationStorageSerializable = annotationStorage.serializable;\n        break;\n      default:\n        warn(`getRenderingIntent - invalid annotationMode: ${annotationMode}`);\n    }\n\n    if (isEditing) {\n      renderingIntent += RenderingIntentFlag.IS_EDITING;\n    }\n    if (isOpList) {\n      renderingIntent += RenderingIntentFlag.OPLIST;\n    }\n\n    const { ids: modifiedIds, hash: modifiedIdsHash } =\n      annotationStorage.modifiedIds;\n\n    const cacheKeyBuf = [\n      renderingIntent,\n      annotationStorageSerializable.hash,\n      modifiedIdsHash,\n    ];\n\n    return {\n      renderingIntent,\n      cacheKey: cacheKeyBuf.join(\"_\"),\n      annotationStorageSerializable,\n      modifiedIds,\n    };\n  }\n\n  destroy() {\n    if (this.destroyCapability) {\n      return this.destroyCapability.promise;\n    }\n\n    this.destroyed = true;\n    this.destroyCapability = Promise.withResolvers();\n\n    this.#passwordCapability?.reject(\n      new Error(\"Worker was destroyed during onPassword callback\")\n    );\n\n    const waitOn = [];\n    // We need to wait for all renderings to be completed, e.g.\n    // timeout/rAF can take a long time.\n    for (const page of this.#pageCache.values()) {\n      waitOn.push(page._destroy());\n    }\n    this.#pageCache.clear();\n    this.#pagePromises.clear();\n    this.#pageRefCache.clear();\n    // Allow `AnnotationStorage`-related clean-up when destroying the document.\n    if (this.hasOwnProperty(\"annotationStorage\")) {\n      this.annotationStorage.resetModified();\n    }\n    // We also need to wait for the worker to finish its long running tasks.\n    const terminated = this.messageHandler.sendWithPromise(\"Terminate\", null);\n    waitOn.push(terminated);\n\n    Promise.all(waitOn).then(() => {\n      this.commonObjs.clear();\n      this.fontLoader.clear();\n      this.#methodPromises.clear();\n      this.filterFactory.destroy();\n      TextLayer.cleanup();\n\n      this._networkStream?.cancelAllRequests(\n        new AbortException(\"Worker was terminated.\")\n      );\n\n      if (this.messageHandler) {\n        this.messageHandler.destroy();\n        this.messageHandler = null;\n      }\n      this.destroyCapability.resolve();\n    }, this.destroyCapability.reject);\n    return this.destroyCapability.promise;\n  }\n\n  setupMessageHandler() {\n    const { messageHandler, loadingTask } = this;\n\n    messageHandler.on(\"GetReader\", (data, sink) => {\n      assert(\n        this._networkStream,\n        \"GetReader - no `IPDFStream` instance available.\"\n      );\n      this._fullReader = this._networkStream.getFullReader();\n      this._fullReader.onProgress = evt => {\n        this._lastProgress = {\n          loaded: evt.loaded,\n          total: evt.total,\n        };\n      };\n      sink.onPull = () => {\n        this._fullReader\n          .read()\n          .then(function ({ value, done }) {\n            if (done) {\n              sink.close();\n              return;\n            }\n            assert(\n              value instanceof ArrayBuffer,\n              \"GetReader - expected an ArrayBuffer.\"\n            );\n            // Enqueue data chunk into sink, and transfer it\n            // to other side as `Transferable` object.\n            sink.enqueue(new Uint8Array(value), 1, [value]);\n          })\n          .catch(reason => {\n            sink.error(reason);\n          });\n      };\n\n      sink.onCancel = reason => {\n        this._fullReader.cancel(reason);\n\n        sink.ready.catch(readyReason => {\n          if (this.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          throw readyReason;\n        });\n      };\n    });\n\n    messageHandler.on(\"ReaderHeadersReady\", data => {\n      const headersCapability = Promise.withResolvers();\n      const fullReader = this._fullReader;\n      fullReader.headersReady.then(() => {\n        // If stream or range are disabled, it's our only way to report\n        // loading progress.\n        if (!fullReader.isStreamingSupported || !fullReader.isRangeSupported) {\n          if (this._lastProgress) {\n            loadingTask.onProgress?.(this._lastProgress);\n          }\n          fullReader.onProgress = evt => {\n            loadingTask.onProgress?.({\n              loaded: evt.loaded,\n              total: evt.total,\n            });\n          };\n        }\n\n        headersCapability.resolve({\n          isStreamingSupported: fullReader.isStreamingSupported,\n          isRangeSupported: fullReader.isRangeSupported,\n          contentLength: fullReader.contentLength,\n        });\n      }, headersCapability.reject);\n\n      return headersCapability.promise;\n    });\n\n    messageHandler.on(\"GetRangeReader\", (data, sink) => {\n      assert(\n        this._networkStream,\n        \"GetRangeReader - no `IPDFStream` instance available.\"\n      );\n      const rangeReader = this._networkStream.getRangeReader(\n        data.begin,\n        data.end\n      );\n\n      // When streaming is enabled, it's possible that the data requested here\n      // has already been fetched via the `_fullRequestReader` implementation.\n      // However, given that the PDF data is loaded asynchronously on the\n      // main-thread and then sent via `postMessage` to the worker-thread,\n      // it may not have been available during parsing (hence the attempt to\n      // use range requests here).\n      //\n      // To avoid wasting time and resources here, we'll thus *not* dispatch\n      // range requests if the data was already loaded but has not been sent to\n      // the worker-thread yet (which will happen via the `_fullRequestReader`).\n      if (!rangeReader) {\n        sink.close();\n        return;\n      }\n\n      sink.onPull = () => {\n        rangeReader\n          .read()\n          .then(function ({ value, done }) {\n            if (done) {\n              sink.close();\n              return;\n            }\n            assert(\n              value instanceof ArrayBuffer,\n              \"GetRangeReader - expected an ArrayBuffer.\"\n            );\n            sink.enqueue(new Uint8Array(value), 1, [value]);\n          })\n          .catch(reason => {\n            sink.error(reason);\n          });\n      };\n\n      sink.onCancel = reason => {\n        rangeReader.cancel(reason);\n\n        sink.ready.catch(readyReason => {\n          if (this.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          throw readyReason;\n        });\n      };\n    });\n\n    messageHandler.on(\"GetDoc\", ({ pdfInfo }) => {\n      this._numPages = pdfInfo.numPages;\n      this._htmlForXfa = pdfInfo.htmlForXfa;\n      delete pdfInfo.htmlForXfa;\n      loadingTask._capability.resolve(new PDFDocumentProxy(pdfInfo, this));\n    });\n\n    messageHandler.on(\"DocException\", function (ex) {\n      let reason;\n      switch (ex.name) {\n        case \"PasswordException\":\n          reason = new PasswordException(ex.message, ex.code);\n          break;\n        case \"InvalidPDFException\":\n          reason = new InvalidPDFException(ex.message);\n          break;\n        case \"MissingPDFException\":\n          reason = new MissingPDFException(ex.message);\n          break;\n        case \"UnexpectedResponseException\":\n          reason = new UnexpectedResponseException(ex.message, ex.status);\n          break;\n        case \"UnknownErrorException\":\n          reason = new UnknownErrorException(ex.message, ex.details);\n          break;\n        default:\n          unreachable(\"DocException - expected a valid Error.\");\n      }\n      loadingTask._capability.reject(reason);\n    });\n\n    messageHandler.on(\"PasswordRequest\", exception => {\n      this.#passwordCapability = Promise.withResolvers();\n\n      if (loadingTask.onPassword) {\n        const updatePassword = password => {\n          if (password instanceof Error) {\n            this.#passwordCapability.reject(password);\n          } else {\n            this.#passwordCapability.resolve({ password });\n          }\n        };\n        try {\n          loadingTask.onPassword(updatePassword, exception.code);\n        } catch (ex) {\n          this.#passwordCapability.reject(ex);\n        }\n      } else {\n        this.#passwordCapability.reject(\n          new PasswordException(exception.message, exception.code)\n        );\n      }\n      return this.#passwordCapability.promise;\n    });\n\n    messageHandler.on(\"DataLoaded\", data => {\n      // For consistency: Ensure that progress is always reported when the\n      // entire PDF file has been loaded, regardless of how it was fetched.\n      loadingTask.onProgress?.({\n        loaded: data.length,\n        total: data.length,\n      });\n\n      this.downloadInfoCapability.resolve(data);\n    });\n\n    messageHandler.on(\"StartRenderPage\", data => {\n      if (this.destroyed) {\n        return; // Ignore any pending requests if the worker was terminated.\n      }\n\n      const page = this.#pageCache.get(data.pageIndex);\n      page._startRenderPage(data.transparency, data.cacheKey);\n    });\n\n    messageHandler.on(\"commonobj\", ([id, type, exportedData]) => {\n      if (this.destroyed) {\n        return null; // Ignore any pending requests if the worker was terminated.\n      }\n\n      if (this.commonObjs.has(id)) {\n        return null;\n      }\n\n      switch (type) {\n        case \"Font\":\n          const { disableFontFace, fontExtraProperties, pdfBug } = this._params;\n\n          if (\"error\" in exportedData) {\n            const exportedError = exportedData.error;\n            warn(`Error during font loading: ${exportedError}`);\n            this.commonObjs.resolve(id, exportedError);\n            break;\n          }\n\n          const inspectFont =\n            pdfBug && globalThis.FontInspector?.enabled\n              ? (font, url) => globalThis.FontInspector.fontAdded(font, url)\n              : null;\n          const font = new FontFaceObject(exportedData, {\n            disableFontFace,\n            inspectFont,\n          });\n\n          this.fontLoader\n            .bind(font)\n            .catch(() => messageHandler.sendWithPromise(\"FontFallback\", { id }))\n            .finally(() => {\n              if (!fontExtraProperties && font.data) {\n                // Immediately release the `font.data` property once the font\n                // has been attached to the DOM, since it's no longer needed,\n                // rather than waiting for a `PDFDocumentProxy.cleanup` call.\n                // Since `font.data` could be very large, e.g. in some cases\n                // multiple megabytes, this will help reduce memory usage.\n                font.data = null;\n              }\n              this.commonObjs.resolve(id, font);\n            });\n          break;\n        case \"CopyLocalImage\":\n          const { imageRef } = exportedData;\n          assert(imageRef, \"The imageRef must be defined.\");\n\n          for (const pageProxy of this.#pageCache.values()) {\n            for (const [, data] of pageProxy.objs) {\n              if (data?.ref !== imageRef) {\n                continue;\n              }\n              if (!data.dataLen) {\n                return null;\n              }\n              this.commonObjs.resolve(id, structuredClone(data));\n              return data.dataLen;\n            }\n          }\n          break;\n        case \"FontPath\":\n        case \"Image\":\n        case \"Pattern\":\n          this.commonObjs.resolve(id, exportedData);\n          break;\n        default:\n          throw new Error(`Got unknown common object type ${type}`);\n      }\n\n      return null;\n    });\n\n    messageHandler.on(\"obj\", ([id, pageIndex, type, imageData]) => {\n      if (this.destroyed) {\n        // Ignore any pending requests if the worker was terminated.\n        return;\n      }\n\n      const pageProxy = this.#pageCache.get(pageIndex);\n      if (pageProxy.objs.has(id)) {\n        return;\n      }\n      // Don't store data *after* cleanup has successfully run, see bug 1854145.\n      if (pageProxy._intentStates.size === 0) {\n        imageData?.bitmap?.close(); // Release any `ImageBitmap` data.\n        return;\n      }\n\n      switch (type) {\n        case \"Image\":\n          pageProxy.objs.resolve(id, imageData);\n\n          // Heuristic that will allow us not to store large data.\n          if (imageData?.dataLen > MAX_IMAGE_SIZE_TO_CACHE) {\n            pageProxy._maybeCleanupAfterRender = true;\n          }\n          break;\n        case \"Pattern\":\n          pageProxy.objs.resolve(id, imageData);\n          break;\n        default:\n          throw new Error(`Got unknown object type ${type}`);\n      }\n    });\n\n    messageHandler.on(\"DocProgress\", data => {\n      if (this.destroyed) {\n        return; // Ignore any pending requests if the worker was terminated.\n      }\n      loadingTask.onProgress?.({\n        loaded: data.loaded,\n        total: data.total,\n      });\n    });\n\n    messageHandler.on(\"FetchBuiltInCMap\", data => {\n      if (this.destroyed) {\n        return Promise.reject(new Error(\"Worker was destroyed.\"));\n      }\n      if (!this.cMapReaderFactory) {\n        return Promise.reject(\n          new Error(\n            \"CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.\"\n          )\n        );\n      }\n      return this.cMapReaderFactory.fetch(data);\n    });\n\n    messageHandler.on(\"FetchStandardFontData\", data => {\n      if (this.destroyed) {\n        return Promise.reject(new Error(\"Worker was destroyed.\"));\n      }\n      if (!this.standardFontDataFactory) {\n        return Promise.reject(\n          new Error(\n            \"StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.\"\n          )\n        );\n      }\n      return this.standardFontDataFactory.fetch(data);\n    });\n  }\n\n  getData() {\n    return this.messageHandler.sendWithPromise(\"GetData\", null);\n  }\n\n  saveDocument() {\n    if (this.annotationStorage.size <= 0) {\n      warn(\n        \"saveDocument called while `annotationStorage` is empty, \" +\n          \"please use the getData-method instead.\"\n      );\n    }\n    const { map, transfer } = this.annotationStorage.serializable;\n\n    return this.messageHandler\n      .sendWithPromise(\n        \"SaveDocument\",\n        {\n          isPureXfa: !!this._htmlForXfa,\n          numPages: this._numPages,\n          annotationStorage: map,\n          filename: this._fullReader?.filename ?? null,\n        },\n        transfer\n      )\n      .finally(() => {\n        this.annotationStorage.resetModified();\n      });\n  }\n\n  getPage(pageNumber) {\n    if (\n      !Number.isInteger(pageNumber) ||\n      pageNumber <= 0 ||\n      pageNumber > this._numPages\n    ) {\n      return Promise.reject(new Error(\"Invalid page request.\"));\n    }\n\n    const pageIndex = pageNumber - 1,\n      cachedPromise = this.#pagePromises.get(pageIndex);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler\n      .sendWithPromise(\"GetPage\", {\n        pageIndex,\n      })\n      .then(pageInfo => {\n        if (this.destroyed) {\n          throw new Error(\"Transport destroyed\");\n        }\n        if (pageInfo.refStr) {\n          this.#pageRefCache.set(pageInfo.refStr, pageNumber);\n        }\n\n        const page = new PDFPageProxy(\n          pageIndex,\n          pageInfo,\n          this,\n          this._params.pdfBug\n        );\n        this.#pageCache.set(pageIndex, page);\n        return page;\n      });\n    this.#pagePromises.set(pageIndex, promise);\n    return promise;\n  }\n\n  getPageIndex(ref) {\n    if (!isRefProxy(ref)) {\n      return Promise.reject(new Error(\"Invalid pageIndex request.\"));\n    }\n    return this.messageHandler.sendWithPromise(\"GetPageIndex\", {\n      num: ref.num,\n      gen: ref.gen,\n    });\n  }\n\n  getAnnotations(pageIndex, intent) {\n    return this.messageHandler.sendWithPromise(\"GetAnnotations\", {\n      pageIndex,\n      intent,\n    });\n  }\n\n  getFieldObjects() {\n    return this.#cacheSimpleMethod(\"GetFieldObjects\");\n  }\n\n  hasJSActions() {\n    return this.#cacheSimpleMethod(\"HasJSActions\");\n  }\n\n  getCalculationOrderIds() {\n    return this.messageHandler.sendWithPromise(\"GetCalculationOrderIds\", null);\n  }\n\n  getDestinations() {\n    return this.messageHandler.sendWithPromise(\"GetDestinations\", null);\n  }\n\n  getDestination(id) {\n    if (typeof id !== \"string\") {\n      return Promise.reject(new Error(\"Invalid destination request.\"));\n    }\n    return this.messageHandler.sendWithPromise(\"GetDestination\", {\n      id,\n    });\n  }\n\n  getPageLabels() {\n    return this.messageHandler.sendWithPromise(\"GetPageLabels\", null);\n  }\n\n  getPageLayout() {\n    return this.messageHandler.sendWithPromise(\"GetPageLayout\", null);\n  }\n\n  getPageMode() {\n    return this.messageHandler.sendWithPromise(\"GetPageMode\", null);\n  }\n\n  getViewerPreferences() {\n    return this.messageHandler.sendWithPromise(\"GetViewerPreferences\", null);\n  }\n\n  getOpenAction() {\n    return this.messageHandler.sendWithPromise(\"GetOpenAction\", null);\n  }\n\n  getAttachments() {\n    return this.messageHandler.sendWithPromise(\"GetAttachments\", null);\n  }\n\n  getDocJSActions() {\n    return this.#cacheSimpleMethod(\"GetDocJSActions\");\n  }\n\n  getPageJSActions(pageIndex) {\n    return this.messageHandler.sendWithPromise(\"GetPageJSActions\", {\n      pageIndex,\n    });\n  }\n\n  getStructTree(pageIndex) {\n    return this.messageHandler.sendWithPromise(\"GetStructTree\", {\n      pageIndex,\n    });\n  }\n\n  getOutline() {\n    return this.messageHandler.sendWithPromise(\"GetOutline\", null);\n  }\n\n  getOptionalContentConfig(renderingIntent) {\n    return this.#cacheSimpleMethod(\"GetOptionalContentConfig\").then(\n      data => new OptionalContentConfig(data, renderingIntent)\n    );\n  }\n\n  getPermissions() {\n    return this.messageHandler.sendWithPromise(\"GetPermissions\", null);\n  }\n\n  getMetadata() {\n    const name = \"GetMetadata\",\n      cachedPromise = this.#methodPromises.get(name);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler\n      .sendWithPromise(name, null)\n      .then(results => ({\n        info: results[0],\n        metadata: results[1] ? new Metadata(results[1]) : null,\n        contentDispositionFilename: this._fullReader?.filename ?? null,\n        contentLength: this._fullReader?.contentLength ?? null,\n      }));\n    this.#methodPromises.set(name, promise);\n    return promise;\n  }\n\n  getMarkInfo() {\n    return this.messageHandler.sendWithPromise(\"GetMarkInfo\", null);\n  }\n\n  async startCleanup(keepLoadedFonts = false) {\n    if (this.destroyed) {\n      return; // No need to manually clean-up when destruction has started.\n    }\n    await this.messageHandler.sendWithPromise(\"Cleanup\", null);\n\n    for (const page of this.#pageCache.values()) {\n      const cleanupSuccessful = page.cleanup();\n\n      if (!cleanupSuccessful) {\n        throw new Error(\n          `startCleanup: Page ${page.pageNumber} is currently rendering.`\n        );\n      }\n    }\n    this.commonObjs.clear();\n    if (!keepLoadedFonts) {\n      this.fontLoader.clear();\n    }\n    this.#methodPromises.clear();\n    this.filterFactory.destroy(/* keepHCM = */ true);\n    TextLayer.cleanup();\n  }\n\n  cachedPageNumber(ref) {\n    if (!isRefProxy(ref)) {\n      return null;\n    }\n    const refStr = ref.gen === 0 ? `${ref.num}R` : `${ref.num}R${ref.gen}`;\n    return this.#pageRefCache.get(refStr) ?? null;\n  }\n}\n\nconst INITIAL_DATA = Symbol(\"INITIAL_DATA\");\n\n/**\n * A PDF document and page is built of many objects. E.g. there are objects for\n * fonts, images, rendering code, etc. These objects may get processed inside of\n * a worker. This class implements some basic methods to manage these objects.\n */\nclass PDFObjects {\n  #objs = Object.create(null);\n\n  /**\n   * Ensures there is an object defined for `objId`.\n   *\n   * @param {string} objId\n   * @returns {Object}\n   */\n  #ensureObj(objId) {\n    return (this.#objs[objId] ||= {\n      ...Promise.withResolvers(),\n      data: INITIAL_DATA,\n    });\n  }\n\n  /**\n   * If called *without* callback, this returns the data of `objId` but the\n   * object needs to be resolved. If it isn't, this method throws.\n   *\n   * If called *with* a callback, the callback is called with the data of the\n   * object once the object is resolved. That means, if you call this method\n   * and the object is already resolved, the callback gets called right away.\n   *\n   * @param {string} objId\n   * @param {function} [callback]\n   * @returns {any}\n   */\n  get(objId, callback = null) {\n    // If there is a callback, then the get can be async and the object is\n    // not required to be resolved right now.\n    if (callback) {\n      const obj = this.#ensureObj(objId);\n      obj.promise.then(() => callback(obj.data));\n      return null;\n    }\n    // If there isn't a callback, the user expects to get the resolved data\n    // directly.\n    const obj = this.#objs[objId];\n    // If there isn't an object yet or the object isn't resolved, then the\n    // data isn't ready yet!\n    if (!obj || obj.data === INITIAL_DATA) {\n      throw new Error(`Requesting object that isn't resolved yet ${objId}.`);\n    }\n    return obj.data;\n  }\n\n  /**\n   * @param {string} objId\n   * @returns {boolean}\n   */\n  has(objId) {\n    const obj = this.#objs[objId];\n    return !!obj && obj.data !== INITIAL_DATA;\n  }\n\n  /**\n   * Resolves the object `objId` with optional `data`.\n   *\n   * @param {string} objId\n   * @param {any} [data]\n   */\n  resolve(objId, data = null) {\n    const obj = this.#ensureObj(objId);\n    obj.data = data;\n    obj.resolve();\n  }\n\n  clear() {\n    for (const objId in this.#objs) {\n      const { data } = this.#objs[objId];\n      data?.bitmap?.close(); // Release any `ImageBitmap` data.\n    }\n    this.#objs = Object.create(null);\n  }\n\n  *[Symbol.iterator]() {\n    for (const objId in this.#objs) {\n      const { data } = this.#objs[objId];\n\n      if (data === INITIAL_DATA) {\n        continue;\n      }\n      yield [objId, data];\n    }\n  }\n}\n\n/**\n * Allows controlling of the rendering tasks.\n */\nclass RenderTask {\n  #internalRenderTask = null;\n\n  constructor(internalRenderTask) {\n    this.#internalRenderTask = internalRenderTask;\n\n    /**\n     * Callback for incremental rendering -- a function that will be called\n     * each time the rendering is paused.  To continue rendering call the\n     * function that is the first argument to the callback.\n     * @type {function}\n     */\n    this.onContinue = null;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getOperatorList\", {\n        value: () => this.#internalRenderTask.operatorList,\n      });\n    }\n  }\n\n  /**\n   * Promise for rendering task completion.\n   * @type {Promise<void>}\n   */\n  get promise() {\n    return this.#internalRenderTask.capability.promise;\n  }\n\n  /**\n   * Cancels the rendering task. If the task is currently rendering it will\n   * not be cancelled until graphics pauses with a timeout. The promise that\n   * this object extends will be rejected when cancelled.\n   *\n   * @param {number} [extraDelay]\n   */\n  cancel(extraDelay = 0) {\n    this.#internalRenderTask.cancel(/* error = */ null, extraDelay);\n  }\n\n  /**\n   * Whether form fields are rendered separately from the main operatorList.\n   * @type {boolean}\n   */\n  get separateAnnots() {\n    const { separateAnnots } = this.#internalRenderTask.operatorList;\n    if (!separateAnnots) {\n      return false;\n    }\n    const { annotationCanvasMap } = this.#internalRenderTask;\n    return (\n      separateAnnots.form ||\n      (separateAnnots.canvas && annotationCanvasMap?.size > 0)\n    );\n  }\n}\n\n/**\n * For internal use only.\n * @ignore\n */\nclass InternalRenderTask {\n  #rAF = null;\n\n  static #canvasInUse = new WeakSet();\n\n  constructor({\n    callback,\n    params,\n    objs,\n    commonObjs,\n    annotationCanvasMap,\n    operatorList,\n    pageIndex,\n    canvasFactory,\n    filterFactory,\n    useRequestAnimationFrame = false,\n    pdfBug = false,\n    pageColors = null,\n  }) {\n    this.callback = callback;\n    this.params = params;\n    this.objs = objs;\n    this.commonObjs = commonObjs;\n    this.annotationCanvasMap = annotationCanvasMap;\n    this.operatorListIdx = null;\n    this.operatorList = operatorList;\n    this._pageIndex = pageIndex;\n    this.canvasFactory = canvasFactory;\n    this.filterFactory = filterFactory;\n    this._pdfBug = pdfBug;\n    this.pageColors = pageColors;\n\n    this.running = false;\n    this.graphicsReadyCallback = null;\n    this.graphicsReady = false;\n    this._useRequestAnimationFrame =\n      useRequestAnimationFrame === true && typeof window !== \"undefined\";\n    this.cancelled = false;\n    this.capability = Promise.withResolvers();\n    this.task = new RenderTask(this);\n    // caching this-bound methods\n    this._cancelBound = this.cancel.bind(this);\n    this._continueBound = this._continue.bind(this);\n    this._scheduleNextBound = this._scheduleNext.bind(this);\n    this._nextBound = this._next.bind(this);\n    this._canvas = params.canvasContext.canvas;\n  }\n\n  get completed() {\n    return this.capability.promise.catch(function () {\n      // Ignoring errors, since we only want to know when rendering is\n      // no longer pending.\n    });\n  }\n\n  initializeGraphics({ transparency = false, optionalContentConfig }) {\n    if (this.cancelled) {\n      return;\n    }\n    if (this._canvas) {\n      if (InternalRenderTask.#canvasInUse.has(this._canvas)) {\n        throw new Error(\n          \"Cannot use the same canvas during multiple render() operations. \" +\n            \"Use different canvas or ensure previous operations were \" +\n            \"cancelled or completed.\"\n        );\n      }\n      InternalRenderTask.#canvasInUse.add(this._canvas);\n    }\n\n    if (this._pdfBug && globalThis.StepperManager?.enabled) {\n      this.stepper = globalThis.StepperManager.create(this._pageIndex);\n      this.stepper.init(this.operatorList);\n      this.stepper.nextBreakPoint = this.stepper.getNextBreakPoint();\n    }\n    const { canvasContext, viewport, transform, background } = this.params;\n\n    this.gfx = new CanvasGraphics(\n      canvasContext,\n      this.commonObjs,\n      this.objs,\n      this.canvasFactory,\n      this.filterFactory,\n      { optionalContentConfig },\n      this.annotationCanvasMap,\n      this.pageColors\n    );\n    this.gfx.beginDrawing({\n      transform,\n      viewport,\n      transparency,\n      background,\n    });\n    this.operatorListIdx = 0;\n    this.graphicsReady = true;\n    this.graphicsReadyCallback?.();\n  }\n\n  cancel(error = null, extraDelay = 0) {\n    this.running = false;\n    this.cancelled = true;\n    this.gfx?.endDrawing();\n    if (this.#rAF) {\n      window.cancelAnimationFrame(this.#rAF);\n      this.#rAF = null;\n    }\n    InternalRenderTask.#canvasInUse.delete(this._canvas);\n\n    this.callback(\n      error ||\n        new RenderingCancelledException(\n          `Rendering cancelled, page ${this._pageIndex + 1}`,\n          extraDelay\n        )\n    );\n  }\n\n  operatorListChanged() {\n    if (!this.graphicsReady) {\n      this.graphicsReadyCallback ||= this._continueBound;\n      return;\n    }\n    this.stepper?.updateOperatorList(this.operatorList);\n\n    if (this.running) {\n      return;\n    }\n    this._continue();\n  }\n\n  _continue() {\n    this.running = true;\n    if (this.cancelled) {\n      return;\n    }\n    if (this.task.onContinue) {\n      this.task.onContinue(this._scheduleNextBound);\n    } else {\n      this._scheduleNext();\n    }\n  }\n\n  _scheduleNext() {\n    if (this._useRequestAnimationFrame) {\n      this.#rAF = window.requestAnimationFrame(() => {\n        this.#rAF = null;\n        this._nextBound().catch(this._cancelBound);\n      });\n    } else {\n      Promise.resolve().then(this._nextBound).catch(this._cancelBound);\n    }\n  }\n\n  async _next() {\n    if (this.cancelled) {\n      return;\n    }\n    this.operatorListIdx = this.gfx.executeOperatorList(\n      this.operatorList,\n      this.operatorListIdx,\n      this._continueBound,\n      this.stepper\n    );\n    if (this.operatorListIdx === this.operatorList.argsArray.length) {\n      this.running = false;\n      if (this.operatorList.lastChunk) {\n        this.gfx.endDrawing();\n        InternalRenderTask.#canvasInUse.delete(this._canvas);\n\n        this.callback();\n      }\n    }\n  }\n}\n\n/** @type {string} */\nconst version =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_VERSION\") : null;\n/** @type {string} */\nconst build =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_BUILD\") : null;\n\nexport {\n  build,\n  DefaultCanvasFactory,\n  DefaultCMapReaderFactory,\n  DefaultFilterFactory,\n  DefaultStandardFontDataFactory,\n  getDocument,\n  LoopbackPort,\n  PDFDataRangeTransport,\n  PDFDocumentLoadingTask,\n  PDFDocumentProxy,\n  PDFPageProxy,\n  PDFWorker,\n  PDFWorkerUtil,\n  RenderTask,\n  version,\n};\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * PLEASE NOTE: This file is currently imported in both the `../display/` and\n *              `../scripting_api/` folders, hence be EXTREMELY careful about\n *              introducing any dependencies here since that can lead to an\n *              unexpected/unnecessary size increase of the *built* files.\n */\n\nfunction makeColorComp(n) {\n  return Math.floor(Math.max(0, Math.min(1, n)) * 255)\n    .toString(16)\n    .padStart(2, \"0\");\n}\n\nfunction scaleAndClamp(x) {\n  return Math.max(0, Math.min(255, 255 * x));\n}\n\n// PDF specifications section 10.3\nclass ColorConverters {\n  static CMYK_G([c, y, m, k]) {\n    return [\"G\", 1 - Math.min(1, 0.3 * c + 0.59 * m + 0.11 * y + k)];\n  }\n\n  static G_CMYK([g]) {\n    return [\"CMYK\", 0, 0, 0, 1 - g];\n  }\n\n  static G_RGB([g]) {\n    return [\"RGB\", g, g, g];\n  }\n\n  static G_rgb([g]) {\n    g = scaleAndClamp(g);\n    return [g, g, g];\n  }\n\n  static G_HTML([g]) {\n    const G = makeColorComp(g);\n    return `#${G}${G}${G}`;\n  }\n\n  static RGB_G([r, g, b]) {\n    return [\"G\", 0.3 * r + 0.59 * g + 0.11 * b];\n  }\n\n  static RGB_rgb(color) {\n    return color.map(scaleAndClamp);\n  }\n\n  static RGB_HTML(color) {\n    return `#${color.map(makeColorComp).join(\"\")}`;\n  }\n\n  static T_HTML() {\n    return \"#00000000\";\n  }\n\n  static T_rgb() {\n    return [null];\n  }\n\n  static CMYK_RGB([c, y, m, k]) {\n    return [\n      \"RGB\",\n      1 - Math.min(1, c + k),\n      1 - Math.min(1, m + k),\n      1 - Math.min(1, y + k),\n    ];\n  }\n\n  static CMYK_rgb([c, y, m, k]) {\n    return [\n      scaleAndClamp(1 - Math.min(1, c + k)),\n      scaleAndClamp(1 - Math.min(1, m + k)),\n      scaleAndClamp(1 - Math.min(1, y + k)),\n    ];\n  }\n\n  static CMYK_HTML(components) {\n    const rgb = this.CMYK_RGB(components).slice(1);\n    return this.RGB_HTML(rgb);\n  }\n\n  static RGB_CMYK([r, g, b]) {\n    const c = 1 - r;\n    const m = 1 - g;\n    const y = 1 - b;\n    const k = Math.min(c, m, y);\n    return [\"CMYK\", c, m, y, k];\n  }\n}\n\nexport { ColorConverters };\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_storage\").AnnotationStorage} AnnotationStorage */\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"../../web/interfaces\").IPDFLinkService} IPDFLinkService */\n\nimport { XfaText } from \"./xfa_text.js\";\n\n/**\n * @typedef {Object} XfaLayerParameters\n * @property {PageViewport} viewport\n * @property {HTMLDivElement} div\n * @property {Object} xfaHtml\n * @property {AnnotationStorage} [annotationStorage]\n * @property {IPDFLinkService} linkService\n * @property {string} [intent] - (default value is 'display').\n */\n\nclass XfaLayer {\n  static setupStorage(html, id, element, storage, intent) {\n    const storedData = storage.getValue(id, { value: null });\n    switch (element.name) {\n      case \"textarea\":\n        if (storedData.value !== null) {\n          html.textContent = storedData.value;\n        }\n        if (intent === \"print\") {\n          break;\n        }\n        html.addEventListener(\"input\", event => {\n          storage.setValue(id, { value: event.target.value });\n        });\n        break;\n      case \"input\":\n        if (\n          element.attributes.type === \"radio\" ||\n          element.attributes.type === \"checkbox\"\n        ) {\n          if (storedData.value === element.attributes.xfaOn) {\n            html.setAttribute(\"checked\", true);\n          } else if (storedData.value === element.attributes.xfaOff) {\n            // The checked attribute may have been set when opening the file,\n            // unset through the UI and we're here because of printing.\n            html.removeAttribute(\"checked\");\n          }\n          if (intent === \"print\") {\n            break;\n          }\n          html.addEventListener(\"change\", event => {\n            storage.setValue(id, {\n              value: event.target.checked\n                ? event.target.getAttribute(\"xfaOn\")\n                : event.target.getAttribute(\"xfaOff\"),\n            });\n          });\n        } else {\n          if (storedData.value !== null) {\n            html.setAttribute(\"value\", storedData.value);\n          }\n          if (intent === \"print\") {\n            break;\n          }\n          html.addEventListener(\"input\", event => {\n            storage.setValue(id, { value: event.target.value });\n          });\n        }\n        break;\n      case \"select\":\n        if (storedData.value !== null) {\n          html.setAttribute(\"value\", storedData.value);\n          for (const option of element.children) {\n            if (option.attributes.value === storedData.value) {\n              option.attributes.selected = true;\n            } else if (option.attributes.hasOwnProperty(\"selected\")) {\n              delete option.attributes.selected;\n            }\n          }\n        }\n        html.addEventListener(\"input\", event => {\n          const options = event.target.options;\n          const value =\n            options.selectedIndex === -1\n              ? \"\"\n              : options[options.selectedIndex].value;\n          storage.setValue(id, { value });\n        });\n        break;\n    }\n  }\n\n  static setAttributes({ html, element, storage = null, intent, linkService }) {\n    const { attributes } = element;\n    const isHTMLAnchorElement = html instanceof HTMLAnchorElement;\n\n    if (attributes.type === \"radio\") {\n      // Avoid to have a radio group when printing with the same as one\n      // already displayed.\n      attributes.name = `${attributes.name}-${intent}`;\n    }\n    for (const [key, value] of Object.entries(attributes)) {\n      if (value === null || value === undefined) {\n        continue;\n      }\n\n      switch (key) {\n        case \"class\":\n          if (value.length) {\n            html.setAttribute(key, value.join(\" \"));\n          }\n          break;\n        case \"dataId\":\n          // We don't need to add dataId in the html object but it can\n          // be useful to know its value when writing printing tests:\n          // in this case, don't skip dataId to have its value.\n          break;\n        case \"id\":\n          html.setAttribute(\"data-element-id\", value);\n          break;\n        case \"style\":\n          Object.assign(html.style, value);\n          break;\n        case \"textContent\":\n          html.textContent = value;\n          break;\n        default:\n          if (!isHTMLAnchorElement || (key !== \"href\" && key !== \"newWindow\")) {\n            html.setAttribute(key, value);\n          }\n      }\n    }\n\n    if (isHTMLAnchorElement) {\n      linkService.addLinkAttributes(\n        html,\n        attributes.href,\n        attributes.newWindow\n      );\n    }\n\n    // Set the value after the others to be sure to overwrite any other values.\n    if (storage && attributes.dataId) {\n      this.setupStorage(html, attributes.dataId, element, storage);\n    }\n  }\n\n  /**\n   * Render the XFA layer.\n   *\n   * @param {XfaLayerParameters} parameters\n   */\n  static render(parameters) {\n    const storage = parameters.annotationStorage;\n    const linkService = parameters.linkService;\n    const root = parameters.xfaHtml;\n    const intent = parameters.intent || \"display\";\n    const rootHtml = document.createElement(root.name);\n    if (root.attributes) {\n      this.setAttributes({\n        html: rootHtml,\n        element: root,\n        intent,\n        linkService,\n      });\n    }\n\n    const isNotForRichText = intent !== \"richText\";\n    const rootDiv = parameters.div;\n    rootDiv.append(rootHtml);\n\n    if (parameters.viewport) {\n      const transform = `matrix(${parameters.viewport.transform.join(\",\")})`;\n      rootDiv.style.transform = transform;\n    }\n\n    // Set defaults.\n    if (isNotForRichText) {\n      rootDiv.setAttribute(\"class\", \"xfaLayer xfaFont\");\n    }\n\n    // Text nodes used for the text highlighter.\n    const textDivs = [];\n\n    // In the rich text context, it's possible to just have a text node without\n    // a root element, so we handle this case here (see issue 17215).\n    if (root.children.length === 0) {\n      if (root.value) {\n        const node = document.createTextNode(root.value);\n        rootHtml.append(node);\n        if (isNotForRichText && XfaText.shouldBuildText(root.name)) {\n          textDivs.push(node);\n        }\n      }\n      return { textDivs };\n    }\n\n    const stack = [[root, -1, rootHtml]];\n\n    while (stack.length > 0) {\n      const [parent, i, html] = stack.at(-1);\n      if (i + 1 === parent.children.length) {\n        stack.pop();\n        continue;\n      }\n\n      const child = parent.children[++stack.at(-1)[1]];\n      if (child === null) {\n        continue;\n      }\n\n      const { name } = child;\n      if (name === \"#text\") {\n        const node = document.createTextNode(child.value);\n        textDivs.push(node);\n        html.append(node);\n        continue;\n      }\n\n      const childHtml = child?.attributes?.xmlns\n        ? document.createElementNS(child.attributes.xmlns, name)\n        : document.createElement(name);\n\n      html.append(childHtml);\n      if (child.attributes) {\n        this.setAttributes({\n          html: childHtml,\n          element: child,\n          storage,\n          intent,\n          linkService,\n        });\n      }\n\n      if (child.children?.length > 0) {\n        stack.push([child, -1, childHtml]);\n      } else if (child.value) {\n        const node = document.createTextNode(child.value);\n        if (isNotForRichText && XfaText.shouldBuildText(name)) {\n          textDivs.push(node);\n        }\n        childHtml.append(node);\n      }\n    }\n\n    /**\n     * TODO: re-enable that stuff once we've JS implementation.\n     * See https://bugzilla.mozilla.org/show_bug.cgi?id=1719465.\n     *\n     * for (const el of rootDiv.querySelectorAll(\n     * \".xfaDisabled input, .xfaDisabled textarea\"\n     * )) {\n     * el.setAttribute(\"disabled\", true);\n     * }\n     * for (const el of rootDiv.querySelectorAll(\n     * \".xfaReadOnly input, .xfaReadOnly textarea\"\n     * )) {\n     * el.setAttribute(\"readOnly\", true);\n     * }\n     */\n\n    for (const el of rootDiv.querySelectorAll(\n      \".xfaNonInteractive input, .xfaNonInteractive textarea\"\n    )) {\n      el.setAttribute(\"readOnly\", true);\n    }\n\n    return {\n      textDivs,\n    };\n  }\n\n  /**\n   * Update the XFA layer.\n   *\n   * @param {XfaLayerParameters} parameters\n   */\n  static update(parameters) {\n    const transform = `matrix(${parameters.viewport.transform.join(\",\")})`;\n    parameters.div.style.transform = transform;\n    parameters.div.hidden = false;\n  }\n}\n\nexport { XfaLayer };\n","/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./api\").PDFPageProxy} PDFPageProxy */\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/interfaces\").IDownloadManager} IDownloadManager */\n/** @typedef {import(\"../../web/interfaces\").IPDFLinkService} IPDFLinkService */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/editor/tools.js\").AnnotationEditorUIManager} AnnotationEditorUIManager */\n\nimport {\n  AnnotationBorderStyleType,\n  AnnotationEditorType,\n  AnnotationPrefix,\n  AnnotationType,\n  FeatureTest,\n  LINE_FACTOR,\n  shadow,\n  unreachable,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  DOMSVGFactory,\n  PDFDateString,\n  setLayerDimensions,\n} from \"./display_utils.js\";\nimport { AnnotationStorage } from \"./annotation_storage.js\";\nimport { ColorConverters } from \"../shared/scripting_utils.js\";\nimport { XfaLayer } from \"./xfa_layer.js\";\n\nconst DEFAULT_TAB_INDEX = 1000;\nconst DEFAULT_FONT_SIZE = 9;\nconst GetElementsByNameSet = new WeakSet();\n\nfunction getRectDims(rect) {\n  return {\n    width: rect[2] - rect[0],\n    height: rect[3] - rect[1],\n  };\n}\n\n/**\n * @typedef {Object} AnnotationElementParameters\n * @property {Object} data\n * @property {HTMLDivElement} layer\n * @property {IPDFLinkService} linkService\n * @property {IDownloadManager} [downloadManager]\n * @property {AnnotationStorage} [annotationStorage]\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   for annotation icons. Include trailing slash.\n * @property {boolean} renderForms\n * @property {Object} svgFactory\n * @property {boolean} [enableScripting]\n * @property {boolean} [hasJSActions]\n * @property {Object} [fieldObjects]\n */\n\nclass AnnotationElementFactory {\n  /**\n   * @param {AnnotationElementParameters} parameters\n   * @returns {AnnotationElement}\n   */\n  static create(parameters) {\n    const subtype = parameters.data.annotationType;\n\n    switch (subtype) {\n      case AnnotationType.LINK:\n        return new LinkAnnotationElement(parameters);\n\n      case AnnotationType.TEXT:\n        return new TextAnnotationElement(parameters);\n\n      case AnnotationType.WIDGET:\n        const fieldType = parameters.data.fieldType;\n\n        switch (fieldType) {\n          case \"Tx\":\n            return new TextWidgetAnnotationElement(parameters);\n          case \"Btn\":\n            if (parameters.data.radioButton) {\n              return new RadioButtonWidgetAnnotationElement(parameters);\n            } else if (parameters.data.checkBox) {\n              return new CheckboxWidgetAnnotationElement(parameters);\n            }\n            return new PushButtonWidgetAnnotationElement(parameters);\n          case \"Ch\":\n            return new ChoiceWidgetAnnotationElement(parameters);\n          case \"Sig\":\n            return new SignatureWidgetAnnotationElement(parameters);\n        }\n        return new WidgetAnnotationElement(parameters);\n\n      case AnnotationType.POPUP:\n        return new PopupAnnotationElement(parameters);\n\n      case AnnotationType.FREETEXT:\n        return new FreeTextAnnotationElement(parameters);\n\n      case AnnotationType.LINE:\n        return new LineAnnotationElement(parameters);\n\n      case AnnotationType.SQUARE:\n        return new SquareAnnotationElement(parameters);\n\n      case AnnotationType.CIRCLE:\n        return new CircleAnnotationElement(parameters);\n\n      case AnnotationType.POLYLINE:\n        return new PolylineAnnotationElement(parameters);\n\n      case AnnotationType.CARET:\n        return new CaretAnnotationElement(parameters);\n\n      case AnnotationType.INK:\n        return new InkAnnotationElement(parameters);\n\n      case AnnotationType.POLYGON:\n        return new PolygonAnnotationElement(parameters);\n\n      case AnnotationType.HIGHLIGHT:\n        return new HighlightAnnotationElement(parameters);\n\n      case AnnotationType.UNDERLINE:\n        return new UnderlineAnnotationElement(parameters);\n\n      case AnnotationType.SQUIGGLY:\n        return new SquigglyAnnotationElement(parameters);\n\n      case AnnotationType.STRIKEOUT:\n        return new StrikeOutAnnotationElement(parameters);\n\n      case AnnotationType.STAMP:\n        return new StampAnnotationElement(parameters);\n\n      case AnnotationType.FILEATTACHMENT:\n        return new FileAttachmentAnnotationElement(parameters);\n\n      default:\n        return new AnnotationElement(parameters);\n    }\n  }\n}\n\nclass AnnotationElement {\n  #updates = null;\n\n  #hasBorder = false;\n\n  #popupElement = null;\n\n  constructor(\n    parameters,\n    {\n      isRenderable = false,\n      ignoreBorder = false,\n      createQuadrilaterals = false,\n    } = {}\n  ) {\n    this.isRenderable = isRenderable;\n    this.data = parameters.data;\n    this.layer = parameters.layer;\n    this.linkService = parameters.linkService;\n    this.downloadManager = parameters.downloadManager;\n    this.imageResourcesPath = parameters.imageResourcesPath;\n    this.renderForms = parameters.renderForms;\n    this.svgFactory = parameters.svgFactory;\n    this.annotationStorage = parameters.annotationStorage;\n    this.enableScripting = parameters.enableScripting;\n    this.hasJSActions = parameters.hasJSActions;\n    this._fieldObjects = parameters.fieldObjects;\n    this.parent = parameters.parent;\n\n    if (isRenderable) {\n      this.container = this._createContainer(ignoreBorder);\n    }\n    if (createQuadrilaterals) {\n      this._createQuadrilaterals();\n    }\n  }\n\n  static _hasPopupData({ titleObj, contentsObj, richText }) {\n    return !!(titleObj?.str || contentsObj?.str || richText?.str);\n  }\n\n  get _isEditable() {\n    return this.data.isEditable;\n  }\n\n  get hasPopupData() {\n    return AnnotationElement._hasPopupData(this.data);\n  }\n\n  updateEdited(params) {\n    if (!this.container) {\n      return;\n    }\n\n    this.#updates ||= {\n      rect: this.data.rect.slice(0),\n    };\n\n    const { rect } = params;\n\n    if (rect) {\n      this.#setRectEdited(rect);\n    }\n\n    this.#popupElement?.popup.updateEdited(params);\n  }\n\n  resetEdited() {\n    if (!this.#updates) {\n      return;\n    }\n    this.#setRectEdited(this.#updates.rect);\n    this.#popupElement?.popup.resetEdited();\n    this.#updates = null;\n  }\n\n  #setRectEdited(rect) {\n    const {\n      container: { style },\n      data: { rect: currentRect, rotation },\n      parent: {\n        viewport: {\n          rawDims: { pageWidth, pageHeight, pageX, pageY },\n        },\n      },\n    } = this;\n    currentRect?.splice(0, 4, ...rect);\n    const { width, height } = getRectDims(rect);\n    style.left = `${(100 * (rect[0] - pageX)) / pageWidth}%`;\n    style.top = `${(100 * (pageHeight - rect[3] + pageY)) / pageHeight}%`;\n    if (rotation === 0) {\n      style.width = `${(100 * width) / pageWidth}%`;\n      style.height = `${(100 * height) / pageHeight}%`;\n    } else {\n      this.setRotation(rotation);\n    }\n  }\n\n  /**\n   * Create an empty container for the annotation's HTML element.\n   *\n   * @private\n   * @param {boolean} ignoreBorder\n   * @memberof AnnotationElement\n   * @returns {HTMLElement} A section element.\n   */\n  _createContainer(ignoreBorder) {\n    const {\n      data,\n      parent: { page, viewport },\n    } = this;\n\n    const container = document.createElement(\"section\");\n    container.setAttribute(\"data-annotation-id\", data.id);\n    if (!(this instanceof WidgetAnnotationElement)) {\n      container.tabIndex = DEFAULT_TAB_INDEX;\n    }\n    const { style } = container;\n\n    // The accessibility manager will move the annotation in the DOM in\n    // order to match the visual ordering.\n    // But if an annotation is above an other one, then we must draw it\n    // after the other one whatever the order is in the DOM, hence the\n    // use of the z-index.\n    style.zIndex = this.parent.zIndex++;\n\n    if (data.popupRef) {\n      container.setAttribute(\"aria-haspopup\", \"dialog\");\n    }\n\n    if (data.alternativeText) {\n      container.title = data.alternativeText;\n    }\n\n    if (data.noRotate) {\n      container.classList.add(\"norotate\");\n    }\n\n    if (!data.rect || this instanceof PopupAnnotationElement) {\n      const { rotation } = data;\n      if (!data.hasOwnCanvas && rotation !== 0) {\n        this.setRotation(rotation, container);\n      }\n      return container;\n    }\n\n    const { width, height } = getRectDims(data.rect);\n\n    if (!ignoreBorder && data.borderStyle.width > 0) {\n      style.borderWidth = `${data.borderStyle.width}px`;\n\n      const horizontalRadius = data.borderStyle.horizontalCornerRadius;\n      const verticalRadius = data.borderStyle.verticalCornerRadius;\n      if (horizontalRadius > 0 || verticalRadius > 0) {\n        const radius = `calc(${horizontalRadius}px * var(--scale-factor)) / calc(${verticalRadius}px * var(--scale-factor))`;\n        style.borderRadius = radius;\n      } else if (this instanceof RadioButtonWidgetAnnotationElement) {\n        const radius = `calc(${width}px * var(--scale-factor)) / calc(${height}px * var(--scale-factor))`;\n        style.borderRadius = radius;\n      }\n\n      switch (data.borderStyle.style) {\n        case AnnotationBorderStyleType.SOLID:\n          style.borderStyle = \"solid\";\n          break;\n\n        case AnnotationBorderStyleType.DASHED:\n          style.borderStyle = \"dashed\";\n          break;\n\n        case AnnotationBorderStyleType.BEVELED:\n          warn(\"Unimplemented border style: beveled\");\n          break;\n\n        case AnnotationBorderStyleType.INSET:\n          warn(\"Unimplemented border style: inset\");\n          break;\n\n        case AnnotationBorderStyleType.UNDERLINE:\n          style.borderBottomStyle = \"solid\";\n          break;\n\n        default:\n          break;\n      }\n\n      const borderColor = data.borderColor || null;\n      if (borderColor) {\n        this.#hasBorder = true;\n        style.borderColor = Util.makeHexColor(\n          borderColor[0] | 0,\n          borderColor[1] | 0,\n          borderColor[2] | 0\n        );\n      } else {\n        // Transparent (invisible) border, so do not draw it at all.\n        style.borderWidth = 0;\n      }\n    }\n\n    // Do *not* modify `data.rect`, since that will corrupt the annotation\n    // position on subsequent calls to `_createContainer` (see issue 6804).\n    const rect = Util.normalizeRect([\n      data.rect[0],\n      page.view[3] - data.rect[1] + page.view[1],\n      data.rect[2],\n      page.view[3] - data.rect[3] + page.view[1],\n    ]);\n    const { pageWidth, pageHeight, pageX, pageY } = viewport.rawDims;\n\n    style.left = `${(100 * (rect[0] - pageX)) / pageWidth}%`;\n    style.top = `${(100 * (rect[1] - pageY)) / pageHeight}%`;\n\n    const { rotation } = data;\n    if (data.hasOwnCanvas || rotation === 0) {\n      style.width = `${(100 * width) / pageWidth}%`;\n      style.height = `${(100 * height) / pageHeight}%`;\n    } else {\n      this.setRotation(rotation, container);\n    }\n\n    return container;\n  }\n\n  setRotation(angle, container = this.container) {\n    if (!this.data.rect) {\n      return;\n    }\n    const { pageWidth, pageHeight } = this.parent.viewport.rawDims;\n    const { width, height } = getRectDims(this.data.rect);\n\n    let elementWidth, elementHeight;\n    if (angle % 180 === 0) {\n      elementWidth = (100 * width) / pageWidth;\n      elementHeight = (100 * height) / pageHeight;\n    } else {\n      elementWidth = (100 * height) / pageWidth;\n      elementHeight = (100 * width) / pageHeight;\n    }\n\n    container.style.width = `${elementWidth}%`;\n    container.style.height = `${elementHeight}%`;\n\n    container.setAttribute(\"data-main-rotation\", (360 - angle) % 360);\n  }\n\n  get _commonActions() {\n    const setColor = (jsName, styleName, event) => {\n      const color = event.detail[jsName];\n      const colorType = color[0];\n      const colorArray = color.slice(1);\n      event.target.style[styleName] =\n        ColorConverters[`${colorType}_HTML`](colorArray);\n      this.annotationStorage.setValue(this.data.id, {\n        [styleName]: ColorConverters[`${colorType}_rgb`](colorArray),\n      });\n    };\n\n    return shadow(this, \"_commonActions\", {\n      display: event => {\n        const { display } = event.detail;\n        // See scripting/constants.js for the values of `Display`.\n        // 0 = visible, 1 = hidden, 2 = noPrint and 3 = noView.\n        const hidden = display % 2 === 1;\n        this.container.style.visibility = hidden ? \"hidden\" : \"visible\";\n        this.annotationStorage.setValue(this.data.id, {\n          noView: hidden,\n          noPrint: display === 1 || display === 2,\n        });\n      },\n      print: event => {\n        this.annotationStorage.setValue(this.data.id, {\n          noPrint: !event.detail.print,\n        });\n      },\n      hidden: event => {\n        const { hidden } = event.detail;\n        this.container.style.visibility = hidden ? \"hidden\" : \"visible\";\n        this.annotationStorage.setValue(this.data.id, {\n          noPrint: hidden,\n          noView: hidden,\n        });\n      },\n      focus: event => {\n        setTimeout(() => event.target.focus({ preventScroll: false }), 0);\n      },\n      userName: event => {\n        // tooltip\n        event.target.title = event.detail.userName;\n      },\n      readonly: event => {\n        event.target.disabled = event.detail.readonly;\n      },\n      required: event => {\n        this._setRequired(event.target, event.detail.required);\n      },\n      bgColor: event => {\n        setColor(\"bgColor\", \"backgroundColor\", event);\n      },\n      fillColor: event => {\n        setColor(\"fillColor\", \"backgroundColor\", event);\n      },\n      fgColor: event => {\n        setColor(\"fgColor\", \"color\", event);\n      },\n      textColor: event => {\n        setColor(\"textColor\", \"color\", event);\n      },\n      borderColor: event => {\n        setColor(\"borderColor\", \"borderColor\", event);\n      },\n      strokeColor: event => {\n        setColor(\"strokeColor\", \"borderColor\", event);\n      },\n      rotation: event => {\n        const angle = event.detail.rotation;\n        this.setRotation(angle);\n        this.annotationStorage.setValue(this.data.id, {\n          rotation: angle,\n        });\n      },\n    });\n  }\n\n  _dispatchEventFromSandbox(actions, jsEvent) {\n    const commonActions = this._commonActions;\n    for (const name of Object.keys(jsEvent.detail)) {\n      const action = actions[name] || commonActions[name];\n      action?.(jsEvent);\n    }\n  }\n\n  _setDefaultPropertiesFromJS(element) {\n    if (!this.enableScripting) {\n      return;\n    }\n\n    // Some properties may have been updated thanks to JS.\n    const storedData = this.annotationStorage.getRawValue(this.data.id);\n    if (!storedData) {\n      return;\n    }\n\n    const commonActions = this._commonActions;\n    for (const [actionName, detail] of Object.entries(storedData)) {\n      const action = commonActions[actionName];\n      if (action) {\n        const eventProxy = {\n          detail: {\n            [actionName]: detail,\n          },\n          target: element,\n        };\n        action(eventProxy);\n        // The action has been consumed: no need to keep it.\n        delete storedData[actionName];\n      }\n    }\n  }\n\n  /**\n   * Create quadrilaterals from the annotation's quadpoints.\n   *\n   * @private\n   * @memberof AnnotationElement\n   */\n  _createQuadrilaterals() {\n    if (!this.container) {\n      return;\n    }\n    const { quadPoints } = this.data;\n    if (!quadPoints) {\n      return;\n    }\n\n    const [rectBlX, rectBlY, rectTrX, rectTrY] = this.data.rect.map(x =>\n      Math.fround(x)\n    );\n\n    if (quadPoints.length === 8) {\n      const [trX, trY, blX, blY] = quadPoints.subarray(2, 6);\n      if (\n        rectTrX === trX &&\n        rectTrY === trY &&\n        rectBlX === blX &&\n        rectBlY === blY\n      ) {\n        // The quadpoints cover the whole annotation rectangle, so no need to\n        // create a quadrilateral.\n        return;\n      }\n    }\n\n    const { style } = this.container;\n    let svgBuffer;\n    if (this.#hasBorder) {\n      const { borderColor, borderWidth } = style;\n      style.borderWidth = 0;\n      svgBuffer = [\n        \"url('data:image/svg+xml;utf8,\",\n        `<svg xmlns=\"http://www.w3.org/2000/svg\"`,\n        ` preserveAspectRatio=\"none\" viewBox=\"0 0 1 1\">`,\n        `<g fill=\"transparent\" stroke=\"${borderColor}\" stroke-width=\"${borderWidth}\">`,\n      ];\n      this.container.classList.add(\"hasBorder\");\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      this.container.classList.add(\"hasClipPath\");\n    }\n\n    const width = rectTrX - rectBlX;\n    const height = rectTrY - rectBlY;\n\n    const { svgFactory } = this;\n    const svg = svgFactory.createElement(\"svg\");\n    svg.classList.add(\"quadrilateralsContainer\");\n    svg.setAttribute(\"width\", 0);\n    svg.setAttribute(\"height\", 0);\n    const defs = svgFactory.createElement(\"defs\");\n    svg.append(defs);\n    const clipPath = svgFactory.createElement(\"clipPath\");\n    const id = `clippath_${this.data.id}`;\n    clipPath.setAttribute(\"id\", id);\n    clipPath.setAttribute(\"clipPathUnits\", \"objectBoundingBox\");\n    defs.append(clipPath);\n\n    for (let i = 2, ii = quadPoints.length; i < ii; i += 8) {\n      const trX = quadPoints[i];\n      const trY = quadPoints[i + 1];\n      const blX = quadPoints[i + 2];\n      const blY = quadPoints[i + 3];\n      const rect = svgFactory.createElement(\"rect\");\n      const x = (blX - rectBlX) / width;\n      const y = (rectTrY - trY) / height;\n      const rectWidth = (trX - blX) / width;\n      const rectHeight = (trY - blY) / height;\n      rect.setAttribute(\"x\", x);\n      rect.setAttribute(\"y\", y);\n      rect.setAttribute(\"width\", rectWidth);\n      rect.setAttribute(\"height\", rectHeight);\n      clipPath.append(rect);\n      svgBuffer?.push(\n        `<rect vector-effect=\"non-scaling-stroke\" x=\"${x}\" y=\"${y}\" width=\"${rectWidth}\" height=\"${rectHeight}\"/>`\n      );\n    }\n\n    if (this.#hasBorder) {\n      svgBuffer.push(`</g></svg>')`);\n      style.backgroundImage = svgBuffer.join(\"\");\n    }\n\n    this.container.append(svg);\n    this.container.style.clipPath = `url(#${id})`;\n  }\n\n  /**\n   * Create a popup for the annotation's HTML element. This is used for\n   * annotations that do not have a Popup entry in the dictionary, but\n   * are of a type that works with popups (such as Highlight annotations).\n   *\n   * @private\n   * @memberof AnnotationElement\n   */\n  _createPopup() {\n    const { container, data } = this;\n    container.setAttribute(\"aria-haspopup\", \"dialog\");\n\n    const popup = (this.#popupElement = new PopupAnnotationElement({\n      data: {\n        color: data.color,\n        titleObj: data.titleObj,\n        modificationDate: data.modificationDate,\n        contentsObj: data.contentsObj,\n        richText: data.richText,\n        parentRect: data.rect,\n        borderStyle: 0,\n        id: `popup_${data.id}`,\n        rotation: data.rotation,\n      },\n      parent: this.parent,\n      elements: [this],\n    }));\n    this.parent.div.append(popup.render());\n  }\n\n  /**\n   * Render the annotation's HTML element(s).\n   *\n   * @public\n   * @memberof AnnotationElement\n   */\n  render() {\n    unreachable(\"Abstract method `AnnotationElement.render` called\");\n  }\n\n  /**\n   * @private\n   * @returns {Array}\n   */\n  _getElementsByName(name, skipId = null) {\n    const fields = [];\n\n    if (this._fieldObjects) {\n      const fieldObj = this._fieldObjects[name];\n      if (fieldObj) {\n        for (const { page, id, exportValues } of fieldObj) {\n          if (page === -1) {\n            continue;\n          }\n          if (id === skipId) {\n            continue;\n          }\n          const exportValue =\n            typeof exportValues === \"string\" ? exportValues : null;\n\n          const domElement = document.querySelector(\n            `[data-element-id=\"${id}\"]`\n          );\n          if (domElement && !GetElementsByNameSet.has(domElement)) {\n            warn(`_getElementsByName - element not allowed: ${id}`);\n            continue;\n          }\n          fields.push({ id, exportValue, domElement });\n        }\n      }\n      return fields;\n    }\n    // Fallback to a regular DOM lookup, to ensure that the standalone\n    // viewer components won't break.\n    for (const domElement of document.getElementsByName(name)) {\n      const { exportValue } = domElement;\n      const id = domElement.getAttribute(\"data-element-id\");\n      if (id === skipId) {\n        continue;\n      }\n      if (!GetElementsByNameSet.has(domElement)) {\n        continue;\n      }\n      fields.push({ id, exportValue, domElement });\n    }\n    return fields;\n  }\n\n  show() {\n    if (this.container) {\n      this.container.hidden = false;\n    }\n    this.popup?.maybeShow();\n  }\n\n  hide() {\n    if (this.container) {\n      this.container.hidden = true;\n    }\n    this.popup?.forceHide();\n  }\n\n  /**\n   * Get the HTML element(s) which can trigger a popup when clicked or hovered.\n   *\n   * @public\n   * @memberof AnnotationElement\n   * @returns {Array<HTMLElement>|HTMLElement} An array of elements or an\n   *          element.\n   */\n  getElementsToTriggerPopup() {\n    return this.container;\n  }\n\n  addHighlightArea() {\n    const triggers = this.getElementsToTriggerPopup();\n    if (Array.isArray(triggers)) {\n      for (const element of triggers) {\n        element.classList.add(\"highlightArea\");\n      }\n    } else {\n      triggers.classList.add(\"highlightArea\");\n    }\n  }\n\n  _editOnDoubleClick() {\n    if (!this._isEditable) {\n      return;\n    }\n    const {\n      annotationEditorType: mode,\n      data: { id: editId },\n    } = this;\n    this.container.addEventListener(\"dblclick\", () => {\n      this.linkService.eventBus?.dispatch(\"switchannotationeditormode\", {\n        source: this,\n        mode,\n        editId,\n      });\n    });\n  }\n}\n\nclass LinkAnnotationElement extends AnnotationElement {\n  constructor(parameters, options = null) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: !!options?.ignoreBorder,\n      createQuadrilaterals: true,\n    });\n    this.isTooltipOnly = parameters.data.isTooltipOnly;\n  }\n\n  render() {\n    const { data, linkService } = this;\n    const link = document.createElement(\"a\");\n    link.setAttribute(\"data-element-id\", data.id);\n    let isBound = false;\n\n    if (data.url) {\n      linkService.addLinkAttributes(link, data.url, data.newWindow);\n      isBound = true;\n    } else if (data.action) {\n      this._bindNamedAction(link, data.action);\n      isBound = true;\n    } else if (data.attachment) {\n      this.#bindAttachment(link, data.attachment, data.attachmentDest);\n      isBound = true;\n    } else if (data.setOCGState) {\n      this.#bindSetOCGState(link, data.setOCGState);\n      isBound = true;\n    } else if (data.dest) {\n      this._bindLink(link, data.dest);\n      isBound = true;\n    } else {\n      if (\n        data.actions &&\n        (data.actions.Action ||\n          data.actions[\"Mouse Up\"] ||\n          data.actions[\"Mouse Down\"]) &&\n        this.enableScripting &&\n        this.hasJSActions\n      ) {\n        this._bindJSAction(link, data);\n        isBound = true;\n      }\n\n      if (data.resetForm) {\n        this._bindResetFormAction(link, data.resetForm);\n        isBound = true;\n      } else if (this.isTooltipOnly && !isBound) {\n        this._bindLink(link, \"\");\n        isBound = true;\n      }\n    }\n\n    this.container.classList.add(\"linkAnnotation\");\n    if (isBound) {\n      this.container.append(link);\n    }\n\n    return this.container;\n  }\n\n  #setInternalLink() {\n    this.container.setAttribute(\"data-internal-link\", \"\");\n  }\n\n  /**\n   * Bind internal links to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} destination\n   * @memberof LinkAnnotationElement\n   */\n  _bindLink(link, destination) {\n    link.href = this.linkService.getDestinationHash(destination);\n    link.onclick = () => {\n      if (destination) {\n        this.linkService.goToDestination(destination);\n      }\n      return false;\n    };\n    if (destination || destination === /* isTooltipOnly = */ \"\") {\n      this.#setInternalLink();\n    }\n  }\n\n  /**\n   * Bind named actions to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} action\n   * @memberof LinkAnnotationElement\n   */\n  _bindNamedAction(link, action) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    link.onclick = () => {\n      this.linkService.executeNamedAction(action);\n      return false;\n    };\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind attachments to the link element.\n   * @param {Object} link\n   * @param {Object} attachment\n   * @param {str} [dest]\n   */\n  #bindAttachment(link, attachment, dest = null) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    if (attachment.description) {\n      link.title = attachment.description;\n    }\n    link.onclick = () => {\n      this.downloadManager?.openOrDownloadData(\n        attachment.content,\n        attachment.filename,\n        dest\n      );\n      return false;\n    };\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind SetOCGState actions to the link element.\n   * @param {Object} link\n   * @param {Object} action\n   */\n  #bindSetOCGState(link, action) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    link.onclick = () => {\n      this.linkService.executeSetOCGState(action);\n      return false;\n    };\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind JS actions to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} data\n   * @memberof LinkAnnotationElement\n   */\n  _bindJSAction(link, data) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    const map = new Map([\n      [\"Action\", \"onclick\"],\n      [\"Mouse Up\", \"onmouseup\"],\n      [\"Mouse Down\", \"onmousedown\"],\n    ]);\n    for (const name of Object.keys(data.actions)) {\n      const jsName = map.get(name);\n      if (!jsName) {\n        continue;\n      }\n      link[jsName] = () => {\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: data.id,\n            name,\n          },\n        });\n        return false;\n      };\n    }\n\n    if (!link.onclick) {\n      link.onclick = () => false;\n    }\n    this.#setInternalLink();\n  }\n\n  _bindResetFormAction(link, resetForm) {\n    const otherClickAction = link.onclick;\n    if (!otherClickAction) {\n      link.href = this.linkService.getAnchorUrl(\"\");\n    }\n    this.#setInternalLink();\n\n    if (!this._fieldObjects) {\n      warn(\n        `_bindResetFormAction - \"resetForm\" action not supported, ` +\n          \"ensure that the `fieldObjects` parameter is provided.\"\n      );\n      if (!otherClickAction) {\n        link.onclick = () => false;\n      }\n      return;\n    }\n\n    link.onclick = () => {\n      otherClickAction?.();\n\n      const {\n        fields: resetFormFields,\n        refs: resetFormRefs,\n        include,\n      } = resetForm;\n\n      const allFields = [];\n      if (resetFormFields.length !== 0 || resetFormRefs.length !== 0) {\n        const fieldIds = new Set(resetFormRefs);\n        for (const fieldName of resetFormFields) {\n          const fields = this._fieldObjects[fieldName] || [];\n          for (const { id } of fields) {\n            fieldIds.add(id);\n          }\n        }\n        for (const fields of Object.values(this._fieldObjects)) {\n          for (const field of fields) {\n            if (fieldIds.has(field.id) === include) {\n              allFields.push(field);\n            }\n          }\n        }\n      } else {\n        for (const fields of Object.values(this._fieldObjects)) {\n          allFields.push(...fields);\n        }\n      }\n\n      const storage = this.annotationStorage;\n      const allIds = [];\n      for (const field of allFields) {\n        const { id } = field;\n        allIds.push(id);\n        switch (field.type) {\n          case \"text\": {\n            const value = field.defaultValue || \"\";\n            storage.setValue(id, { value });\n            break;\n          }\n          case \"checkbox\":\n          case \"radiobutton\": {\n            const value = field.defaultValue === field.exportValues;\n            storage.setValue(id, { value });\n            break;\n          }\n          case \"combobox\":\n          case \"listbox\": {\n            const value = field.defaultValue || \"\";\n            storage.setValue(id, { value });\n            break;\n          }\n          default:\n            continue;\n        }\n\n        const domElement = document.querySelector(`[data-element-id=\"${id}\"]`);\n        if (!domElement) {\n          continue;\n        } else if (!GetElementsByNameSet.has(domElement)) {\n          warn(`_bindResetFormAction - element not allowed: ${id}`);\n          continue;\n        }\n        domElement.dispatchEvent(new Event(\"resetform\"));\n      }\n\n      if (this.enableScripting) {\n        // Update the values in the sandbox.\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: \"app\",\n            ids: allIds,\n            name: \"ResetForm\",\n          },\n        });\n      }\n\n      return false;\n    };\n  }\n}\n\nclass TextAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true });\n  }\n\n  render() {\n    this.container.classList.add(\"textAnnotation\");\n\n    const image = document.createElement(\"img\");\n    image.src =\n      this.imageResourcesPath +\n      \"annotation-\" +\n      this.data.name.toLowerCase() +\n      \".svg\";\n    image.setAttribute(\"data-l10n-id\", \"pdfjs-text-annotation-type\");\n    image.setAttribute(\n      \"data-l10n-args\",\n      JSON.stringify({ type: this.data.name })\n    );\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.append(image);\n    return this.container;\n  }\n}\n\nclass WidgetAnnotationElement extends AnnotationElement {\n  render() {\n    // Show only the container for unsupported field types.\n    return this.container;\n  }\n\n  showElementAndHideCanvas(element) {\n    if (this.data.hasOwnCanvas) {\n      if (element.previousSibling?.nodeName === \"CANVAS\") {\n        element.previousSibling.hidden = true;\n      }\n      element.hidden = false;\n    }\n  }\n\n  _getKeyModifier(event) {\n    return FeatureTest.platform.isMac ? event.metaKey : event.ctrlKey;\n  }\n\n  _setEventListener(element, elementData, baseName, eventName, valueGetter) {\n    if (baseName.includes(\"mouse\")) {\n      // Mouse events\n      element.addEventListener(baseName, event => {\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: this.data.id,\n            name: eventName,\n            value: valueGetter(event),\n            shift: event.shiftKey,\n            modifier: this._getKeyModifier(event),\n          },\n        });\n      });\n    } else {\n      // Non-mouse events\n      element.addEventListener(baseName, event => {\n        if (baseName === \"blur\") {\n          if (!elementData.focused || !event.relatedTarget) {\n            return;\n          }\n          elementData.focused = false;\n        } else if (baseName === \"focus\") {\n          if (elementData.focused) {\n            return;\n          }\n          elementData.focused = true;\n        }\n\n        if (!valueGetter) {\n          return;\n        }\n\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: this.data.id,\n            name: eventName,\n            value: valueGetter(event),\n          },\n        });\n      });\n    }\n  }\n\n  _setEventListeners(element, elementData, names, getter) {\n    for (const [baseName, eventName] of names) {\n      if (eventName === \"Action\" || this.data.actions?.[eventName]) {\n        if (eventName === \"Focus\" || eventName === \"Blur\") {\n          elementData ||= { focused: false };\n        }\n        this._setEventListener(\n          element,\n          elementData,\n          baseName,\n          eventName,\n          getter\n        );\n        if (eventName === \"Focus\" && !this.data.actions?.Blur) {\n          // Ensure that elementData will have the correct value.\n          this._setEventListener(element, elementData, \"blur\", \"Blur\", null);\n        } else if (eventName === \"Blur\" && !this.data.actions?.Focus) {\n          this._setEventListener(element, elementData, \"focus\", \"Focus\", null);\n        }\n      }\n    }\n  }\n\n  _setBackgroundColor(element) {\n    const color = this.data.backgroundColor || null;\n    element.style.backgroundColor =\n      color === null\n        ? \"transparent\"\n        : Util.makeHexColor(color[0], color[1], color[2]);\n  }\n\n  /**\n   * Apply text styles to the text in the element.\n   *\n   * @private\n   * @param {HTMLDivElement} element\n   * @memberof TextWidgetAnnotationElement\n   */\n  _setTextStyle(element) {\n    const TEXT_ALIGNMENT = [\"left\", \"center\", \"right\"];\n    const { fontColor } = this.data.defaultAppearanceData;\n    const fontSize =\n      this.data.defaultAppearanceData.fontSize || DEFAULT_FONT_SIZE;\n\n    const style = element.style;\n\n    // TODO: If the font-size is zero, calculate it based on the height and\n    //       width of the element.\n    // Not setting `style.fontSize` will use the default font-size for now.\n\n    // We don't use the font, as specified in the PDF document, for the <input>\n    // element. Hence using the original `fontSize` could look bad, which is why\n    // it's instead based on the field height.\n    // If the height is \"big\" then it could lead to a too big font size\n    // so in this case use the one we've in the pdf (hence the min).\n    let computedFontSize;\n    const BORDER_SIZE = 2;\n    const roundToOneDecimal = x => Math.round(10 * x) / 10;\n    if (this.data.multiLine) {\n      const height = Math.abs(\n        this.data.rect[3] - this.data.rect[1] - BORDER_SIZE\n      );\n      const numberOfLines = Math.round(height / (LINE_FACTOR * fontSize)) || 1;\n      const lineHeight = height / numberOfLines;\n      computedFontSize = Math.min(\n        fontSize,\n        roundToOneDecimal(lineHeight / LINE_FACTOR)\n      );\n    } else {\n      const height = Math.abs(\n        this.data.rect[3] - this.data.rect[1] - BORDER_SIZE\n      );\n      computedFontSize = Math.min(\n        fontSize,\n        roundToOneDecimal(height / LINE_FACTOR)\n      );\n    }\n    style.fontSize = `calc(${computedFontSize}px * var(--scale-factor))`;\n\n    style.color = Util.makeHexColor(fontColor[0], fontColor[1], fontColor[2]);\n\n    if (this.data.textAlignment !== null) {\n      style.textAlign = TEXT_ALIGNMENT[this.data.textAlignment];\n    }\n  }\n\n  _setRequired(element, isRequired) {\n    if (isRequired) {\n      element.setAttribute(\"required\", true);\n    } else {\n      element.removeAttribute(\"required\");\n    }\n    element.setAttribute(\"aria-required\", isRequired);\n  }\n}\n\nclass TextWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    const isRenderable =\n      parameters.renderForms ||\n      parameters.data.hasOwnCanvas ||\n      (!parameters.data.hasAppearance && !!parameters.data.fieldValue);\n    super(parameters, { isRenderable });\n  }\n\n  setPropertyOnSiblings(base, key, value, keyInStorage) {\n    const storage = this.annotationStorage;\n    for (const element of this._getElementsByName(\n      base.name,\n      /* skipId = */ base.id\n    )) {\n      if (element.domElement) {\n        element.domElement[key] = value;\n      }\n      storage.setValue(element.id, { [keyInStorage]: value });\n    }\n  }\n\n  render() {\n    const storage = this.annotationStorage;\n    const id = this.data.id;\n\n    this.container.classList.add(\"textWidgetAnnotation\");\n\n    let element = null;\n    if (this.renderForms) {\n      // NOTE: We cannot set the values using `element.value` below, since it\n      //       prevents the AnnotationLayer rasterizer in `test/driver.js`\n      //       from parsing the elements correctly for the reference tests.\n      const storedData = storage.getValue(id, {\n        value: this.data.fieldValue,\n      });\n      let textContent = storedData.value || \"\";\n      const maxLen = storage.getValue(id, {\n        charLimit: this.data.maxLen,\n      }).charLimit;\n      if (maxLen && textContent.length > maxLen) {\n        textContent = textContent.slice(0, maxLen);\n      }\n\n      let fieldFormattedValues =\n        storedData.formattedValue || this.data.textContent?.join(\"\\n\") || null;\n      if (fieldFormattedValues && this.data.comb) {\n        fieldFormattedValues = fieldFormattedValues.replaceAll(/\\s+/g, \"\");\n      }\n\n      const elementData = {\n        userValue: textContent,\n        formattedValue: fieldFormattedValues,\n        lastCommittedValue: null,\n        commitKey: 1,\n        focused: false,\n      };\n\n      if (this.data.multiLine) {\n        element = document.createElement(\"textarea\");\n        element.textContent = fieldFormattedValues ?? textContent;\n        if (this.data.doNotScroll) {\n          element.style.overflowY = \"hidden\";\n        }\n      } else {\n        element = document.createElement(\"input\");\n        element.type = \"text\";\n        element.setAttribute(\"value\", fieldFormattedValues ?? textContent);\n        if (this.data.doNotScroll) {\n          element.style.overflowX = \"hidden\";\n        }\n      }\n      if (this.data.hasOwnCanvas) {\n        element.hidden = true;\n      }\n      GetElementsByNameSet.add(element);\n      element.setAttribute(\"data-element-id\", id);\n\n      element.disabled = this.data.readOnly;\n      element.name = this.data.fieldName;\n      element.tabIndex = DEFAULT_TAB_INDEX;\n\n      this._setRequired(element, this.data.required);\n\n      if (maxLen) {\n        element.maxLength = maxLen;\n      }\n\n      element.addEventListener(\"input\", event => {\n        storage.setValue(id, { value: event.target.value });\n        this.setPropertyOnSiblings(\n          element,\n          \"value\",\n          event.target.value,\n          \"value\"\n        );\n        elementData.formattedValue = null;\n      });\n\n      element.addEventListener(\"resetform\", event => {\n        const defaultValue = this.data.defaultFieldValue ?? \"\";\n        element.value = elementData.userValue = defaultValue;\n        elementData.formattedValue = null;\n      });\n\n      let blurListener = event => {\n        const { formattedValue } = elementData;\n        if (formattedValue !== null && formattedValue !== undefined) {\n          event.target.value = formattedValue;\n        }\n        // Reset the cursor position to the start of the field (issue 12359).\n        event.target.scrollLeft = 0;\n      };\n\n      if (this.enableScripting && this.hasJSActions) {\n        element.addEventListener(\"focus\", event => {\n          if (elementData.focused) {\n            return;\n          }\n          const { target } = event;\n          if (elementData.userValue) {\n            target.value = elementData.userValue;\n          }\n          elementData.lastCommittedValue = target.value;\n          elementData.commitKey = 1;\n          if (!this.data.actions?.Focus) {\n            elementData.focused = true;\n          }\n        });\n\n        element.addEventListener(\"updatefromsandbox\", jsEvent => {\n          this.showElementAndHideCanvas(jsEvent.target);\n          const actions = {\n            value(event) {\n              elementData.userValue = event.detail.value ?? \"\";\n              storage.setValue(id, { value: elementData.userValue.toString() });\n              event.target.value = elementData.userValue;\n            },\n            formattedValue(event) {\n              const { formattedValue } = event.detail;\n              elementData.formattedValue = formattedValue;\n              if (\n                formattedValue !== null &&\n                formattedValue !== undefined &&\n                event.target !== document.activeElement\n              ) {\n                // Input hasn't the focus so display formatted string\n                event.target.value = formattedValue;\n              }\n              storage.setValue(id, {\n                formattedValue,\n              });\n            },\n            selRange(event) {\n              event.target.setSelectionRange(...event.detail.selRange);\n            },\n            charLimit: event => {\n              const { charLimit } = event.detail;\n              const { target } = event;\n              if (charLimit === 0) {\n                target.removeAttribute(\"maxLength\");\n                return;\n              }\n\n              target.setAttribute(\"maxLength\", charLimit);\n              let value = elementData.userValue;\n              if (!value || value.length <= charLimit) {\n                return;\n              }\n              value = value.slice(0, charLimit);\n              target.value = elementData.userValue = value;\n              storage.setValue(id, { value });\n\n              this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n                source: this,\n                detail: {\n                  id,\n                  name: \"Keystroke\",\n                  value,\n                  willCommit: true,\n                  commitKey: 1,\n                  selStart: target.selectionStart,\n                  selEnd: target.selectionEnd,\n                },\n              });\n            },\n          };\n          this._dispatchEventFromSandbox(actions, jsEvent);\n        });\n\n        // Even if the field hasn't any actions\n        // leaving it can still trigger some actions with Calculate\n        element.addEventListener(\"keydown\", event => {\n          elementData.commitKey = 1;\n          // If the key is one of Escape, Enter then the data are committed.\n          // If we've a Tab then data will be committed on blur.\n          let commitKey = -1;\n          if (event.key === \"Escape\") {\n            commitKey = 0;\n          } else if (event.key === \"Enter\" && !this.data.multiLine) {\n            // When we've a multiline field, \"Enter\" key is a key as the other\n            // hence we don't commit the data (Acrobat behaves the same way)\n            // (see issue #15627).\n            commitKey = 2;\n          } else if (event.key === \"Tab\") {\n            elementData.commitKey = 3;\n          }\n          if (commitKey === -1) {\n            return;\n          }\n          const { value } = event.target;\n          if (elementData.lastCommittedValue === value) {\n            return;\n          }\n          elementData.lastCommittedValue = value;\n          // Save the entered value\n          elementData.userValue = value;\n          this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n            source: this,\n            detail: {\n              id,\n              name: \"Keystroke\",\n              value,\n              willCommit: true,\n              commitKey,\n              selStart: event.target.selectionStart,\n              selEnd: event.target.selectionEnd,\n            },\n          });\n        });\n        const _blurListener = blurListener;\n        blurListener = null;\n        element.addEventListener(\"blur\", event => {\n          if (!elementData.focused || !event.relatedTarget) {\n            return;\n          }\n          if (!this.data.actions?.Blur) {\n            elementData.focused = false;\n          }\n          const { value } = event.target;\n          elementData.userValue = value;\n          if (elementData.lastCommittedValue !== value) {\n            this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n              source: this,\n              detail: {\n                id,\n                name: \"Keystroke\",\n                value,\n                willCommit: true,\n                commitKey: elementData.commitKey,\n                selStart: event.target.selectionStart,\n                selEnd: event.target.selectionEnd,\n              },\n            });\n          }\n          _blurListener(event);\n        });\n\n        if (this.data.actions?.Keystroke) {\n          element.addEventListener(\"beforeinput\", event => {\n            elementData.lastCommittedValue = null;\n            const { data, target } = event;\n            const { value, selectionStart, selectionEnd } = target;\n\n            let selStart = selectionStart,\n              selEnd = selectionEnd;\n\n            switch (event.inputType) {\n              // https://rawgit.com/w3c/input-events/v1/index.html#interface-InputEvent-Attributes\n              case \"deleteWordBackward\": {\n                const match = value\n                  .substring(0, selectionStart)\n                  .match(/\\w*[^\\w]*$/);\n                if (match) {\n                  selStart -= match[0].length;\n                }\n                break;\n              }\n              case \"deleteWordForward\": {\n                const match = value\n                  .substring(selectionStart)\n                  .match(/^[^\\w]*\\w*/);\n                if (match) {\n                  selEnd += match[0].length;\n                }\n                break;\n              }\n              case \"deleteContentBackward\":\n                if (selectionStart === selectionEnd) {\n                  selStart -= 1;\n                }\n                break;\n              case \"deleteContentForward\":\n                if (selectionStart === selectionEnd) {\n                  selEnd += 1;\n                }\n                break;\n            }\n\n            // We handle the event ourselves.\n            event.preventDefault();\n            this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n              source: this,\n              detail: {\n                id,\n                name: \"Keystroke\",\n                value,\n                change: data || \"\",\n                willCommit: false,\n                selStart,\n                selEnd,\n              },\n            });\n          });\n        }\n\n        this._setEventListeners(\n          element,\n          elementData,\n          [\n            [\"focus\", \"Focus\"],\n            [\"blur\", \"Blur\"],\n            [\"mousedown\", \"Mouse Down\"],\n            [\"mouseenter\", \"Mouse Enter\"],\n            [\"mouseleave\", \"Mouse Exit\"],\n            [\"mouseup\", \"Mouse Up\"],\n          ],\n          event => event.target.value\n        );\n      }\n\n      if (blurListener) {\n        element.addEventListener(\"blur\", blurListener);\n      }\n\n      if (this.data.comb) {\n        const fieldWidth = this.data.rect[2] - this.data.rect[0];\n        const combWidth = fieldWidth / maxLen;\n\n        element.classList.add(\"comb\");\n        element.style.letterSpacing = `calc(${combWidth}px * var(--scale-factor) - 1ch)`;\n      }\n    } else {\n      element = document.createElement(\"div\");\n      element.textContent = this.data.fieldValue;\n      element.style.verticalAlign = \"middle\";\n      element.style.display = \"table-cell\";\n\n      if (this.data.hasOwnCanvas) {\n        element.hidden = true;\n      }\n    }\n\n    this._setTextStyle(element);\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass SignatureWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: !!parameters.data.hasOwnCanvas });\n  }\n}\n\nclass CheckboxWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    const storage = this.annotationStorage;\n    const data = this.data;\n    const id = data.id;\n    let value = storage.getValue(id, {\n      value: data.exportValue === data.fieldValue,\n    }).value;\n    if (typeof value === \"string\") {\n      // The value has been changed through js and set in annotationStorage.\n      value = value !== \"Off\";\n      storage.setValue(id, { value });\n    }\n\n    this.container.classList.add(\"buttonWidgetAnnotation\", \"checkBox\");\n\n    const element = document.createElement(\"input\");\n    GetElementsByNameSet.add(element);\n    element.setAttribute(\"data-element-id\", id);\n\n    element.disabled = data.readOnly;\n    this._setRequired(element, this.data.required);\n    element.type = \"checkbox\";\n    element.name = data.fieldName;\n    if (value) {\n      element.setAttribute(\"checked\", true);\n    }\n    element.setAttribute(\"exportValue\", data.exportValue);\n    element.tabIndex = DEFAULT_TAB_INDEX;\n\n    element.addEventListener(\"change\", event => {\n      const { name, checked } = event.target;\n      for (const checkbox of this._getElementsByName(name, /* skipId = */ id)) {\n        const curChecked = checked && checkbox.exportValue === data.exportValue;\n        if (checkbox.domElement) {\n          checkbox.domElement.checked = curChecked;\n        }\n        storage.setValue(checkbox.id, { value: curChecked });\n      }\n      storage.setValue(id, { value: checked });\n    });\n\n    element.addEventListener(\"resetform\", event => {\n      const defaultValue = data.defaultFieldValue || \"Off\";\n      event.target.checked = defaultValue === data.exportValue;\n    });\n\n    if (this.enableScripting && this.hasJSActions) {\n      element.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value(event) {\n            event.target.checked = event.detail.value !== \"Off\";\n            storage.setValue(id, { value: event.target.checked });\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      this._setEventListeners(\n        element,\n        null,\n        [\n          [\"change\", \"Validate\"],\n          [\"change\", \"Action\"],\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n        ],\n        event => event.target.checked\n      );\n    }\n\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass RadioButtonWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    this.container.classList.add(\"buttonWidgetAnnotation\", \"radioButton\");\n    const storage = this.annotationStorage;\n    const data = this.data;\n    const id = data.id;\n    let value = storage.getValue(id, {\n      value: data.fieldValue === data.buttonValue,\n    }).value;\n    if (typeof value === \"string\") {\n      // The value has been changed through js and set in annotationStorage.\n      value = value !== data.buttonValue;\n      storage.setValue(id, { value });\n    }\n\n    if (value) {\n      // It's possible that multiple radio buttons are checked.\n      // So if this one is checked we just reset the other ones.\n      // (see bug 1864136). Then when the other ones will be rendered they will\n      // unchecked (because of their value in the storage).\n      // Consequently, the first checked radio button will be the only checked\n      // one.\n      for (const radio of this._getElementsByName(\n        data.fieldName,\n        /* skipId = */ id\n      )) {\n        storage.setValue(radio.id, { value: false });\n      }\n    }\n\n    const element = document.createElement(\"input\");\n    GetElementsByNameSet.add(element);\n    element.setAttribute(\"data-element-id\", id);\n\n    element.disabled = data.readOnly;\n    this._setRequired(element, this.data.required);\n    element.type = \"radio\";\n    element.name = data.fieldName;\n    if (value) {\n      element.setAttribute(\"checked\", true);\n    }\n    element.tabIndex = DEFAULT_TAB_INDEX;\n\n    element.addEventListener(\"change\", event => {\n      const { name, checked } = event.target;\n      for (const radio of this._getElementsByName(name, /* skipId = */ id)) {\n        storage.setValue(radio.id, { value: false });\n      }\n      storage.setValue(id, { value: checked });\n    });\n\n    element.addEventListener(\"resetform\", event => {\n      const defaultValue = data.defaultFieldValue;\n      event.target.checked =\n        defaultValue !== null &&\n        defaultValue !== undefined &&\n        defaultValue === data.buttonValue;\n    });\n\n    if (this.enableScripting && this.hasJSActions) {\n      const pdfButtonValue = data.buttonValue;\n      element.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value: event => {\n            const checked = pdfButtonValue === event.detail.value;\n            for (const radio of this._getElementsByName(event.target.name)) {\n              const curChecked = checked && radio.id === id;\n              if (radio.domElement) {\n                radio.domElement.checked = curChecked;\n              }\n              storage.setValue(radio.id, { value: curChecked });\n            }\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      this._setEventListeners(\n        element,\n        null,\n        [\n          [\"change\", \"Validate\"],\n          [\"change\", \"Action\"],\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n        ],\n        event => event.target.checked\n      );\n    }\n\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass PushButtonWidgetAnnotationElement extends LinkAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { ignoreBorder: parameters.data.hasAppearance });\n  }\n\n  render() {\n    // The rendering and functionality of a push button widget annotation is\n    // equal to that of a link annotation, but may have more functionality, such\n    // as performing actions on form fields (resetting, submitting, et cetera).\n    const container = super.render();\n    container.classList.add(\"buttonWidgetAnnotation\", \"pushButton\");\n\n    const linkElement = container.lastChild;\n    if (this.enableScripting && this.hasJSActions && linkElement) {\n      this._setDefaultPropertiesFromJS(linkElement);\n\n      linkElement.addEventListener(\"updatefromsandbox\", jsEvent => {\n        this._dispatchEventFromSandbox({}, jsEvent);\n      });\n    }\n\n    return container;\n  }\n}\n\nclass ChoiceWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    this.container.classList.add(\"choiceWidgetAnnotation\");\n    const storage = this.annotationStorage;\n    const id = this.data.id;\n\n    const storedData = storage.getValue(id, {\n      value: this.data.fieldValue,\n    });\n\n    const selectElement = document.createElement(\"select\");\n    GetElementsByNameSet.add(selectElement);\n    selectElement.setAttribute(\"data-element-id\", id);\n\n    selectElement.disabled = this.data.readOnly;\n    this._setRequired(selectElement, this.data.required);\n    selectElement.name = this.data.fieldName;\n    selectElement.tabIndex = DEFAULT_TAB_INDEX;\n\n    let addAnEmptyEntry = this.data.combo && this.data.options.length > 0;\n\n    if (!this.data.combo) {\n      // List boxes have a size and (optionally) multiple selection.\n      selectElement.size = this.data.options.length;\n      if (this.data.multiSelect) {\n        selectElement.multiple = true;\n      }\n    }\n\n    selectElement.addEventListener(\"resetform\", event => {\n      const defaultValue = this.data.defaultFieldValue;\n      for (const option of selectElement.options) {\n        option.selected = option.value === defaultValue;\n      }\n    });\n\n    // Insert the options into the choice field.\n    for (const option of this.data.options) {\n      const optionElement = document.createElement(\"option\");\n      optionElement.textContent = option.displayValue;\n      optionElement.value = option.exportValue;\n      if (storedData.value.includes(option.exportValue)) {\n        optionElement.setAttribute(\"selected\", true);\n        addAnEmptyEntry = false;\n      }\n      selectElement.append(optionElement);\n    }\n\n    let removeEmptyEntry = null;\n    if (addAnEmptyEntry) {\n      const noneOptionElement = document.createElement(\"option\");\n      noneOptionElement.value = \" \";\n      noneOptionElement.setAttribute(\"hidden\", true);\n      noneOptionElement.setAttribute(\"selected\", true);\n      selectElement.prepend(noneOptionElement);\n\n      removeEmptyEntry = () => {\n        noneOptionElement.remove();\n        selectElement.removeEventListener(\"input\", removeEmptyEntry);\n        removeEmptyEntry = null;\n      };\n      selectElement.addEventListener(\"input\", removeEmptyEntry);\n    }\n\n    const getValue = isExport => {\n      const name = isExport ? \"value\" : \"textContent\";\n      const { options, multiple } = selectElement;\n      if (!multiple) {\n        return options.selectedIndex === -1\n          ? null\n          : options[options.selectedIndex][name];\n      }\n      return Array.prototype.filter\n        .call(options, option => option.selected)\n        .map(option => option[name]);\n    };\n\n    let selectedValues = getValue(/* isExport */ false);\n\n    const getItems = event => {\n      const options = event.target.options;\n      return Array.prototype.map.call(options, option => ({\n        displayValue: option.textContent,\n        exportValue: option.value,\n      }));\n    };\n\n    if (this.enableScripting && this.hasJSActions) {\n      selectElement.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value(event) {\n            removeEmptyEntry?.();\n            const value = event.detail.value;\n            const values = new Set(Array.isArray(value) ? value : [value]);\n            for (const option of selectElement.options) {\n              option.selected = values.has(option.value);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          multipleSelection(event) {\n            selectElement.multiple = true;\n          },\n          remove(event) {\n            const options = selectElement.options;\n            const index = event.detail.remove;\n            options[index].selected = false;\n            selectElement.remove(index);\n            if (options.length > 0) {\n              const i = Array.prototype.findIndex.call(\n                options,\n                option => option.selected\n              );\n              if (i === -1) {\n                options[0].selected = true;\n              }\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          clear(event) {\n            while (selectElement.length !== 0) {\n              selectElement.remove(0);\n            }\n            storage.setValue(id, { value: null, items: [] });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          insert(event) {\n            const { index, displayValue, exportValue } = event.detail.insert;\n            const selectChild = selectElement.children[index];\n            const optionElement = document.createElement(\"option\");\n            optionElement.textContent = displayValue;\n            optionElement.value = exportValue;\n\n            if (selectChild) {\n              selectChild.before(optionElement);\n            } else {\n              selectElement.append(optionElement);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          items(event) {\n            const { items } = event.detail;\n            while (selectElement.length !== 0) {\n              selectElement.remove(0);\n            }\n            for (const item of items) {\n              const { displayValue, exportValue } = item;\n              const optionElement = document.createElement(\"option\");\n              optionElement.textContent = displayValue;\n              optionElement.value = exportValue;\n              selectElement.append(optionElement);\n            }\n            if (selectElement.options.length > 0) {\n              selectElement.options[0].selected = true;\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          indices(event) {\n            const indices = new Set(event.detail.indices);\n            for (const option of event.target.options) {\n              option.selected = indices.has(option.index);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          editable(event) {\n            event.target.disabled = !event.detail.editable;\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      selectElement.addEventListener(\"input\", event => {\n        const exportValue = getValue(/* isExport */ true);\n        const change = getValue(/* isExport */ false);\n        storage.setValue(id, { value: exportValue });\n\n        event.preventDefault();\n\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id,\n            name: \"Keystroke\",\n            value: selectedValues,\n            change,\n            changeEx: exportValue,\n            willCommit: false,\n            commitKey: 1,\n            keyDown: false,\n          },\n        });\n      });\n\n      this._setEventListeners(\n        selectElement,\n        null,\n        [\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n          [\"input\", \"Action\"],\n          [\"input\", \"Validate\"],\n        ],\n        event => event.target.value\n      );\n    } else {\n      selectElement.addEventListener(\"input\", function (event) {\n        storage.setValue(id, { value: getValue(/* isExport */ true) });\n      });\n    }\n\n    if (this.data.combo) {\n      this._setTextStyle(selectElement);\n    } else {\n      // Just use the default font size...\n      // it's a bit hard to guess what is a good size.\n    }\n    this._setBackgroundColor(selectElement);\n    this._setDefaultPropertiesFromJS(selectElement);\n\n    this.container.append(selectElement);\n    return this.container;\n  }\n}\n\nclass PopupAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    const { data, elements } = parameters;\n    super(parameters, { isRenderable: AnnotationElement._hasPopupData(data) });\n    this.elements = elements;\n    this.popup = null;\n  }\n\n  render() {\n    this.container.classList.add(\"popupAnnotation\");\n\n    const popup = (this.popup = new PopupElement({\n      container: this.container,\n      color: this.data.color,\n      titleObj: this.data.titleObj,\n      modificationDate: this.data.modificationDate,\n      contentsObj: this.data.contentsObj,\n      richText: this.data.richText,\n      rect: this.data.rect,\n      parentRect: this.data.parentRect || null,\n      parent: this.parent,\n      elements: this.elements,\n      open: this.data.open,\n    }));\n\n    const elementIds = [];\n    for (const element of this.elements) {\n      element.popup = popup;\n      elementIds.push(element.data.id);\n      element.addHighlightArea();\n    }\n\n    this.container.setAttribute(\n      \"aria-controls\",\n      elementIds.map(id => `${AnnotationPrefix}${id}`).join(\",\")\n    );\n\n    return this.container;\n  }\n}\n\nclass PopupElement {\n  #boundKeyDown = this.#keyDown.bind(this);\n\n  #boundHide = this.#hide.bind(this);\n\n  #boundShow = this.#show.bind(this);\n\n  #boundToggle = this.#toggle.bind(this);\n\n  #color = null;\n\n  #container = null;\n\n  #contentsObj = null;\n\n  #dateObj = null;\n\n  #elements = null;\n\n  #parent = null;\n\n  #parentRect = null;\n\n  #pinned = false;\n\n  #popup = null;\n\n  #position = null;\n\n  #rect = null;\n\n  #richText = null;\n\n  #titleObj = null;\n\n  #updates = null;\n\n  #wasVisible = false;\n\n  constructor({\n    container,\n    color,\n    elements,\n    titleObj,\n    modificationDate,\n    contentsObj,\n    richText,\n    parent,\n    rect,\n    parentRect,\n    open,\n  }) {\n    this.#container = container;\n    this.#titleObj = titleObj;\n    this.#contentsObj = contentsObj;\n    this.#richText = richText;\n    this.#parent = parent;\n    this.#color = color;\n    this.#rect = rect;\n    this.#parentRect = parentRect;\n    this.#elements = elements;\n\n    // The modification date is shown in the popup instead of the creation\n    // date if it is available and can be parsed correctly, which is\n    // consistent with other viewers such as Adobe Acrobat.\n    this.#dateObj = PDFDateString.toDateObject(modificationDate);\n\n    this.trigger = elements.flatMap(e => e.getElementsToTriggerPopup());\n    // Attach the event listeners to the trigger element.\n    for (const element of this.trigger) {\n      element.addEventListener(\"click\", this.#boundToggle);\n      element.addEventListener(\"mouseenter\", this.#boundShow);\n      element.addEventListener(\"mouseleave\", this.#boundHide);\n      element.classList.add(\"popupTriggerArea\");\n    }\n\n    // Attach the event listener to toggle the popup with the keyboard.\n    for (const element of elements) {\n      element.container?.addEventListener(\"keydown\", this.#boundKeyDown);\n    }\n\n    this.#container.hidden = true;\n    if (open) {\n      this.#toggle();\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      // Since the popup is lazily created, we need to ensure that it'll be\n      // created and displayed during reference tests.\n      this.#parent.popupShow.push(async () => {\n        if (this.#container.hidden) {\n          this.#show();\n        }\n      });\n    }\n  }\n\n  render() {\n    if (this.#popup) {\n      return;\n    }\n\n    const popup = (this.#popup = document.createElement(\"div\"));\n    popup.className = \"popup\";\n\n    if (this.#color) {\n      const baseColor = (popup.style.outlineColor = Util.makeHexColor(\n        ...this.#color\n      ));\n      if (\n        (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        CSS.supports(\"background-color\", \"color-mix(in srgb, red 30%, white)\")\n      ) {\n        popup.style.backgroundColor = `color-mix(in srgb, ${baseColor} 30%, white)`;\n      } else {\n        // color-mix isn't supported in some browsers hence this version.\n        // See https://developer.mozilla.org/en-US/docs/Web/CSS/color_value/color-mix#browser_compatibility\n        // TODO: Use color-mix when it's supported everywhere.\n        // Enlighten the color.\n        const BACKGROUND_ENLIGHT = 0.7;\n        popup.style.backgroundColor = Util.makeHexColor(\n          ...this.#color.map(c =>\n            Math.floor(BACKGROUND_ENLIGHT * (255 - c) + c)\n          )\n        );\n      }\n    }\n\n    const header = document.createElement(\"span\");\n    header.className = \"header\";\n    const title = document.createElement(\"h1\");\n    header.append(title);\n    ({ dir: title.dir, str: title.textContent } = this.#titleObj);\n    popup.append(header);\n\n    if (this.#dateObj) {\n      const modificationDate = document.createElement(\"span\");\n      modificationDate.classList.add(\"popupDate\");\n      modificationDate.setAttribute(\n        \"data-l10n-id\",\n        \"pdfjs-annotation-date-string\"\n      );\n      modificationDate.setAttribute(\n        \"data-l10n-args\",\n        JSON.stringify({\n          date: this.#dateObj.toLocaleDateString(),\n          time: this.#dateObj.toLocaleTimeString(),\n        })\n      );\n      header.append(modificationDate);\n    }\n\n    const html = this.#html;\n    if (html) {\n      XfaLayer.render({\n        xfaHtml: html,\n        intent: \"richText\",\n        div: popup,\n      });\n      popup.lastChild.classList.add(\"richText\", \"popupContent\");\n    } else {\n      const contents = this._formatContents(this.#contentsObj);\n      popup.append(contents);\n    }\n    this.#container.append(popup);\n  }\n\n  get #html() {\n    const richText = this.#richText;\n    const contentsObj = this.#contentsObj;\n    if (\n      richText?.str &&\n      (!contentsObj?.str || contentsObj.str === richText.str)\n    ) {\n      return this.#richText.html || null;\n    }\n    return null;\n  }\n\n  get #fontSize() {\n    return this.#html?.attributes?.style?.fontSize || 0;\n  }\n\n  get #fontColor() {\n    return this.#html?.attributes?.style?.color || null;\n  }\n\n  #makePopupContent(text) {\n    const popupLines = [];\n    const popupContent = {\n      str: text,\n      html: {\n        name: \"div\",\n        attributes: {\n          dir: \"auto\",\n        },\n        children: [\n          {\n            name: \"p\",\n            children: popupLines,\n          },\n        ],\n      },\n    };\n    const lineAttributes = {\n      style: {\n        color: this.#fontColor,\n        fontSize: this.#fontSize\n          ? `calc(${this.#fontSize}px * var(--scale-factor))`\n          : \"\",\n      },\n    };\n    for (const line of text.split(\"\\n\")) {\n      popupLines.push({\n        name: \"span\",\n        value: line,\n        attributes: lineAttributes,\n      });\n    }\n    return popupContent;\n  }\n\n  /**\n   * Format the contents of the popup by adding newlines where necessary.\n   *\n   * @private\n   * @param {Object<string, string>} contentsObj\n   * @memberof PopupElement\n   * @returns {HTMLParagraphElement}\n   */\n  _formatContents({ str, dir }) {\n    const p = document.createElement(\"p\");\n    p.classList.add(\"popupContent\");\n    p.dir = dir;\n    const lines = str.split(/(?:\\r\\n?|\\n)/);\n    for (let i = 0, ii = lines.length; i < ii; ++i) {\n      const line = lines[i];\n      p.append(document.createTextNode(line));\n      if (i < ii - 1) {\n        p.append(document.createElement(\"br\"));\n      }\n    }\n    return p;\n  }\n\n  #keyDown(event) {\n    if (event.altKey || event.shiftKey || event.ctrlKey || event.metaKey) {\n      return;\n    }\n\n    if (event.key === \"Enter\" || (event.key === \"Escape\" && this.#pinned)) {\n      this.#toggle();\n    }\n  }\n\n  updateEdited({ rect, popupContent }) {\n    this.#updates ||= {\n      contentsObj: this.#contentsObj,\n      richText: this.#richText,\n    };\n    if (rect) {\n      this.#position = null;\n    }\n    if (popupContent) {\n      this.#richText = this.#makePopupContent(popupContent);\n      this.#contentsObj = null;\n    }\n    this.#popup?.remove();\n    this.#popup = null;\n  }\n\n  resetEdited() {\n    if (!this.#updates) {\n      return;\n    }\n    ({ contentsObj: this.#contentsObj, richText: this.#richText } =\n      this.#updates);\n    this.#updates = null;\n    this.#popup?.remove();\n    this.#popup = null;\n    this.#position = null;\n  }\n\n  #setPosition() {\n    if (this.#position !== null) {\n      return;\n    }\n    const {\n      page: { view },\n      viewport: {\n        rawDims: { pageWidth, pageHeight, pageX, pageY },\n      },\n    } = this.#parent;\n\n    let useParentRect = !!this.#parentRect;\n    let rect = useParentRect ? this.#parentRect : this.#rect;\n    for (const element of this.#elements) {\n      if (!rect || Util.intersect(element.data.rect, rect) !== null) {\n        rect = element.data.rect;\n        useParentRect = true;\n        break;\n      }\n    }\n\n    const normalizedRect = Util.normalizeRect([\n      rect[0],\n      view[3] - rect[1] + view[1],\n      rect[2],\n      view[3] - rect[3] + view[1],\n    ]);\n\n    const HORIZONTAL_SPACE_AFTER_ANNOTATION = 5;\n    const parentWidth = useParentRect\n      ? rect[2] - rect[0] + HORIZONTAL_SPACE_AFTER_ANNOTATION\n      : 0;\n    const popupLeft = normalizedRect[0] + parentWidth;\n    const popupTop = normalizedRect[1];\n    this.#position = [\n      (100 * (popupLeft - pageX)) / pageWidth,\n      (100 * (popupTop - pageY)) / pageHeight,\n    ];\n\n    const { style } = this.#container;\n    style.left = `${this.#position[0]}%`;\n    style.top = `${this.#position[1]}%`;\n  }\n\n  /**\n   * Toggle the visibility of the popup.\n   */\n  #toggle() {\n    this.#pinned = !this.#pinned;\n    if (this.#pinned) {\n      this.#show();\n      this.#container.addEventListener(\"click\", this.#boundToggle);\n      this.#container.addEventListener(\"keydown\", this.#boundKeyDown);\n    } else {\n      this.#hide();\n      this.#container.removeEventListener(\"click\", this.#boundToggle);\n      this.#container.removeEventListener(\"keydown\", this.#boundKeyDown);\n    }\n  }\n\n  /**\n   * Show the popup.\n   */\n  #show() {\n    if (!this.#popup) {\n      this.render();\n    }\n    if (!this.isVisible) {\n      this.#setPosition();\n      this.#container.hidden = false;\n      this.#container.style.zIndex =\n        parseInt(this.#container.style.zIndex) + 1000;\n    } else if (this.#pinned) {\n      this.#container.classList.add(\"focused\");\n    }\n  }\n\n  /**\n   * Hide the popup.\n   */\n  #hide() {\n    this.#container.classList.remove(\"focused\");\n    if (this.#pinned || !this.isVisible) {\n      return;\n    }\n    this.#container.hidden = true;\n    this.#container.style.zIndex =\n      parseInt(this.#container.style.zIndex) - 1000;\n  }\n\n  forceHide() {\n    this.#wasVisible = this.isVisible;\n    if (!this.#wasVisible) {\n      return;\n    }\n    this.#container.hidden = true;\n  }\n\n  maybeShow() {\n    if (!this.#wasVisible) {\n      return;\n    }\n    if (!this.#popup) {\n      this.#show();\n    }\n    this.#wasVisible = false;\n    this.#container.hidden = false;\n  }\n\n  get isVisible() {\n    return this.#container.hidden === false;\n  }\n}\n\nclass FreeTextAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n    this.textContent = parameters.data.textContent;\n    this.textPosition = parameters.data.textPosition;\n    this.annotationEditorType = AnnotationEditorType.FREETEXT;\n  }\n\n  render() {\n    this.container.classList.add(\"freeTextAnnotation\");\n\n    if (this.textContent) {\n      const content = document.createElement(\"div\");\n      content.classList.add(\"annotationTextContent\");\n      content.setAttribute(\"role\", \"comment\");\n      for (const line of this.textContent) {\n        const lineSpan = document.createElement(\"span\");\n        lineSpan.textContent = line;\n        content.append(lineSpan);\n      }\n      this.container.append(content);\n    }\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this._editOnDoubleClick();\n\n    return this.container;\n  }\n}\n\nclass LineAnnotationElement extends AnnotationElement {\n  #line = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"lineAnnotation\");\n\n    // Create an invisible line with the same starting and ending coordinates\n    // that acts as the trigger for the popup. Only the line itself should\n    // trigger the popup, not the entire container.\n    const data = this.data;\n    const { width, height } = getRectDims(data.rect);\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // PDF coordinates are calculated from a bottom left origin, so transform\n    // the line coordinates to a top left origin for the SVG element.\n    const line = (this.#line = this.svgFactory.createElement(\"svg:line\"));\n    line.setAttribute(\"x1\", data.rect[2] - data.lineCoordinates[0]);\n    line.setAttribute(\"y1\", data.rect[3] - data.lineCoordinates[1]);\n    line.setAttribute(\"x2\", data.rect[2] - data.lineCoordinates[2]);\n    line.setAttribute(\"y2\", data.rect[3] - data.lineCoordinates[3]);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    line.setAttribute(\"stroke-width\", data.borderStyle.width || 1);\n    line.setAttribute(\"stroke\", \"transparent\");\n    line.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(line);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the line instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#line;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass SquareAnnotationElement extends AnnotationElement {\n  #square = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"squareAnnotation\");\n\n    // Create an invisible square with the same rectangle that acts as the\n    // trigger for the popup. Only the square itself should trigger the\n    // popup, not the entire container.\n    const data = this.data;\n    const { width, height } = getRectDims(data.rect);\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // The browser draws half of the borders inside the square and half of\n    // the borders outside the square by default. This behavior cannot be\n    // changed programmatically, so correct for that here.\n    const borderWidth = data.borderStyle.width;\n    const square = (this.#square = this.svgFactory.createElement(\"svg:rect\"));\n    square.setAttribute(\"x\", borderWidth / 2);\n    square.setAttribute(\"y\", borderWidth / 2);\n    square.setAttribute(\"width\", width - borderWidth);\n    square.setAttribute(\"height\", height - borderWidth);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    square.setAttribute(\"stroke-width\", borderWidth || 1);\n    square.setAttribute(\"stroke\", \"transparent\");\n    square.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(square);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the square instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#square;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass CircleAnnotationElement extends AnnotationElement {\n  #circle = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"circleAnnotation\");\n\n    // Create an invisible circle with the same ellipse that acts as the\n    // trigger for the popup. Only the circle itself should trigger the\n    // popup, not the entire container.\n    const data = this.data;\n    const { width, height } = getRectDims(data.rect);\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // The browser draws half of the borders inside the circle and half of\n    // the borders outside the circle by default. This behavior cannot be\n    // changed programmatically, so correct for that here.\n    const borderWidth = data.borderStyle.width;\n    const circle = (this.#circle =\n      this.svgFactory.createElement(\"svg:ellipse\"));\n    circle.setAttribute(\"cx\", width / 2);\n    circle.setAttribute(\"cy\", height / 2);\n    circle.setAttribute(\"rx\", width / 2 - borderWidth / 2);\n    circle.setAttribute(\"ry\", height / 2 - borderWidth / 2);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    circle.setAttribute(\"stroke-width\", borderWidth || 1);\n    circle.setAttribute(\"stroke\", \"transparent\");\n    circle.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(circle);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the circle instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#circle;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass PolylineAnnotationElement extends AnnotationElement {\n  #polyline = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n\n    this.containerClassName = \"polylineAnnotation\";\n    this.svgElementName = \"svg:polyline\";\n  }\n\n  render() {\n    this.container.classList.add(this.containerClassName);\n\n    // Create an invisible polyline with the same points that acts as the\n    // trigger for the popup. Only the polyline itself should trigger the\n    // popup, not the entire container.\n    const {\n      data: { rect, vertices, borderStyle, popupRef },\n    } = this;\n    if (!vertices) {\n      return this.container;\n    }\n    const { width, height } = getRectDims(rect);\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // Convert the vertices array to a single points string that the SVG\n    // polyline element expects (\"x1,y1 x2,y2 ...\"). PDF coordinates are\n    // calculated from a bottom left origin, so transform the polyline\n    // coordinates to a top left origin for the SVG element.\n    let points = [];\n    for (let i = 0, ii = vertices.length; i < ii; i += 2) {\n      const x = vertices[i] - rect[0];\n      const y = rect[3] - vertices[i + 1];\n      points.push(`${x},${y}`);\n    }\n    points = points.join(\" \");\n\n    const polyline = (this.#polyline = this.svgFactory.createElement(\n      this.svgElementName\n    ));\n    polyline.setAttribute(\"points\", points);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    polyline.setAttribute(\"stroke-width\", borderStyle.width || 1);\n    polyline.setAttribute(\"stroke\", \"transparent\");\n    polyline.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(polyline);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the polyline\n    // instead of to the entire container (which is the default).\n    if (!popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#polyline;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass PolygonAnnotationElement extends PolylineAnnotationElement {\n  constructor(parameters) {\n    // Polygons are specific forms of polylines, so reuse their logic.\n    super(parameters);\n\n    this.containerClassName = \"polygonAnnotation\";\n    this.svgElementName = \"svg:polygon\";\n  }\n}\n\nclass CaretAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"caretAnnotation\");\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n    return this.container;\n  }\n}\n\nclass InkAnnotationElement extends AnnotationElement {\n  #polylines = [];\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n\n    this.containerClassName = \"inkAnnotation\";\n\n    // Use the polyline SVG element since it allows us to use coordinates\n    // directly and to draw both straight lines and curves.\n    this.svgElementName = \"svg:polyline\";\n    this.annotationEditorType = AnnotationEditorType.INK;\n  }\n\n  render() {\n    this.container.classList.add(this.containerClassName);\n\n    // Create an invisible polyline with the same points that acts as the\n    // trigger for the popup.\n    const {\n      data: { rect, inkLists, borderStyle, popupRef },\n    } = this;\n    const { width, height } = getRectDims(rect);\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    for (const inkList of inkLists) {\n      // Convert the ink list to a single points string that the SVG\n      // polyline element expects (\"x1,y1 x2,y2 ...\"). PDF coordinates are\n      // calculated from a bottom left origin, so transform the polyline\n      // coordinates to a top left origin for the SVG element.\n      let points = [];\n      for (let i = 0, ii = inkList.length; i < ii; i += 2) {\n        const x = inkList[i] - rect[0];\n        const y = rect[3] - inkList[i + 1];\n        points.push(`${x},${y}`);\n      }\n      points = points.join(\" \");\n\n      const polyline = this.svgFactory.createElement(this.svgElementName);\n      this.#polylines.push(polyline);\n      polyline.setAttribute(\"points\", points);\n      // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n      // won't be possible to open/close the popup (note e.g. issue 11122).\n      polyline.setAttribute(\"stroke-width\", borderStyle.width || 1);\n      polyline.setAttribute(\"stroke\", \"transparent\");\n      polyline.setAttribute(\"fill\", \"transparent\");\n\n      // Create the popup ourselves so that we can bind it to the polyline\n      // instead of to the entire container (which is the default).\n      if (!popupRef && this.hasPopupData) {\n        this._createPopup();\n      }\n\n      svg.append(polyline);\n    }\n\n    this.container.append(svg);\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#polylines;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass HighlightAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"highlightAnnotation\");\n    return this.container;\n  }\n}\n\nclass UnderlineAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"underlineAnnotation\");\n    return this.container;\n  }\n}\n\nclass SquigglyAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"squigglyAnnotation\");\n    return this.container;\n  }\n}\n\nclass StrikeOutAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"strikeoutAnnotation\");\n    return this.container;\n  }\n}\n\nclass StampAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"stampAnnotation\");\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n    return this.container;\n  }\n}\n\nclass FileAttachmentAnnotationElement extends AnnotationElement {\n  #trigger = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true });\n\n    const { file } = this.data;\n    this.filename = file.filename;\n    this.content = file.content;\n\n    this.linkService.eventBus?.dispatch(\"fileattachmentannotation\", {\n      source: this,\n      ...file,\n    });\n  }\n\n  render() {\n    this.container.classList.add(\"fileAttachmentAnnotation\");\n\n    const { container, data } = this;\n    let trigger;\n    if (data.hasAppearance || data.fillAlpha === 0) {\n      trigger = document.createElement(\"div\");\n    } else {\n      // Unfortunately it seems that it's not clearly specified exactly what\n      // names are actually valid, since Table 184 contains:\n      //   Conforming readers shall provide predefined icon appearances for at\n      //   least the following standard names: GraphPushPin, PaperclipTag.\n      //   Additional names may be supported as well. Default value: PushPin.\n      trigger = document.createElement(\"img\");\n      trigger.src = `${this.imageResourcesPath}annotation-${\n        /paperclip/i.test(data.name) ? \"paperclip\" : \"pushpin\"\n      }.svg`;\n\n      if (data.fillAlpha && data.fillAlpha < 1) {\n        trigger.style = `filter: opacity(${Math.round(\n          data.fillAlpha * 100\n        )}%);`;\n\n        if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n          this.container.classList.add(\"hasFillAlpha\");\n        }\n      }\n    }\n    trigger.addEventListener(\"dblclick\", this.#download.bind(this));\n    this.#trigger = trigger;\n\n    const { isMac } = FeatureTest.platform;\n    container.addEventListener(\"keydown\", evt => {\n      if (evt.key === \"Enter\" && (isMac ? evt.metaKey : evt.ctrlKey)) {\n        this.#download();\n      }\n    });\n\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    } else {\n      trigger.classList.add(\"popupTriggerArea\");\n    }\n\n    container.append(trigger);\n    return container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#trigger;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n\n  /**\n   * Download the file attachment associated with this annotation.\n   */\n  #download() {\n    this.downloadManager?.openOrDownloadData(this.content, this.filename);\n  }\n}\n\n/**\n * @typedef {Object} AnnotationLayerParameters\n * @property {PageViewport} viewport\n * @property {HTMLDivElement} div\n * @property {Array} annotations\n * @property {PDFPageProxy} page\n * @property {IPDFLinkService} linkService\n * @property {IDownloadManager} [downloadManager]\n * @property {AnnotationStorage} [annotationStorage]\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   for annotation icons. Include trailing slash.\n * @property {boolean} renderForms\n * @property {boolean} [enableScripting] - Enable embedded script execution.\n * @property {boolean} [hasJSActions] - Some fields have JS actions.\n *   The default value is `false`.\n * @property {Object<string, Array<Object>> | null} [fieldObjects]\n * @property {Map<string, HTMLCanvasElement>} [annotationCanvasMap]\n * @property {TextAccessibilityManager} [accessibilityManager]\n * @property {AnnotationEditorUIManager} [annotationEditorUIManager]\n */\n\n/**\n * Manage the layer containing all the annotations.\n */\nclass AnnotationLayer {\n  #accessibilityManager = null;\n\n  #annotationCanvasMap = null;\n\n  #editableAnnotations = new Map();\n\n  constructor({\n    div,\n    accessibilityManager,\n    annotationCanvasMap,\n    annotationEditorUIManager,\n    page,\n    viewport,\n  }) {\n    this.div = div;\n    this.#accessibilityManager = accessibilityManager;\n    this.#annotationCanvasMap = annotationCanvasMap;\n    this.page = page;\n    this.viewport = viewport;\n    this.zIndex = 0;\n    this._annotationEditorUIManager = annotationEditorUIManager;\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"showPopups\", {\n        value: async () => {\n          for (const show of this.popupShow) {\n            await show();\n          }\n        },\n      });\n      this.popupShow = [];\n    }\n  }\n\n  hasEditableAnnotations() {\n    return this.#editableAnnotations.size > 0;\n  }\n\n  #appendElement(element, id) {\n    const contentElement = element.firstChild || element;\n    contentElement.id = `${AnnotationPrefix}${id}`;\n\n    this.div.append(element);\n    this.#accessibilityManager?.moveElementInDOM(\n      this.div,\n      element,\n      contentElement,\n      /* isRemovable = */ false\n    );\n  }\n\n  /**\n   * Render a new annotation layer with all annotation elements.\n   *\n   * @param {AnnotationLayerParameters} params\n   * @memberof AnnotationLayer\n   */\n  async render(params) {\n    const { annotations } = params;\n    const layer = this.div;\n    setLayerDimensions(layer, this.viewport);\n\n    const popupToElements = new Map();\n    const elementParams = {\n      data: null,\n      layer,\n      linkService: params.linkService,\n      downloadManager: params.downloadManager,\n      imageResourcesPath: params.imageResourcesPath || \"\",\n      renderForms: params.renderForms !== false,\n      svgFactory: new DOMSVGFactory(),\n      annotationStorage: params.annotationStorage || new AnnotationStorage(),\n      enableScripting: params.enableScripting === true,\n      hasJSActions: params.hasJSActions,\n      fieldObjects: params.fieldObjects,\n      parent: this,\n      elements: null,\n    };\n\n    for (const data of annotations) {\n      if (data.noHTML) {\n        continue;\n      }\n      const isPopupAnnotation = data.annotationType === AnnotationType.POPUP;\n      if (!isPopupAnnotation) {\n        const { width, height } = getRectDims(data.rect);\n        if (width <= 0 || height <= 0) {\n          continue; // Ignore empty annotations.\n        }\n      } else {\n        const elements = popupToElements.get(data.id);\n        if (!elements) {\n          // Ignore popup annotations without a corresponding annotation.\n          continue;\n        }\n        elementParams.elements = elements;\n      }\n      elementParams.data = data;\n      const element = AnnotationElementFactory.create(elementParams);\n\n      if (!element.isRenderable) {\n        continue;\n      }\n\n      if (!isPopupAnnotation && data.popupRef) {\n        const elements = popupToElements.get(data.popupRef);\n        if (!elements) {\n          popupToElements.set(data.popupRef, [element]);\n        } else {\n          elements.push(element);\n        }\n      }\n\n      const rendered = element.render();\n      if (data.hidden) {\n        rendered.style.visibility = \"hidden\";\n      }\n      this.#appendElement(rendered, data.id);\n\n      if (element._isEditable) {\n        this.#editableAnnotations.set(element.data.id, element);\n        this._annotationEditorUIManager?.renderAnnotationElement(element);\n      }\n    }\n\n    this.#setAnnotationCanvasMap();\n  }\n\n  /**\n   * Update the annotation elements on existing annotation layer.\n   *\n   * @param {AnnotationLayerParameters} viewport\n   * @memberof AnnotationLayer\n   */\n  update({ viewport }) {\n    const layer = this.div;\n    this.viewport = viewport;\n    setLayerDimensions(layer, { rotation: viewport.rotation });\n\n    this.#setAnnotationCanvasMap();\n    layer.hidden = false;\n  }\n\n  #setAnnotationCanvasMap() {\n    if (!this.#annotationCanvasMap) {\n      return;\n    }\n    const layer = this.div;\n    for (const [id, canvas] of this.#annotationCanvasMap) {\n      const element = layer.querySelector(`[data-annotation-id=\"${id}\"]`);\n      if (!element) {\n        continue;\n      }\n\n      canvas.className = \"annotationContent\";\n      const { firstChild } = element;\n      if (!firstChild) {\n        element.append(canvas);\n      } else if (firstChild.nodeName === \"CANVAS\") {\n        firstChild.replaceWith(canvas);\n      } else if (!firstChild.classList.contains(\"annotationContent\")) {\n        firstChild.before(canvas);\n      } else {\n        firstChild.after(canvas);\n      }\n    }\n    this.#annotationCanvasMap.clear();\n  }\n\n  getEditableAnnotations() {\n    return Array.from(this.#editableAnnotations.values());\n  }\n\n  getEditableAnnotation(id) {\n    return this.#editableAnnotations.get(id);\n  }\n}\n\nexport {\n  AnnotationLayer,\n  FreeTextAnnotationElement,\n  InkAnnotationElement,\n  StampAnnotationElement,\n};\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  assert,\n  LINE_FACTOR,\n  shadow,\n  Util,\n} from \"../../shared/util.js\";\nimport {\n  AnnotationEditorUIManager,\n  bindEvents,\n  KeyboardManager,\n} from \"./tools.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { FreeTextAnnotationElement } from \"../annotation_layer.js\";\n\nconst EOL_PATTERN = /\\r\\n?|\\n/g;\n\n/**\n * Basic text editor in order to create a FreeTex annotation.\n */\nclass FreeTextEditor extends AnnotationEditor {\n  #boundEditorDivBlur = this.editorDivBlur.bind(this);\n\n  #boundEditorDivFocus = this.editorDivFocus.bind(this);\n\n  #boundEditorDivInput = this.editorDivInput.bind(this);\n\n  #boundEditorDivKeydown = this.editorDivKeydown.bind(this);\n\n  #boundEditorDivPaste = this.editorDivPaste.bind(this);\n\n  #color;\n\n  #content = \"\";\n\n  #editorDivId = `${this.id}-editor`;\n\n  #fontSize;\n\n  #initialData = null;\n\n  static _freeTextDefaultContent = \"\";\n\n  static _internalPadding = 0;\n\n  static _defaultColor = null;\n\n  static _defaultFontSize = 10;\n\n  static get _keyboardManager() {\n    const proto = FreeTextEditor.prototype;\n\n    const arrowChecker = self => self.isEmpty();\n\n    const small = AnnotationEditorUIManager.TRANSLATE_SMALL;\n    const big = AnnotationEditorUIManager.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          // Commit the text in case the user use ctrl+s to save the document.\n          // The event must bubble in order to be caught by the viewer.\n          // See bug 1831574.\n          [\"ctrl+s\", \"mac+meta+s\", \"ctrl+p\", \"mac+meta+p\"],\n          proto.commitOrRemove,\n          { bubbles: true },\n        ],\n        [\n          [\"ctrl+Enter\", \"mac+meta+Enter\", \"Escape\", \"mac+Escape\"],\n          proto.commitOrRemove,\n        ],\n        [\n          [\"ArrowLeft\", \"mac+ArrowLeft\"],\n          proto._translateEmpty,\n          { args: [-small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          proto._translateEmpty,\n          { args: [-big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowRight\", \"mac+ArrowRight\"],\n          proto._translateEmpty,\n          { args: [small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          proto._translateEmpty,\n          { args: [big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowUp\", \"mac+ArrowUp\"],\n          proto._translateEmpty,\n          { args: [0, -small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"],\n          proto._translateEmpty,\n          { args: [0, -big], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowDown\", \"mac+ArrowDown\"],\n          proto._translateEmpty,\n          { args: [0, small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"],\n          proto._translateEmpty,\n          { args: [0, big], checker: arrowChecker },\n        ],\n      ])\n    );\n  }\n\n  static _type = \"freetext\";\n\n  static _editorType = AnnotationEditorType.FREETEXT;\n\n  constructor(params) {\n    super({ ...params, name: \"freeTextEditor\" });\n    this.#color =\n      params.color ||\n      FreeTextEditor._defaultColor ||\n      AnnotationEditor._defaultLineColor;\n    this.#fontSize = params.fontSize || FreeTextEditor._defaultFontSize;\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager, {\n      strings: [\"pdfjs-free-text-default-content\"],\n    });\n    const style = getComputedStyle(document.documentElement);\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      const lineHeight = parseFloat(\n        style.getPropertyValue(\"--freetext-line-height\")\n      );\n      assert(\n        lineHeight === LINE_FACTOR,\n        \"Update the CSS variable to agree with the constant.\"\n      );\n    }\n\n    this._internalPadding = parseFloat(\n      style.getPropertyValue(\"--freetext-padding\")\n    );\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.FREETEXT_SIZE:\n        FreeTextEditor._defaultFontSize = value;\n        break;\n      case AnnotationEditorParamsType.FREETEXT_COLOR:\n        FreeTextEditor._defaultColor = value;\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.FREETEXT_SIZE:\n        this.#updateFontSize(value);\n        break;\n      case AnnotationEditorParamsType.FREETEXT_COLOR:\n        this.#updateColor(value);\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  static get defaultPropertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.FREETEXT_SIZE,\n        FreeTextEditor._defaultFontSize,\n      ],\n      [\n        AnnotationEditorParamsType.FREETEXT_COLOR,\n        FreeTextEditor._defaultColor || AnnotationEditor._defaultLineColor,\n      ],\n    ];\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    return [\n      [AnnotationEditorParamsType.FREETEXT_SIZE, this.#fontSize],\n      [AnnotationEditorParamsType.FREETEXT_COLOR, this.#color],\n    ];\n  }\n\n  /**\n   * Update the font size and make this action as undoable.\n   * @param {number} fontSize\n   */\n  #updateFontSize(fontSize) {\n    const setFontsize = size => {\n      this.editorDiv.style.fontSize = `calc(${size}px * var(--scale-factor))`;\n      this.translate(0, -(size - this.#fontSize) * this.parentScale);\n      this.#fontSize = size;\n      this.#setEditorDimensions();\n    };\n    const savedFontsize = this.#fontSize;\n    this.addCommands({\n      cmd: setFontsize.bind(this, fontSize),\n      undo: setFontsize.bind(this, savedFontsize),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.FREETEXT_SIZE,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /**\n   * Update the color and make this action undoable.\n   * @param {string} color\n   */\n  #updateColor(color) {\n    const setColor = col => {\n      this.#color = this.editorDiv.style.color = col;\n    };\n    const savedColor = this.#color;\n    this.addCommands({\n      cmd: setColor.bind(this, color),\n      undo: setColor.bind(this, savedColor),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.FREETEXT_COLOR,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /**\n   * Helper to translate the editor with the keyboard when it's empty.\n   * @param {number} x in page units.\n   * @param {number} y in page units.\n   */\n  _translateEmpty(x, y) {\n    this._uiManager.translateSelectedEditors(x, y, /* noCommit = */ true);\n  }\n\n  /** @inheritdoc */\n  getInitialTranslation() {\n    // The start of the base line is where the user clicked.\n    const scale = this.parentScale;\n    return [\n      -FreeTextEditor._internalPadding * scale,\n      -(FreeTextEditor._internalPadding + this.#fontSize) * scale,\n    ];\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilting it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  /** @inheritdoc */\n  enableEditMode() {\n    if (this.isInEditMode()) {\n      return;\n    }\n\n    this.parent.setEditingState(false);\n    this.parent.updateToolbar(AnnotationEditorType.FREETEXT);\n    super.enableEditMode();\n    this.overlayDiv.classList.remove(\"enabled\");\n    this.editorDiv.contentEditable = true;\n    this._isDraggable = false;\n    this.div.removeAttribute(\"aria-activedescendant\");\n    const signal = this._uiManager._signal;\n    this.editorDiv.addEventListener(\"keydown\", this.#boundEditorDivKeydown, {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"focus\", this.#boundEditorDivFocus, {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"blur\", this.#boundEditorDivBlur, {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"input\", this.#boundEditorDivInput, {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"paste\", this.#boundEditorDivPaste, {\n      signal,\n    });\n  }\n\n  /** @inheritdoc */\n  disableEditMode() {\n    if (!this.isInEditMode()) {\n      return;\n    }\n\n    this.parent.setEditingState(true);\n    super.disableEditMode();\n    this.overlayDiv.classList.add(\"enabled\");\n    this.editorDiv.contentEditable = false;\n    this.div.setAttribute(\"aria-activedescendant\", this.#editorDivId);\n    this._isDraggable = true;\n    this.editorDiv.removeEventListener(\"keydown\", this.#boundEditorDivKeydown);\n    this.editorDiv.removeEventListener(\"focus\", this.#boundEditorDivFocus);\n    this.editorDiv.removeEventListener(\"blur\", this.#boundEditorDivBlur);\n    this.editorDiv.removeEventListener(\"input\", this.#boundEditorDivInput);\n    this.editorDiv.removeEventListener(\"paste\", this.#boundEditorDivPaste);\n\n    // On Chrome, the focus is given to <body> when contentEditable is set to\n    // false, hence we focus the div.\n    this.div.focus({\n      preventScroll: true /* See issue #15744 */,\n    });\n\n    // In case the blur callback hasn't been called.\n    this.isEditing = false;\n    this.parent.div.classList.add(\"freetextEditing\");\n  }\n\n  /** @inheritdoc */\n  focusin(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n    super.focusin(event);\n    if (event.target !== this.editorDiv) {\n      this.editorDiv.focus();\n    }\n  }\n\n  /** @inheritdoc */\n  onceAdded() {\n    if (this.width) {\n      // The editor was created in using ctrl+c.\n      return;\n    }\n    this.enableEditMode();\n    this.editorDiv.focus();\n    if (this._initialOptions?.isCentered) {\n      this.center();\n    }\n    this._initialOptions = null;\n  }\n\n  /** @inheritdoc */\n  isEmpty() {\n    return !this.editorDiv || this.editorDiv.innerText.trim() === \"\";\n  }\n\n  /** @inheritdoc */\n  remove() {\n    this.isEditing = false;\n    if (this.parent) {\n      this.parent.setEditingState(true);\n      this.parent.div.classList.add(\"freetextEditing\");\n    }\n    super.remove();\n  }\n\n  /**\n   * Extract the text from this editor.\n   * @returns {string}\n   */\n  #extractText() {\n    // We don't use innerText because there are some bugs with line breaks.\n    const buffer = [];\n    this.editorDiv.normalize();\n    for (const child of this.editorDiv.childNodes) {\n      buffer.push(FreeTextEditor.#getNodeContent(child));\n    }\n    return buffer.join(\"\\n\");\n  }\n\n  #setEditorDimensions() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n\n    let rect;\n    if (this.isAttachedToDOM) {\n      rect = this.div.getBoundingClientRect();\n    } else {\n      // This editor isn't on screen but we need to get its dimensions, so\n      // we just insert it in the DOM, get its bounding box and then remove it.\n      const { currentLayer, div } = this;\n      const savedDisplay = div.style.display;\n      const savedVisibility = div.classList.contains(\"hidden\");\n      div.classList.remove(\"hidden\");\n      div.style.display = \"hidden\";\n      currentLayer.div.append(this.div);\n      rect = div.getBoundingClientRect();\n      div.remove();\n      div.style.display = savedDisplay;\n      div.classList.toggle(\"hidden\", savedVisibility);\n    }\n\n    // The dimensions are relative to the rotation of the page, hence we need to\n    // take that into account (see issue #16636).\n    if (this.rotation % 180 === this.parentRotation % 180) {\n      this.width = rect.width / parentWidth;\n      this.height = rect.height / parentHeight;\n    } else {\n      this.width = rect.height / parentWidth;\n      this.height = rect.width / parentHeight;\n    }\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Commit the content we have in this editor.\n   * @returns {undefined}\n   */\n  commit() {\n    if (!this.isInEditMode()) {\n      return;\n    }\n\n    super.commit();\n    this.disableEditMode();\n    const savedText = this.#content;\n    const newText = (this.#content = this.#extractText().trimEnd());\n    if (savedText === newText) {\n      return;\n    }\n\n    const setText = text => {\n      this.#content = text;\n      if (!text) {\n        this.remove();\n        return;\n      }\n      this.#setContent();\n      this._uiManager.rebuild(this);\n      this.#setEditorDimensions();\n    };\n    this.addCommands({\n      cmd: () => {\n        setText(newText);\n      },\n      undo: () => {\n        setText(savedText);\n      },\n      mustExec: false,\n    });\n    this.#setEditorDimensions();\n  }\n\n  /** @inheritdoc */\n  shouldGetKeyboardEvents() {\n    return this.isInEditMode();\n  }\n\n  /** @inheritdoc */\n  enterInEditMode() {\n    this.enableEditMode();\n    this.editorDiv.focus();\n  }\n\n  /**\n   * ondblclick callback.\n   * @param {MouseEvent} event\n   */\n  dblclick(event) {\n    this.enterInEditMode();\n  }\n\n  /**\n   * onkeydown callback.\n   * @param {KeyboardEvent} event\n   */\n  keydown(event) {\n    if (event.target === this.div && event.key === \"Enter\") {\n      this.enterInEditMode();\n      // Avoid to add an unwanted new line.\n      event.preventDefault();\n    }\n  }\n\n  editorDivKeydown(event) {\n    FreeTextEditor._keyboardManager.exec(this, event);\n  }\n\n  editorDivFocus(event) {\n    this.isEditing = true;\n  }\n\n  editorDivBlur(event) {\n    this.isEditing = false;\n  }\n\n  editorDivInput(event) {\n    this.parent.div.classList.toggle(\"freetextEditing\", this.isEmpty());\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    this.editorDiv.setAttribute(\"role\", \"comment\");\n    this.editorDiv.removeAttribute(\"aria-multiline\");\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    this.editorDiv.setAttribute(\"role\", \"textbox\");\n    this.editorDiv.setAttribute(\"aria-multiline\", true);\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this.width) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n    this.editorDiv = document.createElement(\"div\");\n    this.editorDiv.className = \"internal\";\n\n    this.editorDiv.setAttribute(\"id\", this.#editorDivId);\n    this.editorDiv.setAttribute(\"data-l10n-id\", \"pdfjs-free-text\");\n    this.enableEditing();\n\n    AnnotationEditor._l10nPromise\n      .get(\"pdfjs-free-text-default-content\")\n      .then(msg => this.editorDiv?.setAttribute(\"default-content\", msg));\n    this.editorDiv.contentEditable = true;\n\n    const { style } = this.editorDiv;\n    style.fontSize = `calc(${this.#fontSize}px * var(--scale-factor))`;\n    style.color = this.#color;\n\n    this.div.append(this.editorDiv);\n\n    this.overlayDiv = document.createElement(\"div\");\n    this.overlayDiv.classList.add(\"overlay\", \"enabled\");\n    this.div.append(this.overlayDiv);\n\n    bindEvents(this, this.div, [\"dblclick\", \"keydown\"]);\n\n    if (this.width) {\n      // This editor was created in using copy (ctrl+c).\n      const [parentWidth, parentHeight] = this.parentDimensions;\n      if (this.annotationElementId) {\n        // This stuff is hard to test: if something is changed here, please\n        // test with the following PDF file:\n        //  - freetexts.pdf\n        //  - rotated_freetexts.pdf\n        // Only small variations between the original annotation and its editor\n        // are allowed.\n\n        // position is the position of the first glyph in the annotation\n        // and it's relative to its container.\n        const { position } = this.#initialData;\n        let [tx, ty] = this.getInitialTranslation();\n        [tx, ty] = this.pageTranslationToScreen(tx, ty);\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        const [pageX, pageY] = this.pageTranslation;\n        let posX, posY;\n        switch (this.rotation) {\n          case 0:\n            posX = baseX + (position[0] - pageX) / pageWidth;\n            posY = baseY + this.height - (position[1] - pageY) / pageHeight;\n            break;\n          case 90:\n            posX = baseX + (position[0] - pageX) / pageWidth;\n            posY = baseY - (position[1] - pageY) / pageHeight;\n            [tx, ty] = [ty, -tx];\n            break;\n          case 180:\n            posX = baseX - this.width + (position[0] - pageX) / pageWidth;\n            posY = baseY - (position[1] - pageY) / pageHeight;\n            [tx, ty] = [-tx, -ty];\n            break;\n          case 270:\n            posX =\n              baseX +\n              (position[0] - pageX - this.height * pageHeight) / pageWidth;\n            posY =\n              baseY +\n              (position[1] - pageY - this.width * pageWidth) / pageHeight;\n            [tx, ty] = [-ty, tx];\n            break;\n        }\n        this.setAt(posX * parentWidth, posY * parentHeight, tx, ty);\n      } else {\n        this.setAt(\n          baseX * parentWidth,\n          baseY * parentHeight,\n          this.width * parentWidth,\n          this.height * parentHeight\n        );\n      }\n\n      this.#setContent();\n      this._isDraggable = true;\n      this.editorDiv.contentEditable = false;\n    } else {\n      this._isDraggable = false;\n      this.editorDiv.contentEditable = true;\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      this.div.setAttribute(\"annotation-id\", this.annotationElementId);\n    }\n\n    return this.div;\n  }\n\n  static #getNodeContent(node) {\n    return (\n      node.nodeType === Node.TEXT_NODE ? node.nodeValue : node.innerText\n    ).replaceAll(EOL_PATTERN, \"\");\n  }\n\n  editorDivPaste(event) {\n    const clipboardData = event.clipboardData || window.clipboardData;\n    const { types } = clipboardData;\n    if (types.length === 1 && types[0] === \"text/plain\") {\n      return;\n    }\n\n    event.preventDefault();\n    const paste = FreeTextEditor.#deserializeContent(\n      clipboardData.getData(\"text\") || \"\"\n    ).replaceAll(EOL_PATTERN, \"\\n\");\n    if (!paste) {\n      return;\n    }\n    const selection = window.getSelection();\n    if (!selection.rangeCount) {\n      return;\n    }\n    this.editorDiv.normalize();\n    selection.deleteFromDocument();\n    const range = selection.getRangeAt(0);\n    if (!paste.includes(\"\\n\")) {\n      range.insertNode(document.createTextNode(paste));\n      this.editorDiv.normalize();\n      selection.collapseToStart();\n      return;\n    }\n\n    // Collect the text before and after the caret.\n    const { startContainer, startOffset } = range;\n    const bufferBefore = [];\n    const bufferAfter = [];\n    if (startContainer.nodeType === Node.TEXT_NODE) {\n      const parent = startContainer.parentElement;\n      bufferAfter.push(\n        startContainer.nodeValue.slice(startOffset).replaceAll(EOL_PATTERN, \"\")\n      );\n      if (parent !== this.editorDiv) {\n        let buffer = bufferBefore;\n        for (const child of this.editorDiv.childNodes) {\n          if (child === parent) {\n            buffer = bufferAfter;\n            continue;\n          }\n          buffer.push(FreeTextEditor.#getNodeContent(child));\n        }\n      }\n      bufferBefore.push(\n        startContainer.nodeValue\n          .slice(0, startOffset)\n          .replaceAll(EOL_PATTERN, \"\")\n      );\n    } else if (startContainer === this.editorDiv) {\n      let buffer = bufferBefore;\n      let i = 0;\n      for (const child of this.editorDiv.childNodes) {\n        if (i++ === startOffset) {\n          buffer = bufferAfter;\n        }\n        buffer.push(FreeTextEditor.#getNodeContent(child));\n      }\n    }\n    this.#content = `${bufferBefore.join(\"\\n\")}${paste}${bufferAfter.join(\"\\n\")}`;\n    this.#setContent();\n\n    // Set the caret at the right position.\n    const newRange = new Range();\n    let beforeLength = bufferBefore.reduce((acc, line) => acc + line.length, 0);\n    for (const { firstChild } of this.editorDiv.childNodes) {\n      // Each child is either a div with a text node or a br element.\n      if (firstChild.nodeType === Node.TEXT_NODE) {\n        const length = firstChild.nodeValue.length;\n        if (beforeLength <= length) {\n          newRange.setStart(firstChild, beforeLength);\n          newRange.setEnd(firstChild, beforeLength);\n          break;\n        }\n        beforeLength -= length;\n      }\n    }\n    selection.removeAllRanges();\n    selection.addRange(newRange);\n  }\n\n  #setContent() {\n    this.editorDiv.replaceChildren();\n    if (!this.#content) {\n      return;\n    }\n    for (const line of this.#content.split(\"\\n\")) {\n      const div = document.createElement(\"div\");\n      div.append(\n        line ? document.createTextNode(line) : document.createElement(\"br\")\n      );\n      this.editorDiv.append(div);\n    }\n  }\n\n  #serializeContent() {\n    return this.#content.replaceAll(\"\\xa0\", \" \");\n  }\n\n  static #deserializeContent(content) {\n    return content.replaceAll(\" \", \"\\xa0\");\n  }\n\n  /** @inheritdoc */\n  get contentDiv() {\n    return this.editorDiv;\n  }\n\n  /** @inheritdoc */\n  static deserialize(data, parent, uiManager) {\n    let initialData = null;\n    if (data instanceof FreeTextAnnotationElement) {\n      const {\n        data: {\n          defaultAppearanceData: { fontSize, fontColor },\n          rect,\n          rotation,\n          id,\n        },\n        textContent,\n        textPosition,\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      // textContent is supposed to be an array of strings containing each line\n      // of text. However, it can be null or empty.\n      if (!textContent || textContent.length === 0) {\n        // Empty annotation.\n        return null;\n      }\n      initialData = data = {\n        annotationType: AnnotationEditorType.FREETEXT,\n        color: Array.from(fontColor),\n        fontSize,\n        value: textContent.join(\"\\n\"),\n        position: textPosition,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        id,\n        deleted: false,\n      };\n    }\n    const editor = super.deserialize(data, parent, uiManager);\n    editor.#fontSize = data.fontSize;\n    editor.#color = Util.makeHexColor(...data.color);\n    editor.#content = FreeTextEditor.#deserializeContent(data.value);\n    editor.annotationElementId = data.id || null;\n    editor.#initialData = initialData;\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return {\n        pageIndex: this.pageIndex,\n        id: this.annotationElementId,\n        deleted: true,\n      };\n    }\n\n    const padding = FreeTextEditor._internalPadding * this.parentScale;\n    const rect = this.getRect(padding, padding);\n    const color = AnnotationEditor._colorManager.convert(\n      this.isAttachedToDOM\n        ? getComputedStyle(this.editorDiv).color\n        : this.#color\n    );\n\n    const serialized = {\n      annotationType: AnnotationEditorType.FREETEXT,\n      color,\n      fontSize: this.#fontSize,\n      value: this.#serializeContent(),\n      pageIndex: this.pageIndex,\n      rect,\n      rotation: this.rotation,\n      structTreeParentId: this._structTreeParentId,\n    };\n\n    if (isForCopying) {\n      // Don't add the id when copying because the pasted editor mustn't be\n      // linked to an existing annotation.\n      return serialized;\n    }\n\n    if (this.annotationElementId && !this.#hasElementChanged(serialized)) {\n      return null;\n    }\n\n    serialized.id = this.annotationElementId;\n\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const { value, fontSize, color, pageIndex } = this.#initialData;\n\n    return (\n      this._hasBeenMoved ||\n      serialized.value !== value ||\n      serialized.fontSize !== fontSize ||\n      serialized.color.some((c, i) => c !== color[i]) ||\n      serialized.pageIndex !== pageIndex\n    );\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    const content = super.renderAnnotationElement(annotation);\n    if (this.deleted) {\n      return content;\n    }\n    const { style } = content;\n    style.fontSize = `calc(${this.#fontSize}px * var(--scale-factor))`;\n    style.color = this.#color;\n\n    content.replaceChildren();\n    for (const line of this.#content.split(\"\\n\")) {\n      const div = document.createElement(\"div\");\n      div.append(\n        line ? document.createTextNode(line) : document.createElement(\"br\")\n      );\n      content.append(div);\n    }\n\n    const padding = FreeTextEditor._internalPadding * this.parentScale;\n    annotation.updateEdited({\n      rect: this.getRect(padding, padding),\n      popupContent: this.#content,\n    });\n\n    return content;\n  }\n\n  resetAnnotationElement(annotation) {\n    super.resetAnnotationElement(annotation);\n    annotation.resetEdited();\n  }\n}\n\nexport { FreeTextEditor };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Util } from \"../../shared/util.js\";\n\nclass Outliner {\n  #box;\n\n  #verticalEdges = [];\n\n  #intervals = [];\n\n  /**\n   * Construct an outliner.\n   * @param {Array<Object>} boxes - An array of axis-aligned rectangles.\n   * @param {number} borderWidth - The width of the border of the boxes, it\n   *   allows to make the boxes bigger (or smaller).\n   * @param {number} innerMargin - The margin between the boxes and the\n   *   outlines. It's important to not have a null innerMargin when we want to\n   *   draw the outline else the stroked outline could be clipped because of its\n   *   width.\n   * @param {boolean} isLTR - true if we're in LTR mode. It's used to determine\n   *   the last point of the boxes.\n   */\n  constructor(boxes, borderWidth = 0, innerMargin = 0, isLTR = true) {\n    let minX = Infinity;\n    let maxX = -Infinity;\n    let minY = Infinity;\n    let maxY = -Infinity;\n\n    // We round the coordinates to slightly reduce the number of edges in the\n    // final outlines.\n    const NUMBER_OF_DIGITS = 4;\n    const EPSILON = 10 ** -NUMBER_OF_DIGITS;\n\n    // The coordinates of the boxes are in the page coordinate system.\n    for (const { x, y, width, height } of boxes) {\n      const x1 = Math.floor((x - borderWidth) / EPSILON) * EPSILON;\n      const x2 = Math.ceil((x + width + borderWidth) / EPSILON) * EPSILON;\n      const y1 = Math.floor((y - borderWidth) / EPSILON) * EPSILON;\n      const y2 = Math.ceil((y + height + borderWidth) / EPSILON) * EPSILON;\n      const left = [x1, y1, y2, true];\n      const right = [x2, y1, y2, false];\n      this.#verticalEdges.push(left, right);\n\n      minX = Math.min(minX, x1);\n      maxX = Math.max(maxX, x2);\n      minY = Math.min(minY, y1);\n      maxY = Math.max(maxY, y2);\n    }\n\n    const bboxWidth = maxX - minX + 2 * innerMargin;\n    const bboxHeight = maxY - minY + 2 * innerMargin;\n    const shiftedMinX = minX - innerMargin;\n    const shiftedMinY = minY - innerMargin;\n    const lastEdge = this.#verticalEdges.at(isLTR ? -1 : -2);\n    const lastPoint = [lastEdge[0], lastEdge[2]];\n\n    // Convert the coordinates of the edges into box coordinates.\n    for (const edge of this.#verticalEdges) {\n      const [x, y1, y2] = edge;\n      edge[0] = (x - shiftedMinX) / bboxWidth;\n      edge[1] = (y1 - shiftedMinY) / bboxHeight;\n      edge[2] = (y2 - shiftedMinY) / bboxHeight;\n    }\n\n    this.#box = {\n      x: shiftedMinX,\n      y: shiftedMinY,\n      width: bboxWidth,\n      height: bboxHeight,\n      lastPoint,\n    };\n  }\n\n  getOutlines() {\n    // We begin to sort lexicographically the vertical edges by their abscissa,\n    // and then by their ordinate.\n    this.#verticalEdges.sort(\n      (a, b) => a[0] - b[0] || a[1] - b[1] || a[2] - b[2]\n    );\n\n    // We're now using a sweep line algorithm to find the outlines.\n    // We start with the leftmost vertical edge, and we're going to iterate\n    // over all the vertical edges from left to right.\n    // Each time we encounter a left edge, we're going to insert the interval\n    // [y1, y2] in the set of intervals.\n    // This set of intervals is used to break the vertical edges into chunks:\n    // we only take the part of the vertical edge that isn't in the union of\n    // the intervals.\n    const outlineVerticalEdges = [];\n    for (const edge of this.#verticalEdges) {\n      if (edge[3]) {\n        // Left edge.\n        outlineVerticalEdges.push(...this.#breakEdge(edge));\n        this.#insert(edge);\n      } else {\n        // Right edge.\n        this.#remove(edge);\n        outlineVerticalEdges.push(...this.#breakEdge(edge));\n      }\n    }\n    return this.#getOutlines(outlineVerticalEdges);\n  }\n\n  #getOutlines(outlineVerticalEdges) {\n    const edges = [];\n    const allEdges = new Set();\n\n    for (const edge of outlineVerticalEdges) {\n      const [x, y1, y2] = edge;\n      edges.push([x, y1, edge], [x, y2, edge]);\n    }\n\n    // We sort lexicographically the vertices of each edge by their ordinate and\n    // by their abscissa.\n    // Every pair (v_2i, v_{2i + 1}) of vertices defines a horizontal edge.\n    // So for every vertical edge, we're going to add the two vertical edges\n    // which are connected to it through a horizontal edge.\n    edges.sort((a, b) => a[1] - b[1] || a[0] - b[0]);\n    for (let i = 0, ii = edges.length; i < ii; i += 2) {\n      const edge1 = edges[i][2];\n      const edge2 = edges[i + 1][2];\n      edge1.push(edge2);\n      edge2.push(edge1);\n      allEdges.add(edge1);\n      allEdges.add(edge2);\n    }\n    const outlines = [];\n    let outline;\n\n    while (allEdges.size > 0) {\n      const edge = allEdges.values().next().value;\n      let [x, y1, y2, edge1, edge2] = edge;\n      allEdges.delete(edge);\n      let lastPointX = x;\n      let lastPointY = y1;\n\n      outline = [x, y2];\n      outlines.push(outline);\n\n      while (true) {\n        let e;\n        if (allEdges.has(edge1)) {\n          e = edge1;\n        } else if (allEdges.has(edge2)) {\n          e = edge2;\n        } else {\n          break;\n        }\n\n        allEdges.delete(e);\n        [x, y1, y2, edge1, edge2] = e;\n\n        if (lastPointX !== x) {\n          outline.push(lastPointX, lastPointY, x, lastPointY === y1 ? y1 : y2);\n          lastPointX = x;\n        }\n        lastPointY = lastPointY === y1 ? y2 : y1;\n      }\n      outline.push(lastPointX, lastPointY);\n    }\n    return new HighlightOutline(outlines, this.#box);\n  }\n\n  #binarySearch(y) {\n    const array = this.#intervals;\n    let start = 0;\n    let end = array.length - 1;\n\n    while (start <= end) {\n      const middle = (start + end) >> 1;\n      const y1 = array[middle][0];\n      if (y1 === y) {\n        return middle;\n      }\n      if (y1 < y) {\n        start = middle + 1;\n      } else {\n        end = middle - 1;\n      }\n    }\n    return end + 1;\n  }\n\n  #insert([, y1, y2]) {\n    const index = this.#binarySearch(y1);\n    this.#intervals.splice(index, 0, [y1, y2]);\n  }\n\n  #remove([, y1, y2]) {\n    const index = this.#binarySearch(y1);\n    for (let i = index; i < this.#intervals.length; i++) {\n      const [start, end] = this.#intervals[i];\n      if (start !== y1) {\n        break;\n      }\n      if (start === y1 && end === y2) {\n        this.#intervals.splice(i, 1);\n        return;\n      }\n    }\n    for (let i = index - 1; i >= 0; i--) {\n      const [start, end] = this.#intervals[i];\n      if (start !== y1) {\n        break;\n      }\n      if (start === y1 && end === y2) {\n        this.#intervals.splice(i, 1);\n        return;\n      }\n    }\n  }\n\n  #breakEdge(edge) {\n    const [x, y1, y2] = edge;\n    const results = [[x, y1, y2]];\n    const index = this.#binarySearch(y2);\n    for (let i = 0; i < index; i++) {\n      const [start, end] = this.#intervals[i];\n      for (let j = 0, jj = results.length; j < jj; j++) {\n        const [, y3, y4] = results[j];\n        if (end <= y3 || y4 <= start) {\n          // There is no intersection between the interval and the edge, hence\n          // we keep it as is.\n          continue;\n        }\n        if (y3 >= start) {\n          if (y4 > end) {\n            results[j][1] = end;\n          } else {\n            if (jj === 1) {\n              return [];\n            }\n            // The edge is included in the interval, hence we remove it.\n            results.splice(j, 1);\n            j--;\n            jj--;\n          }\n          continue;\n        }\n        results[j][2] = start;\n        if (y4 > end) {\n          results.push([x, end, y4]);\n        }\n      }\n    }\n    return results;\n  }\n}\n\nclass Outline {\n  /**\n   * @returns {string} The SVG path of the outline.\n   */\n  toSVGPath() {\n    throw new Error(\"Abstract method `toSVGPath` must be implemented.\");\n  }\n\n  /**\n   * @type {Object|null} The bounding box of the outline.\n   */\n  get box() {\n    throw new Error(\"Abstract getter `box` must be implemented.\");\n  }\n\n  serialize(_bbox, _rotation) {\n    throw new Error(\"Abstract method `serialize` must be implemented.\");\n  }\n\n  get free() {\n    return this instanceof FreeHighlightOutline;\n  }\n}\n\nclass HighlightOutline extends Outline {\n  #box;\n\n  #outlines;\n\n  constructor(outlines, box) {\n    super();\n    this.#outlines = outlines;\n    this.#box = box;\n  }\n\n  toSVGPath() {\n    const buffer = [];\n    for (const polygon of this.#outlines) {\n      let [prevX, prevY] = polygon;\n      buffer.push(`M${prevX} ${prevY}`);\n      for (let i = 2; i < polygon.length; i += 2) {\n        const x = polygon[i];\n        const y = polygon[i + 1];\n        if (x === prevX) {\n          buffer.push(`V${y}`);\n          prevY = y;\n        } else if (y === prevY) {\n          buffer.push(`H${x}`);\n          prevX = x;\n        }\n      }\n      buffer.push(\"Z\");\n    }\n    return buffer.join(\" \");\n  }\n\n  /**\n   * Serialize the outlines into the PDF page coordinate system.\n   * @param {Array<number>} _bbox - the bounding box of the annotation.\n   * @param {number} _rotation - the rotation of the annotation.\n   * @returns {Array<Array<number>>}\n   */\n  serialize([blX, blY, trX, trY], _rotation) {\n    const outlines = [];\n    const width = trX - blX;\n    const height = trY - blY;\n    for (const outline of this.#outlines) {\n      const points = new Array(outline.length);\n      for (let i = 0; i < outline.length; i += 2) {\n        points[i] = blX + outline[i] * width;\n        points[i + 1] = trY - outline[i + 1] * height;\n      }\n      outlines.push(points);\n    }\n    return outlines;\n  }\n\n  get box() {\n    return this.#box;\n  }\n}\n\nclass FreeOutliner {\n  #box;\n\n  #bottom = [];\n\n  #innerMargin;\n\n  #isLTR;\n\n  #top = [];\n\n  // The first 6 elements are the last 3 points of the top part of the outline.\n  // The next 6 elements are the last 3 points of the line.\n  // The next 6 elements are the last 3 points of the bottom part of the\n  // outline.\n  // We track the last 3 points in order to be able to:\n  //  - compute the normal of the line,\n  //  - compute the control points of the quadratic Bzier curve.\n  #last = new Float64Array(18);\n\n  #lastX;\n\n  #lastY;\n\n  #min;\n\n  #min_dist;\n\n  #scaleFactor;\n\n  #thickness;\n\n  #points = [];\n\n  static #MIN_DIST = 8;\n\n  static #MIN_DIFF = 2;\n\n  static #MIN = FreeOutliner.#MIN_DIST + FreeOutliner.#MIN_DIFF;\n\n  constructor({ x, y }, box, scaleFactor, thickness, isLTR, innerMargin = 0) {\n    this.#box = box;\n    this.#thickness = thickness * scaleFactor;\n    this.#isLTR = isLTR;\n    this.#last.set([NaN, NaN, NaN, NaN, x, y], 6);\n    this.#innerMargin = innerMargin;\n    this.#min_dist = FreeOutliner.#MIN_DIST * scaleFactor;\n    this.#min = FreeOutliner.#MIN * scaleFactor;\n    this.#scaleFactor = scaleFactor;\n    this.#points.push(x, y);\n  }\n\n  get free() {\n    return true;\n  }\n\n  isEmpty() {\n    // When we add a second point then this.#last.slice(6) will be something\n    // like [NaN, NaN, firstX, firstY, secondX, secondY,...] so having a NaN\n    // at index 8 means that we've only one point.\n    return isNaN(this.#last[8]);\n  }\n\n  #getLastCoords() {\n    const lastTop = this.#last.subarray(4, 6);\n    const lastBottom = this.#last.subarray(16, 18);\n    const [x, y, width, height] = this.#box;\n\n    return [\n      (this.#lastX + (lastTop[0] - lastBottom[0]) / 2 - x) / width,\n      (this.#lastY + (lastTop[1] - lastBottom[1]) / 2 - y) / height,\n      (this.#lastX + (lastBottom[0] - lastTop[0]) / 2 - x) / width,\n      (this.#lastY + (lastBottom[1] - lastTop[1]) / 2 - y) / height,\n    ];\n  }\n\n  add({ x, y }) {\n    this.#lastX = x;\n    this.#lastY = y;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    let [x1, y1, x2, y2] = this.#last.subarray(8, 12);\n    const diffX = x - x2;\n    const diffY = y - y2;\n    const d = Math.hypot(diffX, diffY);\n    if (d < this.#min) {\n      // The idea is to avoid garbage points around the last point.\n      // When the points are too close, it just leads to bad normal vectors and\n      // control points.\n      return false;\n    }\n    const diffD = d - this.#min_dist;\n    const K = diffD / d;\n    const shiftX = K * diffX;\n    const shiftY = K * diffY;\n\n    // We update the last 3 points of the line.\n    let x0 = x1;\n    let y0 = y1;\n    x1 = x2;\n    y1 = y2;\n    x2 += shiftX;\n    y2 += shiftY;\n\n    // We keep track of the points in order to be able to compute the focus\n    // outline.\n    this.#points?.push(x, y);\n\n    // Create the normal unit vector.\n    // |(shiftX, shiftY)| = |K| * |(diffX, diffY)| = |K| * d = diffD.\n    const nX = -shiftY / diffD;\n    const nY = shiftX / diffD;\n    const thX = nX * this.#thickness;\n    const thY = nY * this.#thickness;\n    this.#last.set(this.#last.subarray(2, 8), 0);\n    this.#last.set([x2 + thX, y2 + thY], 4);\n    this.#last.set(this.#last.subarray(14, 18), 12);\n    this.#last.set([x2 - thX, y2 - thY], 16);\n\n    if (isNaN(this.#last[6])) {\n      if (this.#top.length === 0) {\n        this.#last.set([x1 + thX, y1 + thY], 2);\n        this.#top.push(\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          (x1 + thX - layerX) / layerWidth,\n          (y1 + thY - layerY) / layerHeight\n        );\n        this.#last.set([x1 - thX, y1 - thY], 14);\n        this.#bottom.push(\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          (x1 - thX - layerX) / layerWidth,\n          (y1 - thY - layerY) / layerHeight\n        );\n      }\n      this.#last.set([x0, y0, x1, y1, x2, y2], 6);\n      return !this.isEmpty();\n    }\n\n    this.#last.set([x0, y0, x1, y1, x2, y2], 6);\n\n    const angle = Math.abs(\n      Math.atan2(y0 - y1, x0 - x1) - Math.atan2(shiftY, shiftX)\n    );\n    if (angle < Math.PI / 2) {\n      // In order to avoid some possible artifacts, we're going to use the a\n      // straight line instead of a quadratic Bzier curve.\n      [x1, y1, x2, y2] = this.#last.subarray(2, 6);\n      this.#top.push(\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        ((x1 + x2) / 2 - layerX) / layerWidth,\n        ((y1 + y2) / 2 - layerY) / layerHeight\n      );\n      [x1, y1, x0, y0] = this.#last.subarray(14, 18);\n      this.#bottom.push(\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        ((x0 + x1) / 2 - layerX) / layerWidth,\n        ((y0 + y1) / 2 - layerY) / layerHeight\n      );\n      return true;\n    }\n\n    // Control points and the final point for the quadratic Bzier curve.\n    [x0, y0, x1, y1, x2, y2] = this.#last.subarray(0, 6);\n    this.#top.push(\n      ((x0 + 5 * x1) / 6 - layerX) / layerWidth,\n      ((y0 + 5 * y1) / 6 - layerY) / layerHeight,\n      ((5 * x1 + x2) / 6 - layerX) / layerWidth,\n      ((5 * y1 + y2) / 6 - layerY) / layerHeight,\n      ((x1 + x2) / 2 - layerX) / layerWidth,\n      ((y1 + y2) / 2 - layerY) / layerHeight\n    );\n    [x2, y2, x1, y1, x0, y0] = this.#last.subarray(12, 18);\n    this.#bottom.push(\n      ((x0 + 5 * x1) / 6 - layerX) / layerWidth,\n      ((y0 + 5 * y1) / 6 - layerY) / layerHeight,\n      ((5 * x1 + x2) / 6 - layerX) / layerWidth,\n      ((5 * y1 + y2) / 6 - layerY) / layerHeight,\n      ((x1 + x2) / 2 - layerX) / layerWidth,\n      ((y1 + y2) / 2 - layerY) / layerHeight\n    );\n    return true;\n  }\n\n  toSVGPath() {\n    if (this.isEmpty()) {\n      // We've only one point.\n      return \"\";\n    }\n    const top = this.#top;\n    const bottom = this.#bottom;\n    const lastTop = this.#last.subarray(4, 6);\n    const lastBottom = this.#last.subarray(16, 18);\n    const [x, y, width, height] = this.#box;\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n\n    if (isNaN(this.#last[6]) && !this.isEmpty()) {\n      // We've only two points.\n      return `M${(this.#last[2] - x) / width} ${\n        (this.#last[3] - y) / height\n      } L${(this.#last[4] - x) / width} ${(this.#last[5] - y) / height} L${lastTopX} ${lastTopY} L${lastBottomX} ${lastBottomY} L${\n        (this.#last[16] - x) / width\n      } ${(this.#last[17] - y) / height} L${(this.#last[14] - x) / width} ${\n        (this.#last[15] - y) / height\n      } Z`;\n    }\n\n    const buffer = [];\n    buffer.push(`M${top[4]} ${top[5]}`);\n    for (let i = 6; i < top.length; i += 6) {\n      if (isNaN(top[i])) {\n        buffer.push(`L${top[i + 4]} ${top[i + 5]}`);\n      } else {\n        buffer.push(\n          `C${top[i]} ${top[i + 1]} ${top[i + 2]} ${top[i + 3]} ${top[i + 4]} ${\n            top[i + 5]\n          }`\n        );\n      }\n    }\n\n    buffer.push(\n      `L${(lastTop[0] - x) / width} ${(lastTop[1] - y) / height} L${lastTopX} ${lastTopY} L${lastBottomX} ${lastBottomY} L${\n        (lastBottom[0] - x) / width\n      } ${(lastBottom[1] - y) / height}`\n    );\n    for (let i = bottom.length - 6; i >= 6; i -= 6) {\n      if (isNaN(bottom[i])) {\n        buffer.push(`L${bottom[i + 4]} ${bottom[i + 5]}`);\n      } else {\n        buffer.push(\n          `C${bottom[i]} ${bottom[i + 1]} ${bottom[i + 2]} ${bottom[i + 3]} ${\n            bottom[i + 4]\n          } ${bottom[i + 5]}`\n        );\n      }\n    }\n    buffer.push(`L${bottom[4]} ${bottom[5]} Z`);\n\n    return buffer.join(\" \");\n  }\n\n  getOutlines() {\n    const top = this.#top;\n    const bottom = this.#bottom;\n    const last = this.#last;\n    const lastTop = last.subarray(4, 6);\n    const lastBottom = last.subarray(16, 18);\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n\n    const points = new Float64Array((this.#points?.length ?? 0) + 2);\n    for (let i = 0, ii = points.length - 2; i < ii; i += 2) {\n      points[i] = (this.#points[i] - layerX) / layerWidth;\n      points[i + 1] = (this.#points[i + 1] - layerY) / layerHeight;\n    }\n    points[points.length - 2] = (this.#lastX - layerX) / layerWidth;\n    points[points.length - 1] = (this.#lastY - layerY) / layerHeight;\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n\n    if (isNaN(last[6]) && !this.isEmpty()) {\n      // We've only two points.\n      const outline = new Float64Array(36);\n      outline.set(\n        [\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          (last[2] - layerX) / layerWidth,\n          (last[3] - layerY) / layerHeight,\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          (last[4] - layerX) / layerWidth,\n          (last[5] - layerY) / layerHeight,\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          lastTopX,\n          lastTopY,\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          lastBottomX,\n          lastBottomY,\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          (last[16] - layerX) / layerWidth,\n          (last[17] - layerY) / layerHeight,\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          (last[14] - layerX) / layerWidth,\n          (last[15] - layerY) / layerHeight,\n        ],\n        0\n      );\n      return new FreeHighlightOutline(\n        outline,\n        points,\n        this.#box,\n        this.#scaleFactor,\n        this.#innerMargin,\n        this.#isLTR\n      );\n    }\n\n    const outline = new Float64Array(\n      this.#top.length + 24 + this.#bottom.length\n    );\n    let N = top.length;\n    for (let i = 0; i < N; i += 2) {\n      if (isNaN(top[i])) {\n        outline[i] = outline[i + 1] = NaN;\n        continue;\n      }\n      outline[i] = top[i];\n      outline[i + 1] = top[i + 1];\n    }\n\n    outline.set(\n      [\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (lastTop[0] - layerX) / layerWidth,\n        (lastTop[1] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastTopX,\n        lastTopY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastBottomX,\n        lastBottomY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (lastBottom[0] - layerX) / layerWidth,\n        (lastBottom[1] - layerY) / layerHeight,\n      ],\n      N\n    );\n    N += 24;\n\n    for (let i = bottom.length - 6; i >= 6; i -= 6) {\n      for (let j = 0; j < 6; j += 2) {\n        if (isNaN(bottom[i + j])) {\n          outline[N] = outline[N + 1] = NaN;\n          N += 2;\n          continue;\n        }\n        outline[N] = bottom[i + j];\n        outline[N + 1] = bottom[i + j + 1];\n        N += 2;\n      }\n    }\n    outline.set([NaN, NaN, NaN, NaN, bottom[4], bottom[5]], N);\n    return new FreeHighlightOutline(\n      outline,\n      points,\n      this.#box,\n      this.#scaleFactor,\n      this.#innerMargin,\n      this.#isLTR\n    );\n  }\n}\n\nclass FreeHighlightOutline extends Outline {\n  #box;\n\n  #bbox = null;\n\n  #innerMargin;\n\n  #isLTR;\n\n  #points;\n\n  #scaleFactor;\n\n  #outline;\n\n  constructor(outline, points, box, scaleFactor, innerMargin, isLTR) {\n    super();\n    this.#outline = outline;\n    this.#points = points;\n    this.#box = box;\n    this.#scaleFactor = scaleFactor;\n    this.#innerMargin = innerMargin;\n    this.#isLTR = isLTR;\n    this.#computeMinMax(isLTR);\n\n    const { x, y, width, height } = this.#bbox;\n    for (let i = 0, ii = outline.length; i < ii; i += 2) {\n      outline[i] = (outline[i] - x) / width;\n      outline[i + 1] = (outline[i + 1] - y) / height;\n    }\n    for (let i = 0, ii = points.length; i < ii; i += 2) {\n      points[i] = (points[i] - x) / width;\n      points[i + 1] = (points[i + 1] - y) / height;\n    }\n  }\n\n  toSVGPath() {\n    const buffer = [`M${this.#outline[4]} ${this.#outline[5]}`];\n    for (let i = 6, ii = this.#outline.length; i < ii; i += 6) {\n      if (isNaN(this.#outline[i])) {\n        buffer.push(`L${this.#outline[i + 4]} ${this.#outline[i + 5]}`);\n        continue;\n      }\n      buffer.push(\n        `C${this.#outline[i]} ${this.#outline[i + 1]} ${this.#outline[i + 2]} ${\n          this.#outline[i + 3]\n        } ${this.#outline[i + 4]} ${this.#outline[i + 5]}`\n      );\n    }\n    buffer.push(\"Z\");\n    return buffer.join(\" \");\n  }\n\n  serialize([blX, blY, trX, trY], rotation) {\n    const width = trX - blX;\n    const height = trY - blY;\n    let outline;\n    let points;\n    switch (rotation) {\n      case 0:\n        outline = this.#rescale(this.#outline, blX, trY, width, -height);\n        points = this.#rescale(this.#points, blX, trY, width, -height);\n        break;\n      case 90:\n        outline = this.#rescaleAndSwap(this.#outline, blX, blY, width, height);\n        points = this.#rescaleAndSwap(this.#points, blX, blY, width, height);\n        break;\n      case 180:\n        outline = this.#rescale(this.#outline, trX, blY, -width, height);\n        points = this.#rescale(this.#points, trX, blY, -width, height);\n        break;\n      case 270:\n        outline = this.#rescaleAndSwap(\n          this.#outline,\n          trX,\n          trY,\n          -width,\n          -height\n        );\n        points = this.#rescaleAndSwap(this.#points, trX, trY, -width, -height);\n        break;\n    }\n    return { outline: Array.from(outline), points: [Array.from(points)] };\n  }\n\n  #rescale(src, tx, ty, sx, sy) {\n    const dest = new Float64Array(src.length);\n    for (let i = 0, ii = src.length; i < ii; i += 2) {\n      dest[i] = tx + src[i] * sx;\n      dest[i + 1] = ty + src[i + 1] * sy;\n    }\n    return dest;\n  }\n\n  #rescaleAndSwap(src, tx, ty, sx, sy) {\n    const dest = new Float64Array(src.length);\n    for (let i = 0, ii = src.length; i < ii; i += 2) {\n      dest[i] = tx + src[i + 1] * sx;\n      dest[i + 1] = ty + src[i] * sy;\n    }\n    return dest;\n  }\n\n  #computeMinMax(isLTR) {\n    const outline = this.#outline;\n    let lastX = outline[4];\n    let lastY = outline[5];\n    let minX = lastX;\n    let minY = lastY;\n    let maxX = lastX;\n    let maxY = lastY;\n    let lastPointX = lastX;\n    let lastPointY = lastY;\n    const ltrCallback = isLTR ? Math.max : Math.min;\n\n    for (let i = 6, ii = outline.length; i < ii; i += 6) {\n      if (isNaN(outline[i])) {\n        minX = Math.min(minX, outline[i + 4]);\n        minY = Math.min(minY, outline[i + 5]);\n        maxX = Math.max(maxX, outline[i + 4]);\n        maxY = Math.max(maxY, outline[i + 5]);\n        if (lastPointY < outline[i + 5]) {\n          lastPointX = outline[i + 4];\n          lastPointY = outline[i + 5];\n        } else if (lastPointY === outline[i + 5]) {\n          lastPointX = ltrCallback(lastPointX, outline[i + 4]);\n        }\n      } else {\n        const bbox = Util.bezierBoundingBox(\n          lastX,\n          lastY,\n          ...outline.slice(i, i + 6)\n        );\n        minX = Math.min(minX, bbox[0]);\n        minY = Math.min(minY, bbox[1]);\n        maxX = Math.max(maxX, bbox[2]);\n        maxY = Math.max(maxY, bbox[3]);\n        if (lastPointY < bbox[3]) {\n          lastPointX = bbox[2];\n          lastPointY = bbox[3];\n        } else if (lastPointY === bbox[3]) {\n          lastPointX = ltrCallback(lastPointX, bbox[2]);\n        }\n      }\n      lastX = outline[i + 4];\n      lastY = outline[i + 5];\n    }\n\n    const x = minX - this.#innerMargin,\n      y = minY - this.#innerMargin,\n      width = maxX - minX + 2 * this.#innerMargin,\n      height = maxY - minY + 2 * this.#innerMargin;\n    this.#bbox = { x, y, width, height, lastPoint: [lastPointX, lastPointY] };\n  }\n\n  get box() {\n    return this.#bbox;\n  }\n\n  getNewOutline(thickness, innerMargin) {\n    // Build the outline of the highlight to use as the focus outline.\n    const { x, y, width, height } = this.#bbox;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    const sx = width * layerWidth;\n    const sy = height * layerHeight;\n    const tx = x * layerWidth + layerX;\n    const ty = y * layerHeight + layerY;\n    const outliner = new FreeOutliner(\n      {\n        x: this.#points[0] * sx + tx,\n        y: this.#points[1] * sy + ty,\n      },\n      this.#box,\n      this.#scaleFactor,\n      thickness,\n      this.#isLTR,\n      innerMargin ?? this.#innerMargin\n    );\n    for (let i = 2; i < this.#points.length; i += 2) {\n      outliner.add({\n        x: this.#points[i] * sx + tx,\n        y: this.#points[i + 1] * sy + ty,\n      });\n    }\n    return outliner.getOutlines();\n  }\n}\n\nexport { FreeOutliner, Outliner };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorParamsType, shadow } from \"../../shared/util.js\";\nimport { KeyboardManager } from \"./tools.js\";\nimport { noContextMenu } from \"../display_utils.js\";\n\nclass ColorPicker {\n  #boundKeyDown = this.#keyDown.bind(this);\n\n  #boundPointerDown = this.#pointerDown.bind(this);\n\n  #button = null;\n\n  #buttonSwatch = null;\n\n  #defaultColor;\n\n  #dropdown = null;\n\n  #dropdownWasFromKeyboard = false;\n\n  #isMainColorPicker = false;\n\n  #editor = null;\n\n  #eventBus;\n\n  #uiManager = null;\n\n  #type;\n\n  static get _keyboardManager() {\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          [\"Escape\", \"mac+Escape\"],\n          ColorPicker.prototype._hideDropdownFromKeyboard,\n        ],\n        [[\" \", \"mac+ \"], ColorPicker.prototype._colorSelectFromKeyboard],\n        [\n          [\"ArrowDown\", \"ArrowRight\", \"mac+ArrowDown\", \"mac+ArrowRight\"],\n          ColorPicker.prototype._moveToNext,\n        ],\n        [\n          [\"ArrowUp\", \"ArrowLeft\", \"mac+ArrowUp\", \"mac+ArrowLeft\"],\n          ColorPicker.prototype._moveToPrevious,\n        ],\n        [[\"Home\", \"mac+Home\"], ColorPicker.prototype._moveToBeginning],\n        [[\"End\", \"mac+End\"], ColorPicker.prototype._moveToEnd],\n      ])\n    );\n  }\n\n  constructor({ editor = null, uiManager = null }) {\n    if (editor) {\n      this.#isMainColorPicker = false;\n      this.#type = AnnotationEditorParamsType.HIGHLIGHT_COLOR;\n      this.#editor = editor;\n    } else {\n      this.#isMainColorPicker = true;\n      this.#type = AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR;\n    }\n    this.#uiManager = editor?._uiManager || uiManager;\n    this.#eventBus = this.#uiManager._eventBus;\n    this.#defaultColor =\n      editor?.color ||\n      this.#uiManager?.highlightColors.values().next().value ||\n      \"#FFFF98\";\n  }\n\n  renderButton() {\n    const button = (this.#button = document.createElement(\"button\"));\n    button.className = \"colorPicker\";\n    button.tabIndex = \"0\";\n    button.setAttribute(\"data-l10n-id\", \"pdfjs-editor-colorpicker-button\");\n    button.setAttribute(\"aria-haspopup\", true);\n    const signal = this.#uiManager._signal;\n    button.addEventListener(\"click\", this.#openDropdown.bind(this), { signal });\n    button.addEventListener(\"keydown\", this.#boundKeyDown, { signal });\n    const swatch = (this.#buttonSwatch = document.createElement(\"span\"));\n    swatch.className = \"swatch\";\n    swatch.setAttribute(\"aria-hidden\", true);\n    swatch.style.backgroundColor = this.#defaultColor;\n    button.append(swatch);\n    return button;\n  }\n\n  renderMainDropdown() {\n    const dropdown = (this.#dropdown = this.#getDropdownRoot());\n    dropdown.setAttribute(\"aria-orientation\", \"horizontal\");\n    dropdown.setAttribute(\"aria-labelledby\", \"highlightColorPickerLabel\");\n\n    return dropdown;\n  }\n\n  #getDropdownRoot() {\n    const div = document.createElement(\"div\");\n    const signal = this.#uiManager._signal;\n    div.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    div.className = \"dropdown\";\n    div.role = \"listbox\";\n    div.setAttribute(\"aria-multiselectable\", false);\n    div.setAttribute(\"aria-orientation\", \"vertical\");\n    div.setAttribute(\"data-l10n-id\", \"pdfjs-editor-colorpicker-dropdown\");\n    for (const [name, color] of this.#uiManager.highlightColors) {\n      const button = document.createElement(\"button\");\n      button.tabIndex = \"0\";\n      button.role = \"option\";\n      button.setAttribute(\"data-color\", color);\n      button.title = name;\n      button.setAttribute(\"data-l10n-id\", `pdfjs-editor-colorpicker-${name}`);\n      const swatch = document.createElement(\"span\");\n      button.append(swatch);\n      swatch.className = \"swatch\";\n      swatch.style.backgroundColor = color;\n      button.setAttribute(\"aria-selected\", color === this.#defaultColor);\n      button.addEventListener(\"click\", this.#colorSelect.bind(this, color), {\n        signal,\n      });\n      div.append(button);\n    }\n\n    div.addEventListener(\"keydown\", this.#boundKeyDown, { signal });\n\n    return div;\n  }\n\n  #colorSelect(color, event) {\n    event.stopPropagation();\n    this.#eventBus.dispatch(\"switchannotationeditorparams\", {\n      source: this,\n      type: this.#type,\n      value: color,\n    });\n  }\n\n  _colorSelectFromKeyboard(event) {\n    if (event.target === this.#button) {\n      this.#openDropdown(event);\n      return;\n    }\n    const color = event.target.getAttribute(\"data-color\");\n    if (!color) {\n      return;\n    }\n    this.#colorSelect(color, event);\n  }\n\n  _moveToNext(event) {\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n      return;\n    }\n    if (event.target === this.#button) {\n      this.#dropdown.firstChild?.focus();\n      return;\n    }\n    event.target.nextSibling?.focus();\n  }\n\n  _moveToPrevious(event) {\n    if (\n      event.target === this.#dropdown?.firstChild ||\n      event.target === this.#button\n    ) {\n      if (this.#isDropdownVisible) {\n        this._hideDropdownFromKeyboard();\n      }\n      return;\n    }\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n    }\n    event.target.previousSibling?.focus();\n  }\n\n  _moveToBeginning(event) {\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n      return;\n    }\n    this.#dropdown.firstChild?.focus();\n  }\n\n  _moveToEnd(event) {\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n      return;\n    }\n    this.#dropdown.lastChild?.focus();\n  }\n\n  #keyDown(event) {\n    ColorPicker._keyboardManager.exec(this, event);\n  }\n\n  #openDropdown(event) {\n    if (this.#isDropdownVisible) {\n      this.hideDropdown();\n      return;\n    }\n    this.#dropdownWasFromKeyboard = event.detail === 0;\n    window.addEventListener(\"pointerdown\", this.#boundPointerDown, {\n      signal: this.#uiManager._signal,\n    });\n    if (this.#dropdown) {\n      this.#dropdown.classList.remove(\"hidden\");\n      return;\n    }\n    const root = (this.#dropdown = this.#getDropdownRoot());\n    this.#button.append(root);\n  }\n\n  #pointerDown(event) {\n    if (this.#dropdown?.contains(event.target)) {\n      return;\n    }\n    this.hideDropdown();\n  }\n\n  hideDropdown() {\n    this.#dropdown?.classList.add(\"hidden\");\n    window.removeEventListener(\"pointerdown\", this.#boundPointerDown);\n  }\n\n  get #isDropdownVisible() {\n    return this.#dropdown && !this.#dropdown.classList.contains(\"hidden\");\n  }\n\n  _hideDropdownFromKeyboard() {\n    if (this.#isMainColorPicker) {\n      return;\n    }\n    if (!this.#isDropdownVisible) {\n      // The user pressed Escape with no dropdown visible, so we must\n      // unselect it.\n      this.#editor?.unselect();\n      return;\n    }\n    this.hideDropdown();\n    this.#button.focus({\n      preventScroll: true,\n      focusVisible: this.#dropdownWasFromKeyboard,\n    });\n  }\n\n  updateColor(color) {\n    if (this.#buttonSwatch) {\n      this.#buttonSwatch.style.backgroundColor = color;\n    }\n    if (!this.#dropdown) {\n      return;\n    }\n\n    const i = this.#uiManager.highlightColors.values();\n    for (const child of this.#dropdown.children) {\n      child.setAttribute(\"aria-selected\", i.next().value === color);\n    }\n  }\n\n  destroy() {\n    this.#button?.remove();\n    this.#button = null;\n    this.#buttonSwatch = null;\n    this.#dropdown?.remove();\n    this.#dropdown = null;\n  }\n}\n\nexport { ColorPicker };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  shadow,\n  Util,\n} from \"../../shared/util.js\";\nimport { bindEvents, KeyboardManager } from \"./tools.js\";\nimport { FreeOutliner, Outliner } from \"./outliner.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { ColorPicker } from \"./color_picker.js\";\nimport { noContextMenu } from \"../display_utils.js\";\n\n/**\n * Basic draw editor in order to generate an Highlight annotation.\n */\nclass HighlightEditor extends AnnotationEditor {\n  #anchorNode = null;\n\n  #anchorOffset = 0;\n\n  #boxes;\n\n  #clipPathId = null;\n\n  #colorPicker = null;\n\n  #focusOutlines = null;\n\n  #focusNode = null;\n\n  #focusOffset = 0;\n\n  #highlightDiv = null;\n\n  #highlightOutlines = null;\n\n  #id = null;\n\n  #isFreeHighlight = false;\n\n  #boundKeydown = this.#keydown.bind(this);\n\n  #lastPoint = null;\n\n  #opacity;\n\n  #outlineId = null;\n\n  #text = \"\";\n\n  #thickness;\n\n  #methodOfCreation = \"\";\n\n  static _defaultColor = null;\n\n  static _defaultOpacity = 1;\n\n  static _defaultThickness = 12;\n\n  static _l10nPromise;\n\n  static _type = \"highlight\";\n\n  static _editorType = AnnotationEditorType.HIGHLIGHT;\n\n  static _freeHighlightId = -1;\n\n  static _freeHighlight = null;\n\n  static _freeHighlightClipId = \"\";\n\n  static get _keyboardManager() {\n    const proto = HighlightEditor.prototype;\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [[\"ArrowLeft\", \"mac+ArrowLeft\"], proto._moveCaret, { args: [0] }],\n        [[\"ArrowRight\", \"mac+ArrowRight\"], proto._moveCaret, { args: [1] }],\n        [[\"ArrowUp\", \"mac+ArrowUp\"], proto._moveCaret, { args: [2] }],\n        [[\"ArrowDown\", \"mac+ArrowDown\"], proto._moveCaret, { args: [3] }],\n      ])\n    );\n  }\n\n  constructor(params) {\n    super({ ...params, name: \"highlightEditor\" });\n    this.color = params.color || HighlightEditor._defaultColor;\n    this.#thickness = params.thickness || HighlightEditor._defaultThickness;\n    this.#opacity = params.opacity || HighlightEditor._defaultOpacity;\n    this.#boxes = params.boxes || null;\n    this.#methodOfCreation = params.methodOfCreation || \"\";\n    this.#text = params.text || \"\";\n    this._isDraggable = false;\n\n    if (params.highlightId > -1) {\n      this.#isFreeHighlight = true;\n      this.#createFreeOutlines(params);\n      this.#addToDrawLayer();\n    } else {\n      this.#anchorNode = params.anchorNode;\n      this.#anchorOffset = params.anchorOffset;\n      this.#focusNode = params.focusNode;\n      this.#focusOffset = params.focusOffset;\n      this.#createOutlines();\n      this.#addToDrawLayer();\n      this.rotate(this.rotation);\n    }\n  }\n\n  /** @inheritdoc */\n  get telemetryInitialData() {\n    return {\n      action: \"added\",\n      type: this.#isFreeHighlight ? \"free_highlight\" : \"highlight\",\n      color: this._uiManager.highlightColorNames.get(this.color),\n      thickness: this.#thickness,\n      methodOfCreation: this.#methodOfCreation,\n    };\n  }\n\n  /** @inheritdoc */\n  get telemetryFinalData() {\n    return {\n      type: \"highlight\",\n      color: this._uiManager.highlightColorNames.get(this.color),\n    };\n  }\n\n  static computeTelemetryFinalData(data) {\n    // We want to know how many colors have been used.\n    return { numberOfColors: data.get(\"color\").size };\n  }\n\n  #createOutlines() {\n    const outliner = new Outliner(this.#boxes, /* borderWidth = */ 0.001);\n    this.#highlightOutlines = outliner.getOutlines();\n    ({\n      x: this.x,\n      y: this.y,\n      width: this.width,\n      height: this.height,\n    } = this.#highlightOutlines.box);\n\n    const outlinerForOutline = new Outliner(\n      this.#boxes,\n      /* borderWidth = */ 0.0025,\n      /* innerMargin = */ 0.001,\n      this._uiManager.direction === \"ltr\"\n    );\n    this.#focusOutlines = outlinerForOutline.getOutlines();\n\n    // The last point is in the pages coordinate system.\n    const { lastPoint } = this.#focusOutlines.box;\n    this.#lastPoint = [\n      (lastPoint[0] - this.x) / this.width,\n      (lastPoint[1] - this.y) / this.height,\n    ];\n  }\n\n  #createFreeOutlines({ highlightOutlines, highlightId, clipPathId }) {\n    this.#highlightOutlines = highlightOutlines;\n    const extraThickness = 1.5;\n    this.#focusOutlines = highlightOutlines.getNewOutline(\n      /* Slightly bigger than the highlight in order to have a little\n         space between the highlight and the outline. */\n      this.#thickness / 2 + extraThickness,\n      /* innerMargin = */ 0.0025\n    );\n\n    if (highlightId >= 0) {\n      this.#id = highlightId;\n      this.#clipPathId = clipPathId;\n      // We need to redraw the highlight because we change the coordinates to be\n      // in the box coordinate system.\n      this.parent.drawLayer.finalizeLine(highlightId, highlightOutlines);\n      this.#outlineId = this.parent.drawLayer.highlightOutline(\n        this.#focusOutlines\n      );\n    } else if (this.parent) {\n      const angle = this.parent.viewport.rotation;\n      this.parent.drawLayer.updateLine(this.#id, highlightOutlines);\n      this.parent.drawLayer.updateBox(\n        this.#id,\n        HighlightEditor.#rotateBbox(\n          this.#highlightOutlines.box,\n          (angle - this.rotation + 360) % 360\n        )\n      );\n\n      this.parent.drawLayer.updateLine(this.#outlineId, this.#focusOutlines);\n      this.parent.drawLayer.updateBox(\n        this.#outlineId,\n        HighlightEditor.#rotateBbox(this.#focusOutlines.box, angle)\n      );\n    }\n    const { x, y, width, height } = highlightOutlines.box;\n    switch (this.rotation) {\n      case 0:\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n        break;\n      case 90: {\n        const [pageWidth, pageHeight] = this.parentDimensions;\n        this.x = y;\n        this.y = 1 - x;\n        this.width = (width * pageHeight) / pageWidth;\n        this.height = (height * pageWidth) / pageHeight;\n        break;\n      }\n      case 180:\n        this.x = 1 - x;\n        this.y = 1 - y;\n        this.width = width;\n        this.height = height;\n        break;\n      case 270: {\n        const [pageWidth, pageHeight] = this.parentDimensions;\n        this.x = 1 - y;\n        this.y = x;\n        this.width = (width * pageHeight) / pageWidth;\n        this.height = (height * pageWidth) / pageHeight;\n        break;\n      }\n    }\n\n    const { lastPoint } = this.#focusOutlines.box;\n    this.#lastPoint = [(lastPoint[0] - x) / width, (lastPoint[1] - y) / height];\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n    HighlightEditor._defaultColor ||=\n      uiManager.highlightColors?.values().next().value || \"#fff066\";\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:\n        HighlightEditor._defaultColor = value;\n        break;\n      case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:\n        HighlightEditor._defaultThickness = value;\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  translateInPage(x, y) {}\n\n  /** @inheritdoc */\n  get toolbarPosition() {\n    return this.#lastPoint;\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.HIGHLIGHT_COLOR:\n        this.#updateColor(value);\n        break;\n      case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:\n        this.#updateThickness(value);\n        break;\n    }\n  }\n\n  static get defaultPropertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,\n        HighlightEditor._defaultColor,\n      ],\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,\n        HighlightEditor._defaultThickness,\n      ],\n    ];\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n        this.color || HighlightEditor._defaultColor,\n      ],\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,\n        this.#thickness || HighlightEditor._defaultThickness,\n      ],\n      [AnnotationEditorParamsType.HIGHLIGHT_FREE, this.#isFreeHighlight],\n    ];\n  }\n\n  /**\n   * Update the color and make this action undoable.\n   * @param {string} color\n   */\n  #updateColor(color) {\n    const setColor = col => {\n      this.color = col;\n      this.parent?.drawLayer.changeColor(this.#id, col);\n      this.#colorPicker?.updateColor(col);\n    };\n    const savedColor = this.color;\n    this.addCommands({\n      cmd: setColor.bind(this, color),\n      undo: setColor.bind(this, savedColor),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n\n    this._reportTelemetry(\n      {\n        action: \"color_changed\",\n        color: this._uiManager.highlightColorNames.get(color),\n      },\n      /* mustWait = */ true\n    );\n  }\n\n  /**\n   * Update the thickness and make this action undoable.\n   * @param {number} thickness\n   */\n  #updateThickness(thickness) {\n    const savedThickness = this.#thickness;\n    const setThickness = th => {\n      this.#thickness = th;\n      this.#changeThickness(th);\n    };\n    this.addCommands({\n      cmd: setThickness.bind(this, thickness),\n      undo: setThickness.bind(this, savedThickness),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.INK_THICKNESS,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n    this._reportTelemetry(\n      { action: \"thickness_changed\", thickness },\n      /* mustWait = */ true\n    );\n  }\n\n  /** @inheritdoc */\n  async addEditToolbar() {\n    const toolbar = await super.addEditToolbar();\n    if (!toolbar) {\n      return null;\n    }\n    if (this._uiManager.highlightColors) {\n      this.#colorPicker = new ColorPicker({ editor: this });\n      toolbar.addColorPicker(this.#colorPicker);\n    }\n    return toolbar;\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    super.disableEditing();\n    this.div.classList.toggle(\"disabled\", true);\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    super.enableEditing();\n    this.div.classList.toggle(\"disabled\", false);\n  }\n\n  /** @inheritdoc */\n  fixAndSetPosition() {\n    return super.fixAndSetPosition(this.#getRotation());\n  }\n\n  /** @inheritdoc */\n  getBaseTranslation() {\n    // The editor itself doesn't have any CSS border (we're drawing one\n    // ourselves in using SVG).\n    return [0, 0];\n  }\n\n  /** @inheritdoc */\n  getRect(tx, ty) {\n    return super.getRect(tx, ty, this.#getRotation());\n  }\n\n  /** @inheritdoc */\n  onceAdded() {\n    this.parent.addUndoableEditor(this);\n    this.div.focus();\n  }\n\n  /** @inheritdoc */\n  remove() {\n    this.#cleanDrawLayer();\n    this._reportTelemetry({\n      action: \"deleted\",\n    });\n    super.remove();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    this.#addToDrawLayer();\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilding it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  setParent(parent) {\n    let mustBeSelected = false;\n    if (this.parent && !parent) {\n      this.#cleanDrawLayer();\n    } else if (parent) {\n      this.#addToDrawLayer(parent);\n      // If mustBeSelected is true it means that this editor was selected\n      // when its parent has been destroyed, hence we must select it again.\n      mustBeSelected =\n        !this.parent && this.div?.classList.contains(\"selectedEditor\");\n    }\n    super.setParent(parent);\n    this.show(this._isVisible);\n    if (mustBeSelected) {\n      // We select it after the parent has been set.\n      this.select();\n    }\n  }\n\n  #changeThickness(thickness) {\n    if (!this.#isFreeHighlight) {\n      return;\n    }\n    this.#createFreeOutlines({\n      highlightOutlines: this.#highlightOutlines.getNewOutline(thickness / 2),\n    });\n    this.fixAndSetPosition();\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setDims(this.width * parentWidth, this.height * parentHeight);\n  }\n\n  #cleanDrawLayer() {\n    if (this.#id === null || !this.parent) {\n      return;\n    }\n    this.parent.drawLayer.remove(this.#id);\n    this.#id = null;\n    this.parent.drawLayer.remove(this.#outlineId);\n    this.#outlineId = null;\n  }\n\n  #addToDrawLayer(parent = this.parent) {\n    if (this.#id !== null) {\n      return;\n    }\n    ({ id: this.#id, clipPathId: this.#clipPathId } =\n      parent.drawLayer.highlight(\n        this.#highlightOutlines,\n        this.color,\n        this.#opacity\n      ));\n    this.#outlineId = parent.drawLayer.highlightOutline(this.#focusOutlines);\n    if (this.#highlightDiv) {\n      this.#highlightDiv.style.clipPath = this.#clipPathId;\n    }\n  }\n\n  static #rotateBbox({ x, y, width, height }, angle) {\n    switch (angle) {\n      case 90:\n        return {\n          x: 1 - y - height,\n          y: x,\n          width: height,\n          height: width,\n        };\n      case 180:\n        return {\n          x: 1 - x - width,\n          y: 1 - y - height,\n          width,\n          height,\n        };\n      case 270:\n        return {\n          x: y,\n          y: 1 - x - width,\n          width: height,\n          height: width,\n        };\n    }\n    return {\n      x,\n      y,\n      width,\n      height,\n    };\n  }\n\n  /** @inheritdoc */\n  rotate(angle) {\n    // We need to rotate the svgs because of the coordinates system.\n    const { drawLayer } = this.parent;\n    let box;\n    if (this.#isFreeHighlight) {\n      angle = (angle - this.rotation + 360) % 360;\n      box = HighlightEditor.#rotateBbox(this.#highlightOutlines.box, angle);\n    } else {\n      // An highlight annotation is always drawn horizontally.\n      box = HighlightEditor.#rotateBbox(this, angle);\n    }\n    drawLayer.rotate(this.#id, angle);\n    drawLayer.rotate(this.#outlineId, angle);\n    drawLayer.updateBox(this.#id, box);\n    drawLayer.updateBox(\n      this.#outlineId,\n      HighlightEditor.#rotateBbox(this.#focusOutlines.box, angle)\n    );\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    const div = super.render();\n    if (this.#text) {\n      div.setAttribute(\"aria-label\", this.#text);\n      div.setAttribute(\"role\", \"mark\");\n    }\n    if (this.#isFreeHighlight) {\n      div.classList.add(\"free\");\n    } else {\n      this.div.addEventListener(\"keydown\", this.#boundKeydown, {\n        signal: this._uiManager._signal,\n      });\n    }\n    const highlightDiv = (this.#highlightDiv = document.createElement(\"div\"));\n    div.append(highlightDiv);\n    highlightDiv.setAttribute(\"aria-hidden\", \"true\");\n    highlightDiv.className = \"internal\";\n    highlightDiv.style.clipPath = this.#clipPathId;\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setDims(this.width * parentWidth, this.height * parentHeight);\n\n    bindEvents(this, this.#highlightDiv, [\"pointerover\", \"pointerleave\"]);\n    this.enableEditing();\n\n    return div;\n  }\n\n  pointerover() {\n    this.parent.drawLayer.addClass(this.#outlineId, \"hovered\");\n  }\n\n  pointerleave() {\n    this.parent.drawLayer.removeClass(this.#outlineId, \"hovered\");\n  }\n\n  #keydown(event) {\n    HighlightEditor._keyboardManager.exec(this, event);\n  }\n\n  _moveCaret(direction) {\n    this.parent.unselect(this);\n    switch (direction) {\n      case 0 /* left */:\n      case 2 /* up */:\n        this.#setCaret(/* start = */ true);\n        break;\n      case 1 /* right */:\n      case 3 /* down */:\n        this.#setCaret(/* start = */ false);\n        break;\n    }\n  }\n\n  #setCaret(start) {\n    if (!this.#anchorNode) {\n      return;\n    }\n    const selection = window.getSelection();\n    if (start) {\n      selection.setPosition(this.#anchorNode, this.#anchorOffset);\n    } else {\n      selection.setPosition(this.#focusNode, this.#focusOffset);\n    }\n  }\n\n  /** @inheritdoc */\n  select() {\n    super.select();\n    if (!this.#outlineId) {\n      return;\n    }\n    this.parent?.drawLayer.removeClass(this.#outlineId, \"hovered\");\n    this.parent?.drawLayer.addClass(this.#outlineId, \"selected\");\n  }\n\n  /** @inheritdoc */\n  unselect() {\n    super.unselect();\n    if (!this.#outlineId) {\n      return;\n    }\n    this.parent?.drawLayer.removeClass(this.#outlineId, \"selected\");\n    if (!this.#isFreeHighlight) {\n      this.#setCaret(/* start = */ false);\n    }\n  }\n\n  /** @inheritdoc */\n  get _mustFixPosition() {\n    return !this.#isFreeHighlight;\n  }\n\n  /** @inheritdoc */\n  show(visible = this._isVisible) {\n    super.show(visible);\n    if (this.parent) {\n      this.parent.drawLayer.show(this.#id, visible);\n      this.parent.drawLayer.show(this.#outlineId, visible);\n    }\n  }\n\n  #getRotation() {\n    // Highlight annotations are always drawn horizontally but if\n    // a free highlight annotation can be rotated.\n    return this.#isFreeHighlight ? this.rotation : 0;\n  }\n\n  #serializeBoxes() {\n    if (this.#isFreeHighlight) {\n      return null;\n    }\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const [pageX, pageY] = this.pageTranslation;\n    const boxes = this.#boxes;\n    const quadPoints = new Float32Array(boxes.length * 8);\n    let i = 0;\n    for (const { x, y, width, height } of boxes) {\n      const sx = x * pageWidth + pageX;\n      const sy = (1 - y - height) * pageHeight + pageY;\n      // The specifications say that the rectangle should start from the bottom\n      // left corner and go counter-clockwise.\n      // But when opening the file in Adobe Acrobat it appears that this isn't\n      // correct hence the 4th and 6th numbers are just swapped.\n      quadPoints[i] = quadPoints[i + 4] = sx;\n      quadPoints[i + 1] = quadPoints[i + 3] = sy;\n      quadPoints[i + 2] = quadPoints[i + 6] = sx + width * pageWidth;\n      quadPoints[i + 5] = quadPoints[i + 7] = sy + height * pageHeight;\n      i += 8;\n    }\n    return quadPoints;\n  }\n\n  #serializeOutlines(rect) {\n    return this.#highlightOutlines.serialize(rect, this.#getRotation());\n  }\n\n  static startHighlighting(parent, isLTR, { target: textLayer, x, y }) {\n    const {\n      x: layerX,\n      y: layerY,\n      width: parentWidth,\n      height: parentHeight,\n    } = textLayer.getBoundingClientRect();\n    const pointerMove = e => {\n      this.#highlightMove(parent, e);\n    };\n    const signal = parent._signal;\n    const pointerDownOptions = { capture: true, passive: false, signal };\n    const pointerDown = e => {\n      // Avoid to have undesired clicks during the drawing.\n      e.preventDefault();\n      e.stopPropagation();\n    };\n    const pointerUpCallback = e => {\n      textLayer.removeEventListener(\"pointermove\", pointerMove);\n      window.removeEventListener(\"blur\", pointerUpCallback);\n      window.removeEventListener(\"pointerup\", pointerUpCallback);\n      window.removeEventListener(\n        \"pointerdown\",\n        pointerDown,\n        pointerDownOptions\n      );\n      window.removeEventListener(\"contextmenu\", noContextMenu);\n      this.#endHighlight(parent, e);\n    };\n    window.addEventListener(\"blur\", pointerUpCallback, { signal });\n    window.addEventListener(\"pointerup\", pointerUpCallback, { signal });\n    window.addEventListener(\"pointerdown\", pointerDown, pointerDownOptions);\n    window.addEventListener(\"contextmenu\", noContextMenu, { signal });\n\n    textLayer.addEventListener(\"pointermove\", pointerMove, { signal });\n    this._freeHighlight = new FreeOutliner(\n      { x, y },\n      [layerX, layerY, parentWidth, parentHeight],\n      parent.scale,\n      this._defaultThickness / 2,\n      isLTR,\n      /* innerMargin = */ 0.001\n    );\n    ({ id: this._freeHighlightId, clipPathId: this._freeHighlightClipId } =\n      parent.drawLayer.highlight(\n        this._freeHighlight,\n        this._defaultColor,\n        this._defaultOpacity,\n        /* isPathUpdatable = */ true\n      ));\n  }\n\n  static #highlightMove(parent, event) {\n    if (this._freeHighlight.add(event)) {\n      // Redraw only if the point has been added.\n      parent.drawLayer.updatePath(this._freeHighlightId, this._freeHighlight);\n    }\n  }\n\n  static #endHighlight(parent, event) {\n    if (!this._freeHighlight.isEmpty()) {\n      parent.createAndAddNewEditor(event, false, {\n        highlightId: this._freeHighlightId,\n        highlightOutlines: this._freeHighlight.getOutlines(),\n        clipPathId: this._freeHighlightClipId,\n        methodOfCreation: \"main_toolbar\",\n      });\n    } else {\n      parent.drawLayer.removeFreeHighlight(this._freeHighlightId);\n    }\n    this._freeHighlightId = -1;\n    this._freeHighlight = null;\n    this._freeHighlightClipId = \"\";\n  }\n\n  /** @inheritdoc */\n  static deserialize(data, parent, uiManager) {\n    const editor = super.deserialize(data, parent, uiManager);\n\n    const {\n      rect: [blX, blY, trX, trY],\n      color,\n      quadPoints,\n    } = data;\n    editor.color = Util.makeHexColor(...color);\n    editor.#opacity = data.opacity;\n\n    const [pageWidth, pageHeight] = editor.pageDimensions;\n    editor.width = (trX - blX) / pageWidth;\n    editor.height = (trY - blY) / pageHeight;\n    const boxes = (editor.#boxes = []);\n    for (let i = 0; i < quadPoints.length; i += 8) {\n      boxes.push({\n        x: (quadPoints[4] - trX) / pageWidth,\n        y: (trY - (1 - quadPoints[i + 5])) / pageHeight,\n        width: (quadPoints[i + 2] - quadPoints[i]) / pageWidth,\n        height: (quadPoints[i + 5] - quadPoints[i + 1]) / pageHeight,\n      });\n    }\n    editor.#createOutlines();\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    // It doesn't make sense to copy/paste a highlight annotation.\n    if (this.isEmpty() || isForCopying) {\n      return null;\n    }\n\n    const rect = this.getRect(0, 0);\n    const color = AnnotationEditor._colorManager.convert(this.color);\n\n    return {\n      annotationType: AnnotationEditorType.HIGHLIGHT,\n      color,\n      opacity: this.#opacity,\n      thickness: this.#thickness,\n      quadPoints: this.#serializeBoxes(),\n      outlines: this.#serializeOutlines(rect),\n      pageIndex: this.pageIndex,\n      rect,\n      rotation: this.#getRotation(),\n      structTreeParentId: this._structTreeParentId,\n    };\n  }\n\n  static canCreateNewEmptyEditor() {\n    return false;\n  }\n}\n\nexport { HighlightEditor };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  Util,\n} from \"../../shared/util.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { InkAnnotationElement } from \"../annotation_layer.js\";\nimport { noContextMenu } from \"../display_utils.js\";\nimport { opacityToHex } from \"./tools.js\";\n\n/**\n * Basic draw editor in order to generate an Ink annotation.\n */\nclass InkEditor extends AnnotationEditor {\n  #baseHeight = 0;\n\n  #baseWidth = 0;\n\n  #boundCanvasPointermove = this.canvasPointermove.bind(this);\n\n  #boundCanvasPointerleave = this.canvasPointerleave.bind(this);\n\n  #boundCanvasPointerup = this.canvasPointerup.bind(this);\n\n  #boundCanvasPointerdown = this.canvasPointerdown.bind(this);\n\n  #canvasContextMenuTimeoutId = null;\n\n  #currentPath2D = new Path2D();\n\n  #disableEditing = false;\n\n  #hasSomethingToDraw = false;\n\n  #isCanvasInitialized = false;\n\n  #observer = null;\n\n  #realWidth = 0;\n\n  #realHeight = 0;\n\n  #requestFrameCallback = null;\n\n  static _defaultColor = null;\n\n  static _defaultOpacity = 1;\n\n  static _defaultThickness = 1;\n\n  static _type = \"ink\";\n\n  static _editorType = AnnotationEditorType.INK;\n\n  constructor(params) {\n    super({ ...params, name: \"inkEditor\" });\n    this.color = params.color || null;\n    this.thickness = params.thickness || null;\n    this.opacity = params.opacity || null;\n    this.paths = [];\n    this.bezierPath2D = [];\n    this.allRawPaths = [];\n    this.currentPath = [];\n    this.scaleFactor = 1;\n    this.translationX = this.translationY = 0;\n    this.x = 0;\n    this.y = 0;\n    this._willKeepAspectRatio = true;\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.INK_THICKNESS:\n        InkEditor._defaultThickness = value;\n        break;\n      case AnnotationEditorParamsType.INK_COLOR:\n        InkEditor._defaultColor = value;\n        break;\n      case AnnotationEditorParamsType.INK_OPACITY:\n        InkEditor._defaultOpacity = value / 100;\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.INK_THICKNESS:\n        this.#updateThickness(value);\n        break;\n      case AnnotationEditorParamsType.INK_COLOR:\n        this.#updateColor(value);\n        break;\n      case AnnotationEditorParamsType.INK_OPACITY:\n        this.#updateOpacity(value);\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  static get defaultPropertiesToUpdate() {\n    return [\n      [AnnotationEditorParamsType.INK_THICKNESS, InkEditor._defaultThickness],\n      [\n        AnnotationEditorParamsType.INK_COLOR,\n        InkEditor._defaultColor || AnnotationEditor._defaultLineColor,\n      ],\n      [\n        AnnotationEditorParamsType.INK_OPACITY,\n        Math.round(InkEditor._defaultOpacity * 100),\n      ],\n    ];\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.INK_THICKNESS,\n        this.thickness || InkEditor._defaultThickness,\n      ],\n      [\n        AnnotationEditorParamsType.INK_COLOR,\n        this.color ||\n          InkEditor._defaultColor ||\n          AnnotationEditor._defaultLineColor,\n      ],\n      [\n        AnnotationEditorParamsType.INK_OPACITY,\n        Math.round(100 * (this.opacity ?? InkEditor._defaultOpacity)),\n      ],\n    ];\n  }\n\n  /**\n   * Update the thickness and make this action undoable.\n   * @param {number} thickness\n   */\n  #updateThickness(thickness) {\n    const setThickness = th => {\n      this.thickness = th;\n      this.#fitToContent();\n    };\n    const savedThickness = this.thickness;\n    this.addCommands({\n      cmd: setThickness.bind(this, thickness),\n      undo: setThickness.bind(this, savedThickness),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.INK_THICKNESS,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /**\n   * Update the color and make this action undoable.\n   * @param {string} color\n   */\n  #updateColor(color) {\n    const setColor = col => {\n      this.color = col;\n      this.#redraw();\n    };\n    const savedColor = this.color;\n    this.addCommands({\n      cmd: setColor.bind(this, color),\n      undo: setColor.bind(this, savedColor),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.INK_COLOR,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /**\n   * Update the opacity and make this action undoable.\n   * @param {number} opacity\n   */\n  #updateOpacity(opacity) {\n    const setOpacity = op => {\n      this.opacity = op;\n      this.#redraw();\n    };\n    opacity /= 100;\n    const savedOpacity = this.opacity;\n    this.addCommands({\n      cmd: setOpacity.bind(this, opacity),\n      undo: setOpacity.bind(this, savedOpacity),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.INK_OPACITY,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    if (!this.canvas) {\n      this.#createCanvas();\n      this.#createObserver();\n    }\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilding it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n      this.#setCanvasDims();\n    }\n    this.#fitToContent();\n  }\n\n  /** @inheritdoc */\n  remove() {\n    if (this.canvas === null) {\n      return;\n    }\n\n    if (!this.isEmpty()) {\n      this.commit();\n    }\n\n    // Destroy the canvas.\n    this.canvas.width = this.canvas.height = 0;\n    this.canvas.remove();\n    this.canvas = null;\n\n    if (this.#canvasContextMenuTimeoutId) {\n      clearTimeout(this.#canvasContextMenuTimeoutId);\n      this.#canvasContextMenuTimeoutId = null;\n    }\n\n    this.#observer?.disconnect();\n    this.#observer = null;\n\n    super.remove();\n  }\n\n  setParent(parent) {\n    if (!this.parent && parent) {\n      // We've a parent hence the rescale will be handled thanks to the\n      // ResizeObserver.\n      this._uiManager.removeShouldRescale(this);\n    } else if (this.parent && parent === null) {\n      // The editor is removed from the DOM, hence we handle the rescale thanks\n      // to the onScaleChanging callback.\n      // This way, it'll be saved/printed correctly.\n      this._uiManager.addShouldRescale(this);\n    }\n    super.setParent(parent);\n  }\n\n  onScaleChanging() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const width = this.width * parentWidth;\n    const height = this.height * parentHeight;\n    this.setDimensions(width, height);\n  }\n\n  /** @inheritdoc */\n  enableEditMode() {\n    if (this.#disableEditing || this.canvas === null) {\n      return;\n    }\n\n    super.enableEditMode();\n    this._isDraggable = false;\n    this.canvas.addEventListener(\"pointerdown\", this.#boundCanvasPointerdown, {\n      signal: this._uiManager._signal,\n    });\n  }\n\n  /** @inheritdoc */\n  disableEditMode() {\n    if (!this.isInEditMode() || this.canvas === null) {\n      return;\n    }\n\n    super.disableEditMode();\n    this._isDraggable = !this.isEmpty();\n    this.div.classList.remove(\"editing\");\n\n    this.canvas.removeEventListener(\n      \"pointerdown\",\n      this.#boundCanvasPointerdown\n    );\n  }\n\n  /** @inheritdoc */\n  onceAdded() {\n    this._isDraggable = !this.isEmpty();\n  }\n\n  /** @inheritdoc */\n  isEmpty() {\n    return (\n      this.paths.length === 0 ||\n      (this.paths.length === 1 && this.paths[0].length === 0)\n    );\n  }\n\n  #getInitialBBox() {\n    const {\n      parentRotation,\n      parentDimensions: [width, height],\n    } = this;\n    switch (parentRotation) {\n      case 90:\n        return [0, height, height, width];\n      case 180:\n        return [width, height, width, height];\n      case 270:\n        return [width, 0, height, width];\n      default:\n        return [0, 0, width, height];\n    }\n  }\n\n  /**\n   * Set line styles.\n   */\n  #setStroke() {\n    const { ctx, color, opacity, thickness, parentScale, scaleFactor } = this;\n    ctx.lineWidth = (thickness * parentScale) / scaleFactor;\n    ctx.lineCap = \"round\";\n    ctx.lineJoin = \"round\";\n    ctx.miterLimit = 10;\n    ctx.strokeStyle = `${color}${opacityToHex(opacity)}`;\n  }\n\n  /**\n   * Start to draw on the canvas.\n   * @param {number} x\n   * @param {number} y\n   */\n  #startDrawing(x, y) {\n    const signal = this._uiManager._signal;\n    this.canvas.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    this.canvas.addEventListener(\n      \"pointerleave\",\n      this.#boundCanvasPointerleave,\n      { signal }\n    );\n    this.canvas.addEventListener(\"pointermove\", this.#boundCanvasPointermove, {\n      signal,\n    });\n    this.canvas.addEventListener(\"pointerup\", this.#boundCanvasPointerup, {\n      signal,\n    });\n    this.canvas.removeEventListener(\n      \"pointerdown\",\n      this.#boundCanvasPointerdown\n    );\n\n    this.isEditing = true;\n    if (!this.#isCanvasInitialized) {\n      this.#isCanvasInitialized = true;\n      this.#setCanvasDims();\n      this.thickness ||= InkEditor._defaultThickness;\n      this.color ||=\n        InkEditor._defaultColor || AnnotationEditor._defaultLineColor;\n      this.opacity ??= InkEditor._defaultOpacity;\n    }\n    this.currentPath.push([x, y]);\n    this.#hasSomethingToDraw = false;\n    this.#setStroke();\n\n    this.#requestFrameCallback = () => {\n      this.#drawPoints();\n      if (this.#requestFrameCallback) {\n        window.requestAnimationFrame(this.#requestFrameCallback);\n      }\n    };\n    window.requestAnimationFrame(this.#requestFrameCallback);\n  }\n\n  /**\n   * Draw on the canvas.\n   * @param {number} x\n   * @param {number} y\n   */\n  #draw(x, y) {\n    const [lastX, lastY] = this.currentPath.at(-1);\n    if (this.currentPath.length > 1 && x === lastX && y === lastY) {\n      return;\n    }\n    const currentPath = this.currentPath;\n    let path2D = this.#currentPath2D;\n    currentPath.push([x, y]);\n    this.#hasSomethingToDraw = true;\n\n    if (currentPath.length <= 2) {\n      path2D.moveTo(...currentPath[0]);\n      path2D.lineTo(x, y);\n      return;\n    }\n\n    if (currentPath.length === 3) {\n      this.#currentPath2D = path2D = new Path2D();\n      path2D.moveTo(...currentPath[0]);\n    }\n\n    this.#makeBezierCurve(\n      path2D,\n      ...currentPath.at(-3),\n      ...currentPath.at(-2),\n      x,\n      y\n    );\n  }\n\n  #endPath() {\n    if (this.currentPath.length === 0) {\n      return;\n    }\n    const lastPoint = this.currentPath.at(-1);\n    this.#currentPath2D.lineTo(...lastPoint);\n  }\n\n  /**\n   * Stop to draw on the canvas.\n   * @param {number} x\n   * @param {number} y\n   */\n  #stopDrawing(x, y) {\n    this.#requestFrameCallback = null;\n\n    x = Math.min(Math.max(x, 0), this.canvas.width);\n    y = Math.min(Math.max(y, 0), this.canvas.height);\n\n    this.#draw(x, y);\n    this.#endPath();\n\n    // Interpolate the path entered by the user with some\n    // Bezier's curves in order to have a smoother path and\n    // to reduce the data size used to draw it in the PDF.\n    let bezier;\n    if (this.currentPath.length !== 1) {\n      bezier = this.#generateBezierPoints();\n    } else {\n      // We have only one point finally.\n      const xy = [x, y];\n      bezier = [[xy, xy.slice(), xy.slice(), xy]];\n    }\n    const path2D = this.#currentPath2D;\n    const currentPath = this.currentPath;\n    this.currentPath = [];\n    this.#currentPath2D = new Path2D();\n\n    const cmd = () => {\n      this.allRawPaths.push(currentPath);\n      this.paths.push(bezier);\n      this.bezierPath2D.push(path2D);\n      this._uiManager.rebuild(this);\n    };\n\n    const undo = () => {\n      this.allRawPaths.pop();\n      this.paths.pop();\n      this.bezierPath2D.pop();\n      if (this.paths.length === 0) {\n        this.remove();\n      } else {\n        if (!this.canvas) {\n          this.#createCanvas();\n          this.#createObserver();\n        }\n        this.#fitToContent();\n      }\n    };\n\n    this.addCommands({ cmd, undo, mustExec: true });\n  }\n\n  #drawPoints() {\n    if (!this.#hasSomethingToDraw) {\n      return;\n    }\n    this.#hasSomethingToDraw = false;\n\n    const thickness = Math.ceil(this.thickness * this.parentScale);\n    const lastPoints = this.currentPath.slice(-3);\n    const x = lastPoints.map(xy => xy[0]);\n    const y = lastPoints.map(xy => xy[1]);\n    const xMin = Math.min(...x) - thickness;\n    const xMax = Math.max(...x) + thickness;\n    const yMin = Math.min(...y) - thickness;\n    const yMax = Math.max(...y) + thickness;\n\n    const { ctx } = this;\n    ctx.save();\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      // In Chrome, the clip() method doesn't work as expected.\n      ctx.clearRect(xMin, yMin, xMax - xMin, yMax - yMin);\n      ctx.beginPath();\n      ctx.rect(xMin, yMin, xMax - xMin, yMax - yMin);\n      ctx.clip();\n    } else {\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    for (const path of this.bezierPath2D) {\n      ctx.stroke(path);\n    }\n    ctx.stroke(this.#currentPath2D);\n\n    ctx.restore();\n  }\n\n  #makeBezierCurve(path2D, x0, y0, x1, y1, x2, y2) {\n    const prevX = (x0 + x1) / 2;\n    const prevY = (y0 + y1) / 2;\n    const x3 = (x1 + x2) / 2;\n    const y3 = (y1 + y2) / 2;\n\n    path2D.bezierCurveTo(\n      prevX + (2 * (x1 - prevX)) / 3,\n      prevY + (2 * (y1 - prevY)) / 3,\n      x3 + (2 * (x1 - x3)) / 3,\n      y3 + (2 * (y1 - y3)) / 3,\n      x3,\n      y3\n    );\n  }\n\n  #generateBezierPoints() {\n    const path = this.currentPath;\n    if (path.length <= 2) {\n      return [[path[0], path[0], path.at(-1), path.at(-1)]];\n    }\n\n    const bezierPoints = [];\n    let i;\n    let [x0, y0] = path[0];\n    for (i = 1; i < path.length - 2; i++) {\n      const [x1, y1] = path[i];\n      const [x2, y2] = path[i + 1];\n      const x3 = (x1 + x2) / 2;\n      const y3 = (y1 + y2) / 2;\n\n      // The quadratic is: [[x0, y0], [x1, y1], [x3, y3]].\n      // Convert the quadratic to a cubic\n      // (see https://fontforge.org/docs/techref/bezier.html#converting-truetype-to-postscript)\n      const control1 = [x0 + (2 * (x1 - x0)) / 3, y0 + (2 * (y1 - y0)) / 3];\n      const control2 = [x3 + (2 * (x1 - x3)) / 3, y3 + (2 * (y1 - y3)) / 3];\n\n      bezierPoints.push([[x0, y0], control1, control2, [x3, y3]]);\n\n      [x0, y0] = [x3, y3];\n    }\n\n    const [x1, y1] = path[i];\n    const [x2, y2] = path[i + 1];\n\n    // The quadratic is: [[x0, y0], [x1, y1], [x2, y2]].\n    const control1 = [x0 + (2 * (x1 - x0)) / 3, y0 + (2 * (y1 - y0)) / 3];\n    const control2 = [x2 + (2 * (x1 - x2)) / 3, y2 + (2 * (y1 - y2)) / 3];\n\n    bezierPoints.push([[x0, y0], control1, control2, [x2, y2]]);\n    return bezierPoints;\n  }\n\n  /**\n   * Redraw all the paths.\n   */\n  #redraw() {\n    if (this.isEmpty()) {\n      this.#updateTransform();\n      return;\n    }\n    this.#setStroke();\n\n    const { canvas, ctx } = this;\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    this.#updateTransform();\n\n    for (const path of this.bezierPath2D) {\n      ctx.stroke(path);\n    }\n  }\n\n  /**\n   * Commit the curves we have in this editor.\n   */\n  commit() {\n    if (this.#disableEditing) {\n      return;\n    }\n\n    super.commit();\n\n    this.isEditing = false;\n    this.disableEditMode();\n\n    // This editor must be on top of the main ink editor.\n    this.setInForeground();\n\n    this.#disableEditing = true;\n    this.div.classList.add(\"disabled\");\n\n    this.#fitToContent(/* firstTime = */ true);\n    this.select();\n\n    this.parent.addInkEditorIfNeeded(/* isCommitting = */ true);\n\n    // When committing, the position of this editor is changed, hence we must\n    // move it to the right position in the DOM.\n    this.moveInDOM();\n    this.div.focus({\n      preventScroll: true /* See issue #15744 */,\n    });\n  }\n\n  /** @inheritdoc */\n  focusin(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n    super.focusin(event);\n    this.enableEditMode();\n  }\n\n  /**\n   * onpointerdown callback for the canvas we're drawing on.\n   * @param {PointerEvent} event\n   */\n  canvasPointerdown(event) {\n    if (event.button !== 0 || !this.isInEditMode() || this.#disableEditing) {\n      return;\n    }\n\n    // We want to draw on top of any other editors.\n    // Since it's the last child, there's no need to give it a higher z-index.\n    this.setInForeground();\n\n    event.preventDefault();\n\n    if (!this.div.contains(document.activeElement)) {\n      this.div.focus({\n        preventScroll: true /* See issue #17327 */,\n      });\n    }\n\n    this.#startDrawing(event.offsetX, event.offsetY);\n  }\n\n  /**\n   * onpointermove callback for the canvas we're drawing on.\n   * @param {PointerEvent} event\n   */\n  canvasPointermove(event) {\n    event.preventDefault();\n    this.#draw(event.offsetX, event.offsetY);\n  }\n\n  /**\n   * onpointerup callback for the canvas we're drawing on.\n   * @param {PointerEvent} event\n   */\n  canvasPointerup(event) {\n    event.preventDefault();\n    this.#endDrawing(event);\n  }\n\n  /**\n   * onpointerleave callback for the canvas we're drawing on.\n   * @param {PointerEvent} event\n   */\n  canvasPointerleave(event) {\n    this.#endDrawing(event);\n  }\n\n  /**\n   * End the drawing.\n   * @param {PointerEvent} event\n   */\n  #endDrawing(event) {\n    this.canvas.removeEventListener(\n      \"pointerleave\",\n      this.#boundCanvasPointerleave\n    );\n    this.canvas.removeEventListener(\n      \"pointermove\",\n      this.#boundCanvasPointermove\n    );\n    this.canvas.removeEventListener(\"pointerup\", this.#boundCanvasPointerup);\n    this.canvas.addEventListener(\"pointerdown\", this.#boundCanvasPointerdown, {\n      signal: this._uiManager._signal,\n    });\n\n    // Slight delay to avoid the context menu to appear (it can happen on a long\n    // tap with a pen).\n    if (this.#canvasContextMenuTimeoutId) {\n      clearTimeout(this.#canvasContextMenuTimeoutId);\n    }\n    this.#canvasContextMenuTimeoutId = setTimeout(() => {\n      this.#canvasContextMenuTimeoutId = null;\n      this.canvas.removeEventListener(\"contextmenu\", noContextMenu);\n    }, 10);\n\n    this.#stopDrawing(event.offsetX, event.offsetY);\n\n    this.addToAnnotationStorage();\n\n    // Since the ink editor covers all of the page and we want to be able\n    // to select another editor, we just put this one in the background.\n    this.setInBackground();\n  }\n\n  /**\n   * Create the canvas element.\n   */\n  #createCanvas() {\n    this.canvas = document.createElement(\"canvas\");\n    this.canvas.width = this.canvas.height = 0;\n    this.canvas.className = \"inkEditorCanvas\";\n    this.canvas.setAttribute(\"data-l10n-id\", \"pdfjs-ink-canvas\");\n\n    this.div.append(this.canvas);\n    this.ctx = this.canvas.getContext(\"2d\");\n  }\n\n  /**\n   * Create the resize observer.\n   */\n  #createObserver() {\n    this.#observer = new ResizeObserver(entries => {\n      const rect = entries[0].contentRect;\n      if (rect.width && rect.height) {\n        this.setDimensions(rect.width, rect.height);\n      }\n    });\n    this.#observer.observe(this.div);\n    this._uiManager._signal.addEventListener(\n      \"abort\",\n      () => {\n        this.#observer?.disconnect();\n        this.#observer = null;\n      },\n      { once: true }\n    );\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return !this.isEmpty() && this.#disableEditing;\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this.width) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n\n    this.div.setAttribute(\"data-l10n-id\", \"pdfjs-ink\");\n\n    const [x, y, w, h] = this.#getInitialBBox();\n    this.setAt(x, y, 0, 0);\n    this.setDims(w, h);\n\n    this.#createCanvas();\n\n    if (this.width) {\n      // This editor was created in using copy (ctrl+c).\n      const [parentWidth, parentHeight] = this.parentDimensions;\n      this.setAspectRatio(this.width * parentWidth, this.height * parentHeight);\n      this.setAt(\n        baseX * parentWidth,\n        baseY * parentHeight,\n        this.width * parentWidth,\n        this.height * parentHeight\n      );\n      this.#isCanvasInitialized = true;\n      this.#setCanvasDims();\n      this.setDims(this.width * parentWidth, this.height * parentHeight);\n      this.#redraw();\n      this.div.classList.add(\"disabled\");\n    } else {\n      this.div.classList.add(\"editing\");\n      this.enableEditMode();\n    }\n\n    this.#createObserver();\n\n    return this.div;\n  }\n\n  #setCanvasDims() {\n    if (!this.#isCanvasInitialized) {\n      return;\n    }\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.canvas.width = Math.ceil(this.width * parentWidth);\n    this.canvas.height = Math.ceil(this.height * parentHeight);\n    this.#updateTransform();\n  }\n\n  /**\n   * When the dimensions of the div change the inner canvas must\n   * renew its dimensions, hence it must redraw its own contents.\n   * @param {number} width - the new width of the div\n   * @param {number} height - the new height of the div\n   * @returns\n   */\n  setDimensions(width, height) {\n    const roundedWidth = Math.round(width);\n    const roundedHeight = Math.round(height);\n    if (\n      this.#realWidth === roundedWidth &&\n      this.#realHeight === roundedHeight\n    ) {\n      return;\n    }\n\n    this.#realWidth = roundedWidth;\n    this.#realHeight = roundedHeight;\n\n    this.canvas.style.visibility = \"hidden\";\n\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.width = width / parentWidth;\n    this.height = height / parentHeight;\n    this.fixAndSetPosition();\n\n    if (this.#disableEditing) {\n      this.#setScaleFactor(width, height);\n    }\n\n    this.#setCanvasDims();\n    this.#redraw();\n\n    this.canvas.style.visibility = \"visible\";\n\n    // For any reason the dimensions couldn't be in percent but in pixels, hence\n    // we must fix them.\n    this.fixDims();\n  }\n\n  #setScaleFactor(width, height) {\n    const padding = this.#getPadding();\n    const scaleFactorW = (width - padding) / this.#baseWidth;\n    const scaleFactorH = (height - padding) / this.#baseHeight;\n    this.scaleFactor = Math.min(scaleFactorW, scaleFactorH);\n  }\n\n  /**\n   * Update the canvas transform.\n   */\n  #updateTransform() {\n    const padding = this.#getPadding() / 2;\n    this.ctx.setTransform(\n      this.scaleFactor,\n      0,\n      0,\n      this.scaleFactor,\n      this.translationX * this.scaleFactor + padding,\n      this.translationY * this.scaleFactor + padding\n    );\n  }\n\n  /**\n   * Convert into a Path2D.\n   * @param {Array<Array<number>>} bezier\n   * @returns {Path2D}\n   */\n  static #buildPath2D(bezier) {\n    const path2D = new Path2D();\n    for (let i = 0, ii = bezier.length; i < ii; i++) {\n      const [first, control1, control2, second] = bezier[i];\n      if (i === 0) {\n        path2D.moveTo(...first);\n      }\n      path2D.bezierCurveTo(\n        control1[0],\n        control1[1],\n        control2[0],\n        control2[1],\n        second[0],\n        second[1]\n      );\n    }\n    return path2D;\n  }\n\n  static #toPDFCoordinates(points, rect, rotation) {\n    const [blX, blY, trX, trY] = rect;\n\n    switch (rotation) {\n      case 0:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          points[i] += blX;\n          points[i + 1] = trY - points[i + 1];\n        }\n        break;\n      case 90:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          const x = points[i];\n          points[i] = points[i + 1] + blX;\n          points[i + 1] = x + blY;\n        }\n        break;\n      case 180:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          points[i] = trX - points[i];\n          points[i + 1] += blY;\n        }\n        break;\n      case 270:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          const x = points[i];\n          points[i] = trX - points[i + 1];\n          points[i + 1] = trY - x;\n        }\n        break;\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n    return points;\n  }\n\n  static #fromPDFCoordinates(points, rect, rotation) {\n    const [blX, blY, trX, trY] = rect;\n\n    switch (rotation) {\n      case 0:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          points[i] -= blX;\n          points[i + 1] = trY - points[i + 1];\n        }\n        break;\n      case 90:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          const x = points[i];\n          points[i] = points[i + 1] - blY;\n          points[i + 1] = x - blX;\n        }\n        break;\n      case 180:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          points[i] = trX - points[i];\n          points[i + 1] -= blY;\n        }\n        break;\n      case 270:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          const x = points[i];\n          points[i] = trY - points[i + 1];\n          points[i + 1] = trX - x;\n        }\n        break;\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n    return points;\n  }\n\n  /**\n   * Transform and serialize the paths.\n   * @param {number} s - scale factor\n   * @param {number} tx - abscissa of the translation\n   * @param {number} ty - ordinate of the translation\n   * @param {Array<number>} rect - the bounding box of the annotation\n   */\n  #serializePaths(s, tx, ty, rect) {\n    const paths = [];\n    const padding = this.thickness / 2;\n    const shiftX = s * tx + padding;\n    const shiftY = s * ty + padding;\n    for (const bezier of this.paths) {\n      const buffer = [];\n      const points = [];\n      for (let j = 0, jj = bezier.length; j < jj; j++) {\n        const [first, control1, control2, second] = bezier[j];\n        if (first[0] === second[0] && first[1] === second[1] && jj === 1) {\n          // We have only one point.\n          const p0 = s * first[0] + shiftX;\n          const p1 = s * first[1] + shiftY;\n          buffer.push(p0, p1);\n          points.push(p0, p1);\n          break;\n        }\n        const p10 = s * first[0] + shiftX;\n        const p11 = s * first[1] + shiftY;\n        const p20 = s * control1[0] + shiftX;\n        const p21 = s * control1[1] + shiftY;\n        const p30 = s * control2[0] + shiftX;\n        const p31 = s * control2[1] + shiftY;\n        const p40 = s * second[0] + shiftX;\n        const p41 = s * second[1] + shiftY;\n\n        if (j === 0) {\n          buffer.push(p10, p11);\n          points.push(p10, p11);\n        }\n        buffer.push(p20, p21, p30, p31, p40, p41);\n        points.push(p20, p21);\n        if (j === jj - 1) {\n          points.push(p40, p41);\n        }\n      }\n      paths.push({\n        bezier: InkEditor.#toPDFCoordinates(buffer, rect, this.rotation),\n        points: InkEditor.#toPDFCoordinates(points, rect, this.rotation),\n      });\n    }\n\n    return paths;\n  }\n\n  /**\n   * Get the bounding box containing all the paths.\n   * @returns {Array<number>}\n   */\n  #getBbox() {\n    let xMin = Infinity;\n    let xMax = -Infinity;\n    let yMin = Infinity;\n    let yMax = -Infinity;\n\n    for (const path of this.paths) {\n      for (const [first, control1, control2, second] of path) {\n        const bbox = Util.bezierBoundingBox(\n          ...first,\n          ...control1,\n          ...control2,\n          ...second\n        );\n        xMin = Math.min(xMin, bbox[0]);\n        yMin = Math.min(yMin, bbox[1]);\n        xMax = Math.max(xMax, bbox[2]);\n        yMax = Math.max(yMax, bbox[3]);\n      }\n    }\n\n    return [xMin, yMin, xMax, yMax];\n  }\n\n  /**\n   * The bounding box is computed with null thickness, so we must take\n   * it into account for the display.\n   * It corresponds to the total padding, hence it should be divided by 2\n   * in order to have left/right paddings.\n   * @returns {number}\n   */\n  #getPadding() {\n    return this.#disableEditing\n      ? Math.ceil(this.thickness * this.parentScale)\n      : 0;\n  }\n\n  /**\n   * Set the div position and dimensions in order to fit to\n   * the bounding box of the contents.\n   * @returns {undefined}\n   */\n  #fitToContent(firstTime = false) {\n    if (this.isEmpty()) {\n      return;\n    }\n\n    if (!this.#disableEditing) {\n      this.#redraw();\n      return;\n    }\n\n    const bbox = this.#getBbox();\n    const padding = this.#getPadding();\n    this.#baseWidth = Math.max(AnnotationEditor.MIN_SIZE, bbox[2] - bbox[0]);\n    this.#baseHeight = Math.max(AnnotationEditor.MIN_SIZE, bbox[3] - bbox[1]);\n\n    const width = Math.ceil(padding + this.#baseWidth * this.scaleFactor);\n    const height = Math.ceil(padding + this.#baseHeight * this.scaleFactor);\n\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.width = width / parentWidth;\n    this.height = height / parentHeight;\n\n    this.setAspectRatio(width, height);\n\n    const prevTranslationX = this.translationX;\n    const prevTranslationY = this.translationY;\n\n    this.translationX = -bbox[0];\n    this.translationY = -bbox[1];\n    this.#setCanvasDims();\n    this.#redraw();\n\n    this.#realWidth = width;\n    this.#realHeight = height;\n\n    this.setDims(width, height);\n    const unscaledPadding = firstTime ? padding / this.scaleFactor / 2 : 0;\n    this.translate(\n      prevTranslationX - this.translationX - unscaledPadding,\n      prevTranslationY - this.translationY - unscaledPadding\n    );\n  }\n\n  /** @inheritdoc */\n  static deserialize(data, parent, uiManager) {\n    if (data instanceof InkAnnotationElement) {\n      return null;\n    }\n    const editor = super.deserialize(data, parent, uiManager);\n\n    editor.thickness = data.thickness;\n    editor.color = Util.makeHexColor(...data.color);\n    editor.opacity = data.opacity;\n\n    const [pageWidth, pageHeight] = editor.pageDimensions;\n    const width = editor.width * pageWidth;\n    const height = editor.height * pageHeight;\n    const scaleFactor = editor.parentScale;\n    const padding = data.thickness / 2;\n\n    editor.#disableEditing = true;\n    editor.#realWidth = Math.round(width);\n    editor.#realHeight = Math.round(height);\n\n    const { paths, rect, rotation } = data;\n\n    for (let { bezier } of paths) {\n      bezier = InkEditor.#fromPDFCoordinates(bezier, rect, rotation);\n      const path = [];\n      editor.paths.push(path);\n      let p0 = scaleFactor * (bezier[0] - padding);\n      let p1 = scaleFactor * (bezier[1] - padding);\n      for (let i = 2, ii = bezier.length; i < ii; i += 6) {\n        const p10 = scaleFactor * (bezier[i] - padding);\n        const p11 = scaleFactor * (bezier[i + 1] - padding);\n        const p20 = scaleFactor * (bezier[i + 2] - padding);\n        const p21 = scaleFactor * (bezier[i + 3] - padding);\n        const p30 = scaleFactor * (bezier[i + 4] - padding);\n        const p31 = scaleFactor * (bezier[i + 5] - padding);\n        path.push([\n          [p0, p1],\n          [p10, p11],\n          [p20, p21],\n          [p30, p31],\n        ]);\n        p0 = p30;\n        p1 = p31;\n      }\n      const path2D = this.#buildPath2D(path);\n      editor.bezierPath2D.push(path2D);\n    }\n\n    const bbox = editor.#getBbox();\n    editor.#baseWidth = Math.max(AnnotationEditor.MIN_SIZE, bbox[2] - bbox[0]);\n    editor.#baseHeight = Math.max(AnnotationEditor.MIN_SIZE, bbox[3] - bbox[1]);\n    editor.#setScaleFactor(width, height);\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize() {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    const rect = this.getRect(0, 0);\n    const color = AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);\n\n    return {\n      annotationType: AnnotationEditorType.INK,\n      color,\n      thickness: this.thickness,\n      opacity: this.opacity,\n      paths: this.#serializePaths(\n        this.scaleFactor / this.parentScale,\n        this.translationX,\n        this.translationY,\n        rect\n      ),\n      pageIndex: this.pageIndex,\n      rect,\n      rotation: this.rotation,\n      structTreeParentId: this._structTreeParentId,\n    };\n  }\n}\n\nexport { InkEditor };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorType, shadow } from \"../../shared/util.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { PixelsPerInch } from \"../display_utils.js\";\nimport { StampAnnotationElement } from \"../annotation_layer.js\";\n\n/**\n * Basic text editor in order to create a FreeTex annotation.\n */\nclass StampEditor extends AnnotationEditor {\n  #bitmap = null;\n\n  #bitmapId = null;\n\n  #bitmapPromise = null;\n\n  #bitmapUrl = null;\n\n  #bitmapFile = null;\n\n  #bitmapFileName = \"\";\n\n  #canvas = null;\n\n  #hasMLBeenQueried = false;\n\n  #observer = null;\n\n  #resizeTimeoutId = null;\n\n  #isSvg = false;\n\n  #hasBeenAddedInUndoStack = false;\n\n  static _type = \"stamp\";\n\n  static _editorType = AnnotationEditorType.STAMP;\n\n  constructor(params) {\n    super({ ...params, name: \"stampEditor\" });\n    this.#bitmapUrl = params.bitmapUrl;\n    this.#bitmapFile = params.bitmapFile;\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n  }\n\n  static get supportedTypes() {\n    // See https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Image_types\n    // to know which types are supported by the browser.\n    const types = [\n      \"apng\",\n      \"avif\",\n      \"bmp\",\n      \"gif\",\n      \"jpeg\",\n      \"png\",\n      \"svg+xml\",\n      \"webp\",\n      \"x-icon\",\n    ];\n    return shadow(\n      this,\n      \"supportedTypes\",\n      types.map(type => `image/${type}`)\n    );\n  }\n\n  static get supportedTypesStr() {\n    return shadow(this, \"supportedTypesStr\", this.supportedTypes.join(\",\"));\n  }\n\n  /** @inheritdoc */\n  static isHandlingMimeForPasting(mime) {\n    return this.supportedTypes.includes(mime);\n  }\n\n  /** @inheritdoc */\n  static paste(item, parent) {\n    parent.pasteEditor(AnnotationEditorType.STAMP, {\n      bitmapFile: item.getAsFile(),\n    });\n  }\n\n  #getBitmapFetched(data, fromId = false) {\n    if (!data) {\n      this.remove();\n      return;\n    }\n    this.#bitmap = data.bitmap;\n    if (!fromId) {\n      this.#bitmapId = data.id;\n      this.#isSvg = data.isSvg;\n    }\n    if (data.file) {\n      this.#bitmapFileName = data.file.name;\n    }\n    this.#createCanvas();\n  }\n\n  #getBitmapDone() {\n    this.#bitmapPromise = null;\n    this._uiManager.enableWaiting(false);\n    if (this.#canvas) {\n      this.div.focus();\n    }\n  }\n\n  #getBitmap() {\n    if (this.#bitmapId) {\n      this._uiManager.enableWaiting(true);\n      this._uiManager.imageManager\n        .getFromId(this.#bitmapId)\n        .then(data => this.#getBitmapFetched(data, /* fromId = */ true))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    if (this.#bitmapUrl) {\n      const url = this.#bitmapUrl;\n      this.#bitmapUrl = null;\n      this._uiManager.enableWaiting(true);\n      this.#bitmapPromise = this._uiManager.imageManager\n        .getFromUrl(url)\n        .then(data => this.#getBitmapFetched(data))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    if (this.#bitmapFile) {\n      const file = this.#bitmapFile;\n      this.#bitmapFile = null;\n      this._uiManager.enableWaiting(true);\n      this.#bitmapPromise = this._uiManager.imageManager\n        .getFromFile(file)\n        .then(data => this.#getBitmapFetched(data))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    const input = document.createElement(\"input\");\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      input.hidden = true;\n      input.id = \"stampEditorFileInput\";\n      document.body.append(input);\n    }\n    input.type = \"file\";\n    input.accept = StampEditor.supportedTypesStr;\n    const signal = this._uiManager._signal;\n    this.#bitmapPromise = new Promise(resolve => {\n      input.addEventListener(\n        \"change\",\n        async () => {\n          if (!input.files || input.files.length === 0) {\n            this.remove();\n          } else {\n            this._uiManager.enableWaiting(true);\n            const data = await this._uiManager.imageManager.getFromFile(\n              input.files[0]\n            );\n            this.#getBitmapFetched(data);\n          }\n          if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n            input.remove();\n          }\n          resolve();\n        },\n        { signal }\n      );\n      input.addEventListener(\n        \"cancel\",\n        () => {\n          this.remove();\n          resolve();\n        },\n        { signal }\n      );\n    }).finally(() => this.#getBitmapDone());\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"TESTING\")) {\n      input.click();\n    }\n  }\n\n  /** @inheritdoc */\n  remove() {\n    if (this.#bitmapId) {\n      this.#bitmap = null;\n      this._uiManager.imageManager.deleteId(this.#bitmapId);\n      this.#canvas?.remove();\n      this.#canvas = null;\n      this.#observer?.disconnect();\n      this.#observer = null;\n      if (this.#resizeTimeoutId) {\n        clearTimeout(this.#resizeTimeoutId);\n        this.#resizeTimeoutId = null;\n      }\n    }\n    super.remove();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      // It's possible to have to rebuild an editor which is not on a visible\n      // page.\n      if (this.#bitmapId) {\n        this.#getBitmap();\n      }\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    if (this.#bitmapId && this.#canvas === null) {\n      this.#getBitmap();\n    }\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilting it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  /** @inheritdoc */\n  onceAdded() {\n    this._isDraggable = true;\n    this.div.focus();\n  }\n\n  /** @inheritdoc */\n  isEmpty() {\n    return !(\n      this.#bitmapPromise ||\n      this.#bitmap ||\n      this.#bitmapUrl ||\n      this.#bitmapFile ||\n      this.#bitmapId\n    );\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this.width) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n    this.div.hidden = true;\n\n    this.addAltTextButton();\n\n    if (this.#bitmap) {\n      this.#createCanvas();\n    } else {\n      this.#getBitmap();\n    }\n\n    if (this.width) {\n      // This editor was created in using copy (ctrl+c).\n      const [parentWidth, parentHeight] = this.parentDimensions;\n      this.setAt(\n        baseX * parentWidth,\n        baseY * parentHeight,\n        this.width * parentWidth,\n        this.height * parentHeight\n      );\n    }\n\n    return this.div;\n  }\n\n  #createCanvas() {\n    const { div } = this;\n    let { width, height } = this.#bitmap;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const MAX_RATIO = 0.75;\n    if (this.width) {\n      width = this.width * pageWidth;\n      height = this.height * pageHeight;\n    } else if (\n      width > MAX_RATIO * pageWidth ||\n      height > MAX_RATIO * pageHeight\n    ) {\n      // If the the image is too big compared to the page dimensions\n      // (more than MAX_RATIO) then we scale it down.\n      const factor = Math.min(\n        (MAX_RATIO * pageWidth) / width,\n        (MAX_RATIO * pageHeight) / height\n      );\n      width *= factor;\n      height *= factor;\n    }\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setDims(\n      (width * parentWidth) / pageWidth,\n      (height * parentHeight) / pageHeight\n    );\n\n    this._uiManager.enableWaiting(false);\n    const canvas = (this.#canvas = document.createElement(\"canvas\"));\n    div.append(canvas);\n    div.hidden = false;\n    this.#drawBitmap(width, height);\n    this.#createObserver();\n    if (!this.#hasBeenAddedInUndoStack) {\n      this.parent.addUndoableEditor(this);\n      this.#hasBeenAddedInUndoStack = true;\n    }\n\n    // There are multiple ways to add an image to the page, so here we just\n    // count the number of times an image is added to the page whatever the way\n    // is.\n    this._reportTelemetry({\n      action: \"inserted_image\",\n    });\n    if (this.#bitmapFileName) {\n      canvas.setAttribute(\"aria-label\", this.#bitmapFileName);\n    }\n  }\n\n  /**\n   * When the dimensions of the div change the inner canvas must\n   * renew its dimensions, hence it must redraw its own contents.\n   * @param {number} width - the new width of the div\n   * @param {number} height - the new height of the div\n   * @returns\n   */\n  #setDimensions(width, height) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.width = width / parentWidth;\n    this.height = height / parentHeight;\n    this.setDims(width, height);\n    if (this._initialOptions?.isCentered) {\n      this.center();\n    } else {\n      this.fixAndSetPosition();\n    }\n    this._initialOptions = null;\n    if (this.#resizeTimeoutId !== null) {\n      clearTimeout(this.#resizeTimeoutId);\n    }\n    // When the user is resizing the editor we just use CSS to scale the image\n    // to avoid redrawing it too often.\n    // And once the user stops resizing the editor we redraw the image in\n    // rescaling it correctly (see this.#scaleBitmap).\n    const TIME_TO_WAIT = 200;\n    this.#resizeTimeoutId = setTimeout(() => {\n      this.#resizeTimeoutId = null;\n      this.#drawBitmap(width, height);\n    }, TIME_TO_WAIT);\n  }\n\n  #scaleBitmap(width, height) {\n    const { width: bitmapWidth, height: bitmapHeight } = this.#bitmap;\n\n    let newWidth = bitmapWidth;\n    let newHeight = bitmapHeight;\n    let bitmap = this.#bitmap;\n    while (newWidth > 2 * width || newHeight > 2 * height) {\n      const prevWidth = newWidth;\n      const prevHeight = newHeight;\n\n      if (newWidth > 2 * width) {\n        // See bug 1820511 (Windows specific bug).\n        // TODO: once the above bug is fixed we could revert to:\n        // newWidth = Math.ceil(newWidth / 2);\n        newWidth =\n          newWidth >= 16384\n            ? Math.floor(newWidth / 2) - 1\n            : Math.ceil(newWidth / 2);\n      }\n      if (newHeight > 2 * height) {\n        newHeight =\n          newHeight >= 16384\n            ? Math.floor(newHeight / 2) - 1\n            : Math.ceil(newHeight / 2);\n      }\n\n      const offscreen = new OffscreenCanvas(newWidth, newHeight);\n      const ctx = offscreen.getContext(\"2d\");\n      ctx.drawImage(\n        bitmap,\n        0,\n        0,\n        prevWidth,\n        prevHeight,\n        0,\n        0,\n        newWidth,\n        newHeight\n      );\n      bitmap = offscreen.transferToImageBitmap();\n    }\n\n    return bitmap;\n  }\n\n  async #mlGuessAltText(bitmap, width, height) {\n    if (this.#hasMLBeenQueried) {\n      return;\n    }\n    this.#hasMLBeenQueried = true;\n    const isMLEnabled = await this._uiManager.isMLEnabledFor(\"altText\");\n    if (!isMLEnabled || this.hasAltText()) {\n      return;\n    }\n    const offscreen = new OffscreenCanvas(width, height);\n    const ctx = offscreen.getContext(\"2d\", { willReadFrequently: true });\n    ctx.drawImage(\n      bitmap,\n      0,\n      0,\n      bitmap.width,\n      bitmap.height,\n      0,\n      0,\n      width,\n      height\n    );\n    const response = await this._uiManager.mlGuess({\n      service: \"moz-image-to-text\",\n      request: {\n        data: ctx.getImageData(0, 0, width, height).data,\n        width,\n        height,\n        channels: 4,\n      },\n    });\n    const altText = response?.output || \"\";\n    if (this.parent && altText && !this.hasAltText()) {\n      this.altTextData = { altText, decorative: false };\n    }\n  }\n\n  #drawBitmap(width, height) {\n    width = Math.ceil(width);\n    height = Math.ceil(height);\n    const canvas = this.#canvas;\n    if (!canvas || (canvas.width === width && canvas.height === height)) {\n      return;\n    }\n    canvas.width = width;\n    canvas.height = height;\n    const bitmap = this.#isSvg\n      ? this.#bitmap\n      : this.#scaleBitmap(width, height);\n\n    this.#mlGuessAltText(bitmap, width, height);\n\n    const ctx = canvas.getContext(\"2d\");\n    ctx.filter = this._uiManager.hcmFilter;\n    ctx.drawImage(\n      bitmap,\n      0,\n      0,\n      bitmap.width,\n      bitmap.height,\n      0,\n      0,\n      width,\n      height\n    );\n  }\n\n  /** @inheritdoc */\n  getImageForAltText() {\n    return this.#canvas;\n  }\n\n  #serializeBitmap(toUrl) {\n    if (toUrl) {\n      if (this.#isSvg) {\n        const url = this._uiManager.imageManager.getSvgUrl(this.#bitmapId);\n        if (url) {\n          return url;\n        }\n      }\n      // We convert to a data url because it's sync and the url can live in the\n      // clipboard.\n      const canvas = document.createElement(\"canvas\");\n      ({ width: canvas.width, height: canvas.height } = this.#bitmap);\n      const ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(this.#bitmap, 0, 0);\n\n      return canvas.toDataURL();\n    }\n\n    if (this.#isSvg) {\n      const [pageWidth, pageHeight] = this.pageDimensions;\n      // Multiply by PixelsPerInch.PDF_TO_CSS_UNITS in order to increase the\n      // image resolution when rasterizing it.\n      const width = Math.round(\n        this.width * pageWidth * PixelsPerInch.PDF_TO_CSS_UNITS\n      );\n      const height = Math.round(\n        this.height * pageHeight * PixelsPerInch.PDF_TO_CSS_UNITS\n      );\n      const offscreen = new OffscreenCanvas(width, height);\n      const ctx = offscreen.getContext(\"2d\");\n      ctx.drawImage(\n        this.#bitmap,\n        0,\n        0,\n        this.#bitmap.width,\n        this.#bitmap.height,\n        0,\n        0,\n        width,\n        height\n      );\n      return offscreen.transferToImageBitmap();\n    }\n\n    return structuredClone(this.#bitmap);\n  }\n\n  /**\n   * Create the resize observer.\n   */\n  #createObserver() {\n    if (!this._uiManager._signal) {\n      // This method is called after the canvas has been created but the canvas\n      // creation is async, so it's possible that the viewer has been closed.\n      return;\n    }\n    this.#observer = new ResizeObserver(entries => {\n      const rect = entries[0].contentRect;\n      if (rect.width && rect.height) {\n        this.#setDimensions(rect.width, rect.height);\n      }\n    });\n    this.#observer.observe(this.div);\n    this._uiManager._signal.addEventListener(\n      \"abort\",\n      () => {\n        this.#observer?.disconnect();\n        this.#observer = null;\n      },\n      { once: true }\n    );\n  }\n\n  /** @inheritdoc */\n  static deserialize(data, parent, uiManager) {\n    if (data instanceof StampAnnotationElement) {\n      return null;\n    }\n    const editor = super.deserialize(data, parent, uiManager);\n    const { rect, bitmapUrl, bitmapId, isSvg, accessibilityData } = data;\n    if (bitmapId && uiManager.imageManager.isValidId(bitmapId)) {\n      editor.#bitmapId = bitmapId;\n    } else {\n      editor.#bitmapUrl = bitmapUrl;\n    }\n    editor.#isSvg = isSvg;\n\n    const [parentWidth, parentHeight] = editor.pageDimensions;\n    editor.width = (rect[2] - rect[0]) / parentWidth;\n    editor.height = (rect[3] - rect[1]) / parentHeight;\n\n    if (accessibilityData) {\n      editor.altTextData = accessibilityData;\n    }\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false, context = null) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    const serialized = {\n      annotationType: AnnotationEditorType.STAMP,\n      bitmapId: this.#bitmapId,\n      pageIndex: this.pageIndex,\n      rect: this.getRect(0, 0),\n      rotation: this.rotation,\n      isSvg: this.#isSvg,\n      structTreeParentId: this._structTreeParentId,\n    };\n\n    if (isForCopying) {\n      // We don't know what's the final destination (this pdf or another one)\n      // of this annotation and the clipboard doesn't support ImageBitmaps,\n      // hence we serialize the bitmap to a data url.\n      serialized.bitmapUrl = this.#serializeBitmap(/* toUrl = */ true);\n      serialized.accessibilityData = this.altTextData;\n      return serialized;\n    }\n\n    const { decorative, altText } = this.altTextData;\n    if (!decorative && altText) {\n      serialized.accessibilityData = { type: \"Figure\", alt: altText };\n    }\n\n    if (context === null) {\n      return serialized;\n    }\n\n    context.stamps ||= new Map();\n    const area = this.#isSvg\n      ? (serialized.rect[2] - serialized.rect[0]) *\n        (serialized.rect[3] - serialized.rect[1])\n      : null;\n    if (!context.stamps.has(this.#bitmapId)) {\n      // We don't want to have multiple copies of the same bitmap in the\n      // annotationMap, hence we only add the bitmap the first time we meet it.\n      context.stamps.set(this.#bitmapId, { area, serialized });\n      serialized.bitmap = this.#serializeBitmap(/* toUrl = */ false);\n    } else if (this.#isSvg) {\n      // If we have multiple copies of the same svg but with different sizes,\n      // then we want to keep the biggest one.\n      const prevData = context.stamps.get(this.#bitmapId);\n      if (area > prevData.area) {\n        prevData.area = area;\n        prevData.serialized.bitmap.close();\n        prevData.serialized.bitmap = this.#serializeBitmap(/* toUrl = */ false);\n      }\n    }\n    return serialized;\n  }\n}\n\nexport { StampEditor };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./tools.js\").AnnotationEditorUIManager} AnnotationEditorUIManager */\n/** @typedef {import(\"../display_utils.js\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../../web/text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n/** @typedef {import(\"../../../web/interfaces\").IL10n} IL10n */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../annotation_layer.js\").AnnotationLayer} AnnotationLayer */\n/** @typedef {import(\"../draw_layer.js\").DrawLayer} DrawLayer */\n\nimport { AnnotationEditorType, FeatureTest } from \"../../shared/util.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { FreeTextEditor } from \"./freetext.js\";\nimport { HighlightEditor } from \"./highlight.js\";\nimport { InkEditor } from \"./ink.js\";\nimport { setLayerDimensions } from \"../display_utils.js\";\nimport { StampEditor } from \"./stamp.js\";\n\n/**\n * @typedef {Object} AnnotationEditorLayerOptions\n * @property {Object} mode\n * @property {HTMLDivElement} div\n * @property {AnnotationEditorUIManager} uiManager\n * @property {boolean} enabled\n * @property {TextAccessibilityManager} [accessibilityManager]\n * @property {number} pageIndex\n * @property {IL10n} l10n\n * @property {AnnotationLayer} [annotationLayer]\n * @property {HTMLDivElement} [textLayer]\n * @property {DrawLayer} drawLayer\n * @property {PageViewport} viewport\n */\n\n/**\n * @typedef {Object} RenderEditorLayerOptions\n * @property {PageViewport} viewport\n */\n\n/**\n * Manage all the different editors on a page.\n */\nclass AnnotationEditorLayer {\n  #accessibilityManager;\n\n  #allowClick = false;\n\n  #annotationLayer = null;\n\n  #boundPointerup = null;\n\n  #boundPointerdown = null;\n\n  #boundTextLayerPointerDown = null;\n\n  #editorFocusTimeoutId = null;\n\n  #editors = new Map();\n\n  #hadPointerDown = false;\n\n  #isCleaningUp = false;\n\n  #isDisabling = false;\n\n  #textLayer = null;\n\n  #uiManager;\n\n  static _initialized = false;\n\n  static #editorTypes = new Map(\n    [FreeTextEditor, InkEditor, StampEditor, HighlightEditor].map(type => [\n      type._editorType,\n      type,\n    ])\n  );\n\n  /**\n   * @param {AnnotationEditorLayerOptions} options\n   */\n  constructor({\n    uiManager,\n    pageIndex,\n    div,\n    accessibilityManager,\n    annotationLayer,\n    drawLayer,\n    textLayer,\n    viewport,\n    l10n,\n  }) {\n    const editorTypes = [...AnnotationEditorLayer.#editorTypes.values()];\n    if (!AnnotationEditorLayer._initialized) {\n      AnnotationEditorLayer._initialized = true;\n      for (const editorType of editorTypes) {\n        editorType.initialize(l10n, uiManager);\n      }\n    }\n    uiManager.registerEditorTypes(editorTypes);\n\n    this.#uiManager = uiManager;\n    this.pageIndex = pageIndex;\n    this.div = div;\n    this.#accessibilityManager = accessibilityManager;\n    this.#annotationLayer = annotationLayer;\n    this.viewport = viewport;\n    this.#textLayer = textLayer;\n    this.drawLayer = drawLayer;\n\n    this.#uiManager.addLayer(this);\n  }\n\n  get isEmpty() {\n    return this.#editors.size === 0;\n  }\n\n  get isInvisible() {\n    return (\n      this.isEmpty && this.#uiManager.getMode() === AnnotationEditorType.NONE\n    );\n  }\n\n  /**\n   * Update the toolbar if it's required to reflect the tool currently used.\n   * @param {number} mode\n   */\n  updateToolbar(mode) {\n    this.#uiManager.updateToolbar(mode);\n  }\n\n  /**\n   * The mode has changed: it must be updated.\n   * @param {number} mode\n   */\n  updateMode(mode = this.#uiManager.getMode()) {\n    this.#cleanup();\n    switch (mode) {\n      case AnnotationEditorType.NONE:\n        this.disableTextSelection();\n        this.togglePointerEvents(false);\n        this.toggleAnnotationLayerPointerEvents(true);\n        this.disableClick();\n        return;\n      case AnnotationEditorType.INK:\n        // We always want to have an ink editor ready to draw in.\n        this.addInkEditorIfNeeded(false);\n\n        this.disableTextSelection();\n        this.togglePointerEvents(true);\n        this.disableClick();\n        break;\n      case AnnotationEditorType.HIGHLIGHT:\n        this.enableTextSelection();\n        this.togglePointerEvents(false);\n        this.disableClick();\n        break;\n      default:\n        this.disableTextSelection();\n        this.togglePointerEvents(true);\n        this.enableClick();\n    }\n\n    this.toggleAnnotationLayerPointerEvents(false);\n    const { classList } = this.div;\n    for (const editorType of AnnotationEditorLayer.#editorTypes.values()) {\n      classList.toggle(\n        `${editorType._type}Editing`,\n        mode === editorType._editorType\n      );\n    }\n    this.div.hidden = false;\n  }\n\n  hasTextLayer(textLayer) {\n    return textLayer === this.#textLayer?.div;\n  }\n\n  addInkEditorIfNeeded(isCommitting) {\n    if (this.#uiManager.getMode() !== AnnotationEditorType.INK) {\n      // We don't want to add an ink editor if we're not in ink mode!\n      return;\n    }\n\n    if (!isCommitting) {\n      // We're removing an editor but an empty one can already exist so in this\n      // case we don't need to create a new one.\n      for (const editor of this.#editors.values()) {\n        if (editor.isEmpty()) {\n          editor.setInBackground();\n          return;\n        }\n      }\n    }\n\n    const editor = this.createAndAddNewEditor(\n      { offsetX: 0, offsetY: 0 },\n      /* isCentered = */ false\n    );\n    editor.setInBackground();\n  }\n\n  /**\n   * Set the editing state.\n   * @param {boolean} isEditing\n   */\n  setEditingState(isEditing) {\n    this.#uiManager.setEditingState(isEditing);\n  }\n\n  /**\n   * Add some commands into the CommandManager (undo/redo stuff).\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this.#uiManager.addCommands(params);\n  }\n\n  toggleDrawing(enabled = false) {\n    this.div.classList.toggle(\"drawing\", !enabled);\n  }\n\n  togglePointerEvents(enabled = false) {\n    this.div.classList.toggle(\"disabled\", !enabled);\n  }\n\n  toggleAnnotationLayerPointerEvents(enabled = false) {\n    this.#annotationLayer?.div.classList.toggle(\"disabled\", !enabled);\n  }\n\n  /**\n   * Enable pointer events on the main div in order to enable\n   * editor creation.\n   */\n  enable() {\n    this.div.tabIndex = 0;\n    this.togglePointerEvents(true);\n    const annotationElementIds = new Set();\n    for (const editor of this.#editors.values()) {\n      editor.enableEditing();\n      editor.show(true);\n      if (editor.annotationElementId) {\n        this.#uiManager.removeChangedExistingAnnotation(editor);\n        annotationElementIds.add(editor.annotationElementId);\n      }\n    }\n\n    if (!this.#annotationLayer) {\n      return;\n    }\n\n    const editables = this.#annotationLayer.getEditableAnnotations();\n    for (const editable of editables) {\n      // The element must be hidden whatever its state is.\n      editable.hide();\n      if (this.#uiManager.isDeletedAnnotationElement(editable.data.id)) {\n        continue;\n      }\n      if (annotationElementIds.has(editable.data.id)) {\n        continue;\n      }\n      const editor = this.deserialize(editable);\n      if (!editor) {\n        continue;\n      }\n      this.addOrRebuild(editor);\n      editor.enableEditing();\n    }\n  }\n\n  /**\n   * Disable editor creation.\n   */\n  disable() {\n    this.#isDisabling = true;\n    this.div.tabIndex = -1;\n    this.togglePointerEvents(false);\n    const changedAnnotations = new Map();\n    const resetAnnotations = new Map();\n    for (const editor of this.#editors.values()) {\n      editor.disableEditing();\n      if (!editor.annotationElementId) {\n        continue;\n      }\n      if (editor.serialize() !== null) {\n        changedAnnotations.set(editor.annotationElementId, editor);\n        continue;\n      } else {\n        resetAnnotations.set(editor.annotationElementId, editor);\n      }\n      this.getEditableAnnotation(editor.annotationElementId)?.show();\n      editor.remove();\n    }\n\n    if (this.#annotationLayer) {\n      // Show the annotations that were hidden in enable().\n      const editables = this.#annotationLayer.getEditableAnnotations();\n      for (const editable of editables) {\n        const { id } = editable.data;\n        if (this.#uiManager.isDeletedAnnotationElement(id)) {\n          continue;\n        }\n        let editor = resetAnnotations.get(id);\n        if (editor) {\n          editor.resetAnnotationElement(editable);\n          editor.show(false);\n          editable.show();\n          continue;\n        }\n\n        editor = changedAnnotations.get(id);\n        if (editor) {\n          this.#uiManager.addChangedExistingAnnotation(editor);\n          editor.renderAnnotationElement(editable);\n          editor.show(false);\n        }\n        editable.show();\n      }\n    }\n\n    this.#cleanup();\n    if (this.isEmpty) {\n      this.div.hidden = true;\n    }\n    const { classList } = this.div;\n    for (const editorType of AnnotationEditorLayer.#editorTypes.values()) {\n      classList.remove(`${editorType._type}Editing`);\n    }\n    this.disableTextSelection();\n    this.toggleAnnotationLayerPointerEvents(true);\n\n    this.#isDisabling = false;\n  }\n\n  getEditableAnnotation(id) {\n    return this.#annotationLayer?.getEditableAnnotation(id) || null;\n  }\n\n  /**\n   * Set the current editor.\n   * @param {AnnotationEditor} editor\n   */\n  setActiveEditor(editor) {\n    const currentActive = this.#uiManager.getActive();\n    if (currentActive === editor) {\n      return;\n    }\n\n    this.#uiManager.setActiveEditor(editor);\n  }\n\n  enableTextSelection() {\n    this.div.tabIndex = -1;\n    if (this.#textLayer?.div && !this.#boundTextLayerPointerDown) {\n      this.#boundTextLayerPointerDown = this.#textLayerPointerDown.bind(this);\n      this.#textLayer.div.addEventListener(\n        \"pointerdown\",\n        this.#boundTextLayerPointerDown,\n        { signal: this.#uiManager._signal }\n      );\n      this.#textLayer.div.classList.add(\"highlighting\");\n    }\n  }\n\n  disableTextSelection() {\n    this.div.tabIndex = 0;\n    if (this.#textLayer?.div && this.#boundTextLayerPointerDown) {\n      this.#textLayer.div.removeEventListener(\n        \"pointerdown\",\n        this.#boundTextLayerPointerDown\n      );\n      this.#boundTextLayerPointerDown = null;\n      this.#textLayer.div.classList.remove(\"highlighting\");\n    }\n  }\n\n  #textLayerPointerDown(event) {\n    // Unselect all the editors in order to let the user select some text\n    // without being annoyed by an editor toolbar.\n    this.#uiManager.unselectAll();\n    const { target } = event;\n    if (\n      target === this.#textLayer.div ||\n      (target.classList.contains(\"endOfContent\") &&\n        this.#textLayer.div.contains(target))\n    ) {\n      const { isMac } = FeatureTest.platform;\n      if (event.button !== 0 || (event.ctrlKey && isMac)) {\n        // Do nothing on right click.\n        return;\n      }\n      this.#uiManager.showAllEditors(\n        \"highlight\",\n        true,\n        /* updateButton = */ true\n      );\n      this.#textLayer.div.classList.add(\"free\");\n      this.toggleDrawing();\n      HighlightEditor.startHighlighting(\n        this,\n        this.#uiManager.direction === \"ltr\",\n        event\n      );\n      this.#textLayer.div.addEventListener(\n        \"pointerup\",\n        () => {\n          this.#textLayer.div.classList.remove(\"free\");\n          this.toggleDrawing(true);\n        },\n        { once: true, signal: this.#uiManager._signal }\n      );\n      event.preventDefault();\n    }\n  }\n\n  enableClick() {\n    if (this.#boundPointerdown) {\n      return;\n    }\n    const signal = this.#uiManager._signal;\n    this.#boundPointerdown = this.pointerdown.bind(this);\n    this.#boundPointerup = this.pointerup.bind(this);\n    this.div.addEventListener(\"pointerdown\", this.#boundPointerdown, {\n      signal,\n    });\n    this.div.addEventListener(\"pointerup\", this.#boundPointerup, { signal });\n  }\n\n  disableClick() {\n    if (!this.#boundPointerdown) {\n      return;\n    }\n    this.div.removeEventListener(\"pointerdown\", this.#boundPointerdown);\n    this.div.removeEventListener(\"pointerup\", this.#boundPointerup);\n    this.#boundPointerdown = null;\n    this.#boundPointerup = null;\n  }\n\n  attach(editor) {\n    this.#editors.set(editor.id, editor);\n    const { annotationElementId } = editor;\n    if (\n      annotationElementId &&\n      this.#uiManager.isDeletedAnnotationElement(annotationElementId)\n    ) {\n      this.#uiManager.removeDeletedAnnotationElement(editor);\n    }\n  }\n\n  detach(editor) {\n    this.#editors.delete(editor.id);\n    this.#accessibilityManager?.removePointerInTextLayer(editor.contentDiv);\n\n    if (!this.#isDisabling && editor.annotationElementId) {\n      this.#uiManager.addDeletedAnnotationElement(editor);\n    }\n  }\n\n  /**\n   * Remove an editor.\n   * @param {AnnotationEditor} editor\n   */\n  remove(editor) {\n    this.detach(editor);\n    this.#uiManager.removeEditor(editor);\n    editor.div.remove();\n    editor.isAttachedToDOM = false;\n\n    if (!this.#isCleaningUp) {\n      this.addInkEditorIfNeeded(/* isCommitting = */ false);\n    }\n  }\n\n  /**\n   * An editor can have a different parent, for example after having\n   * being dragged and droped from a page to another.\n   * @param {AnnotationEditor} editor\n   */\n  changeParent(editor) {\n    if (editor.parent === this) {\n      return;\n    }\n\n    if (editor.parent && editor.annotationElementId) {\n      this.#uiManager.addDeletedAnnotationElement(editor.annotationElementId);\n      AnnotationEditor.deleteAnnotationElement(editor);\n      editor.annotationElementId = null;\n    }\n\n    this.attach(editor);\n    editor.parent?.detach(editor);\n    editor.setParent(this);\n    if (editor.div && editor.isAttachedToDOM) {\n      editor.div.remove();\n      this.div.append(editor.div);\n    }\n  }\n\n  /**\n   * Add a new editor in the current view.\n   * @param {AnnotationEditor} editor\n   */\n  add(editor) {\n    if (editor.parent === this && editor.isAttachedToDOM) {\n      return;\n    }\n    this.changeParent(editor);\n    this.#uiManager.addEditor(editor);\n    this.attach(editor);\n\n    if (!editor.isAttachedToDOM) {\n      const div = editor.render();\n      this.div.append(div);\n      editor.isAttachedToDOM = true;\n    }\n\n    // The editor will be correctly moved into the DOM (see fixAndSetPosition).\n    editor.fixAndSetPosition();\n    editor.onceAdded();\n    this.#uiManager.addToAnnotationStorage(editor);\n    editor._reportTelemetry(editor.telemetryInitialData);\n  }\n\n  moveEditorInDOM(editor) {\n    if (!editor.isAttachedToDOM) {\n      return;\n    }\n\n    const { activeElement } = document;\n    if (editor.div.contains(activeElement) && !this.#editorFocusTimeoutId) {\n      // When the div is moved in the DOM the focus can move somewhere else,\n      // so we want to be sure that the focus will stay on the editor but we\n      // don't want to call any focus callbacks, hence we disable them and only\n      // re-enable them when the editor has the focus.\n      editor._focusEventsAllowed = false;\n      this.#editorFocusTimeoutId = setTimeout(() => {\n        this.#editorFocusTimeoutId = null;\n        if (!editor.div.contains(document.activeElement)) {\n          editor.div.addEventListener(\n            \"focusin\",\n            () => {\n              editor._focusEventsAllowed = true;\n            },\n            { once: true, signal: this.#uiManager._signal }\n          );\n          activeElement.focus();\n        } else {\n          editor._focusEventsAllowed = true;\n        }\n      }, 0);\n    }\n\n    editor._structTreeParentId = this.#accessibilityManager?.moveElementInDOM(\n      this.div,\n      editor.div,\n      editor.contentDiv,\n      /* isRemovable = */ true\n    );\n  }\n\n  /**\n   * Add or rebuild depending if it has been removed or not.\n   * @param {AnnotationEditor} editor\n   */\n  addOrRebuild(editor) {\n    if (editor.needsToBeRebuilt()) {\n      editor.parent ||= this;\n      editor.rebuild();\n      editor.show();\n    } else {\n      this.add(editor);\n    }\n  }\n\n  /**\n   * Add a new editor and make this addition undoable.\n   * @param {AnnotationEditor} editor\n   */\n  addUndoableEditor(editor) {\n    const cmd = () => editor._uiManager.rebuild(editor);\n    const undo = () => {\n      editor.remove();\n    };\n\n    this.addCommands({ cmd, undo, mustExec: false });\n  }\n\n  /**\n   * Get an id for an editor.\n   * @returns {string}\n   */\n  getNextId() {\n    return this.#uiManager.getId();\n  }\n\n  get #currentEditorType() {\n    return AnnotationEditorLayer.#editorTypes.get(this.#uiManager.getMode());\n  }\n\n  get _signal() {\n    return this.#uiManager._signal;\n  }\n\n  /**\n   * Create a new editor\n   * @param {Object} params\n   * @returns {AnnotationEditor}\n   */\n  #createNewEditor(params) {\n    const editorType = this.#currentEditorType;\n    return editorType ? new editorType.prototype.constructor(params) : null;\n  }\n\n  canCreateNewEmptyEditor() {\n    return this.#currentEditorType?.canCreateNewEmptyEditor();\n  }\n\n  /**\n   * Paste some content into a new editor.\n   * @param {number} mode\n   * @param {Object} params\n   */\n  pasteEditor(mode, params) {\n    this.#uiManager.updateToolbar(mode);\n    this.#uiManager.updateMode(mode);\n\n    const { offsetX, offsetY } = this.#getCenterPoint();\n    const id = this.getNextId();\n    const editor = this.#createNewEditor({\n      parent: this,\n      id,\n      x: offsetX,\n      y: offsetY,\n      uiManager: this.#uiManager,\n      isCentered: true,\n      ...params,\n    });\n    if (editor) {\n      this.add(editor);\n    }\n  }\n\n  /**\n   * Create a new editor\n   * @param {Object} data\n   * @returns {AnnotationEditor | null}\n   */\n  deserialize(data) {\n    return (\n      AnnotationEditorLayer.#editorTypes\n        .get(data.annotationType ?? data.annotationEditorType)\n        ?.deserialize(data, this, this.#uiManager) || null\n    );\n  }\n\n  /**\n   * Create and add a new editor.\n   * @param {PointerEvent} event\n   * @param {boolean} isCentered\n   * @param [Object] data\n   * @returns {AnnotationEditor}\n   */\n  createAndAddNewEditor(event, isCentered, data = {}) {\n    const id = this.getNextId();\n    const editor = this.#createNewEditor({\n      parent: this,\n      id,\n      x: event.offsetX,\n      y: event.offsetY,\n      uiManager: this.#uiManager,\n      isCentered,\n      ...data,\n    });\n    if (editor) {\n      this.add(editor);\n    }\n\n    return editor;\n  }\n\n  #getCenterPoint() {\n    const { x, y, width, height } = this.div.getBoundingClientRect();\n    const tlX = Math.max(0, x);\n    const tlY = Math.max(0, y);\n    const brX = Math.min(window.innerWidth, x + width);\n    const brY = Math.min(window.innerHeight, y + height);\n    const centerX = (tlX + brX) / 2 - x;\n    const centerY = (tlY + brY) / 2 - y;\n    const [offsetX, offsetY] =\n      this.viewport.rotation % 180 === 0\n        ? [centerX, centerY]\n        : [centerY, centerX];\n\n    return { offsetX, offsetY };\n  }\n\n  /**\n   * Create and add a new editor.\n   */\n  addNewEditor() {\n    this.createAndAddNewEditor(this.#getCenterPoint(), /* isCentered = */ true);\n  }\n\n  /**\n   * Set the last selected editor.\n   * @param {AnnotationEditor} editor\n   */\n  setSelected(editor) {\n    this.#uiManager.setSelected(editor);\n  }\n\n  /**\n   * Add or remove an editor the current selection.\n   * @param {AnnotationEditor} editor\n   */\n  toggleSelected(editor) {\n    this.#uiManager.toggleSelected(editor);\n  }\n\n  /**\n   * Check if the editor is selected.\n   * @param {AnnotationEditor} editor\n   */\n  isSelected(editor) {\n    return this.#uiManager.isSelected(editor);\n  }\n\n  /**\n   * Unselect an editor.\n   * @param {AnnotationEditor} editor\n   */\n  unselect(editor) {\n    this.#uiManager.unselect(editor);\n  }\n\n  /**\n   * Pointerup callback.\n   * @param {PointerEvent} event\n   */\n  pointerup(event) {\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Don't create an editor on right click.\n      return;\n    }\n\n    if (event.target !== this.div) {\n      return;\n    }\n\n    if (!this.#hadPointerDown) {\n      // It can happen when the user starts a drag inside a text editor\n      // and then releases the mouse button outside of it. In such a case\n      // we don't want to create a new editor, hence we check that a pointerdown\n      // occurred on this div previously.\n      return;\n    }\n    this.#hadPointerDown = false;\n\n    if (!this.#allowClick) {\n      this.#allowClick = true;\n      return;\n    }\n\n    if (this.#uiManager.getMode() === AnnotationEditorType.STAMP) {\n      this.#uiManager.unselectAll();\n      return;\n    }\n\n    this.createAndAddNewEditor(event, /* isCentered = */ false);\n  }\n\n  /**\n   * Pointerdown callback.\n   * @param {PointerEvent} event\n   */\n  pointerdown(event) {\n    if (this.#uiManager.getMode() === AnnotationEditorType.HIGHLIGHT) {\n      this.enableTextSelection();\n    }\n    if (this.#hadPointerDown) {\n      // It's possible to have a second pointerdown event before a pointerup one\n      // when the user puts a finger on a touchscreen and then add a second one\n      // to start a pinch-to-zoom gesture.\n      // That said, in case it's possible to have two pointerdown events with\n      // a mouse, we don't want to create a new editor in such a case either.\n      this.#hadPointerDown = false;\n      return;\n    }\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Do nothing on right click.\n      return;\n    }\n\n    if (event.target !== this.div) {\n      return;\n    }\n\n    this.#hadPointerDown = true;\n\n    const editor = this.#uiManager.getActive();\n    this.#allowClick = !editor || editor.isEmpty();\n  }\n\n  /**\n   *\n   * @param {AnnotationEditor} editor\n   * @param {number} x\n   * @param {number} y\n   * @returns\n   */\n  findNewParent(editor, x, y) {\n    const layer = this.#uiManager.findParent(x, y);\n    if (layer === null || layer === this) {\n      return false;\n    }\n    layer.changeParent(editor);\n    return true;\n  }\n\n  /**\n   * Destroy the main editor.\n   */\n  destroy() {\n    if (this.#uiManager.getActive()?.parent === this) {\n      // We need to commit the current editor before destroying the layer.\n      this.#uiManager.commitOrRemove();\n      this.#uiManager.setActiveEditor(null);\n    }\n\n    if (this.#editorFocusTimeoutId) {\n      clearTimeout(this.#editorFocusTimeoutId);\n      this.#editorFocusTimeoutId = null;\n    }\n\n    for (const editor of this.#editors.values()) {\n      this.#accessibilityManager?.removePointerInTextLayer(editor.contentDiv);\n      editor.setParent(null);\n      editor.isAttachedToDOM = false;\n      editor.div.remove();\n    }\n    this.div = null;\n    this.#editors.clear();\n    this.#uiManager.removeLayer(this);\n  }\n\n  #cleanup() {\n    // When we're cleaning up, some editors are removed but we don't want\n    // to add a new one which will induce an addition in this.#editors, hence\n    // an infinite loop.\n    this.#isCleaningUp = true;\n    for (const editor of this.#editors.values()) {\n      if (editor.isEmpty()) {\n        editor.remove();\n      }\n    }\n    this.#isCleaningUp = false;\n  }\n\n  /**\n   * Render the main editor.\n   * @param {RenderEditorLayerOptions} parameters\n   */\n  render({ viewport }) {\n    this.viewport = viewport;\n    setLayerDimensions(this.div, viewport);\n    for (const editor of this.#uiManager.getEditors(this.pageIndex)) {\n      this.add(editor);\n      editor.rebuild();\n    }\n    // We're maybe rendering a layer which was invisible when we started to edit\n    // so we must set the different callbacks for it.\n    this.updateMode();\n  }\n\n  /**\n   * Update the main editor.\n   * @param {RenderEditorLayerOptions} parameters\n   */\n  update({ viewport }) {\n    // Editors have their dimensions/positions in percent so to avoid any\n    // issues (see #15582), we must commit the current one before changing\n    // the viewport.\n    this.#uiManager.commitOrRemove();\n    this.#cleanup();\n\n    const oldRotation = this.viewport.rotation;\n    const rotation = viewport.rotation;\n    this.viewport = viewport;\n    setLayerDimensions(this.div, { rotation });\n    if (oldRotation !== rotation) {\n      for (const editor of this.#editors.values()) {\n        editor.rotate(rotation);\n      }\n    }\n    this.addInkEditorIfNeeded(/* isCommitting = */ false);\n  }\n\n  /**\n   * Get page dimensions.\n   * @returns {Object} dimensions.\n   */\n  get pageDimensions() {\n    const { pageWidth, pageHeight } = this.viewport.rawDims;\n    return [pageWidth, pageHeight];\n  }\n\n  get scale() {\n    return this.#uiManager.viewParameters.realScale;\n  }\n}\n\nexport { AnnotationEditorLayer };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DOMSVGFactory } from \"./display_utils.js\";\nimport { shadow } from \"../shared/util.js\";\n\n/**\n * Manage the SVGs drawn on top of the page canvas.\n * It's important to have them directly on top of the canvas because we want to\n * be able to use mix-blend-mode for some of them.\n */\nclass DrawLayer {\n  #parent = null;\n\n  #id = 0;\n\n  #mapping = new Map();\n\n  #toUpdate = new Map();\n\n  constructor({ pageIndex }) {\n    this.pageIndex = pageIndex;\n  }\n\n  setParent(parent) {\n    if (!this.#parent) {\n      this.#parent = parent;\n      return;\n    }\n\n    if (this.#parent !== parent) {\n      if (this.#mapping.size > 0) {\n        for (const root of this.#mapping.values()) {\n          root.remove();\n          parent.append(root);\n        }\n      }\n      this.#parent = parent;\n    }\n  }\n\n  static get _svgFactory() {\n    return shadow(this, \"_svgFactory\", new DOMSVGFactory());\n  }\n\n  static #setBox(element, { x = 0, y = 0, width = 1, height = 1 } = {}) {\n    const { style } = element;\n    style.top = `${100 * y}%`;\n    style.left = `${100 * x}%`;\n    style.width = `${100 * width}%`;\n    style.height = `${100 * height}%`;\n  }\n\n  #createSVG(box) {\n    const svg = DrawLayer._svgFactory.create(1, 1, /* skipDimensions = */ true);\n    this.#parent.append(svg);\n    svg.setAttribute(\"aria-hidden\", true);\n    DrawLayer.#setBox(svg, box);\n\n    return svg;\n  }\n\n  #createClipPath(defs, pathId) {\n    const clipPath = DrawLayer._svgFactory.createElement(\"clipPath\");\n    defs.append(clipPath);\n    const clipPathId = `clip_${pathId}`;\n    clipPath.setAttribute(\"id\", clipPathId);\n    clipPath.setAttribute(\"clipPathUnits\", \"objectBoundingBox\");\n    const clipPathUse = DrawLayer._svgFactory.createElement(\"use\");\n    clipPath.append(clipPathUse);\n    clipPathUse.setAttribute(\"href\", `#${pathId}`);\n    clipPathUse.classList.add(\"clip\");\n\n    return clipPathId;\n  }\n\n  highlight(outlines, color, opacity, isPathUpdatable = false) {\n    const id = this.#id++;\n    const root = this.#createSVG(outlines.box);\n    root.classList.add(\"highlight\");\n    if (outlines.free) {\n      root.classList.add(\"free\");\n    }\n    const defs = DrawLayer._svgFactory.createElement(\"defs\");\n    root.append(defs);\n    const path = DrawLayer._svgFactory.createElement(\"path\");\n    defs.append(path);\n    const pathId = `path_p${this.pageIndex}_${id}`;\n    path.setAttribute(\"id\", pathId);\n    path.setAttribute(\"d\", outlines.toSVGPath());\n\n    if (isPathUpdatable) {\n      this.#toUpdate.set(id, path);\n    }\n\n    // Create the clipping path for the editor div.\n    const clipPathId = this.#createClipPath(defs, pathId);\n\n    const use = DrawLayer._svgFactory.createElement(\"use\");\n    root.append(use);\n    root.setAttribute(\"fill\", color);\n    root.setAttribute(\"fill-opacity\", opacity);\n    use.setAttribute(\"href\", `#${pathId}`);\n\n    this.#mapping.set(id, root);\n\n    return { id, clipPathId: `url(#${clipPathId})` };\n  }\n\n  highlightOutline(outlines) {\n    // We cannot draw the outline directly in the SVG for highlights because\n    // it composes with its parent with mix-blend-mode: multiply.\n    // But the outline has a different mix-blend-mode, so we need to draw it in\n    // its own SVG.\n    const id = this.#id++;\n    const root = this.#createSVG(outlines.box);\n    root.classList.add(\"highlightOutline\");\n    const defs = DrawLayer._svgFactory.createElement(\"defs\");\n    root.append(defs);\n    const path = DrawLayer._svgFactory.createElement(\"path\");\n    defs.append(path);\n    const pathId = `path_p${this.pageIndex}_${id}`;\n    path.setAttribute(\"id\", pathId);\n    path.setAttribute(\"d\", outlines.toSVGPath());\n    path.setAttribute(\"vector-effect\", \"non-scaling-stroke\");\n\n    let maskId;\n    if (outlines.free) {\n      root.classList.add(\"free\");\n      const mask = DrawLayer._svgFactory.createElement(\"mask\");\n      defs.append(mask);\n      maskId = `mask_p${this.pageIndex}_${id}`;\n      mask.setAttribute(\"id\", maskId);\n      mask.setAttribute(\"maskUnits\", \"objectBoundingBox\");\n      const rect = DrawLayer._svgFactory.createElement(\"rect\");\n      mask.append(rect);\n      rect.setAttribute(\"width\", \"1\");\n      rect.setAttribute(\"height\", \"1\");\n      rect.setAttribute(\"fill\", \"white\");\n      const use = DrawLayer._svgFactory.createElement(\"use\");\n      mask.append(use);\n      use.setAttribute(\"href\", `#${pathId}`);\n      use.setAttribute(\"stroke\", \"none\");\n      use.setAttribute(\"fill\", \"black\");\n      use.setAttribute(\"fill-rule\", \"nonzero\");\n      use.classList.add(\"mask\");\n    }\n\n    const use1 = DrawLayer._svgFactory.createElement(\"use\");\n    root.append(use1);\n    use1.setAttribute(\"href\", `#${pathId}`);\n    if (maskId) {\n      use1.setAttribute(\"mask\", `url(#${maskId})`);\n    }\n    const use2 = use1.cloneNode();\n    root.append(use2);\n    use1.classList.add(\"mainOutline\");\n    use2.classList.add(\"secondaryOutline\");\n\n    this.#mapping.set(id, root);\n\n    return id;\n  }\n\n  finalizeLine(id, line) {\n    const path = this.#toUpdate.get(id);\n    this.#toUpdate.delete(id);\n    this.updateBox(id, line.box);\n    path.setAttribute(\"d\", line.toSVGPath());\n  }\n\n  updateLine(id, line) {\n    const root = this.#mapping.get(id);\n    const defs = root.firstChild;\n    const path = defs.firstChild;\n    path.setAttribute(\"d\", line.toSVGPath());\n  }\n\n  removeFreeHighlight(id) {\n    this.remove(id);\n    this.#toUpdate.delete(id);\n  }\n\n  updatePath(id, line) {\n    this.#toUpdate.get(id).setAttribute(\"d\", line.toSVGPath());\n  }\n\n  updateBox(id, box) {\n    DrawLayer.#setBox(this.#mapping.get(id), box);\n  }\n\n  show(id, visible) {\n    this.#mapping.get(id).classList.toggle(\"hidden\", !visible);\n  }\n\n  rotate(id, angle) {\n    this.#mapping.get(id).setAttribute(\"data-main-rotation\", angle);\n  }\n\n  changeColor(id, color) {\n    this.#mapping.get(id).setAttribute(\"fill\", color);\n  }\n\n  changeOpacity(id, opacity) {\n    this.#mapping.get(id).setAttribute(\"fill-opacity\", opacity);\n  }\n\n  addClass(id, className) {\n    this.#mapping.get(id).classList.add(className);\n  }\n\n  removeClass(id, className) {\n    this.#mapping.get(id).classList.remove(className);\n  }\n\n  remove(id) {\n    if (this.#parent === null) {\n      return;\n    }\n    this.#mapping.get(id).remove();\n    this.#mapping.delete(id);\n  }\n\n  destroy() {\n    this.#parent = null;\n    for (const root of this.#mapping.values()) {\n      root.remove();\n    }\n    this.#mapping.clear();\n  }\n}\n\nexport { DrawLayer };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./display/api\").OnProgressParameters} OnProgressParameters */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./display/api\").PDFDocumentLoadingTask} PDFDocumentLoadingTask */\n/** @typedef {import(\"./display/api\").PDFDocumentProxy} PDFDocumentProxy */\n/** @typedef {import(\"./display/api\").PDFPageProxy} PDFPageProxy */\n/** @typedef {import(\"./display/api\").RenderTask} RenderTask */\n/** @typedef {import(\"./display/display_utils\").PageViewport} PageViewport */\n\nimport {\n  AbortException,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationMode,\n  CMapCompressionType,\n  createValidAbsoluteUrl,\n  FeatureTest,\n  ImageKind,\n  InvalidPDFException,\n  MissingPDFException,\n  normalizeUnicode,\n  OPS,\n  PasswordResponses,\n  PermissionFlag,\n  shadow,\n  UnexpectedResponseException,\n  Util,\n  VerbosityLevel,\n} from \"./shared/util.js\";\nimport {\n  build,\n  getDocument,\n  PDFDataRangeTransport,\n  PDFWorker,\n  version,\n} from \"./display/api.js\";\nimport {\n  DOMSVGFactory,\n  fetchData,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getXfaPageViewport,\n  isDataScheme,\n  isPdfFile,\n  noContextMenu,\n  PDFDateString,\n  PixelsPerInch,\n  RenderingCancelledException,\n  setLayerDimensions,\n} from \"./display/display_utils.js\";\nimport { AnnotationEditorLayer } from \"./display/editor/annotation_editor_layer.js\";\nimport { AnnotationEditorUIManager } from \"./display/editor/tools.js\";\nimport { AnnotationLayer } from \"./display/annotation_layer.js\";\nimport { ColorPicker } from \"./display/editor/color_picker.js\";\nimport { DrawLayer } from \"./display/draw_layer.js\";\nimport { GlobalWorkerOptions } from \"./display/worker_options.js\";\nimport { Outliner } from \"./display/editor/outliner.js\";\nimport { TextLayer } from \"./display/text_layer.js\";\nimport { XfaLayer } from \"./display/xfa_layer.js\";\n\n/* eslint-disable-next-line no-unused-vars */\nconst pdfjsVersion =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_VERSION\") : void 0;\n/* eslint-disable-next-line no-unused-vars */\nconst pdfjsBuild =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_BUILD\") : void 0;\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n  globalThis.pdfjsTestingUtils = {\n    Outliner,\n  };\n}\n\nexport {\n  AbortException,\n  AnnotationEditorLayer,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationEditorUIManager,\n  AnnotationLayer,\n  AnnotationMode,\n  build,\n  CMapCompressionType,\n  ColorPicker,\n  createValidAbsoluteUrl,\n  DOMSVGFactory,\n  DrawLayer,\n  FeatureTest,\n  fetchData,\n  getDocument,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getXfaPageViewport,\n  GlobalWorkerOptions,\n  ImageKind,\n  InvalidPDFException,\n  isDataScheme,\n  isPdfFile,\n  MissingPDFException,\n  noContextMenu,\n  normalizeUnicode,\n  OPS,\n  PasswordResponses,\n  PDFDataRangeTransport,\n  PDFDateString,\n  PDFWorker,\n  PermissionFlag,\n  PixelsPerInch,\n  RenderingCancelledException,\n  setLayerDimensions,\n  shadow,\n  TextLayer,\n  UnexpectedResponseException,\n  Util,\n  VerbosityLevel,\n  version,\n  XfaLayer,\n};\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* eslint-disable import/no-unresolved */\n\nimport { GlobalWorkerOptions } from \"./build/pdf.mjs\";\n\nif (typeof window !== \"undefined\" && \"Worker\" in window) {\n  GlobalWorkerOptions.workerPort = new Worker(\n    new URL(\"./build/pdf.worker.mjs\", import.meta.url),\n    { type: \"module\" }\n  );\n}\n\nexport * from \"./build/pdf.mjs\";\n","/*!\n * Signature Pad v2.3.2\n * https://github.com/szimek/signature_pad\n *\n * Copyright 2017 Szymon Nowak\n * Released under the MIT license\n *\n * The main idea and some parts of the code (e.g. drawing variable width Bzier curve) are taken from:\n * http://corner.squareup.com/2012/07/smoother-signatures.html\n *\n * Implementation of interpolation using cubic Bzier curves is taken from:\n * http://benknowscode.wordpress.com/2012/09/14/path-interpolation-using-cubic-bezier-and-control-point-estimation-in-javascript\n *\n * Algorithm for approximated length of a Bzier curve is taken from:\n * http://www.lemoda.net/maths/bezier-length/index.html\n *\n */\n\nfunction Point(x, y, time) {\n  this.x = x;\n  this.y = y;\n  this.time = time || new Date().getTime();\n}\n\nPoint.prototype.velocityFrom = function (start) {\n  return this.time !== start.time ? this.distanceTo(start) / (this.time - start.time) : 1;\n};\n\nPoint.prototype.distanceTo = function (start) {\n  return Math.sqrt(Math.pow(this.x - start.x, 2) + Math.pow(this.y - start.y, 2));\n};\n\nPoint.prototype.equals = function (other) {\n  return this.x === other.x && this.y === other.y && this.time === other.time;\n};\n\nfunction Bezier(startPoint, control1, control2, endPoint) {\n  this.startPoint = startPoint;\n  this.control1 = control1;\n  this.control2 = control2;\n  this.endPoint = endPoint;\n}\n\n// Returns approximated length.\nBezier.prototype.length = function () {\n  var steps = 10;\n  var length = 0;\n  var px = void 0;\n  var py = void 0;\n\n  for (var i = 0; i <= steps; i += 1) {\n    var t = i / steps;\n    var cx = this._point(t, this.startPoint.x, this.control1.x, this.control2.x, this.endPoint.x);\n    var cy = this._point(t, this.startPoint.y, this.control1.y, this.control2.y, this.endPoint.y);\n    if (i > 0) {\n      var xdiff = cx - px;\n      var ydiff = cy - py;\n      length += Math.sqrt(xdiff * xdiff + ydiff * ydiff);\n    }\n    px = cx;\n    py = cy;\n  }\n\n  return length;\n};\n\n/* eslint-disable no-multi-spaces, space-in-parens */\nBezier.prototype._point = function (t, start, c1, c2, end) {\n  return start * (1.0 - t) * (1.0 - t) * (1.0 - t) + 3.0 * c1 * (1.0 - t) * (1.0 - t) * t + 3.0 * c2 * (1.0 - t) * t * t + end * t * t * t;\n};\n\n/* eslint-disable */\n\n// http://stackoverflow.com/a/27078401/815507\nfunction throttle(func, wait, options) {\n  var context, args, result;\n  var timeout = null;\n  var previous = 0;\n  if (!options) options = {};\n  var later = function later() {\n    previous = options.leading === false ? 0 : Date.now();\n    timeout = null;\n    result = func.apply(context, args);\n    if (!timeout) context = args = null;\n  };\n  return function () {\n    var now = Date.now();\n    if (!previous && options.leading === false) previous = now;\n    var remaining = wait - (now - previous);\n    context = this;\n    args = arguments;\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = null;\n      }\n      previous = now;\n      result = func.apply(context, args);\n      if (!timeout) context = args = null;\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining);\n    }\n    return result;\n  };\n}\n\nfunction SignaturePad(canvas, options) {\n  var self = this;\n  var opts = options || {};\n\n  this.velocityFilterWeight = opts.velocityFilterWeight || 0.7;\n  this.minWidth = opts.minWidth || 0.5;\n  this.maxWidth = opts.maxWidth || 2.5;\n  this.throttle = 'throttle' in opts ? opts.throttle : 16; // in miliseconds\n  this.minDistance = 'minDistance' in opts ? opts.minDistance : 5;\n\n  if (this.throttle) {\n    this._strokeMoveUpdate = throttle(SignaturePad.prototype._strokeUpdate, this.throttle);\n  } else {\n    this._strokeMoveUpdate = SignaturePad.prototype._strokeUpdate;\n  }\n\n  this.dotSize = opts.dotSize || function () {\n    return (this.minWidth + this.maxWidth) / 2;\n  };\n  this.penColor = opts.penColor || 'black';\n  this.backgroundColor = opts.backgroundColor || 'rgba(0,0,0,0)';\n  this.onBegin = opts.onBegin;\n  this.onEnd = opts.onEnd;\n\n  this._canvas = canvas;\n  this._ctx = canvas.getContext('2d');\n  this.clear();\n\n  // We need add these inline so they are available to unbind while still having\n  // access to 'self' we could use _.bind but it's not worth adding a dependency.\n  this._handleMouseDown = function (event) {\n    if (event.which === 1) {\n      self._mouseButtonDown = true;\n      self._strokeBegin(event);\n    }\n  };\n\n  this._handleMouseMove = function (event) {\n    if (self._mouseButtonDown) {\n      self._strokeMoveUpdate(event);\n    }\n  };\n\n  this._handleMouseUp = function (event) {\n    if (event.which === 1 && self._mouseButtonDown) {\n      self._mouseButtonDown = false;\n      self._strokeEnd(event);\n    }\n  };\n\n  this._handleTouchStart = function (event) {\n    if (event.targetTouches.length === 1) {\n      var touch = event.changedTouches[0];\n      self._strokeBegin(touch);\n    }\n  };\n\n  this._handleTouchMove = function (event) {\n    // Prevent scrolling.\n    event.preventDefault();\n\n    var touch = event.targetTouches[0];\n    self._strokeMoveUpdate(touch);\n  };\n\n  this._handleTouchEnd = function (event) {\n    var wasCanvasTouched = event.target === self._canvas;\n    if (wasCanvasTouched) {\n      event.preventDefault();\n      self._strokeEnd(event);\n    }\n  };\n\n  // Enable mouse and touch event handlers\n  this.on();\n}\n\n// Public methods\nSignaturePad.prototype.clear = function () {\n  var ctx = this._ctx;\n  var canvas = this._canvas;\n\n  ctx.fillStyle = this.backgroundColor;\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  this._data = [];\n  this._reset();\n  this._isEmpty = true;\n};\n\nSignaturePad.prototype.fromDataURL = function (dataUrl) {\n  var _this = this;\n\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  var image = new Image();\n  var ratio = options.ratio || window.devicePixelRatio || 1;\n  var width = options.width || this._canvas.width / ratio;\n  var height = options.height || this._canvas.height / ratio;\n\n  this._reset();\n  image.src = dataUrl;\n  image.onload = function () {\n    _this._ctx.drawImage(image, 0, 0, width, height);\n  };\n  this._isEmpty = false;\n};\n\nSignaturePad.prototype.toDataURL = function (type) {\n  var _canvas;\n\n  switch (type) {\n    case 'image/svg+xml':\n      return this._toSVG();\n    default:\n      for (var _len = arguments.length, options = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        options[_key - 1] = arguments[_key];\n      }\n\n      return (_canvas = this._canvas).toDataURL.apply(_canvas, [type].concat(options));\n  }\n};\n\nSignaturePad.prototype.on = function () {\n  this._handleMouseEvents();\n  this._handleTouchEvents();\n};\n\nSignaturePad.prototype.off = function () {\n  this._canvas.removeEventListener('mousedown', this._handleMouseDown);\n  this._canvas.removeEventListener('mousemove', this._handleMouseMove);\n  document.removeEventListener('mouseup', this._handleMouseUp);\n\n  this._canvas.removeEventListener('touchstart', this._handleTouchStart);\n  this._canvas.removeEventListener('touchmove', this._handleTouchMove);\n  this._canvas.removeEventListener('touchend', this._handleTouchEnd);\n};\n\nSignaturePad.prototype.isEmpty = function () {\n  return this._isEmpty;\n};\n\n// Private methods\nSignaturePad.prototype._strokeBegin = function (event) {\n  this._data.push([]);\n  this._reset();\n  this._strokeUpdate(event);\n\n  if (typeof this.onBegin === 'function') {\n    this.onBegin(event);\n  }\n};\n\nSignaturePad.prototype._strokeUpdate = function (event) {\n  var x = event.clientX;\n  var y = event.clientY;\n\n  var point = this._createPoint(x, y);\n  var lastPointGroup = this._data[this._data.length - 1];\n  var lastPoint = lastPointGroup && lastPointGroup[lastPointGroup.length - 1];\n  var isLastPointTooClose = lastPoint && point.distanceTo(lastPoint) < this.minDistance;\n\n  // Skip this point if it's too close to the previous one\n  if (!(lastPoint && isLastPointTooClose)) {\n    var _addPoint = this._addPoint(point),\n        curve = _addPoint.curve,\n        widths = _addPoint.widths;\n\n    if (curve && widths) {\n      this._drawCurve(curve, widths.start, widths.end);\n    }\n\n    this._data[this._data.length - 1].push({\n      x: point.x,\n      y: point.y,\n      time: point.time,\n      color: this.penColor\n    });\n  }\n};\n\nSignaturePad.prototype._strokeEnd = function (event) {\n  var canDrawCurve = this.points.length > 2;\n  var point = this.points[0]; // Point instance\n\n  if (!canDrawCurve && point) {\n    this._drawDot(point);\n  }\n\n  if (point) {\n    var lastPointGroup = this._data[this._data.length - 1];\n    var lastPoint = lastPointGroup[lastPointGroup.length - 1]; // plain object\n\n    // When drawing a dot, there's only one point in a group, so without this check\n    // such group would end up with exactly the same 2 points.\n    if (!point.equals(lastPoint)) {\n      lastPointGroup.push({\n        x: point.x,\n        y: point.y,\n        time: point.time,\n        color: this.penColor\n      });\n    }\n  }\n\n  if (typeof this.onEnd === 'function') {\n    this.onEnd(event);\n  }\n};\n\nSignaturePad.prototype._handleMouseEvents = function () {\n  this._mouseButtonDown = false;\n\n  this._canvas.addEventListener('mousedown', this._handleMouseDown);\n  this._canvas.addEventListener('mousemove', this._handleMouseMove);\n  document.addEventListener('mouseup', this._handleMouseUp);\n};\n\nSignaturePad.prototype._handleTouchEvents = function () {\n  // Pass touch events to canvas element on mobile IE11 and Edge.\n  this._canvas.style.msTouchAction = 'none';\n  this._canvas.style.touchAction = 'none';\n\n  this._canvas.addEventListener('touchstart', this._handleTouchStart);\n  this._canvas.addEventListener('touchmove', this._handleTouchMove);\n  this._canvas.addEventListener('touchend', this._handleTouchEnd);\n};\n\nSignaturePad.prototype._reset = function () {\n  this.points = [];\n  this._lastVelocity = 0;\n  this._lastWidth = (this.minWidth + this.maxWidth) / 2;\n  this._ctx.fillStyle = this.penColor;\n};\n\nSignaturePad.prototype._createPoint = function (x, y, time) {\n  var rect = this._canvas.getBoundingClientRect();\n\n  return new Point(x - rect.left, y - rect.top, time || new Date().getTime());\n};\n\nSignaturePad.prototype._addPoint = function (point) {\n  var points = this.points;\n  var tmp = void 0;\n\n  points.push(point);\n\n  if (points.length > 2) {\n    // To reduce the initial lag make it work with 3 points\n    // by copying the first point to the beginning.\n    if (points.length === 3) points.unshift(points[0]);\n\n    tmp = this._calculateCurveControlPoints(points[0], points[1], points[2]);\n    var c2 = tmp.c2;\n    tmp = this._calculateCurveControlPoints(points[1], points[2], points[3]);\n    var c3 = tmp.c1;\n    var curve = new Bezier(points[1], c2, c3, points[2]);\n    var widths = this._calculateCurveWidths(curve);\n\n    // Remove the first element from the list,\n    // so that we always have no more than 4 points in points array.\n    points.shift();\n\n    return { curve: curve, widths: widths };\n  }\n\n  return {};\n};\n\nSignaturePad.prototype._calculateCurveControlPoints = function (s1, s2, s3) {\n  var dx1 = s1.x - s2.x;\n  var dy1 = s1.y - s2.y;\n  var dx2 = s2.x - s3.x;\n  var dy2 = s2.y - s3.y;\n\n  var m1 = { x: (s1.x + s2.x) / 2.0, y: (s1.y + s2.y) / 2.0 };\n  var m2 = { x: (s2.x + s3.x) / 2.0, y: (s2.y + s3.y) / 2.0 };\n\n  var l1 = Math.sqrt(dx1 * dx1 + dy1 * dy1);\n  var l2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);\n\n  var dxm = m1.x - m2.x;\n  var dym = m1.y - m2.y;\n\n  var k = l2 / (l1 + l2);\n  var cm = { x: m2.x + dxm * k, y: m2.y + dym * k };\n\n  var tx = s2.x - cm.x;\n  var ty = s2.y - cm.y;\n\n  return {\n    c1: new Point(m1.x + tx, m1.y + ty),\n    c2: new Point(m2.x + tx, m2.y + ty)\n  };\n};\n\nSignaturePad.prototype._calculateCurveWidths = function (curve) {\n  var startPoint = curve.startPoint;\n  var endPoint = curve.endPoint;\n  var widths = { start: null, end: null };\n\n  var velocity = this.velocityFilterWeight * endPoint.velocityFrom(startPoint) + (1 - this.velocityFilterWeight) * this._lastVelocity;\n\n  var newWidth = this._strokeWidth(velocity);\n\n  widths.start = this._lastWidth;\n  widths.end = newWidth;\n\n  this._lastVelocity = velocity;\n  this._lastWidth = newWidth;\n\n  return widths;\n};\n\nSignaturePad.prototype._strokeWidth = function (velocity) {\n  return Math.max(this.maxWidth / (velocity + 1), this.minWidth);\n};\n\nSignaturePad.prototype._drawPoint = function (x, y, size) {\n  var ctx = this._ctx;\n\n  ctx.moveTo(x, y);\n  ctx.arc(x, y, size, 0, 2 * Math.PI, false);\n  this._isEmpty = false;\n};\n\nSignaturePad.prototype._drawCurve = function (curve, startWidth, endWidth) {\n  var ctx = this._ctx;\n  var widthDelta = endWidth - startWidth;\n  var drawSteps = Math.floor(curve.length());\n\n  ctx.beginPath();\n\n  for (var i = 0; i < drawSteps; i += 1) {\n    // Calculate the Bezier (x, y) coordinate for this step.\n    var t = i / drawSteps;\n    var tt = t * t;\n    var ttt = tt * t;\n    var u = 1 - t;\n    var uu = u * u;\n    var uuu = uu * u;\n\n    var x = uuu * curve.startPoint.x;\n    x += 3 * uu * t * curve.control1.x;\n    x += 3 * u * tt * curve.control2.x;\n    x += ttt * curve.endPoint.x;\n\n    var y = uuu * curve.startPoint.y;\n    y += 3 * uu * t * curve.control1.y;\n    y += 3 * u * tt * curve.control2.y;\n    y += ttt * curve.endPoint.y;\n\n    var width = startWidth + ttt * widthDelta;\n    this._drawPoint(x, y, width);\n  }\n\n  ctx.closePath();\n  ctx.fill();\n};\n\nSignaturePad.prototype._drawDot = function (point) {\n  var ctx = this._ctx;\n  var width = typeof this.dotSize === 'function' ? this.dotSize() : this.dotSize;\n\n  ctx.beginPath();\n  this._drawPoint(point.x, point.y, width);\n  ctx.closePath();\n  ctx.fill();\n};\n\nSignaturePad.prototype._fromData = function (pointGroups, drawCurve, drawDot) {\n  for (var i = 0; i < pointGroups.length; i += 1) {\n    var group = pointGroups[i];\n\n    if (group.length > 1) {\n      for (var j = 0; j < group.length; j += 1) {\n        var rawPoint = group[j];\n        var point = new Point(rawPoint.x, rawPoint.y, rawPoint.time);\n        var color = rawPoint.color;\n\n        if (j === 0) {\n          // First point in a group. Nothing to draw yet.\n\n          // All points in the group have the same color, so it's enough to set\n          // penColor just at the beginning.\n          this.penColor = color;\n          this._reset();\n\n          this._addPoint(point);\n        } else if (j !== group.length - 1) {\n          // Middle point in a group.\n          var _addPoint2 = this._addPoint(point),\n              curve = _addPoint2.curve,\n              widths = _addPoint2.widths;\n\n          if (curve && widths) {\n            drawCurve(curve, widths, color);\n          }\n        } else {\n          // Last point in a group. Do nothing.\n        }\n      }\n    } else {\n      this._reset();\n      var _rawPoint = group[0];\n      drawDot(_rawPoint);\n    }\n  }\n};\n\nSignaturePad.prototype._toSVG = function () {\n  var _this2 = this;\n\n  var pointGroups = this._data;\n  var canvas = this._canvas;\n  var ratio = Math.max(window.devicePixelRatio || 1, 1);\n  var minX = 0;\n  var minY = 0;\n  var maxX = canvas.width / ratio;\n  var maxY = canvas.height / ratio;\n  var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n\n  svg.setAttributeNS(null, 'width', canvas.width);\n  svg.setAttributeNS(null, 'height', canvas.height);\n\n  this._fromData(pointGroups, function (curve, widths, color) {\n    var path = document.createElement('path');\n\n    // Need to check curve for NaN values, these pop up when drawing\n    // lines on the canvas that are not continuous. E.g. Sharp corners\n    // or stopping mid-stroke and than continuing without lifting mouse.\n    if (!isNaN(curve.control1.x) && !isNaN(curve.control1.y) && !isNaN(curve.control2.x) && !isNaN(curve.control2.y)) {\n      var attr = 'M ' + curve.startPoint.x.toFixed(3) + ',' + curve.startPoint.y.toFixed(3) + ' ' + ('C ' + curve.control1.x.toFixed(3) + ',' + curve.control1.y.toFixed(3) + ' ') + (curve.control2.x.toFixed(3) + ',' + curve.control2.y.toFixed(3) + ' ') + (curve.endPoint.x.toFixed(3) + ',' + curve.endPoint.y.toFixed(3));\n\n      path.setAttribute('d', attr);\n      path.setAttribute('stroke-width', (widths.end * 2.25).toFixed(3));\n      path.setAttribute('stroke', color);\n      path.setAttribute('fill', 'none');\n      path.setAttribute('stroke-linecap', 'round');\n\n      svg.appendChild(path);\n    }\n  }, function (rawPoint) {\n    var circle = document.createElement('circle');\n    var dotSize = typeof _this2.dotSize === 'function' ? _this2.dotSize() : _this2.dotSize;\n    circle.setAttribute('r', dotSize);\n    circle.setAttribute('cx', rawPoint.x);\n    circle.setAttribute('cy', rawPoint.y);\n    circle.setAttribute('fill', rawPoint.color);\n\n    svg.appendChild(circle);\n  });\n\n  var prefix = 'data:image/svg+xml;base64,';\n  var header = '<svg' + ' xmlns=\"http://www.w3.org/2000/svg\"' + ' xmlns:xlink=\"http://www.w3.org/1999/xlink\"' + (' viewBox=\"' + minX + ' ' + minY + ' ' + maxX + ' ' + maxY + '\"') + (' width=\"' + maxX + '\"') + (' height=\"' + maxY + '\"') + '>';\n  var body = svg.innerHTML;\n\n  // IE hack for missing innerHTML property on SVGElement\n  if (body === undefined) {\n    var dummy = document.createElement('dummy');\n    var nodes = svg.childNodes;\n    dummy.innerHTML = '';\n\n    for (var i = 0; i < nodes.length; i += 1) {\n      dummy.appendChild(nodes[i].cloneNode(true));\n    }\n\n    body = dummy.innerHTML;\n  }\n\n  var footer = '</svg>';\n  var data = header + body + footer;\n\n  return prefix + btoa(data);\n};\n\nSignaturePad.prototype.fromData = function (pointGroups) {\n  var _this3 = this;\n\n  this.clear();\n\n  this._fromData(pointGroups, function (curve, widths) {\n    return _this3._drawCurve(curve, widths.start, widths.end);\n  }, function (rawPoint) {\n    return _this3._drawDot(rawPoint);\n  });\n\n  this._data = pointGroups;\n};\n\nSignaturePad.prototype.toData = function () {\n  return this._data;\n};\n\nexport default SignaturePad;\n"],"names":["e","t","n","r","module","exports","require","a","id","loaded","call","m","c","p","__esModule","default","indexOf","Object","prototype","hasOwnProperty","o","TypeError","i","ReferenceError","u","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","defineProperty","s","assign","arguments","length","key","l","d","h","g","this","Array","f","getPrototypeOf","apply","concat","_sigPad","_excludeOurProps","props","canvasProps","clearOnResize","getCanvas","_canvas","getTrimmedCanvas","document","createElement","width","height","getContext","drawImage","getSignaturePad","_checkClearOnResize","_resizeCanvas","Math","max","window","devicePixelRatio","offsetWidth","offsetHeight","scale","clear","on","addEventListener","off","removeEventListener","isEmpty","fromDataURL","toDataURL","fromData","toData","ref","Component","propTypes","velocityFilterWeight","number","minWidth","maxWidth","minDistance","dotSize","oneOfType","func","penColor","string","throttle","onEnd","onBegin","object","bool","defaultProps","getImageData","data","clearRect","putImageData","red","green","blue","alpha","_assertClassBrand","has","_classPrivateFieldGet2","get","_classPrivateFieldDestructureSet","set","__destrObj","_superPropBase","_get","Reflect","bind","getOwnPropertyDescriptor","_classApplyDescriptorSet","_classCheckPrivateStaticFieldDescriptor","_classStaticPrivateFieldSpecSet","_classApplyDescriptorGet","_classStaticPrivateFieldSpecGet","_checkPrivateRedeclaration","_classPrivateMethodInitSpec","add","_classPrivateMethodGet","_classPrivateFieldInitSpec","_classPrivateFieldGet","_classPrivateFieldSet","_classStaticPrivateMethodGet","_createForOfIteratorHelper","Symbol","iterator","isArray","unsupportedIterableToArray","_n","F","done","next","isNodeJS","process","versions","nw","electron","type","IDENTITY_MATRIX","FONT_IDENTITY_MATRIX","LINE_FACTOR","RenderingIntentFlag","AnnotationMode","DISABLE","ENABLE","ENABLE_FORMS","ENABLE_STORAGE","AnnotationEditorType","NONE","FREETEXT","HIGHLIGHT","STAMP","INK","AnnotationEditorParamsType","RESIZE","CREATE","FREETEXT_SIZE","FREETEXT_COLOR","FREETEXT_OPACITY","INK_COLOR","INK_THICKNESS","INK_OPACITY","HIGHLIGHT_COLOR","HIGHLIGHT_DEFAULT_COLOR","HIGHLIGHT_THICKNESS","HIGHLIGHT_FREE","HIGHLIGHT_SHOW_ALL","PermissionFlag","PRINT","MODIFY_CONTENTS","COPY","MODIFY_ANNOTATIONS","FILL_INTERACTIVE_FORMS","COPY_FOR_ACCESSIBILITY","ASSEMBLE","PRINT_HIGH_QUALITY","TextRenderingMode","ImageKind","GRAYSCALE_1BPP","RGB_24BPP","RGBA_32BPP","AnnotationType","AnnotationBorderStyleType","VerbosityLevel","ERRORS","WARNINGS","INFOS","CMapCompressionType","BINARY","OPS","dependency","setLineWidth","setLineCap","setLineJoin","setMiterLimit","setDash","setRenderingIntent","setFlatness","setGState","save","restore","transform","moveTo","lineTo","curveTo","curveTo2","curveTo3","closePath","rectangle","stroke","closeStroke","fill","eoFill","fillStroke","eoFillStroke","closeFillStroke","closeEOFillStroke","endPath","clip","eoClip","beginText","endText","setCharSpacing","setWordSpacing","setHScale","setLeading","setFont","setTextRenderingMode","setTextRise","moveText","setLeadingMoveText","setTextMatrix","nextLine","showText","showSpacedText","nextLineShowText","nextLineSetSpacingShowText","setCharWidth","setCharWidthAndBounds","setStrokeColorSpace","setFillColorSpace","setStrokeColor","setStrokeColorN","setFillColor","setFillColorN","setStrokeGray","setFillGray","setStrokeRGBColor","setFillRGBColor","setStrokeCMYKColor","setFillCMYKColor","shadingFill","beginInlineImage","beginImageData","endInlineImage","paintXObject","markPoint","markPointProps","beginMarkedContent","beginMarkedContentProps","endMarkedContent","beginCompat","endCompat","paintFormXObjectBegin","paintFormXObjectEnd","beginGroup","endGroup","beginAnnotation","endAnnotation","paintImageMaskXObject","paintImageMaskXObjectGroup","paintImageXObject","paintInlineImageXObject","paintInlineImageXObjectGroup","paintImageXObjectRepeat","paintImageMaskXObjectRepeat","paintSolidColorImageMask","constructPath","setStrokeTransparent","setFillTransparent","PasswordResponses","NEED_PASSWORD","INCORRECT_PASSWORD","verbosity","setVerbosityLevel","level","Number","isInteger","getVerbosityLevel","info","msg","console","log","warn","unreachable","Error","assert","cond","_isValidProtocol","url","protocol","createValidAbsoluteUrl","baseUrl","options","addDefaultProtocol","startsWith","dots","match","tryConvertEncoding","stringToUTF8String","absoluteUrl","URL","shadow","obj","prop","nonSerializable","BaseException","message","name","PasswordException","code","UnknownErrorException","details","InvalidPDFException","MissingPDFException","UnexpectedResponseException","status","FormatError","AbortException","bytesToString","bytes","undefined","MAX_ARGUMENT_COUNT","String","fromCharCode","strBuf","chunkEnd","min","chunk","subarray","push","join","stringToBytes","str","Uint8Array","charCodeAt","objectFromMap","map","FeatureTest","buffer8","Uint32Array","buffer","isLittleEndian","Function","isEvalSupported","OffscreenCanvas","navigator","platform","isMac","includes","globalThis","CSS","supports","hexNumbers","from","keys","toString","padStart","Util","b","minMax","temp","m1","m2","p1","applyTransform","p2","slice","p3","p4","transpose","first","second","sqrt","sx","sy","rect","rect1","rect2","xLow","xHigh","yLow","yHigh","x0","y0","x1","y1","x2","y2","x3","y3","mt","tt","ttt","x","y","abs","delta","sqrtDelta","a2","decodeURIComponent","escape","NormalizeRegex","NormalizationMap","normalizeUnicode","Map","replaceAll","_","normalize","getUuid","crypto","randomUUID","buf","getRandomValues","floor","random","AnnotationPrefix","FontRenderOps","BaseFilterFactory","addFilter","maps","addHCMFilter","fgColor","bgColor","addAlphaFilter","addLuminosityFilter","addHighlightHCMFilter","filterName","newFgColor","newBgColor","destroy","BaseCanvasFactory","enableHWA","canvas","_createCanvas","context","willReadFrequently","reset","canvasAndContext","BaseCMapReaderFactory","isCompressed","compressionType","_fetchData","catch","reason","BaseStandardFontDataFactory","filename","BaseSVGFactory","skipDimensions","svg","_createSVG","setAttribute","SVG_NS","PixelsPerInch","PDF","DOMFilterFactory","docId","ownerDocument","tableR","tableG","tableB","filter","remove","fgRGB","makeHexColor","bgRGB","style","color","table","getSteps","start","end","arr","tableA","fgGray","round","bgGray","newFgRGB","newBgRGB","fg","bg","step","newStart","newStep","prev","k","j","keepHCM","size","parentNode","div","visibility","contain","position","top","left","zIndex","createElementNS","append","body","mapR","mapG","mapB","bufferR","bufferG","bufferB","baseURI","isDataScheme","split","feColorMatrix","feComponentTransfer","feFunc","rTable","gTable","bTable","aTable","getRGB","getComputedStyle","getPropertyValue","DOMCanvasFactory","_document","fetchData","isValidFetchUrl","fetch","response","ok","statusText","arrayBuffer","blob","json","text","Promise","resolve","reject","request","XMLHttpRequest","open","responseType","onreadystatechange","readyState","DONE","responseText","send","DOMCMapReaderFactory","then","cMapData","ArrayBuffer","DOMStandardFontDataFactory","DOMSVGFactory","PageViewport","viewBox","rotation","offsetX","offsetY","dontFlip","rotateA","rotateB","rotateC","rotateD","offsetCanvasX","offsetCanvasY","centerX","centerY","pageWidth","pageHeight","pageX","pageY","clone","convertToViewportPoint","convertToViewportRectangle","topLeft","bottomRight","convertToPdfPoint","applyInverseTransform","RenderingCancelledException","extraDelay","ii","trim","substring","toLowerCase","isPdfFile","test","getFilenameFromUrl","lastIndexOf","getPdfFilenameFromUrl","defaultFilename","reURI","reFilename","splitURI","exec","suggestedFilename","pdfDateStringRegex","StatTimer","time","started","Date","now","timeEnd","times","outBuf","longest","padEnd","noContextMenu","preventDefault","PDFDateString","input","RegExp","matches","year","parseInt","month","day","hour","minute","universalTimeRelation","offsetHour","offsetMinute","UTC","getXfaPageViewport","xfaPage","attributes","colorRGB","getCurrentTransform","ctx","getTransform","getCurrentTransformInverse","invertSelf","setLayerDimensions","viewport","mustFlip","mustRotate","rawDims","useRound","isCSSRoundSupported","w","widthStr","heightStr","EditorToolbar","editor","render","editToolbar","className","signal","_uiManager","_signal","buttons","toolbarPosition","direction","insetInlineEnd","hide","classList","hideDropdown","show","addAltTextButton","button","prepend","addColorPicker","colorPicker","renderButton","stopPropagation","_focusEventsAllowed","element","capture","tabIndex","editorType","delete","divider","HighlightToolbar","uiManager","parent","boxes","isLTR","lastY","lastX","box","span","highlightSelection","bindEvents","names","IdManager","ImageManager","file","lastModified","bitmap","refCounter","getFromFile","getFromUrl","getSvgUrl","isSvg","svgUrl","deleteId","isValidId","image","Image","src","decode","rawData","mustRemoveAspectRatioPromise","_isSVGFittingCanvas","fileReader","FileReader","imageElement","imagePromise","onload","result","onerror","readAsDataURL","createImageBitmap","error","CommandManager","maxSize","cmd","undo","post","mustExec","NaN","overwriteIfSameType","keepUndo","splice","redo","hasSomethingToUndo","hasSomethingToRedo","KeyboardManager","callbacks","allKeys","Set","callback","isMacKey","at","self","event","bubbles","args","checker","altKey","ctrlKey","metaKey","shiftKey","ColorManager","colors","computedColor","getColorValues","convert","rgb","matchMedia","_colors","every","_colorsMapping","getHexCode","AnnotationEditorUIManager","container","viewer","altTextManager","eventBus","pdfDocument","pageColors","highlightColors","enableHighlightFloatingButton","enableUpdatedAddImage","mlManager","AbortController","blur","focus","copy","cut","paste","keydown","keyup","onEditingAction","onPageChanging","onScaleChanging","onRotationChanging","isEditing","hasSelectedEditor","hasSelectedText","_eventBus","_on","annotationStorage","filterFactory","viewParameters","realScale","PDF_TO_CSS_UNITS","isShiftKeyDown","abort","_off","values","clearTimeout","guess","isEnabledFor","foreground","background","pair","reverse","setMainHighlightColorPicker","editAltText","switchToMode","mode","once","dispatch","source","setPreference","pageNumber","focusMainContainer","findParent","layer","getBoundingClientRect","layerX","layerY","disableUserSelect","toggle","addShouldRescale","removeShouldRescale","commitOrRemove","pagesRotation","methodOfCreation","selection","getSelection","isCollapsed","anchorNode","anchorOffset","focusNode","focusOffset","anchorElement","textLayer","closest","getSelectionBoxes","empty","isNoneMode","createAndAddNewEditor","showAllEditors","addToAnnotationStorage","setValue","hasSelection","activeElement","contains","lastEditor","lastActiveElement","addEditListeners","removeEditListeners","dragOver","dataTransfer","items","isHandlingMimeForPasting","dropEffect","drop","item","currentLayer","editors","serialized","serialize","clipboardData","setData","JSON","stringify","getData","parse","ex","unselectAll","newEditors","deserializedEditor","deserialize","addCommands","isEditorHandlingKeyboard","_keyboardManager","setEditingState","registerEditorTypes","types","defaultPropertiesToUpdate","getId","getLayer","pageIndex","addLayer","enable","disable","removeLayer","updateMode","editId","isFromKeyboard","annotationElementId","setSelected","enterInEditMode","addNewEditorFromKeyboard","canCreateNewEmptyEditor","addNewEditor","updateToolbar","updateParams","updateColor","action","updateDefaultParams","visible","state","enableWaiting","mustWait","disableClick","enableClick","getEditors","getEditor","addEditor","removeEditor","setTimeout","unselect","addDeletedAnnotationElement","addChangedExistingAnnotation","deleted","isDeletedAnnotationElement","removeDeletedAnnotationElement","removeChangedExistingAnnotation","setActiveEditor","propertiesToUpdate","updateUI","toggleSelected","select","ed","isSelected","firstSelectedEditor","isEnterHandled","params","hasSomethingToControl","selectAll","commit","translateSelectedEditors","noCommit","totalX","totalY","TIME_TO_WAIT","translateInPage","setUpDragSession","savedX","savedY","savedPageIndex","newX","newY","newPageIndex","endDragSession","mustBeAddedInUndoStack","move","_setParentAndPosition","dragSelectedEditors","tx","ty","drag","rebuild","changeParent","addOrRebuild","getActive","shouldGetKeyboardEvents","isActive","getMode","rangeCount","getRangeAt","commonAncestorContainer","rotator","parentWidth","parentHeight","getAttribute","range","collapsed","getClientRects","renderAnnotationElement","annotation","editorId","getRawValue","hasBeenModified","proto","arrowChecker","tagName","textInputChecker","_self","el","target","HTMLInputElement","small","TRANSLATE_SMALL","big","TRANSLATE_BIG","HTMLButtonElement","nodeType","Node","TEXT_NODE","parentElement","hasTextLayer","activeLayer","toggleDrawing","pointerup","entries","some","AltText","altText","_l10nPromise","textContent","onClick","finish","focusVisible","decorative","enabled","disabled","l10nPromise","tooltip","_reportTelemetry","innerText","getImageForAltText","AnnotationEditor","parameters","focusin","focusout","_zIndex","_willKeepAspectRatio","_initialOptions","isCentered","_structTreeParentId","pageRotation","pageDimensions","pageTranslation","parentDimensions","isAttachedToDOM","_type","center","parentRotation","fixAndSetPosition","setInBackground","setInForeground","setParent","relatedTarget","isMultipleSelection","setAt","screenToPageTranslation","translate","scrollIntoView","block","findNewParent","getBaseTranslation","toFixed","_borderLineWidth","_mustFixPosition","bx","by","moveInDOM","pageTranslationToScreen","parentScale","scaledWidth","scaledHeight","setDims","fixDims","widthPercent","endsWith","heightPercent","parseFloat","getInitialTranslation","altTextFinish","removeEditToolbar","getClientDimensions","initialize","addEditToolbar","hasAltText","_isVisible","maxHeight","pointerdown","_isDraggable","moveEditorInDOM","getRect","shiftX","shiftY","getRectInCurrentCoords","onceAdded","enableEditMode","disableEditMode","isInEditMode","needsToBeRebuilt","rotate","_angle","timeout","makeResizable","isResizable","savedWidth","savedHeight","children","boundResizerKeydown","boundResizerBlur","firstPosition","nextFirstPosition","firstChild","before","lastChild","child","stopImmediatePropagation","_resizeWithKeyboard","movementX","movementY","_stopResizingWithKeyboard","preventScroll","disableEditing","enableEditing","setAspectRatio","aspectRatio","_telemetryTimeout","content","querySelector","nodeName","resetAnnotationElement","resize","_colorManager","fakeEditor","FakeEditor","getNextId","l10n","strings","documentElement","_value","mime","accessibilityData","angle","classes","boundResizerPointermove","savedDraggable","pointerMoveOptions","passive","togglePointerEvents","savedParentCursor","cursor","savedCursor","pointerUpCallback","newWidth","newHeight","getPoint","getOpposite","MIN_SIZE","minHeight","rotationMatrix","transf","invRotationMatrix","isDiagonal","isHorizontal","point","oppositePoint","transfOppositePoint","oppositeX","oppositeY","ratioX","ratioY","deltaX","deltaY","oldDiag","hypot","pointerMoveCallback","clientX","clientY","_resizerKeyboardManager","SEED","MASK_HIGH","MASK_LOW","MurmurHash3_64","seed","h1","h2","update","isView","byteLength","blockCounts","tailLength","dataUint32","k1","k2","C1","C2","C1_LOW","C2_LOW","hexdigest","SerializableEmpty","freeze","hash","transfer","AnnotationStorage","onSetModified","onResetModified","onAnnotationEditor","getValue","defaultValue","resetModified","modified","entry","val","getAll","setAll","PrintAnnotationStorage","hasBitmap","stats","typeToEditor","editorStats","telemetryFinalData","counters","count","computeTelemetryFinalData","resetModifiedIds","ids","serializable","structuredClone","FontLoader","styleElement","nativeFontFaces","loadingRequests","loadTestFontId","addNativeFontFace","nativeFontFace","fonts","removeNativeFontFace","insertRule","rule","getElementsByTagName","styleSheet","sheet","cssRules","systemFontInfo","_inspectFont","loadedName","disableFontFace","isFontLoadingAPISupported","fontFace","FontFace","load","baseFontName","font","attached","missingFile","loadSystemFont","createNativeFontFace","family","createFontFaceRule","isSyncFontLoadingSupported","_queueLoadingCallback","_prepareFontLoadEvent","supported","userAgent","complete","otherRequest","shift","atob","int32","offset","spliceString","insert","called","_loadTestFont","XXXX_VALUE","checksum","btoa","fontFamily","isFontReady","fillText","FontFaceObject","translatedData","inspectFont","compiledGlyphs","cssFontInfo","css","weight","fontWeight","italicAngle","mimetype","getPathGenerator","objs","character","cmds","commands","bezierCurveTo","quadraticCurveTo","packageCapability","withResolvers","packageMap","loadPackages","fs","http","https","path2d","NodePackages","promise","promises","readFile","NodeFilterFactory","NodeCanvasFactory","createCanvas","NodeCMapReaderFactory","NodeStandardFontDataFactory","PathType","applyBoundingBox","bbox","region","Path2D","BaseShadingPattern","getPattern","RadialAxialShadingPattern","IR","_bbox","_colorStops","_p0","_p1","_r0","_r1","matrix","_createGradient","grad","createLinearGradient","createRadialGradient","colorStop","addColorStop","owner","inverse","pathType","pattern","ownerBBox","current","getClippedPathBoundingBox","ceil","tmpCanvas","cachedCanvases","tmpCtx","beginPath","baseTransform","fillStyle","createPattern","domMatrix","DOMMatrix","setTransform","drawTriangle","c1","c2","c3","tmp","coords","rowSize","scaleX","scaleY","xa","car","cag","cab","xb","cbr","cbg","cbb","c1r","c1g","c1b","c2r","c2g","c2b","c3r","c3g","c3b","minY","maxY","x1_","x2_","drawFigure","figure","ps","cs","verticesPerRow","rows","cols","q","MeshShadingPattern","_coords","_figures","_bounds","_background","_createMeshCanvas","combinedScale","backgroundColor","boundsWidth","boundsHeight","paddedWidth","BORDER_SIZE","paddedHeight","createImageData","singularValueDecompose2dScale","matrixScale","temporaryPatternCanvas","DummyShadingPattern","getShadingPattern","PaintType","TilingPattern","canvasGraphicsFactory","operatorList","xstep","ystep","paintType","tilingType","createPatternCanvas","curMatrixScale","dimx","getSizeAndScale","dimy","graphics","createCanvasGraphics","groupLevel","setFillAndStrokeStyleToContext","adjustedX0","adjustedY0","adjustedX1","adjustedY1","clipBbox","executeOperatorList","endDrawing","realOutputSize","MAX_PATTERN_SIZE","bboxWidth","bboxHeight","updateRectMinMax","strokeStyle","fillColor","strokeColor","cssColor","convertBlackAndWhiteToRGBA","srcPos","dest","nonBlackColor","inverseDecode","black","zeroMapping","oneMapping","widthInSource","widthRemainder","srcLength","destPos","elem","FULL_CHUNK_HEIGHT","CachedCanvases","canvasFactory","cache","canvasEntry","drawImageAtIntegerCoords","srcImg","srcX","srcY","srcW","srcH","destX","destY","destW","destH","tlX","rTlX","tlY","rTlY","brX","rWidth","brY","rHeight","sign","CanvasExtraState","alphaIsShape","fontSize","fontSizeScale","textMatrix","textMatrixScale","fontMatrix","leading","lineX","lineY","charSpacing","wordSpacing","textHScale","textRenderingMode","textRise","patternFill","fillAlpha","strokeAlpha","lineWidth","activeSMask","transferMaps","startNewPathAndClipBox","clipBox","setCurrentPoint","updatePathMinMax","minX","maxX","updateScalingPathMinMax","scaleMinMax","updateCurvePathMinMax","bezierBoundingBox","getPathBoundingBox","xStrokePad","yStrokePad","updateClipFromPath","intersect","isEmptyClip","Infinity","putBinaryImageData","imgData","ImageData","thisChunkHeight","elemsInThisChunk","partialChunkHeight","fullChunks","totalChunks","chunkImgData","kind","dest32","dest32DataLength","fullSrcDiff","white","srcDiff","kEnd","kEndUnrolled","mask","srcByte","putBinaryImageMask","copyCtxState","sourceCtx","destCtx","property","setLineDash","getLineDash","lineDashOffset","resetCtxToDefault","fillRule","globalAlpha","lineCap","lineJoin","miterLimit","globalCompositeOperation","getImageSmoothingEnabled","interpolate","fround","actualScale","LINE_CAP_STYLES","LINE_JOIN_STYLES","NORMAL_CLIP","EO_CLIP","CanvasGraphics","canvasCtx","commonObjs","annotationCanvasMap","optionalContentConfig","markedContentStack","stateStack","pendingClip","pendingEOFill","res","xobjs","groupStack","processingType3","baseTransformStack","smaskStack","smaskCounter","tempSMask","suspendedCtx","contentVisible","cachedPatterns","viewportScale","outputScaleX","outputScaleY","_cachedScaleForStroking","_cachedGetSinglePixelWidth","_cachedBitmapsMap","getObject","fallback","beginDrawing","transparency","savedFillStyle","fillRect","transparentCanvas","compositeCtx","executionStartIdx","continueCallback","stepper","argsArray","fnArray","argsArrayLen","fnId","chunkOperations","endTime","steps","nextBreakPoint","breakIt","depObjId","objsPool","HTMLCanvasElement","_scaleImage","img","inverseTransform","widthScale","heightScale","paintWidth","paintHeight","tmpCanvasId","_createMaskCanvas","cacheKey","scaled","maskCanvas","isPatternFill","currentTransform","mainKey","cachedImage","maskToCanvas","getAxialAlignedBoundingBox","drawnWidth","drawnHeight","fillCanvas","fillCtx","imageSmoothingEnabled","limit","dashArray","dashPhase","intent","flatness","states","checkSMaskState","inSMaskMode","beginSMaskMode","endSMaskMode","cacheId","scratchCanvas","_removeMirroring","__originalSave","__originalRestore","__originalRotate","__originalScale","__originalTranslate","__originalTransform","__originalSetTransform","__originalResetTransform","resetTransform","__originalClip","__originalMoveTo","__originalLineTo","__originalBezierCurveTo","__originalRect","__originalClosePath","__originalBeginPath","cp1x","cp1y","cp2x","cp2y","mirrorContextOperations","compose","dirtyBox","smask","composeSMask","layerCtx","layerBox","layerOffsetX","layerOffsetY","layerWidth","layerHeight","genericComposeSMask","subtype","backdrop","transferMap","maskCtx","maskOffsetX","maskOffsetY","maskX","maskY","old","pop","ops","startX","startY","isScalingMatrix","minMaxForBezier","xw","yh","consumePath","rescaleAndStroke","needRestore","paths","pendingTextPaths","path","addToPath","spacing","fontRefName","fontObj","fontDirection","isType3Font","typeface","fallbackName","bold","italic","browserFontSize","rise","paintChar","patternTransform","fillStrokeMode","isAddToPathSet","strokeText","glyphs","showType3Text","glyphsLength","vertical","spacingDir","defaultVMetrics","widthAdvanceScale","simpleFillText","getSinglePixelWidth","isInvalidPDFjsFont","chars","glyph","unicode","restoreNeeded","isSpace","fontChar","accent","scaledX","scaledY","vmetric","vx","vy","remeasure","measuredWidth","measureText","isFontSubpixelAAEnabled","characterScaleX","isInFont","scaledAccentX","scaledAccentY","spacingLength","charProcOperatorList","operatorListId","xWidth","yWidth","llx","lly","urx","ury","getColorN_Pattern","_getPattern","objId","inv","group","currentCtx","isolated","knockout","bounds","canvasBounds","groupCtx","startTransformInverse","currentMtx","hasOwnCanvas","canvasWidth","canvasHeight","annotationCanvas","savedCtx","compiled","j0","POINT_TYPES","width1","points","lineSize","pos","sum","Int32Array","p0","pp","compileType3Glyph","skewX","skewY","positions","trans","images","applyTransferMapsToCanvas","applyTransferMapsToBitmap","imgToPaint","HTMLElement","tag","properties","isVisible","isContentVisible","absDet","normX","normY","getScaleForStroking","scaledLineWidth","scaledXLineWidth","scaledYLineWidth","baseArea","saveRestore","dashes","hcmFilterId","savedFilter","op","GlobalWorkerOptions","Worker","CallbackKind","StreamKind","wrapReason","MessageHandler","sourceName","targetName","comObj","callbackId","streamId","streamSinks","streamControllers","callbackCapabilities","actionHandler","_onComObjOnMessage","stream","capability","cbSourceName","cbTargetName","postMessage","actionName","handler","ah","transfers","sendWithPromise","sendWithStream","queueingStrategy","ReadableStream","controller","startCapability","startCall","pullCall","cancelCall","isClosed","desiredSize","pull","pullCapability","cancel","cancelCapability","streamSink","enqueue","isCancelled","lastDesiredSize","sinkCapability","ready","close","onPull","onCancel","success","streamController","allSettled","Metadata","parsedData","getRaw","INTERNAL","OptionalContentGroup","renderingIntent","usage","print","view","viewState","printState","_setVisible","internal","userSet","OptionalContentConfig","creator","order","groups","baseState","getHash","expression","policy","setVisibility","setOCGState","operator","preserveRB","getOrder","getGroups","getGroup","array","PDFDataTransportStream","pdfDataRangeTransport","disableRange","disableStream","initialData","progressiveDone","contentDispositionFilename","_queuedChunks","_progressiveDone","_contentDispositionFilename","_pdfDataRangeTransport","_isStreamingSupported","_isRangeSupported","_contentLength","_fullRequestReader","_rangeReaders","addRangeListener","begin","_onReceiveData","addProgressListener","total","_onProgress","addProgressiveReadListener","addProgressiveDoneListener","_onProgressiveDone","transportReady","_enqueue","rangeReader","_begin","_loaded","evt","onProgress","_removeRangeReader","reader","getFullReader","queuedChunks","PDFDataTransportStreamReader","getRangeReader","_progressiveDataLength","PDFDataTransportStreamRangeReader","requestDataRange","cancelAllRequests","_stream","_done","_filename","_requests","_headersReady","requestCapability","_end","_queuedChunk","validateRangeRequestCapabilities","getResponseHeader","isHttp","rangeChunkSize","returnValues","allowRangeRequests","suggestedLength","extractFilenameFromHeader","contentDisposition","needsEncodingFixup","toParamRegExp","rfc2616unquote","fixupEncoding","rfc2047decode","rfc5987decode","unescape","contentDispositionStr","iter","quot","part","parts","rfc2231getparam","attributePattern","flags","textdecode","encoding","decoder","TextDecoder","fatal","quotindex","extvalue","encodingend","replace","charset","hex","getFilenameFromContentDispositionHeader","createResponseStatusError","validateResponseStatus","createFetchOptions","headers","withCredentials","abortController","method","credentials","redirect","createHeaders","httpHeaders","Headers","getArrayBuffer","PDFFetchStream","_rangeRequestReaders","PDFFetchStreamReader","PDFFetchStreamRangeReader","_reader","_withCredentials","_headersCapability","_disableRange","_rangeChunkSize","_abortController","_headers","getReader","read","_readCapability","NetworkManager","currXhrId","pendingRequests","requestRange","listeners","requestFull","xhr","xhrId","pendingRequest","setRequestHeader","expectedStatus","onError","onStateChange","onprogress","onHeadersReceived","onDone","xhrStatus","rangeHeader","getRequestXhr","isPendingRequest","abortRequest","PDFNetworkStream","_source","_manager","_onRangeRequestReaderClosed","PDFNetworkStreamFullRequestReader","PDFNetworkStreamRangeRequestReader","onClosed","manager","_onHeadersReceived","_onDone","_onError","_url","_fullRequestId","_headersReceivedCapability","_cachedChunks","_storedError","fullRequestXhrId","fullRequestXhr","lengthComputable","_requestId","_close","isStreamingSupported","fileUriRegex","PDFNodeStream","sourceUrl","parsedUrl","host","parseUrl","isFsUrl","PDFNodeStreamFsFullReader","PDFNodeStreamFullReader","PDFNodeStreamFsRangeReader","PDFNodeStreamRangeReader","BaseFullReader","_readableStream","_error","_setReadableStream","readableStream","BaseRangeReader","createRequestOptions","auth","hostname","port","handleResponse","statusCode","_request","_httpHeaders","Range","href","lstat","stat","createReadStream","DEFAULT_FONT_SIZE","TextLayer","textContentSource","FontInspector","WeakMap","prevFontSize","prevFontFamily","pump","lang","styles","onBefore","abortEx","textDivs","textContentItemsStr","geom","textDiv","textDivProperties","hasText","hasEOL","atan2","fontName","PI","fontSubstitution","fontHeight","fontAscent","sin","cos","scaleFactorStr","divStyle","dir","dataset","fontSubstitutionLoadedName","shouldScaleText","absScaleX","absScaleY","br","canvasContext","opacity","lineHeight","cachedAscent","savedFont","metrics","ascent","fontBoundingBoxAscent","descent","fontBoundingBoxDescent","ratio","pixels","XfaText","xfa","output","walk","node","shouldBuildText","DefaultCanvasFactory","DefaultCMapReaderFactory","DefaultFilterFactory","DefaultStandardFontDataFactory","getDocument","task","PDFDocumentLoadingTask","getUrlProp","getDataProp","password","rangeTransport","PDFDataRangeTransport","worker","PDFWorker","docBaseUrl","cMapUrl","cMapPacked","CMapReaderFactory","standardFontDataUrl","StandardFontDataFactory","ignoreErrors","stopAtErrors","maxImageSize","isOffscreenCanvasSupported","canvasMaxAreaInBytes","fontExtraProperties","enableXfa","disableAutoFetch","pdfBug","useSystemFonts","useWorkerFetch","transportFactory","cMapReaderFactory","standardFontDataFactory","workerParams","workerPort","fromPort","_worker","docParams","apiVersion","evaluatorOptions","transportParams","loadingParams","destroyed","networkStream","workerIdPromise","messageHandler","Response","createPDFNetworkStream","workerId","transport","WorkerTransport","_transport","_capability","location","Buffer","isNaN","isRefProxy","num","gen","onPassword","_pendingDestroy","_rangeListeners","_progressListeners","_progressiveReadListeners","_progressiveDoneListeners","_readyCapability","listener","onDataRange","onDataProgress","onDataProgressiveRead","onDataProgressiveDone","PDFDocumentProxy","pdfInfo","_pdfInfo","numPages","fingerprints","_htmlForXfa","getPage","getPageIndex","getDestinations","getDestination","getPageLabels","getPageLayout","getPageMode","getViewerPreferences","getOpenAction","getAttachments","getJSActions","getDocJSActions","getOutline","getOptionalContentConfig","getRenderingIntent","getPermissions","getMetadata","getMarkInfo","saveDocument","getDownloadInfo","downloadInfoCapability","cleanup","keepLoadedFonts","startCleanup","isPureXfa","loadingTask","cachedPageNumber","getFieldObjects","hasJSActions","getCalculationOrderIds","PDFPageProxy","pageInfo","_pageIndex","_pageInfo","_stats","_pdfBug","PDFObjects","_maybeCleanupAfterRender","_intentStates","userUnit","getViewport","getAnnotations","getPageJSActions","annotationMode","optionalContentConfigPromise","printAnnotationStorage","intentArgs","intentState","streamReaderCancelTimeout","intentPrint","displayReadyCapability","lastChunk","separateAnnots","_pumpOperatorList","renderTasks","internalRenderTask","_abortOperatorList","Stats","InternalRenderTask","useRequestAnimationFrame","renderTask","all","initializeGraphics","operatorListChanged","getOperatorList","opListReadCapability","opListTask","streamTextContent","includeMarkedContent","disableNormalization","TEXT_CONTENT_CHUNK_SIZE","highWaterMark","getTextContent","getXfa","getStructTree","_destroy","waitOn","force","completed","resetStats","_startRenderPage","_renderPageChunk","operatorListChunk","annotationStorageSerializable","modifiedIds","streamReader","delay","curCacheKey","delayed","LoopbackPort","terminate","PDFWorkerUtil","isWorkerDisabled","fakeWorkerId","workerSrc","isSameOrigin","otherUrl","base","origin","other","createCDNWrapper","wrapper","createObjectURL","Blob","_port","_webWorker","_messageHandler","_initializeFromPort","_initialize","_setupFakeWorker","terminateEarly","ac","sendTest","testObj","_setupFakeWorkerGlobal","WorkerMessageHandler","workerHandler","setup","cachedPort","loader","pdfjsWorker","factory","fontLoader","_params","destroyCapability","_networkStream","_fullReader","_lastProgress","setupMessageHandler","isOpList","modifiedIdsHash","cacheKeyBuf","page","terminated","sink","readyReason","headersCapability","fullReader","headersReady","isRangeSupported","contentLength","_numPages","htmlForXfa","exception","exportedData","exportedError","fontAdded","finally","imageRef","dataLen","imageData","pageProxy","cachedPromise","refStr","results","metadata","INITIAL_DATA","RenderTask","onContinue","form","operatorListIdx","running","graphicsReadyCallback","graphicsReady","_useRequestAnimationFrame","cancelled","_cancelBound","_continueBound","_continue","_scheduleNextBound","_scheduleNext","_nextBound","_next","StepperManager","init","getNextBreakPoint","gfx","cancelAnimationFrame","updateOperatorList","requestAnimationFrame","WeakSet","version","build","makeColorComp","scaleAndClamp","ColorConverters","G","components","CMYK_RGB","RGB_HTML","XfaLayer","html","storage","storedData","xfaOn","xfaOff","removeAttribute","checked","option","selected","selectedIndex","linkService","isHTMLAnchorElement","HTMLAnchorElement","addLinkAttributes","newWindow","dataId","setupStorage","root","xfaHtml","rootHtml","setAttributes","isNotForRichText","rootDiv","createTextNode","stack","childHtml","xmlns","querySelectorAll","hidden","DEFAULT_TAB_INDEX","GetElementsByNameSet","getRectDims","AnnotationElementFactory","annotationType","LinkAnnotationElement","TextAnnotationElement","fieldType","TextWidgetAnnotationElement","radioButton","RadioButtonWidgetAnnotationElement","checkBox","CheckboxWidgetAnnotationElement","PushButtonWidgetAnnotationElement","ChoiceWidgetAnnotationElement","SignatureWidgetAnnotationElement","WidgetAnnotationElement","PopupAnnotationElement","FreeTextAnnotationElement","LineAnnotationElement","SquareAnnotationElement","CircleAnnotationElement","PolylineAnnotationElement","CaretAnnotationElement","InkAnnotationElement","PolygonAnnotationElement","HighlightAnnotationElement","UnderlineAnnotationElement","SquigglyAnnotationElement","StrikeOutAnnotationElement","StampAnnotationElement","FileAttachmentAnnotationElement","AnnotationElement","isRenderable","ignoreBorder","createQuadrilaterals","downloadManager","imageResourcesPath","renderForms","svgFactory","enableScripting","_fieldObjects","fieldObjects","_createContainer","_createQuadrilaterals","isEditable","_hasPopupData","updateEdited","popup","resetEdited","popupRef","alternativeText","title","noRotate","setRotation","borderStyle","borderWidth","horizontalRadius","horizontalCornerRadius","verticalRadius","verticalCornerRadius","radius","borderRadius","borderBottomStyle","borderColor","normalizeRect","elementWidth","elementHeight","setColor","jsName","styleName","detail","colorType","colorArray","display","noView","noPrint","userName","readonly","required","_setRequired","textColor","_dispatchEventFromSandbox","actions","jsEvent","commonActions","_commonActions","_setDefaultPropertiesFromJS","quadPoints","rectBlX","rectBlY","rectTrX","rectTrY","trX","trY","blX","blY","svgBuffer","defs","clipPath","rectWidth","rectHeight","backgroundImage","_createPopup","titleObj","modificationDate","contentsObj","richText","parentRect","elements","_getElementsByName","skipId","fields","fieldObj","exportValues","exportValue","domElement","getElementsByName","maybeShow","forceHide","getElementsToTriggerPopup","addHighlightArea","triggers","_editOnDoubleClick","_isEditable","annotationEditorType","currentRect","isTooltipOnly","link","isBound","_bindNamedAction","attachment","attachmentDest","_bindLink","Action","_bindJSAction","resetForm","_bindResetFormAction","destination","getDestinationHash","onclick","goToDestination","getAnchorUrl","executeNamedAction","otherClickAction","resetFormFields","resetFormRefs","refs","include","allFields","fieldIds","fieldName","field","allIds","dispatchEvent","Event","description","openOrDownloadData","executeSetOCGState","hasPopupData","showElementAndHideCanvas","previousSibling","_getKeyModifier","_setEventListener","elementData","baseName","eventName","valueGetter","modifier","focused","_setEventListeners","getter","Blur","Focus","_setBackgroundColor","_setTextStyle","computedFontSize","fontColor","defaultAppearanceData","roundToOneDecimal","multiLine","textAlignment","textAlign","isRequired","hasAppearance","fieldValue","setPropertyOnSiblings","keyInStorage","maxLen","charLimit","fieldFormattedValues","formattedValue","comb","userValue","lastCommittedValue","commitKey","doNotScroll","overflowY","overflowX","readOnly","maxLength","defaultFieldValue","blurListener","scrollLeft","selRange","setSelectionRange","willCommit","selStart","selectionStart","selEnd","selectionEnd","_blurListener","Keystroke","inputType","change","combWidth","letterSpacing","verticalAlign","checkbox","curChecked","buttonValue","radio","pdfButtonValue","linkElement","selectElement","addAnEmptyEntry","combo","multiSelect","multiple","optionElement","displayValue","removeEmptyEntry","noneOptionElement","isExport","selectedValues","getItems","multipleSelection","index","findIndex","selectChild","indices","editable","changeEx","keyDown","PopupElement","elementIds","toDateObject","trigger","flatMap","baseColor","outlineColor","header","date","toLocaleDateString","toLocaleTimeString","contents","_formatContents","lines","line","popupContent","popupLines","lineAttributes","useParentRect","normalizedRect","popupLeft","popupTop","textPosition","lineSpan","lineCoordinates","square","circle","containerClassName","svgElementName","vertices","polyline","inkLists","inkList","AnnotationLayer","accessibilityManager","annotationEditorUIManager","_annotationEditorUIManager","hasEditableAnnotations","annotations","popupToElements","elementParams","noHTML","isPopupAnnotation","rendered","getEditableAnnotations","getEditableAnnotation","contentElement","moveElementInDOM","replaceWith","after","EOL_PATTERN","FreeTextEditor","editorDivBlur","editorDivFocus","editorDivInput","editorDivKeydown","editorDivPaste","_defaultColor","_defaultLineColor","_defaultFontSize","_translateEmpty","_internalPadding","overlayDiv","editorDiv","contentEditable","savedText","newText","trimEnd","setText","dblclick","baseX","baseY","posX","posY","deleteFromDocument","insertNode","collapseToStart","startContainer","startOffset","bufferBefore","bufferAfter","nodeValue","childNodes","newRange","beforeLength","reduce","acc","setStart","setEnd","removeAllRanges","addRange","isForCopying","padding","structTreeParentId","replaceChildren","setFontsize","savedFontsize","col","savedColor","savedDisplay","savedVisibility","_hasBeenMoved","Outliner","innerMargin","NUMBER_OF_DIGITS","EPSILON","right","shiftedMinX","shiftedMinY","lastEdge","lastPoint","edge","getOutlines","sort","outlineVerticalEdges","edges","allEdges","edge1","edge2","outline","outlines","lastPointX","lastPointY","HighlightOutline","middle","jj","y4","Outline","toSVGPath","_rotation","FreeHighlightOutline","polygon","prevX","prevY","FreeOutliner","scaleFactor","thickness","Float64Array","diffX","diffY","diffD","K","nY","thX","thY","bottom","lastTop","lastBottom","lastTopX","lastTopY","lastBottomX","lastBottomY","last","N","getNewOutline","outliner","ltrCallback","ColorPicker","swatch","renderMainDropdown","dropdown","_colorSelectFromKeyboard","_moveToNext","nextSibling","_moveToPrevious","_hideDropdownFromKeyboard","_moveToBeginning","_moveToEnd","role","HighlightEditor","_defaultThickness","_defaultOpacity","highlightId","highlightColorNames","toolbar","addUndoableEditor","mustBeSelected","drawLayer","updateBox","highlightDiv","pointerover","addClass","pointerleave","removeClass","_moveCaret","numberOfColors","pointerMove","pointerDownOptions","pointerDown","_freeHighlight","highlight","_freeHighlightId","_freeHighlightClipId","clipPathId","outlinerForOutline","highlightOutlines","finalizeLine","highlightOutline","updateLine","changeColor","savedThickness","setThickness","th","setPosition","Float32Array","updatePath","removeFreeHighlight","InkEditor","canvasPointermove","canvasPointerleave","canvasPointerup","canvasPointerdown","bezierPath2D","allRawPaths","currentPath","translationX","translationY","disconnect","setDimensions","addInkEditorIfNeeded","roundedWidth","roundedHeight","bezier","p10","p11","p20","p21","p30","p31","path2D","setOpacity","savedOpacity","opacityToHex","xy","lastPoints","bezierPoints","control1","control2","ResizeObserver","contentRect","observe","scaleFactorW","scaleFactorH","p40","p41","xMin","xMax","yMin","yMax","firstTime","prevTranslationX","prevTranslationY","unscaledPadding","StampEditor","bitmapUrl","bitmapFile","imageManager","bitmapId","altTextData","alt","stamps","area","prevData","supportedTypes","pasteEditor","getAsFile","fromId","getFromId","accept","supportedTypesStr","files","click","MAX_RATIO","factor","prevWidth","prevHeight","offscreen","transferToImageBitmap","isMLEnabledFor","isMLEnabled","mlGuess","service","channels","hcmFilter","toUrl","AnnotationEditorLayer","annotationLayer","editorTypes","_initialized","disableTextSelection","toggleAnnotationLayerPointerEvents","enableTextSelection","_editorType","isCommitting","annotationElementIds","changedAnnotations","resetAnnotations","attach","detach","removePointerInTextLayer","contentDiv","deleteAnnotationElement","telemetryInitialData","oldRotation","startHighlighting","innerWidth","innerHeight","DrawLayer","isPathUpdatable","free","_svgFactory","pathId","use","maskId","use1","use2","cloneNode","changeOpacity","clipPathUse","Point","getTime","Bezier","startPoint","endPoint","SignaturePad","opts","_strokeMoveUpdate","wait","previous","later","remaining","trailing","_strokeUpdate","_ctx","_handleMouseDown","which","_mouseButtonDown","_strokeBegin","_handleMouseMove","_handleMouseUp","_strokeEnd","_handleTouchStart","targetTouches","touch","changedTouches","_handleTouchMove","_handleTouchEnd","velocityFrom","distanceTo","pow","equals","px","py","cx","_point","cy","xdiff","ydiff","_data","_reset","_isEmpty","dataUrl","_this","_toSVG","_len","_key","_handleMouseEvents","_handleTouchEvents","_createPoint","lastPointGroup","isLastPointTooClose","_addPoint","curve","widths","_drawCurve","canDrawCurve","_drawDot","msTouchAction","touchAction","_lastVelocity","_lastWidth","unshift","_calculateCurveControlPoints","_calculateCurveWidths","s1","s2","s3","dx1","dy1","dx2","dy2","l1","l2","cm","velocity","_strokeWidth","_drawPoint","arc","startWidth","endWidth","widthDelta","drawSteps","uu","uuu","_fromData","pointGroups","drawCurve","drawDot","rawPoint","_addPoint2","_this2","setAttributeNS","attr","appendChild","innerHTML","dummy","nodes","_this3"],"sourceRoot":""}